"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[74846],{28453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>l});var a=t(96540);const o={},i=a.createContext(o);function c(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),a.createElement(i.Provider,{value:n},e.children)}},44905:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>a,toc:()=>r});var a=t(75417),o=t(74848),i=t(28453);const c={title:"\u4f7f\u7528JS\u5bf9\u7528\u6237\u9009\u62e9\u89c6\u9891\u8fdb\u884c\u622a\u56fe",author:"Alan",author_title:"Maintainer of blog",author_url:"https://github.com/alanwei43",author_image_url:"https://github.com/alanwei43.png",tags:["javascript","web"],description:"\u4f7f\u7528 JavaScript \u5bf9\u7528\u6237\u9009\u62e9\u89c6\u9891\u8fdb\u884c\u622a\u56fe",draft:!1,hide_table_of_contents:!1},l=void 0,s={authorsImageUrls:[void 0]},r=[{value:"\u601d\u8def\u6b65\u9aa4",id:"\u601d\u8def\u6b65\u9aa4",level:2},{value:"\u6e90\u7801",id:"\u6e90\u7801",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["\u4e3b\u8981\u53c2\u8003\u8d44\u6e90 ",(0,o.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Manipulating_video_using_canvas",children:"Manipulating video using canvas"})]}),"\n",(0,o.jsxs)(n.p,{children:["\u76f4\u63a5\u8bbf\u95ee ",(0,o.jsx)(n.a,{href:"https://blog.alanwei.com/demo/video.html",children:"\u622a\u56fe\u793a\u4f8b"})," \u5728\u7ebf\u67e5\u770b\u6548\u679c."]}),"\n",(0,o.jsx)(n.h2,{id:"\u601d\u8def\u6b65\u9aa4",children:"\u601d\u8def\u6b65\u9aa4"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\u76d1\u542c",(0,o.jsx)(n.code,{children:"input[type=file]"}),"\u7684",(0,o.jsx)(n.code,{children:"change"}),"\u4e8b\u4ef6, \u8bfb\u53d6 ",(0,o.jsx)(n.code,{children:"event.target.files"})," \u83b7\u5f97\u89c6\u9891\u6587\u4ef6 ",(0,o.jsx)(n.em,{children:"File"})]}),"\n",(0,o.jsxs)(n.li,{children:["\u4f7f\u7528 ",(0,o.jsx)(n.code,{children:"URL.createObjectURL(file)"})," \u521b\u5efa\u89c6\u9891\u6570\u636e"]}),"\n",(0,o.jsxs)(n.li,{children:["\u521b\u5efa ",(0,o.jsx)(n.code,{children:"video"})," \u5143\u7d20, \u89c6\u9891\u6e90\u4f7f\u7528\u4e0a\u9762\u521b\u5efa\u7684 object URL"]}),"\n",(0,o.jsxs)(n.li,{children:["\u4f7f\u7528 ",(0,o.jsx)(n.code,{children:'canvas.getContext("2d").drawImage'})," \u5c06\u89c6\u9891\u622a\u56fe\u7ed8\u753b\u5230 canvas \u5143\u7d20\u4e0a"]}),"\n",(0,o.jsxs)(n.li,{children:["\u8c03\u7528 ",(0,o.jsx)(n.code,{children:"canvas.toDataURL"})," \u8f6c\u6210base64\u56fe\u6807\u6570\u636e, \u4f9b ",(0,o.jsx)(n.code,{children:"<img />"})," \u5c55\u793a"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"\u6e90\u7801",children:"\u6e90\u7801"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-html",metastring:'title="video.html"',children:'<!DOCTYPE html>\n<html lang="en">\n\n<head>\n  <meta charset="UTF-8">\n  <meta http-equiv="X-UA-Compatible" content="IE=edge">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>\u89c6\u9891\u622a\u56fe</title>\n</head>\n\n<body>\n  <div>\n    <label>\n      \u8bf7\u5148\u9009\u62e9\u89c6\u9891: <input type="file" accept="video/*" />\n    </label>\n    <button>\u70b9\u6b64\u622a\u5c4f</button>\n  </div>\n  <div>\n    <h3>Canvas \u622a\u56fe</h3>\n    <canvas id="screenshot" style="width: 200px; height: 200px;"></canvas>\n  </div>\n  <div>\n    <h3>\u56fe\u7247\u622a\u56fe</h3>\n    <img />\n  </div>\n  <script src="./video.js"><\/script>\n</body>\n</html>\n'})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",metastring:'title="video.js"',children:'document.querySelector("input[type=file]").addEventListener("change", e => {\n  /**\n   * \u6dfb\u52a0\u89c6\u9891\n   */\n  const video = e.target.files[0];\n\n  const ele = document.createElement("video");\n  ele.controls = true;\n  ele.style.height = "200px";\n  ele.style.width = "200px";\n  const source = document.createElement("source");\n  source.src = URL.createObjectURL(video);\n  source.type = video.type;\n  ele.appendChild(source);\n\n  document.body.append(ele);\n});\n\ndocument.querySelector("button").addEventListener("click", () => {\n  /**\n   * \u622a\u56fe\n   */\n  const video = document.querySelector("video");\n  const canvas = document.getElementById("screenshot");\n  const ctx = canvas.getContext("2d");\n  ctx.drawImage(video, 0, 0, 200, 200);\n  const imgData = canvas.toDataURL();\n  document.querySelector("img").src = imgData;\n});\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"\u6216\u8005\u9009\u4e2d\u6587\u4ef6\u81ea\u52a8\u622a\u5c4f"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:'document.querySelector("input[type=file]").addEventListener("change", e => {\n  /**\n   * \u6dfb\u52a0\u89c6\u9891\n   */\n  const video = e.target.files[0];\n  readVideoAlbum({\n    video: video,\n  }).then(img => document.querySelector("img").src = img);\n});\n\n\n/**\n * \n * @param {{video: File}} params \n */\nfunction readVideoAlbum(params) {\n  return new Promise((resolve, reject) => {\n    const eleVideo = document.createElement("video");\n    eleVideo.style.display = "none";\n    eleVideo.controls = true;\n    eleVideo.autoplay = false;\n    eleVideo.muted = true;\n    eleVideo.playsInline = true;\n    eleVideo.style.height = "auto";\n    eleVideo.style.width = "auto";\n    const source = document.createElement("source");\n    source.src = URL.createObjectURL(params.video);\n    source.type = params.video.type;\n    eleVideo.appendChild(source);\n    document.body.append(eleVideo);\n    let canvas;\n    eleVideo.play()\n      .then(() => {\n        canvas = document.createElement("canvas");\n        canvas.width = eleVideo.videoWidth;\n        canvas.height = eleVideo.videoHeight;\n        canvas.style.display = "none";\n        document.body.append(canvas);\n        const ctx = canvas.getContext("2d");\n        if (!ctx) {\n          throw new Error("canvas.getContext \u5f02\u5e38");\n        }\n        ctx.drawImage(eleVideo, 0, 0, eleVideo.videoWidth, eleVideo.videoHeight);\n        const base64 = canvas.toDataURL();\n        resolve(base64);\n        eleVideo.pause();\n      })\n      .catch(err => reject(err))\n      .then(() => {\n        setTimeout(() => {\n          /**\n           * \u9500\u6bc1\u521b\u5efa\u7684\u5143\u7d20\n           */\n          canvas && document.body.removeChild(canvas);\n          document.body.removeChild(eleVideo);\n        }, 500);\n      });\n  });\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},75417:e=>{e.exports=JSON.parse('{"permalink":"/blog/2022/05/11/javascript-video-screenshot","editUrl":"https://github.com/alanwei43/blog/tree/master/src/blog/2022/05/11-javascript-video-screenshot.md","source":"@site/src/blog/2022/05/11-javascript-video-screenshot.md","title":"\u4f7f\u7528JS\u5bf9\u7528\u6237\u9009\u62e9\u89c6\u9891\u8fdb\u884c\u622a\u56fe","description":"\u4f7f\u7528 JavaScript \u5bf9\u7528\u6237\u9009\u62e9\u89c6\u9891\u8fdb\u884c\u622a\u56fe","date":"2022-05-11T00:00:00.000Z","tags":[{"inline":true,"label":"javascript","permalink":"/blog/tags/javascript"},{"inline":true,"label":"web","permalink":"/blog/tags/web"}],"readingTime":2.085,"hasTruncateMarker":true,"authors":[{"name":"Alan","title":"Maintainer of blog","url":"https://github.com/alanwei43","imageURL":"https://github.com/alanwei43.png","key":null,"page":null}],"frontMatter":{"title":"\u4f7f\u7528JS\u5bf9\u7528\u6237\u9009\u62e9\u89c6\u9891\u8fdb\u884c\u622a\u56fe","author":"Alan","author_title":"Maintainer of blog","author_url":"https://github.com/alanwei43","author_image_url":"https://github.com/alanwei43.png","tags":["javascript","web"],"description":"\u4f7f\u7528 JavaScript \u5bf9\u7528\u6237\u9009\u62e9\u89c6\u9891\u8fdb\u884c\u622a\u56fe","draft":false,"hide_table_of_contents":false},"unlisted":false,"prevItem":{"title":"\u5f00\u653e docker daemon TCP \u7aef\u53e3\u53f7 2375","permalink":"/blog/2022/05/14/docker-daemon-tcp-port"},"nextItem":{"title":"\u89e3\u51b3 IDEA \u6253\u5f00Java\u9879\u76ee\u63d0\u793a Cannot resolve symbol \u95ee\u9898","permalink":"/blog/2022/05/08/idea-cannot-resolve-symbol"}}')}}]);