"use strict";(self.webpackChunkalan_blog=self.webpackChunkalan_blog||[]).push([[31504],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,p=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=s(n),m=o,h=u["".concat(p,".").concat(m)]||u[m]||c[m]||i;return n?a.createElement(h,r(r({ref:t},d),{},{components:n})):a.createElement(h,r({ref:t},d))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=u;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:o,r[1]=l;for(var s=2;s<i;s++)r[s]=n[s];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},20478:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>r,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>s});var a=n(87462),o=(n(67294),n(3905));const i={tags:["chrome","javascript","web","touch event","touch-action","passive"]},r="Chrome TouchEvent passive \u53c2\u6570\u4ecb\u7ecd",l={permalink:"/blog/2023/07/28/chrome-touchevent-passive",editUrl:"https://github.com/alanwei43/blog/tree/master/src/blog/2023/07/28-chrome-touchevent-passive.md",source:"@site/src/blog/2023/07/28-chrome-touchevent-passive.md",title:"Chrome TouchEvent passive \u53c2\u6570\u4ecb\u7ecd",description:"\u5728 Chrome \u6d4f\u89c8\u5668\u4e2d\u4f7f\u7528\u4ee5\u4e0b\u4ee3\u7801:",date:"2023-07-28T00:00:00.000Z",formattedDate:"July 28, 2023",tags:[{label:"chrome",permalink:"/blog/tags/chrome"},{label:"javascript",permalink:"/blog/tags/javascript"},{label:"web",permalink:"/blog/tags/web"},{label:"touch event",permalink:"/blog/tags/touch-event"},{label:"touch-action",permalink:"/blog/tags/touch-action"},{label:"passive",permalink:"/blog/tags/passive"}],readingTime:14.9,hasTruncateMarker:!0,authors:[],frontMatter:{tags:["chrome","javascript","web","touch event","touch-action","passive"]},prevItem:{title:"VSCode \u5386\u53f2\u7248\u672c\u4e0b\u8f7d",permalink:"/blog/2023/08/06/vscode-previous-release-versions-download"},nextItem:{title:"macOS \u7cfb\u7edf\u5fae\u4fe1\u804a\u5929\u8bb0\u5f55\u5907\u4efd\u76ee\u5f55",permalink:"/blog/2023/06/23/macos-wechat-backup-location"}},p={authorsImageUrls:[]},s=[{value:"\u539f\u56e0",id:"\u539f\u56e0",level:2},{value:"\u53c2\u8003\u8d44\u6599",id:"\u53c2\u8003\u8d44\u6599",level:2},{value:"Making touch scrolling fast by default",id:"making-touch-scrolling-fast-by-default",level:2},{value:"Background: Cancelable Events slow your page down",id:"background-cancelable-events-slow-your-page-down",level:3},{value:"The Intervention",id:"the-intervention",level:3},{value:"Breakage and Guidance",id:"breakage-and-guidance",level:3},{value:"Conclusion",id:"conclusion",level:4}],d={toc:s};function c(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"\u5728 Chrome \u6d4f\u89c8\u5668\u4e2d\u4f7f\u7528\u4ee5\u4e0b\u4ee3\u7801:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'document.body.addEventListener("touchmove", (e) => {\n    console.log(e);\n})\n')),(0,o.kt)("p",null,"\u4f1a\u5728\u63a7\u5236\u53f0\u770b\u5230\u4e00\u4e2a\u8b66\u544a\u4fe1\u606f:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"[Violation] Added non-passive event listener to a scroll-blocking 'touchmove' event. Consider marking event handler as 'passive' to make the page more responsive. See https://www.chromestatus.com/feature/5745543795965952\n")),(0,o.kt)("p",null,"\u89e3\u51b3\u529e\u6cd5\u5c31\u662f\u4f20\u9012\u7b2c\u4e09\u4e2a\u53c2\u6570, \u663e\u5f0f\u8bbe\u7f6e ",(0,o.kt)("inlineCode",{parentName:"p"},"passive")," \u7684\u503c. \u5927\u591a\u6570\u60c5\u51b5\u4e0b, \u662f\u76f4\u63a5\u5728 ",(0,o.kt)("inlineCode",{parentName:"p"},"addEventListener")," \u51fd\u6570\u7684\u7b2c\u4e09\u4e2a\u53c2\u6570\u4f20\u9012 ",(0,o.kt)("inlineCode",{parentName:"p"},"{ passive: true }"),"."),(0,o.kt)("h2",{id:"\u539f\u56e0"},"\u539f\u56e0"),(0,o.kt)("p",null,"\u4ea7\u751f\u8fd9\u4e2a\u8b66\u544a\u7684\u539f\u56e0\u662f, \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5728 ",(0,o.kt)("inlineCode",{parentName:"p"},"touchstart")," \u548c \u7b2c\u4e00\u4e2a",(0,o.kt)("inlineCode",{parentName:"p"},"touchmove")," \u4e8b\u4ef6\u7684\u56de\u8c03\u51fd\u6570\u4e2d\u53ef\u4ee5\u901a\u8fc7\u8c03\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"event.preventDefault()")," \u6765\u963b\u6b62\u9875\u9762\u89e6\u6478\u6eda\u52a8(Chrome 56 \u4e4b\u524d\u7248\u672c), \u4e3a\u4e86\u652f\u6301\u8fd9\u79cd\u4e8b\u4ef6\u884c\u4e3a, \u9ed8\u8ba4\u60c5\u51b5\u4e0b, \u9875\u9762\u7684\u89e6\u6478\u6eda\u52a8\u5c31\u8981\u7b49\u5f85\u7b2c\u4e00\u4e2a ",(0,o.kt)("inlineCode",{parentName:"p"},"touchmove")," \u4e8b\u4ef6\u7ed3\u675f\u540e\u624d\u53ef\u4ee5\u6eda\u52a8, \u8fd9\u4f1a\u5bfc\u81f4\u4e25\u91cd\u7684\u6eda\u52a8\u6027\u80fd\u95ee\u9898. "),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"\u6ce8\u610f\u5728 Chrome 56 \u7248\u672c\u4e4b\u524d, ",(0,o.kt)("inlineCode",{parentName:"p"},"passive")," \u9ed8\u8ba4\u4e3a ",(0,o.kt)("inlineCode",{parentName:"p"},"false"),". \u4e3a\u4e86\u7528\u6237\u4f53\u9a8c, \u5728\u4e4b\u540e\u7248\u672c\u4e2d\u9ed8\u8ba4 ",(0,o.kt)("inlineCode",{parentName:"p"},"true"),".")),(0,o.kt)("p",null,"\u4e3a\u4e86\u89e3\u51b3\u8be5\u95ee\u9898, ",(0,o.kt)("inlineCode",{parentName:"p"},"addEventListenner")," \u7b2c\u4e09\u4e2a\u53c2\u6570 \u5f15\u5165\u4e86 ",(0,o.kt)("inlineCode",{parentName:"p"},"passive")," \u9009\u9879: "),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u5982\u679c\u8bbe\u7f6e\u4e86 ",(0,o.kt)("inlineCode",{parentName:"li"},"passive: true"),", \u5219\u9875\u9762\u89e6\u6478\u6eda\u52a8\u5c31\u4e0d\u9700\u8981\u7b49\u5f85\u7b2c\u4e00\u4e2a",(0,o.kt)("inlineCode",{parentName:"li"},"touchmove")," \u4e8b\u4ef6\u7ed3\u675f, \u4e5f\u610f\u5473\u7740 ",(0,o.kt)("inlineCode",{parentName:"li"},"event.preventDefault()")," \u65b9\u6cd5\u4e0d\u4f1a\u8d77\u4f5c\u7528."),(0,o.kt)("li",{parentName:"ul"},"\u5982\u679c\u8bbe\u7f6e\u4e86 ",(0,o.kt)("inlineCode",{parentName:"li"},"passive: false"),", \u4e0d\u7ba1\u662f\u5426\u9700\u8981\u8c03\u7528 ",(0,o.kt)("inlineCode",{parentName:"li"},"e.preventDefault()")," \u6765\u963b\u6b62\u9875\u9762\u6eda\u52a8\uff0c\u90fd\u9700\u8981\u7b49\u5230\u7b2c\u4e00\u4e2a ",(0,o.kt)("inlineCode",{parentName:"li"},"touchmove")," \u51fd\u6570\u6267\u884c\u5b8c\u6bd5\uff0c\u9875\u9762\u624d\u4f1a\u505a\u51fa\u53cd\u5e94, \u4e5f\u5c31\u53ef\u4ee5\u5728 ",(0,o.kt)("inlineCode",{parentName:"li"},"touchmove"),"\u4e8b\u4ef6\u56de\u8c03\u51fd\u6570\u5185\u8c03\u7528",(0,o.kt)("inlineCode",{parentName:"li"},"event.preventDefault()"),"\u6765\u963b\u6b62\u9875\u9762\u6eda\u52a8.")),(0,o.kt)("admonition",{type:"warning"},(0,o.kt)("p",{parentName:"admonition"},"\u6ce8\u610f\u5b98\u65b9\u4e0d\u5efa\u8bae\u4f7f\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"{ passtive: false }")," + ",(0,o.kt)("inlineCode",{parentName:"p"},"event.preventDefault()")," \u7684\u65b9\u5f0f\u963b\u6b62\u6eda\u52a8, \u5982\u679c\u5b9e\u9645\u9700\u6c42\u4e2d\u9700\u8981\u963b\u6b62\u89e6\u6478\u6eda\u52a8, \u4f7f\u7528CSS\u6837\u5f0f ",(0,o.kt)("inlineCode",{parentName:"p"},"touch-action: none")," \u6216\u8005 ",(0,o.kt)("inlineCode",{parentName:"p"},"touch-action: pan-y pinch-zoom"),"(\u6c34\u5e73\u6eda\u52a8) \u6765\u963b\u6b62\u89e6\u6478\u6eda\u52a8:"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-css"},"/* \u7981\u6b62\u6eda\u52a8\u548c\u7f29\u653e */\nelement {\n  touch-action: none;\n}\n\n/* \u53ea\u5141\u8bb8\u5782\u76f4\u6eda\u52a8 */\nelement {\n  touch-action: pan-y;\n}\n\n/* \u53ea\u5141\u8bb8\u6c34\u5e73\u6eda\u52a8 */\nelement {\n  touch-action: pan-x;\n}\n\n/* \u542f\u7528\u5782\u76f4\u6eda\u52a8\u548c\u7f29\u653e */\nelement {\n  touch-action: pan-y pinch-zoom;\n}\n"))),(0,o.kt)("h2",{id:"\u53c2\u8003\u8d44\u6599"},"\u53c2\u8003\u8d44\u6599"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://zhuanlan.zhihu.com/p/76805949"},"Touchmove \u7981\u6b62\u9ed8\u8ba4\u6eda\u52a8\u7684\u51e0\u79cd\u65b9\u6848")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://developer.chrome.com/blog/scrolling-intervention/"},"Making touch scrolling fast by default"))),(0,o.kt)("h2",{id:"making-touch-scrolling-fast-by-default"},"Making touch scrolling fast by default"),(0,o.kt)("p",null,"We know that scrolling responsiveness is critical to the user's engagement with a website on mobile, yet touch event listeners often cause serious scrolling performance problems. Chrome has been addressing this by allowing touch event listeners to be passive (passing the ",(0,o.kt)("inlineCode",{parentName:"p"},"{passive: true}")," option to ",(0,o.kt)("inlineCode",{parentName:"p"},"addEventListener()"),") and shipping the pointer events API. These are great features to drive new content into models that don't block scrolling, but developers sometimes find them hard to understand and adopt.\n\u6211\u4eec\u77e5\u9053\uff0c\u5728\u79fb\u52a8\u8bbe\u5907\u4e0a\uff0c\u6eda\u52a8\u54cd\u5e94\u5bf9\u7528\u6237\u4e0e\u7f51\u7ad9\u7684\u4e92\u52a8\u81f3\u5173\u91cd\u8981\uff0c\u7136\u800c\u89e6\u6478\u4e8b\u4ef6\u76d1\u542c\u5668\u5e38\u5e38\u5bfc\u81f4\u4e25\u91cd\u7684\u6eda\u52a8\u6027\u80fd\u95ee\u9898\u3002Chrome \u901a\u8fc7\u5141\u8bb8\u89e6\u6478\u4e8b\u4ef6\u76d1\u542c\u5668\u53d8\u4e3a\u88ab\u52a8\uff08\u5c06 ",(0,o.kt)("inlineCode",{parentName:"p"},"{passive: true}")," \u9009\u9879\u4f20\u9012\u7ed9 ",(0,o.kt)("inlineCode",{parentName:"p"},"addEventListener()"),"\uff09\u5e76\u5b9e\u73b0\u6307\u9488\u4e8b\u4ef6 API \u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\u8fd9\u4e9b\u529f\u80fd\u5bf9\u4e8e\u5f15\u5bfc\u65b0\u5185\u5bb9\u5230\u4e0d\u963b\u585e\u6eda\u52a8\u7684\u6a21\u578b\u6765\u8bf4\u975e\u5e38\u6709\u7528\uff0c\u4f46\u5f00\u53d1\u8005\u6709\u65f6\u4f1a\u89c9\u5f97\u5b83\u4eec\u96be\u4ee5\u7406\u89e3\u548c\u91c7\u7eb3\u3002"),(0,o.kt)("p",null,"We believe the web should be fast by default without developers needing to understand arcane details of browser behavior. In Chrome 56 we are defaulting touch listeners to passive by default in cases where that most often matches the developer's intention. We believe that by doing this we can greatly improve the user's experience whilst having minimal negative impact on sites.\n\u6211\u4eec\u76f8\u4fe1\uff0c\u7f51\u7edc\u5e94\u8be5\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5c31\u5f88\u5feb\uff0c\u800c\u65e0\u9700\u5f00\u53d1\u8005\u4e86\u89e3\u6d4f\u89c8\u5668\u884c\u4e3a\u7684\u5965\u79d8\u3002\u5728 Chrome 56 \u4e2d\uff0c\u6211\u4eec\u5c06\u89e6\u6478\u76d1\u542c\u5668\u9ed8\u8ba4\u4e3a\u88ab\u52a8\u7684\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5b83\u901a\u5e38\u4e0e\u5f00\u53d1\u8005\u7684\u610f\u56fe\u76f8\u5339\u914d\u3002\u6211\u4eec\u76f8\u4fe1\uff0c\u901a\u8fc7\u8fd9\u6837\u505a\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u5bf9\u7f51\u7ad9\u7684\u8d1f\u9762\u5f71\u54cd\u6700\u5c0f\u7684\u60c5\u51b5\u4e0b\uff0c\u6781\u5927\u5730\u63d0\u9ad8\u7528\u6237\u7684\u4f53\u9a8c\u3002"),(0,o.kt)("p",null,"In rare cases this change can result in unintended scrolling. This is usually easily addressed by applying a ",(0,o.kt)("inlineCode",{parentName:"p"},"touch-action: none")," style to the element where scrolling shouldn't occur. Read on for details, how to know if you are impacted, and what you can do about it.\n\u5728\u6781\u5c11\u6570\u60c5\u51b5\u4e0b\uff0c\u8fd9\u79cd\u53d8\u5316\u53ef\u80fd\u5bfc\u81f4\u610f\u5916\u7684\u6eda\u52a8\u3002\u901a\u5e38\u901a\u8fc7\u5c06 ",(0,o.kt)("inlineCode",{parentName:"p"},"touch-action: none")," \u6837\u5f0f\u5e94\u7528\u4e8e\u4e0d\u5e94\u53d1\u751f\u6eda\u52a8\u7684\u5143\u7d20\uff0c\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\u8bf7\u7ee7\u7eed\u9605\u8bfb\u4e86\u89e3\u8be6\u7ec6\u4fe1\u606f\uff0c\u4e86\u89e3\u60a8\u662f\u5426\u53d7\u5230\u5f71\u54cd\uff0c\u4ee5\u53ca\u60a8\u53ef\u4ee5\u91c7\u53d6\u54ea\u4e9b\u63aa\u65bd\u3002"),(0,o.kt)("h3",{id:"background-cancelable-events-slow-your-page-down"},"Background: Cancelable Events slow your page down"),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"\u80cc\u666f: \u53ef\u53d6\u6d88\u4e8b\u4ef6\u4f1a\u8ba9\u4f60\u7684\u9875\u9762\u53d8\u6162")),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"\u8fd9\u91cc\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"Cancelable Events")," \u662f\u6307\u4f7f\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"event.preventDefault()")," \u65b9\u6cd5\u963b\u6b62 touch \u4e8b\u4ef6\u963b\u6b62\u9875\u9762\u6eda\u52a8.")),(0,o.kt)("p",null,"If you call ",(0,o.kt)("inlineCode",{parentName:"p"},"preventDefault()")," in the ",(0,o.kt)("inlineCode",{parentName:"p"},"touchstart")," or first ",(0,o.kt)("inlineCode",{parentName:"p"},"touchmove")," events then you will prevent scrolling. The problem is that most often listeners will not call ",(0,o.kt)("inlineCode",{parentName:"p"},"preventDefault()"),', but the browser needs to wait for the event to finish to be sure of that. Developer-defined "passive event listeners" solve this. When you add a touch event with a {passive: true} object as the third parameter in your event handler then you are telling the browser that the touchstart listener will not call preventDefault() and the browser can safely perform the scroll without blocking on the listener. For example:\n\u5982\u679c\u60a8\u5728 ',(0,o.kt)("inlineCode",{parentName:"p"},"touchstart")," \u6216\u7b2c\u4e00\u4e2a ",(0,o.kt)("inlineCode",{parentName:"p"},"touchmove")," \u4e8b\u4ef6\u4e2d\u8c03\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"preventDefault()"),"\uff0c\u90a3\u4e48\u60a8\u5c06\u963b\u6b62\u6eda\u52a8\u3002\u95ee\u9898\u5728\u4e8e\uff0c\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u76d1\u542c\u5668(\u4e8b\u4ef6\u56de\u8c03\u51fd\u6570)\u4e0d\u4f1a\u8c03\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"preventDefault()"),"\uff0c\u4f46\u6d4f\u89c8\u5668\u9700\u8981\u7b49\u5f85\u4e8b\u4ef6\u7ed3\u675f\u624d\u80fd\u786e\u4fdd\u8fd9\u4e00\u70b9\u3002\u5f00\u53d1\u8005\u5b9a\u4e49\u7684 ",(0,o.kt)("em",{parentName:"p"},"passive event listeners")," \u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002\u5f53\u60a8\u5728\u4e8b\u4ef6\u5904\u7406\u7a0b\u5e8f\u4e2d\u5c06 ",(0,o.kt)("inlineCode",{parentName:"p"},"{passive: true}")," \u5bf9\u8c61\u4f5c\u4e3a\u7b2c\u4e09\u4e2a\u53c2\u6570\u6dfb\u52a0\u89e6\u6478\u4e8b\u4ef6\u65f6\uff0c\u60a8\u5c31\u544a\u8bc9\u6d4f\u89c8\u5668 ",(0,o.kt)("inlineCode",{parentName:"p"},"touchstart")," \u76d1\u542c\u5668\u4e0d\u4f1a\u8c03\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"preventDefault()"),"\uff0c\u6d4f\u89c8\u5668\u53ef\u4ee5\u5728\u4e0d\u963b\u585e\u76d1\u542c\u5668\u7684\u60c5\u51b5\u4e0b\u5b89\u5168\u5730\u6267\u884c\u6eda\u52a8\u3002\u4f8b\u5982\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'window.addEventListener("touchstart", func, { passive: true });\n')),(0,o.kt)("h3",{id:"the-intervention"},"The Intervention"),(0,o.kt)("p",null,"Our main motivation is to reduce the time it takes to update the display after the user touches the screen. To understand the usage of ",(0,o.kt)("inlineCode",{parentName:"p"},"touchstart")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"touchmove")," we added metrics to determine how frequently scroll blocking behavior occurred.\n\u6211\u4eec\u7684\u4e3b\u8981\u52a8\u673a\u662f\u51cf\u5c11\u7528\u6237\u89e6\u6478\u5c4f\u5e55\u540e\u66f4\u65b0\u663e\u793a\u6240\u9700\u7684\u65f6\u95f4\u3002\u4e3a\u4e86\u7406\u89e3 ",(0,o.kt)("inlineCode",{parentName:"p"},"touchstart")," \u548c ",(0,o.kt)("inlineCode",{parentName:"p"},"touchmove")," \u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u6211\u4eec\u6dfb\u52a0\u4e86\u6307\u6807\u6765\u786e\u5b9a\u6eda\u52a8\u963b\u585e\u884c\u4e3a\u53d1\u751f\u7684\u9891\u7387\u3002"),(0,o.kt)("p",null,"We looked at the percentage of cancelable touch events that were sent to a root target (",(0,o.kt)("inlineCode",{parentName:"p"},"window"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"document"),", or ",(0,o.kt)("inlineCode",{parentName:"p"},"body"),') and determined that about 80% of these listeners are conceptually passive but were not registered as such. Given the scale of this problem we noticed a great opportunity to improve scrolling without any developer action by making these events automatically "passive".\n\u6211\u4eec\u67e5\u770b\u4e86\u53d1\u9001\u5230\u6839\u8282\u70b9\uff08',(0,o.kt)("inlineCode",{parentName:"p"},"window"),"\u3001",(0,o.kt)("inlineCode",{parentName:"p"},"document"),"\u6216",(0,o.kt)("inlineCode",{parentName:"p"},"body"),"\uff09\u7684\u53ef\u53d6\u6d88\u89e6\u6478\u4e8b\u4ef6\u7684\u767e\u5206\u6bd4\uff0c\u5e76\u786e\u5b9a\u4e86\u5927\u7ea6 80% \u7684\u8fd9\u4e9b\u76d1\u542c\u5668\u5728\u6982\u5ff5\u4e0a\u662f\u88ab\u52a8\u7684\uff0c\u4f46\u5e76\u672a\u4f5c\u4e3a\u6b64\u7c7b\u8fdb\u884c\u6ce8\u518c\u3002\u9274\u4e8e\u8fd9\u4e2a\u95ee\u9898\u7684\u89c4\u6a21\uff0c\u6211\u4eec\u53d1\u73b0\u4e86\u4e00\u4e2a\u5f88\u597d\u7684\u673a\u4f1a\u6765\u6539\u8fdb\u6eda\u52a8\uff0c\u800c\u65e0\u9700\u4efb\u4f55\u5f00\u53d1\u8005\u64cd\u4f5c\uff0c\u90a3\u5c31\u662f\u901a\u8fc7\u81ea\u52a8\u5c06\u8fd9\u4e9b\u4e8b\u4ef6\u53d8\u4e3a\u201c\u88ab\u52a8\u201d\u3002"),(0,o.kt)("p",null,"This drove us to define our intervention as: if the target of a ",(0,o.kt)("inlineCode",{parentName:"p"},"touchstart")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"touchmove")," listener is the ",(0,o.kt)("inlineCode",{parentName:"p"},"window"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"document")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"body")," we default ",(0,o.kt)("inlineCode",{parentName:"p"},"passive")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"true"),". This means that code like:\n\u8fd9\u4f7f\u6211\u4eec\u5c06\u5e72\u9884\u5b9a\u4e49\u4e3a\uff1a\u5982\u679c ",(0,o.kt)("inlineCode",{parentName:"p"},"touchstart")," \u6216 ",(0,o.kt)("inlineCode",{parentName:"p"},"touchmove")," \u76d1\u542c\u5668\u7684\u76ee\u6807\u662f",(0,o.kt)("inlineCode",{parentName:"p"},"window"),"\u3001",(0,o.kt)("inlineCode",{parentName:"p"},"document"),"\u6216",(0,o.kt)("inlineCode",{parentName:"p"},"body"),"\uff0c\u6211\u4eec\u5c06",(0,o.kt)("inlineCode",{parentName:"p"},"passive"),"\u5c5e\u6027\u9ed8\u8ba4\u8bbe\u7f6e\u4e3a ",(0,o.kt)("inlineCode",{parentName:"p"},"true"),"\u3002\u8fd9\u610f\u5473\u7740\u50cf\u8fd9\u6837\u7684\u4ee3\u7801\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'window.addEventListener("touchstart", func);\n')),(0,o.kt)("p",null,"becomes equivalent to:\n\u7b49\u4ef7\u4e8e: "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'window.addEventListener("touchstart", func, {passive: true} );\n')),(0,o.kt)("p",null,"Now calls to ",(0,o.kt)("inlineCode",{parentName:"p"},"preventDefault()")," inside the listener will be ignored.\n\u73b0\u5728\u5728\u4e8b\u4ef6\u76d1\u542c\u5668\u4e2d\u8c03\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"preventDefault()")," \u5c06\u4f1a\u88ab\u5ffd\u7565."),(0,o.kt)("h3",{id:"breakage-and-guidance"},"Breakage and Guidance"),(0,o.kt)("p",null,"In the vast majority of cases, no breakage will be observed. But when breakage does occur, the most common symptom is that scrolling happens when you don't want it. In rare cases, developers may also notice unexpected click events (when ",(0,o.kt)("inlineCode",{parentName:"p"},"preventDefault()")," was missing from a ",(0,o.kt)("inlineCode",{parentName:"p"},"touchend")," listener).\n\u5728\u7edd\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u8be5\u9ed8\u8ba4\u884c\u4e3a\u7684\u53d8\u5316(\u6307Chrome 56 \u4ece ",(0,o.kt)("inlineCode",{parentName:"p"},"{passive: false}")," \u53d8\u6210\u4e86 ",(0,o.kt)("inlineCode",{parentName:"p"},"{passive: true}")," \u5bfc\u81f4 ",(0,o.kt)("inlineCode",{parentName:"p"},"touchmove")," \u4e8b\u4ef6\u76d1\u542c\u5668\u4e2d\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"event.preventDefault()")," \u4e0d\u518d\u8d77\u4f5c\u7528)\u4e0d\u4f1a\u51fa\u73b0\u95ee\u9898\u3002\u4f46\u5f53\u95ee\u9898\u786e\u5b9e\u53d1\u751f\u65f6\uff0c\u6700\u5e38\u89c1\u7684\u75c7\u72b6\u662f\u5728\u60a8\u4e0d\u5e0c\u671b\u6eda\u52a8\u65f6\u53d1\u751f\u6eda\u52a8\u3002\u5728\u6781\u5c11\u6570\u60c5\u51b5\u4e0b\uff0c\u5f00\u53d1\u8005\u53ef\u80fd\u8fd8\u4f1a\u6ce8\u610f\u5230\u610f\u5916\u7684\u70b9\u51fb\u4e8b\u4ef6\uff08\u5f53 ",(0,o.kt)("inlineCode",{parentName:"p"},"touchend")," \u76d1\u542c\u5668\u4e2d\u7f3a\u5c11 ",(0,o.kt)("inlineCode",{parentName:"p"},"preventDefault()"),") \u65f6\uff09\u3002"),(0,o.kt)("p",null,"In Chrome 56 and later, DevTools will log a warning when you call ",(0,o.kt)("inlineCode",{parentName:"p"},"preventDefault()")," in an event where the intervention is active.\n\u5728 Chrome 56 \u53ca\u66f4\u9ad8\u7248\u672c\u4e2d\uff0c\u5f53\u60a8\u5728\u542f\u7528\u5e72\u9884\u7684\u4e8b\u4ef6\u4e2d\u8c03\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"preventDefault()")," \u65f6\uff0cDevTools \u5c06\u6253\u5370\u4e00\u4e2a\u8b66\u544a\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"touch-passive.html:19 Unable to preventDefault inside passive event listener due to target being treated as passive. See https://www.chromestatus.com/features/5093566007214080\n")),(0,o.kt)("p",null,"Your application can determine whether it may be hitting this in the wild by checking if calling ",(0,o.kt)("inlineCode",{parentName:"p"},"preventDefault")," had any effect via the ",(0,o.kt)("inlineCode",{parentName:"p"},"defaultPrevented")," property.\n\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u901a\u8fc7\u68c0\u67e5\u8c03\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"preventDefault")," \u662f\u5426\u5bf9 ",(0,o.kt)("inlineCode",{parentName:"p"},"defaultPrevented")," \u5c5e\u6027\u4ea7\u751f\u4e86\u4efb\u4f55\u5f71\u54cd\u6765\u5224\u65ad\u5b83\u662f\u5426\u5728\u5b9e\u9645\u573a\u666f\u4e2d\u9047\u5230\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002"),(0,o.kt)("p",null,"We've found that a large majority of impacted pages are fixed relatively easily by applying the ",(0,o.kt)("inlineCode",{parentName:"p"},"touch-action")," CSS property whenever possible. If you wish to prevent all browser scrolling and zooming within an element apply ",(0,o.kt)("inlineCode",{parentName:"p"},"touch-action: none")," to it. If you have a horizontal carousel consider applying ",(0,o.kt)("inlineCode",{parentName:"p"},"touch-action: pan-y pinch-zoom")," to it so that the user can still scroll vertically and zoom as normal. Applying ",(0,o.kt)("inlineCode",{parentName:"p"},"touch-action")," correctly is already necessary on browsers such as desktop Edge that support Pointer Events and not Touch Events. For mobile Safari and older mobile browsers that don't support ",(0,o.kt)("inlineCode",{parentName:"p"},"touch-action")," your touch listeners must continue calling ",(0,o.kt)("inlineCode",{parentName:"p"},"preventDefault")," even when it will be ignored by Chrome.\n\u6211\u4eec\u53d1\u73b0\uff0c\u7edd\u5927\u591a\u6570\u53d7\u5f71\u54cd\u7684\u9875\u9762\u901a\u8fc7\u5c3d\u53ef\u80fd\u5e94\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"touch-action")," CSS \u5c5e\u6027\u53ef\u4ee5\u76f8\u5bf9\u5bb9\u6613\u5730\u4fee\u590d\u3002\u5982\u679c\u60a8\u5e0c\u671b\u5728\u5143\u7d20\u5185\u963b\u6b62\u6240\u6709\u6d4f\u89c8\u5668\u6eda\u52a8\u548c\u7f29\u653e\uff0c\u8bf7\u5c06 ",(0,o.kt)("inlineCode",{parentName:"p"},"touch-action: none")," \u5e94\u7528\u4e8e\u5b83\u3002\u5982\u679c\u60a8\u6709\u4e00\u4e2a\u6c34\u5e73\u8f6e\u64ad\uff0c\u8bf7\u8003\u8651\u5c06 ",(0,o.kt)("inlineCode",{parentName:"p"},"touch-action: pan-y pinch-zoom")," \u5e94\u7528\u4e8e\u5b83\uff0c\u4ee5\u4fbf\u7528\u6237\u4ecd\u7136\u53ef\u4ee5\u6b63\u5e38\u5730\u5782\u76f4\u6eda\u52a8\u548c\u7f29\u653e\u3002\u5728\u652f\u6301\u6307\u9488\u4e8b\u4ef6\u800c\u4e0d\u662f\u89e6\u6478\u4e8b\u4ef6\u7684\u6d4f\u89c8\u5668\uff08\u5982\u684c\u9762 Edge\uff09\u4e0a\uff0c\u6b63\u786e\u5e94\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"touch-action")," \u5df2\u7ecf\u662f\u5fc5\u8981\u7684\u3002\u5bf9\u4e8e\u4e0d\u652f\u6301 ",(0,o.kt)("inlineCode",{parentName:"p"},"touch-action")," \u7684\u79fb\u52a8 Safari \u548c\u8f83\u65e7\u7684\u79fb\u52a8\u6d4f\u89c8\u5668\uff0c\u5373\u4f7f Chrome \u4f1a\u5ffd\u7565\u5b83\uff0c\u60a8\u7684\u89e6\u6478\u76d1\u542c\u5668\u4ecd\u7136\u5fc5\u987b\u5728\u8c03\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"preventDefault")," \u65f6\u7ee7\u7eed\u8c03\u7528\u3002"),(0,o.kt)("p",null,"In more complex cases it may be necessary to also rely on one of the following:\n\u5728\u66f4\u590d\u6742\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u80fd\u8fd8\u9700\u8981\u4f9d\u8d56\u4ee5\u4e0b\u65b9\u6cd5\u4e4b\u4e00\uff1a"),(0,o.kt)("p",null,"If your ",(0,o.kt)("inlineCode",{parentName:"p"},"touchstart")," listener calls ",(0,o.kt)("inlineCode",{parentName:"p"},"preventDefault()"),", ensure ",(0,o.kt)("inlineCode",{parentName:"p"},"preventDefault()")," is also called from associated touchend listeners to continue suppressing the generation of click events and other default tap behavior.\n\u5982\u679c\u60a8\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"touchstart")," \u76d1\u542c\u5668\u8c03\u7528\u4e86 ",(0,o.kt)("inlineCode",{parentName:"p"},"preventDefault()"),"\uff0c\u8bf7\u786e\u4fdd ",(0,o.kt)("inlineCode",{parentName:"p"},"preventDefault()")," \u4e5f\u4ece\u5173\u8054\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"touchend")," \u76d1\u542c\u5668\u4e2d\u8c03\u7528\uff0c\u4ee5\u7ee7\u7eed\u963b\u6b62 ",(0,o.kt)("inlineCode",{parentName:"p"},"click")," \u4e8b\u4ef6\u548c\u5176\u4ed6\u9ed8\u8ba4\u70b9\u51fb\u884c\u4e3a\u7684\u4ea7\u751f\u3002"),(0,o.kt)("p",null,"Last (and discouraged) pass ",(0,o.kt)("inlineCode",{parentName:"p"},"{passive: false}")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"addEventListener()")," to override the default behavior. Be aware you will have to feature detect if the User Agent supports ",(0,o.kt)("inlineCode",{parentName:"p"},"EventListenerOptions"),".\n\u6700\u540e\uff08\u5e76\u4e0d\u9f13\u52b1\uff09\uff0c\u5c06 ",(0,o.kt)("inlineCode",{parentName:"p"},"{passive: false}")," \u4f20\u9012\u7ed9 ",(0,o.kt)("inlineCode",{parentName:"p"},"addEventListener()")," \u4ee5\u8986\u76d6\u9ed8\u8ba4\u884c\u4e3a\u3002\u8bf7\u6ce8\u610f\uff0c\u60a8\u9700\u8981\u68c0\u6d4b\u7528\u6237\u4ee3\u7406\u662f\u5426\u652f\u6301 ",(0,o.kt)("inlineCode",{parentName:"p"},"EventListenerOptions")," \u529f\u80fd\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="\u68c0\u6d4b\u6d4f\u89c8\u5668\u662f\u5426\u652f\u6301 passtive \u5c5e\u6027"',title:'"\u68c0\u6d4b\u6d4f\u89c8\u5668\u662f\u5426\u652f\u6301',passtive:!0,'\u5c5e\u6027"':!0},'let passiveSupported = false;\n\ntry {\n  const options = Object.defineProperty({}, "passive", {\n    get: function() {\n      passiveSupported = true;\n    }\n  });\n\n  window.addEventListener("test", options, options);\n  window.removeEventListener("test", options, options);\n} catch (err) {\n  passiveSupported = false;\n}\n\nconst eventOptions = passiveSupported ? { passive: false } : false;\nwindow.addEventListener("touchstart", yourFunction, eventOptions);\n')),(0,o.kt)("p",null,"\u4e0a\u8ff0\u4ee3\u7801\u9996\u5148\u901a\u8fc7\u5c1d\u8bd5\u8bbe\u7f6e\u5e76\u68c0\u6d4b ",(0,o.kt)("inlineCode",{parentName:"p"},"passive")," \u5c5e\u6027\u6765\u68c0\u6d4b\u6d4f\u89c8\u5668\u662f\u5426\u652f\u6301 ",(0,o.kt)("inlineCode",{parentName:"p"},"EventListenerOptions"),"\u3002\u5982\u679c\u652f\u6301\uff0c",(0,o.kt)("inlineCode",{parentName:"p"},"passiveSupported")," \u53d8\u91cf\u5c06\u8bbe\u7f6e\u4e3a ",(0,o.kt)("inlineCode",{parentName:"p"},"true"),"\u3002\u7136\u540e\uff0c\u6839\u636e ",(0,o.kt)("inlineCode",{parentName:"p"},"passiveSupported")," \u53d8\u91cf\u7684\u503c\uff0c\u4e3a ",(0,o.kt)("inlineCode",{parentName:"p"},"addEventListener()")," \u521b\u5efa\u9002\u5f53\u7684\u4e8b\u4ef6\u9009\u9879\u5bf9\u8c61\uff0c\u5176\u4e2d\u5c06 ",(0,o.kt)("inlineCode",{parentName:"p"},"passive")," \u8bbe\u7f6e\u4e3a ",(0,o.kt)("inlineCode",{parentName:"p"},"false"),"\u3002\u8fd9\u6837\u53ef\u4ee5\u8986\u76d6\u9ed8\u8ba4\u884c\u4e3a\uff0c\u4f46\u8bf7\u6ce8\u610f\uff0c\u8fd9\u79cd\u65b9\u6cd5\u5e76\u4e0d\u9f13\u52b1\u4f7f\u7528\uff0c\u56e0\u4e3a\u5b83\u53ef\u80fd\u4f1a\u5f71\u54cd\u9875\u9762\u6eda\u52a8\u6027\u80fd\u3002"),(0,o.kt)("h4",{id:"conclusion"},"Conclusion"),(0,o.kt)("p",null,"In Chrome 56 scrolling starts substantially faster on many websites. This is the only impact that most developers will notice as a result of this change. In some cases developers may notice unintended scrolling.\n\u5728 Chrome 56 \u4e2d\uff0c\u8bb8\u591a\u7f51\u7ad9\u7684\u6eda\u52a8\u901f\u5ea6\u660e\u663e\u52a0\u5feb\u3002\u8fd9\u662f\u5927\u591a\u6570\u5f00\u53d1\u8005\u4f1a\u6ce8\u610f\u5230\u7684\u6b64\u6b21\u66f4\u6539\u5e26\u6765\u7684\u552f\u4e00\u5f71\u54cd\u3002\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u5f00\u53d1\u8005\u53ef\u80fd\u4f1a\u6ce8\u610f\u5230\u610f\u5916\u7684\u6eda\u52a8\u3002"),(0,o.kt)("p",null,"Although it's still necessary to do so for mobile Safari, websites should not rely on calling ",(0,o.kt)("inlineCode",{parentName:"p"},"preventDefault()")," inside of ",(0,o.kt)("inlineCode",{parentName:"p"},"touchstart")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"touchmove")," listeners as this is no longer guaranteed to be honored in Chrome. Developers should apply the ",(0,o.kt)("inlineCode",{parentName:"p"},"touch-action")," CSS property on elements where scrolling and zooming should be disabled to notify the browser before any touch events occur. To suppress the default behavior of a tap (such as the generation of a click event), call ",(0,o.kt)("inlineCode",{parentName:"p"},"preventDefault()")," inside of a touchend listener.\n\u5c3d\u7ba1\u4ecd\u7136\u9700\u8981\u4e3a\u79fb\u52a8 Safari \u8fd9\u6837\u505a\uff0c\u4f46\u7f51\u7ad9\u4e0d\u5e94\u4f9d\u8d56\u5728 ",(0,o.kt)("inlineCode",{parentName:"p"},"touchstart")," \u548c ",(0,o.kt)("inlineCode",{parentName:"p"},"touchmove")," \u76d1\u542c\u5668\u4e2d\u8c03\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"preventDefault()"),"\uff0c\u56e0\u4e3a\u5728 Chrome \u4e2d\u4e0d\u518d\u4fdd\u8bc1\u4f1a\u9075\u5b88\u8be5\u64cd\u4f5c\u3002\u5f00\u53d1\u8005\u5e94\u5728\u9700\u8981\u7981\u7528\u6eda\u52a8\u548c\u7f29\u653e\u7684\u5143\u7d20\u4e0a\u5e94\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"touch-action")," CSS \u5c5e\u6027\uff0c\u4ee5\u5728\u4efb\u4f55\u89e6\u6478\u4e8b\u4ef6\u53d1\u751f\u4e4b\u524d\u901a\u77e5\u6d4f\u89c8\u5668\u3002\u8981\u6291\u5236\u70b9\u51fb\u884c\u4e3a\u7684\u9ed8\u8ba4\u884c\u4e3a\uff08\u4f8b\u5982 ",(0,o.kt)("inlineCode",{parentName:"p"},"click")," \u4e8b\u4ef6\u7684\u751f\u6210\uff09\uff0c\u8bf7\u5728 ",(0,o.kt)("inlineCode",{parentName:"p"},"touchend")," \u76d1\u542c\u5668\u4e2d\u8c03\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"preventDefault()"),"\u3002"),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"Updated on Tuesday, July 31, 2018")))}c.isMDXComponent=!0}}]);