"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[27535],{19586:e=>{e.exports=JSON.parse('{"permalink":"/blog/2024/12/14/node-esbuild-FSLegacyMainResolve","editUrl":"https://github.com/alanwei43/blog/tree/master/src/blog/2024/12-14-node-esbuild-FSLegacyMainResolve.md","source":"@site/src/blog/2024/12-14-node-esbuild-FSLegacyMainResolve.md","title":"Node esBuild suddenly failing with FSLegacyMainResolve problem","description":"ref Node esBuild suddenly failing with FSLegacyMainResolve problem","date":"2024-12-14T00:00:00.000Z","tags":[{"inline":true,"label":"nodejs","permalink":"/blog/tags/nodejs"},{"inline":true,"label":"esbuild","permalink":"/blog/tags/esbuild"},{"inline":true,"label":"FSLegacyMainResolve","permalink":"/blog/tags/fs-legacy-main-resolve"}],"readingTime":1.65,"hasTruncateMarker":true,"authors":[],"frontMatter":{"tags":["nodejs","esbuild","FSLegacyMainResolve"]},"unlisted":false,"prevItem":{"title":"CSS Position Sticky","permalink":"/blog/2024/12/14/css-position-sticky"},"nextItem":{"title":"Ubuntu DNS \u8bbe\u7f6e","permalink":"/blog/2024/12/03/ubuntu-dns"}}')},28453:(e,n,o)=>{o.d(n,{R:()=>i,x:()=>a});var l=o(96540);const s={},t=l.createContext(s);function i(e){const n=l.useContext(t);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),l.createElement(t.Provider,{value:n},e.children)}},79343:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>r,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>d});var l=o(19586),s=o(74848),t=o(28453);const i={tags:["nodejs","esbuild","FSLegacyMainResolve"]},a="Node esBuild suddenly failing with FSLegacyMainResolve problem",r={authorsImageUrls:[]},d=[{value:"Question",id:"question",level:2},{value:"Answer",id:"answer",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://stackoverflow.com/questions/77630548/node-esbuild-suddenly-failing-with-fslegacymainresolve-problem",children:"ref Node esBuild suddenly failing with FSLegacyMainResolve problem"})}),"\n",(0,s.jsx)(n.h2,{id:"question",children:"Question"}),"\n",(0,s.jsx)(n.p,{children:"I have a Node project that builds fine locally, and has historically built with no problems on the GitLab CI/CD server. However, suddenly, the pipeline build fails on the server with no changes to the code. I even opened several branches for past commits that previously built fine, and they also fail on the server."}),"\n",(0,s.jsx)(n.p,{children:'I\'m mostly trying to understand what this error "means":'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"const resolvedOption = FSLegacyMainResolve(packageJsonUrlString, packageConfig.main, baseStringified);\n                         ^\nTypeError: The URL must be of scheme file: <etc...>\n"})}),"\n",(0,s.jsx)(n.p,{children:"I have to assume something changed in the build environment, it's not able to pull down a package suddenly, or similar, but there's nothing really specific about what the problem might be. I'm looking for pointers about why this is occurring, and possibly how to troubleshoot."}),"\n",(0,s.jsx)(n.p,{children:"Relevant error from the log on the build server is:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$ npm install\nadded 362 packages, and audited 363 packages in 17s\n47 packages are looking for funding\n  run `npm fund` for details\nfound 0 vulnerabilities\n$ echo \"Compile complete.\"\nCompile complete.\n$ npm run build\n> my-project@1.0.0 build\n> tsc -skipLibCheck && node esbuild.config.mjs production && npm pack\nnode:internal/modules/esm/resolve:205\n  const resolvedOption = FSLegacyMainResolve(packageJsonUrlString, packageConfig.main, baseStringified);\n                         ^\nTypeError: The URL must be of scheme file:\n    at legacyMainResolve (node:internal/modules/esm/resolve:205:26)\n    at packageResolve (node:internal/modules/esm/resolve:831:14)\n    at moduleResolve (node:internal/modules/esm/resolve:901:20)\n    at defaultResolve (node:internal/modules/esm/resolve:1121:11)\n    at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:396:12)\n    at ModuleLoader.resolve (node:internal/modules/esm/loader:365:25)\n    at ModuleLoader.getModuleJob (node:internal/modules/esm/loader:240:38)\n    at ModuleWrap.<anonymous> (node:internal/modules/esm/module_job:85:39)\n    at link (node:internal/modules/esm/module_job:84:36) {\n  code: 'ERR_INVALID_URL_SCHEME'\n}\nNode.js v20.10.0\nCleaning up project directory and file based variables 00:01\nERROR: Job failed: exit code 1\n"})}),"\n",(0,s.jsx)(n.p,{children:"Again, this runs just fine locally, same version of Node.js, etc. I've cleared local npm cache, deleted node_modules, etc, all in an attempt to potentially replicate the server-side state, but still everything works fine locally."}),"\n",(0,s.jsx)(n.h2,{id:"answer",children:"Answer"}),"\n",(0,s.jsx)(n.p,{children:"I was facing the same issue, but this worked for me"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Delete the node_modules directory: ",(0,s.jsx)(n.code,{children:"rm -rf node_modules"})]}),"\n",(0,s.jsxs)(n.li,{children:["Install dependencies with the --legacy-peer-deps flag: ",(0,s.jsx)(n.code,{children:"npm install --legacy-peer-deps"})]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}}}]);