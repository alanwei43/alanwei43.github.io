"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[38101],{28453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>c});var i=r(96540);const o={},t=i.createContext(o);function s(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(t.Provider,{value:n},e.children)}},61712:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>p,frontMatter:()=>s,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"spring-in-action","title":"Spring in Action","description":"3.4 bean \u7684\u4f5c\u7528\u57df","source":"@site/src/docs/reading/spring-in-action.md","sourceDirName":".","slug":"/spring-in-action","permalink":"/docs/reading/spring-in-action","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1649596569000,"frontMatter":{"title":"Spring in Action"},"sidebar":"tutorialSidebar","previous":{"title":"Redis\u5165\u95e8\u6307\u5357","permalink":"/docs/reading/redis-getting-started-2nd"},"next":{"title":"Understanding ECMAScript 6","permalink":"/docs/reading/understanding-ecmascript-6"}}');var o=r(74848),t=r(28453);const s={title:"Spring in Action"},c=void 0,a={},l=[{value:"3.4 bean \u7684\u4f5c\u7528\u57df",id:"34-bean-\u7684\u4f5c\u7528\u57df",level:3},{value:"Session and Request Scope",id:"session-and-request-scope",level:4},{value:"\u8fd0\u884c\u65f6\u503c\u6ce8\u5165",id:"\u8fd0\u884c\u65f6\u503c\u6ce8\u5165",level:3},{value:"\u89e3\u6790\u5c5e\u6027\u5360\u4f4d\u7b26",id:"\u89e3\u6790\u5c5e\u6027\u5360\u4f4d\u7b26",level:5},{value:"3.5.2 \u4f7f\u7528 Spring \u8868\u8fbe\u5f0f\u8bed\u8a00\u8fdb\u884c\u88c5\u914d",id:"352-\u4f7f\u7528-spring-\u8868\u8fbe\u5f0f\u8bed\u8a00\u8fdb\u884c\u88c5\u914d",level:4},{value:"4 \u9762\u5411\u5207\u9762\u7684 Spring",id:"4-\u9762\u5411\u5207\u9762\u7684-spring",level:2},{value:"4.1 \u4ec0\u4e48\u662f\u9762\u5411\u5207\u9762\u7f16\u7a0b",id:"41-\u4ec0\u4e48\u662f\u9762\u5411\u5207\u9762\u7f16\u7a0b",level:3},{value:"4.1.1 \u5b9a\u4e49AOP\u672f\u8bed",id:"411-\u5b9a\u4e49aop\u672f\u8bed",level:4}];function d(e){const n={code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h3,{id:"34-bean-\u7684\u4f5c\u7528\u57df",children:"3.4 bean \u7684\u4f5c\u7528\u57df"}),"\n",(0,o.jsx)(n.p,{children:"Spring\u5b9a\u4e49\u4e86\u591a\u79cd\u4f5c\u7528\u57df:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsxs)(n.strong,{children:["\u5355\u4f8b(Singleton, ",(0,o.jsx)(n.code,{children:"ConfigurableBeanFactory.SCOPE_SINGLETON"}),")"]}),": \u5728\u6574\u4e2a\u5e94\u7528\u4e2d, \u53ea\u521b\u5efabean\u7684\u4e00\u4e2a\u5b9e\u4f8b\u3002"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsxs)(n.strong,{children:["\u539f\u578b(Prototype, ",(0,o.jsx)(n.code,{children:"ConfigurableBeanFactory.SCOPE_PROTOTYPE"}),")"]}),": \u6bcf\u6b21\u6ce8\u5165\u6216\u8005\u901a\u8fc7Spring\u5e94\u7528\u4e0a\u4e0b\u6587\u83b7\u53d6\u7684\u65f6\u5019\uff0c\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684bean\u5b9e\u4f8b\u3002"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsxs)(n.strong,{children:["\u4f1a\u8bdd(Session, ",(0,o.jsx)(n.code,{children:"WebApplicationContext.SCOPE__SESSION"}),")"]}),": \u5728Web\u5e94\u7528\u4e2d\uff0c\u4e3a\u6bcf\u4e2a\u521b\u5efa\u4e00\u4e2abean\u5b9e\u4f8b\u3002"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"\u8bf7\u6c42(Request)"}),": \u5728Web\u5e94\u7528\u4e2d\uff0c\u4e3a\u6bcf\u4e2a\u8bf7\u6c42\u521b\u5efa\u4e00\u4e2abean\u5b9e\u4f8b\u3002"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["\u5355\u4f8b\u662f\u9ed8\u8ba4\u4f5c\u7528\u57df, \u8981\u66f4\u6539\u4f5c\u7528\u57df\u9700\u8981\u4f7f\u7528",(0,o.jsx)(n.code,{children:"@Scope"}),"\u6ce8\u89e3, \u5b83\u53ef\u4ee5\u4e0e",(0,o.jsx)(n.code,{children:"@Compoent"}),"\u6216",(0,o.jsx)(n.code,{children:"@Bean"}),"\u4e00\u8d77\u4f7f\u7528\u3002"]}),"\n",(0,o.jsx)(n.h4,{id:"session-and-request-scope",children:"Session and Request Scope"}),"\n",(0,o.jsx)(n.p,{children:"\u5047\u8bbe\u4e00\u4e2a\u8d2d\u7269\u8f66 bean:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",children:"@Component\n@Scope(value=WebApplicationContext.SCOPE_SESSION, proxyMode=ScopedProxyMode.INTERFACES)\npublic ShoppingCart cart(){ }\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"value=WebApplicationContext.SCOPE_SESSION"})," \u8868\u793a\u8fd9\u662f\u4e00\u4e2a\u4f1a\u8bddbean."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"proxyMode=ScopedProxyMode=INTERFACES"})," \u662f\u4e3a\u4e86\u89e3\u51b3\u5c06\u4f1a\u8bdd\u6216\u8bf7\u6c42\u4f5c\u7528\u57df\u7684bean\u6ce8\u5165\u5230\u5355\u4f8bbean\u4e2d\u9047\u5230\u7684\u95ee\u9898."]}),"\n",(0,o.jsxs)(n.p,{children:["\u5047\u8bbe\u6211\u4eec\u8981\u5c06 ",(0,o.jsx)(n.code,{children:"ShoppingCart"})," bean \u6ce8\u5165\u5230\u5355\u4f8b ",(0,o.jsx)(n.code,{children:"StoreService"})," bean \u7684 ",(0,o.jsx)(n.code,{children:"Setter"})," \u65b9\u6cd5\u4e2d:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",children:"@Component\npublic class StoreService {\n\t@Autowired\n\tpublic void setShoppingCart(ShoppingCart cart){\n\t\t//...\n\t}\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u56e0\u4e3a",(0,o.jsx)(n.code,{children:"StoreService"}),"\u662f\u4e00\u4e2a\u5355\u4f8bbean, \u4f1a\u5728\u5e94\u7528\u4e0a\u4e0b\u6587\u5bb6\u5728\u7684\u65f6\u5019\u521b\u5efa, \u5f53\u5b83\u521b\u5efa\u7684\u65f6\u5019, Spring\u4f1a\u8bd5\u56fe\u5c06",(0,o.jsx)(n.code,{children:"ShoppingCart"})," \u6ce8\u5165\u5230 ",(0,o.jsx)(n.code,{children:"setShoppingCart"}),", \u4f46\u662f ",(0,o.jsx)(n.code,{children:"ShoppingCart"})," \u53ea\u6709\u5728\u521b\u5efa\u4f1a\u8bdd\u4e4b\u540e\u624d\u4f1a\u51fa\u73b0\u5b9e\u4f8b, \u53e6\u5916\u7cfb\u7edf\u5c06\u4f1a\u6709\u591a\u4e2a",(0,o.jsx)(n.code,{children:"ShoppingCart"}),"\u5b9e\u4f8b, \u5e76\u4e0d\u60f3\u8ba9\u67d0\u4e2a\u7279\u5b9a\u7684\u5b9e\u4f8b\u6ce8\u5165\u5230 ",(0,o.jsx)(n.code,{children:"StoreService"})," \u4e2d. \u52a0\u4e0a",(0,o.jsx)(n.code,{children:"ScopedProxyMode.INTERFACES"}),"\u4e4b\u540e, Spring\u5e76\u4e0d\u4f1a\u5c06\u5b9e\u9645\u7684 ",(0,o.jsx)(n.code,{children:"ShoppingCart"})," bean\u6ce8\u5165\u5230 ",(0,o.jsx)(n.code,{children:"StoreService"}),"\u4e2d, Spring\u4f1a\u6ce8\u5165\u4e00\u4e2a\u5230 ",(0,o.jsx)(n.code,{children:"ShoppingCart"})," bean\u7684\u4ee3\u7406. \u8fd9\u4e2a\u4ee3\u7406\u4f1a\u66b4\u9732\u548c ",(0,o.jsx)(n.code,{children:"ShoppingCart"})," \u63a5\u53e3\u76f8\u540c\u7684\u65b9\u6cd5, \u5f53 ",(0,o.jsx)(n.code,{children:"StoreService"})," \u8c03\u7528 ",(0,o.jsx)(n.code,{children:"ShoppingCart"})," \u7684\u65b9\u6cd5\u65f6, \u4ee3\u7406\u4f1a\u5bf9\u5176\u8fdb\u884c\u61d2\u89e3\u6790, \u5e76\u5c06\u8c03\u7528\u59d4\u6258\u7ed9\u4f1a\u8bdd\u4f5c\u7528\u57df\u4e2d\u771f\u6b63\u7684",(0,o.jsx)(n.code,{children:"ShoppingCart"})," bean. \u5982\u679c",(0,o.jsx)(n.code,{children:"ShoppingCart"})," \u662f\u63a5\u53e3\u800c\u4e0d\u662f\u4e00\u4e2a\u5177\u4f53\u7c7b\u7684\u8bdd, Spring\u5c31\u6ca1\u6709\u529e\u6cd5\u521b\u5efa\u57fa\u4e8e\u63a5\u53e3\u7684\u4ee3\u7406\u4e86, \u6b64\u65f6\u5b83\u5fc5\u987b\u4f7f\u7528CGLib\u6765\u751f\u6210\u57fa\u4e8e\u7c7b\u7684\u4ee3\u7406, \u6240\u4ee5 bean\u7c7b\u578b\u662f\u5177\u4f53\u7c7b\u7684\u8bdd, \u5fc5\u987b\u5c06 ",(0,o.jsx)(n.code,{children:"proxyMode"})," \u5c5e\u6027\u8bbe\u7f6e\u4e3a",(0,o.jsx)(n.code,{children:"ScopedProxyMode.TARGET_CLASS"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"\u8fd0\u884c\u65f6\u503c\u6ce8\u5165",children:"\u8fd0\u884c\u65f6\u503c\u6ce8\u5165"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",metastring:'title="src/main/java/chapter3/ResourcesSample.java"',children:'package chapter3;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.PropertySource;\nimport org.springframework.core.env.Environment;\nimport org.springframework.stereotype.Component;\n\n@Component\n@PropertySource("classpath:/chapter3/app.properties")\npublic class ResourcesSample {\n\n    @Autowired\n    private Environment env;\n\n    public void print() {\n\n        String firstName = this.env.getProperty("firstName");\n        System.out.println("first name: " + firstName);\n\n        Integer age = this.env.getProperty("age", Integer.class);\n        System.out.println("age: " + age);\n\n        String notExisted = this.env.getProperty("notExisted", "default");\n        System.out.println("not existed: " + notExisted);\n    }\n\n}\n'})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-properties",metastring:'title="src/main/resources/chapter3/app.properties"',children:"firstName=alan\nlastName=wei\nage=28\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"String getProperty(String key)"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"String getProperty(String key, String defaultValue)"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"T getProperty(String key, Class<T> type)"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"T getProperty(String key, Class<T> type, T defaultValue)"})}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["\u5728\u4f7f\u7528 ",(0,o.jsx)(n.code,{children:"getProperty"})," \u65b9\u6cd5\u65f6\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u9ed8\u8ba4\u503c(",(0,o.jsx)(n.code,{children:"defaultValue"}),"), \u5e76\u4e14\u8fd9\u4e2a\u5c5e\u6027\u6ca1\u6709\u5b9a\u4e49\u7684\u8bdd, \u83b7\u53d6\u5230\u7684\u503c\u662fnull. \u5982\u679c\u4f60\u5e0c\u671b\u8fd9\u4e2a\u5c5e\u6027\u5fc5\u987b\u8981\u5b9a\u4e49, \u53ef\u4ee5\u4f7f\u7528 ",(0,o.jsx)(n.code,{children:"getRequiredProeprty()"})," \u65b9\u6cd5(\u5982\u679c\u672a\u5b9a\u4e49\u629b\u51fa",(0,o.jsx)(n.code,{children:"IllegalStateException"}),"\u5f02\u5e38)."]}),"\n",(0,o.jsxs)(n.p,{children:["\u5982\u679c\u60f3\u68c0\u67e5\u5c5e\u6027\u662f\u5426\u5b58\u5728, \u53ef\u4ee5\u8c03\u7528 ",(0,o.jsx)(n.code,{children:"boolean Environment.containsProperty(String key)"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["\u5982\u679c\u60f3\u5c06\u5c5e\u6027\u89e3\u6790\u4e3a\u7c7b\u7684\u8bdd, \u53ef\u4ee5\u4f7f\u7528 ",(0,o.jsx)(n.code,{children:"getPropertyAsClass()"}),"\u65b9\u6cd5:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",children:'Class<Foo> foo = env.getPropertyAsClass("foo.class", Foo.class);\n'})}),"\n",(0,o.jsx)(n.h5,{id:"\u89e3\u6790\u5c5e\u6027\u5360\u4f4d\u7b26",children:"\u89e3\u6790\u5c5e\u6027\u5360\u4f4d\u7b26"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",children:'package temporary;\n\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.context.annotation.PropertySource;\nimport org.springframework.context.support.PropertySourcesPlaceholderConfigurer;\n\n@Configuration\n@PropertySource("classpath:/chapter3/app.properties")\npublic class AppConfig {\n\n\t//\u8fd9\u91cc\u6267\u884c\u503c\u6ce8\u5165\n    @Value("${db.driver}")\n    private String driver;\n\n\t//\u4e3a\u4e86\u4f7f\u503c\u6ce8\u5165\u751f\u6548, \u5fc5\u987b\u914d\u7f6e\u4e00\u4e2a PropertySourcesPlaceholderConfigurer, \n\t//\u56e0\u4e3a\u5b83\u80fd\u591f\u57fa\u4e8e Spring Environment \u53ca\u5176\u5c5e\u6027\u6e90\u6765\u89e3\u6790\u5360\u4f4d\u7b26.\n    @Bean\n    public static PropertySourcesPlaceholderConfigurer propertyConfigInDev() {\n        return new PropertySourcesPlaceholderConfigurer();\n    }\n}\n'})}),"\n",(0,o.jsx)(n.h4,{id:"352-\u4f7f\u7528-spring-\u8868\u8fbe\u5f0f\u8bed\u8a00\u8fdb\u884c\u88c5\u914d",children:"3.5.2 \u4f7f\u7528 Spring \u8868\u8fbe\u5f0f\u8bed\u8a00\u8fdb\u884c\u88c5\u914d"}),"\n",(0,o.jsx)(n.p,{children:"Spring 3\u5f15\u5165\u4e86 SpEL(Spring Expression Language, SpEL), \u80fd\u591f\u5c06\u503c\u88c5\u914d\u5230bean\u5c5e\u6027\u548c\u6784\u9020\u5668\u53c2\u6570\u4e2d:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"\u4f7f\u7528 bean \u7684ID\u6765\u996e\u7528bean"}),"\n",(0,o.jsx)(n.li,{children:"\u8c03\u7528\u65b9\u6cd5\u548c\u8bbf\u95ee\u5bf9\u8c61\u7684\u5c5e\u6027"}),"\n",(0,o.jsx)(n.li,{children:"\u5bf9\u503c\u8fdb\u884c\u7b97\u6570\u3001\u5173\u7cfb\u548c\u903b\u8f91\u8fd0\u7b97"}),"\n",(0,o.jsx)(n.li,{children:"\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d"}),"\n",(0,o.jsx)(n.li,{children:"\u96c6\u5408\u64cd\u4f5c"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"4-\u9762\u5411\u5207\u9762\u7684-spring",children:"4 \u9762\u5411\u5207\u9762\u7684 Spring"}),"\n",(0,o.jsx)(n.p,{children:"\u5728\u8f6f\u4ef6\u5f00\u53d1\u4e2d, \u6563\u5e03\u4e8e\u5e94\u7528\u4e2d\u591a\u5904\u7684\u529f\u80fd\u88ab\u79f0\u4e3a\u6a2a\u5207\u5173\u6ce8\u70b9(cross-cutting concern). \u901a\u5e38\u6765\u8bb2\uff0c\u8fd9\u4e9b\u6a2a\u5207\u5173\u6ce8\u70b9\u4ece\u6982\u5ff5\u4e0a\u662f\u4e0e\u5e94\u7528\u7684\u4e1a\u52a1\u903b\u8f91\u76f8\u5206\u79bb\u7684(\u4f46\u662f\u5f80\u5f80\u4f1a\u76f4\u63a5\u5207\u5165\u5230\u5e94\u7528\u7684\u4e1a\u52a1\u903b\u8f91\u4e2d.) \u628a\u8fd9\u4e9b\u6a2a\u5207\u5173\u6ce8\u70b9\u4e0e\u4e1a\u52a1\u903b\u8f91\u76f8\u5206\u79bb\u6b63\u5f0f\u9762\u5411\u5207\u9762\u7f16\u7a0b(AOP)\u6240\u8981\u89e3\u51b3\u7684\u95ee\u9898."}),"\n",(0,o.jsx)(n.h3,{id:"41-\u4ec0\u4e48\u662f\u9762\u5411\u5207\u9762\u7f16\u7a0b",children:"4.1 \u4ec0\u4e48\u662f\u9762\u5411\u5207\u9762\u7f16\u7a0b"}),"\n",(0,o.jsx)(n.h4,{id:"411-\u5b9a\u4e49aop\u672f\u8bed",children:"4.1.1 \u5b9a\u4e49AOP\u672f\u8bed"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsxs)(n.strong,{children:["\u901a\u77e5(",(0,o.jsx)(n.em,{children:"Advice"}),")"]})," \u5207\u9762\u7684\u5de5\u4f5c\u88ab\u79f0\u4e3a\u901a\u77e5. \u901a\u77e5\u5b9a\u4e49\u4e86\u5207\u9762\u662f\u4ec0\u4e48\u4ee5\u53ca\u4f55\u65f6\u4f7f\u7528. Spring \u5207\u9762\u53ef\u4ee5\u5e94\u75285\u79cd\u7c7b\u578b\u7684\u901a\u77e5:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"\u524d\u7f6e\u901a\u77e5(Before): \u5728\u76ee\u6807\u65b9\u6cd5\u88ab\u8c03\u7528\u4e4b\u524d\u8c03\u7528\u901a\u77e5\u529f\u80fd"}),"\n",(0,o.jsx)(n.li,{children:"\u540e\u7f6e\u901a\u77e5(After): \u5728\u76ee\u6807\u65b9\u6cd5\u5b8c\u6210\u4e4b\u540e\u8c03\u7528\u901a\u77e5, \u6b64\u65f6\u4e0d\u4f1a\u5173\u5fc3\u65b9\u6cd5\u7684\u8f93\u51fa\u662f\u4ec0\u4e48"}),"\n",(0,o.jsx)(n.li,{children:"\u8fd4\u56de\u901a\u77e5(After-returning): \u5728\u76ee\u6807\u65b9\u6cd5\u6210\u529f\u6267\u884c\u4e4b\u540e\u8c03\u7528\u901a\u77e5"}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);