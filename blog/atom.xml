<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://blog.alanwei.com/blog</id>
    <title>Alan's Blog Blog</title>
    <updated>2022-11-27T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://blog.alanwei.com/blog"/>
    <subtitle>Alan's Blog Blog</subtitle>
    <icon>https://blog.alanwei.com/img/favicon.png</icon>
    <entry>
        <title type="html"><![CDATA[fnm - Node版本管理工具]]></title>
        <id>/2022/11/27/fnm-node-version-manager</id>
        <link href="https://blog.alanwei.com/blog/2022/11/27/fnm-node-version-manager"/>
        <updated>2022-11-27T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Node版本工具 - fnm 简介]]></summary>
        <content type="html"><![CDATA[<p>Node版本工具 - <a href="https://github.com/Schniz/fnm" target="_blank" rel="noopener noreferrer">fnm</a> 简介</p><p><a href="https://zhuanlan.zhihu.com/p/587008009" target="_blank" rel="noopener noreferrer">引用原文</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装">安装<a class="hash-link" href="#安装" title="Direct link to heading">​</a></h2><p>建议直接下载 <a href="https://github.com/Schniz/fnm/releases" target="_blank" rel="noopener noreferrer">fnm v1.32.0</a> 的可执行文件:</p><ul><li><a href="https://github.com/Schniz/fnm/releases/download/v1.32.0/fnm-windows.zip" target="_blank" rel="noopener noreferrer">Windows</a></li><li><a href="https://github.com/Schniz/fnm/releases/download/v1.32.0/fnm-linux.zip" target="_blank" rel="noopener noreferrer">Linux</a></li><li><a href="https://github.com/Schniz/fnm/releases/download/v1.32.0/fnm-macos.zip" target="_blank" rel="noopener noreferrer">macOS</a></li></ul><p>将 <code>fnm</code>/<code>fnm.exe</code> 放在系统 <code>PATH</code> 路径下(比如 <code>/usr/local/bin</code> 或者 <code>C:\windows\system32</code>).</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置">配置<a class="hash-link" href="#配置" title="Direct link to heading">​</a></h2><p>安装完成之后需要配置脚本, 目前官方支持以下几种:</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="bash-zsh">bash, Zsh<a class="hash-link" href="#bash-zsh" title="Direct link to heading">​</a></h3><p>在 <code>~/.bashrc</code>、<code>~/.zshrc</code>(zsh)、<code>~/.bash_profile</code>(macOS) 文件添加以下一行代码: </p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">.bashrc</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">eval</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable" style="color:#36acaa">fnm </span><span class="token string variable function" style="color:#d73a49">env</span><span class="token string variable" style="color:#36acaa"> --use-on-cd</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="fish-shell">Fish shell<a class="hash-link" href="#fish-shell" title="Direct link to heading">​</a></h3><p>创建文件 <code>~/.config/fish/conf.d/fnm.fish</code>, 并添加以下代码:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">fnm.fish</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fnm </span><span class="token function" style="color:#d73a49">env</span><span class="token plain"> --use-on-cd </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token builtin class-name">source</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="powershell">PowerShell<a class="hash-link" href="#powershell" title="Direct link to heading">​</a></h3><p>在 PowerShell Profile 文件添加以下代码:</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">~\Documents\PowerShell\Microsoft.PowerShell_profile.ps1</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fnm env --use-on-cd | Out-String | Invoke-Expression</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Powershell Profile 文件位置可以使用 <code>echo $PROFILE</code> 查看.</p><blockquote><p>注意要直接使用 PowerShell 终端，不要在 cmd 终端中输入 <code>powershell</code> 命令的方式使用 PowerShell.</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用">使用<a class="hash-link" href="#使用" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 安装最新的 LTS 版本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fnm </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> --lts </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 安装 node v16 版本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fnm </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 使用淘宝镜像安装 node v16 版本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fnm </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token plain"> --node-dist-mirror</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">https://npmmirror.com/mirrors/node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 线是本地已按扎ung版本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fnm list </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 在当前shell使用 node v16 版本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fnm use </span><span class="token number" style="color:#36acaa">16</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 设置全局默认版本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fnm default </span><span class="token number" style="color:#36acaa">16</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 使用指定版本来执行某个全局命令</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fnm </span><span class="token builtin class-name">exec</span><span class="token plain"> --using</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">18</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 在特定目录自动切换版本，也可以提交到源码库方便协作。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果目录下有 <code>.node-version</code> 文件, 会自动在该目录使用该文件指定的 node 版本, 比如设置当前目录使用 v16 版本:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'16'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> .node-version</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="nodejs" term="nodejs"/>
        <category label="node.js" term="node.js"/>
        <category label="node" term="node"/>
        <category label="fnm" term="fnm"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Linux install VMware Workstation]]></title>
        <id>/2022/11/22/linux-install-vmware-workstation</id>
        <link href="https://blog.alanwei.com/blog/2022/11/22/linux-install-vmware-workstation"/>
        <updated>2022-11-22T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[原文]]></summary>
        <content type="html"><![CDATA[<p><a href="https://www.linuxtechi.com/install-vmware-workstation-on-ubuntu/" target="_blank" rel="noopener noreferrer">原文</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="下载安装包">下载安装包<a class="hash-link" href="#下载安装包" title="Direct link to heading">​</a></h2><p>访问<a href="https://www.vmware.com/products/workstation-pro/workstation-pro-evaluation.html" target="_blank" rel="noopener noreferrer">VMware download page</a>下载对应安装包. 或者直接点击下方下载:</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="windows">Windows<a class="hash-link" href="#windows" title="Direct link to heading">​</a></h3><p><a href="https://download3.vmware.com/software/WKST-1700-WIN/VMware-workstation-full-17.0.0-20800274.exe" target="_blank" rel="noopener noreferrer">https://download3.vmware.com/software/WKST-1700-WIN/VMware-workstation-full-17.0.0-20800274.exe</a></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="macos-13-ventura">macOS 13 Ventura<a class="hash-link" href="#macos-13-ventura" title="Direct link to heading">​</a></h3><p><a href="https://download3.vmware.com/software/FUS-1300/VMware-Fusion-13.0.0-20802013_universal.dmg" target="_blank" rel="noopener noreferrer">https://download3.vmware.com/software/FUS-1300/VMware-Fusion-13.0.0-20802013_universal.dmg</a></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="linux">Linux<a class="hash-link" href="#linux" title="Direct link to heading">​</a></h3><p><a href="https://download3.vmware.com/software/WKST-1700-LX/VMware-Workstation-Full-17.0.0-20800274.x86_64.bundle" target="_blank" rel="noopener noreferrer">https://download3.vmware.com/software/WKST-1700-LX/VMware-Workstation-Full-17.0.0-20800274.x86_64.bundle</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装">安装<a class="hash-link" href="#安装" title="Direct link to heading">​</a></h2><p>假如下载下来的文件名是 <code>VMware-Workstation.bundle</code> , 然后执行以下命令:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -y gcc build-essential </span><span class="token comment" style="color:#999988;font-style:italic"># 安装 C/C++ 开发构建工具</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">bash</span><span class="token plain"> ./VMware-Workstation.bundle </span><span class="token comment" style="color:#999988;font-style:italic"># 执行按扎ung</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> vmware-modconfig --console --install-all </span><span class="token comment" style="color:#999988;font-style:italic"># 安装依赖的 kernel modules</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>如果遇到 <code>build-essential</code> 安装失败, 且原因是因为该包依赖的其他包(比如 <code>libc6</code>)版本太高, 可以选择降低 <code>libc6</code> 的版本. 降低版本可以参考 <a href="/blog/2022/11/22/ubuntu-downgrade-package-version">Ubuntu downgrade pacakge version</a></p></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="vmware" term="vmware"/>
        <category label="linux" term="linux"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[国内 .npmrc 配置]]></title>
        <id>/2022/11/22/resolve-npm-install-fail</id>
        <link href="https://blog.alanwei.com/blog/2022/11/22/resolve-npm-install-fail"/>
        <updated>2022-11-22T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[国内 .npmrc 配置:]]></summary>
        <content type="html"><![CDATA[<p>国内 <code>.npmrc</code> 配置:</p><div class="language-rc codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">.npmrc</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rc codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">registry=https://registry.npmmirror.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sass_binary_site=https://npmmirror.com/mirrors/node-sass/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">phantomjs_cdnurl=https://npmmirror.com/mirrors/phantomjs/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">electron_mirror=https://npmmirror.com/mirrors/electron/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sqlite3_binary_host_mirror=http://npmmirror.com/mirrors/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">profiler_binary_host_mirror=http://npmmirror.com/mirrors/node-inspector/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chromedriver_cdnurl=https://npmmirror.com/mirrors/chromedriver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sentrycli_cdnurl=https://npmmirror.com/mirrors/sentry-cli/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="nodejs" term="nodejs"/>
        <category label="npm" term="npm"/>
        <category label="yarn" term="yarn"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Ubuntu 降低包版本号]]></title>
        <id>/2022/11/22/ubuntu-downgrade-package-version</id>
        <link href="https://blog.alanwei.com/blog/2022/11/22/ubuntu-downgrade-package-version"/>
        <updated>2022-11-22T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[原文 How to Downgrade Packages on Ubuntu]]></summary>
        <content type="html"><![CDATA[<p><a href="https://vitux.com/how-to-downgrade-packages-on-ubuntu/" target="_blank" rel="noopener noreferrer">原文 How to Downgrade Packages on Ubuntu</a></p><p>操作步骤如下(需要将 <code>package-name</code> 替换成真正的包名):</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 查看可用版本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt-cache</span><span class="token plain"> showpkg package-name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 安装指定版本(version是上一个命令列出的可用版本号)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">packagename</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 可选命令 固定包的版本号, 不自动升级</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> apt-mark hold firefox</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="ubuntu" term="ubuntu"/>
        <category label="linux" term="linux"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[以非root账号方式运行Docker]]></title>
        <id>/2022/11/18/docker-run-as-non-root-user</id>
        <link href="https://blog.alanwei.com/blog/2022/11/18/docker-run-as-non-root-user"/>
        <updated>2022-11-18T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[原文 Manage Docker as a non-root user]]></summary>
        <content type="html"><![CDATA[<p><a href="https://docs.docker.com/engine/install/linux-postinstall/" target="_blank" rel="noopener noreferrer">原文 Manage Docker as a non-root user</a></p><p>Docker daemon 绑定到 Unix socket, 而不是 TCP Port. 默认情况下只有 <code>root</code> 账号可以访问 Unix socket, 所以一般需要操作Docker时需要使用 <code>sudo docker</code> 的方式.</p><p>下面介绍如果使用docker命令而不需要root账号:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 创建 docker group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">groupadd</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 如果是使用包管理器安装docker, 有可能已经创建了这个group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 把当前用户添加到该 group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">usermod</span><span class="token plain"> -aG </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token environment constant" style="color:#36acaa">$USER</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 使用以下命令激活该组, 或者退出重新登陆</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">newgrp </span><span class="token function" style="color:#d73a49">docker</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后执行docker命令就不需要借助sudo了, Visual Studio Code 也可以正常使用容器开发了.</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="docker" term="docker"/>
        <category label="vsc" term="vsc"/>
        <category label="visual studio code" term="visual studio code"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[google.cn 资源整理]]></title>
        <id>/2022/11/13/google-cn-resources</id>
        <link href="https://blog.alanwei.com/blog/2022/11/13/google-cn-resources"/>
        <updated>2022-11-13T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[* Google Developers]]></summary>
        <content type="html"><![CDATA[<ul><li><a href="https://developers.google.cn/" target="_blank" rel="noopener noreferrer">Google Developers</a></li><li>Chrome下载地址<ul><li><a href="https://www.google.cn/intl/en_us/chrome/" target="_blank" rel="noopener noreferrer">Chrome</a></li><li><a href="https://www.google.cn/intl/en_us/chrome/beta/" target="_blank" rel="noopener noreferrer">Chrome beta</a></li></ul></li><li><a href="https://developer.android.google.cn/" target="_blank" rel="noopener noreferrer">Android Developer</a></li></ul>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="google" term="google"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[解决nuxt依赖Node原生模块导致构建失败问题]]></title>
        <id>/2022/09/04/fix-nuxt-node-fs-resolver-problem</id>
        <link href="https://blog.alanwei.com/blog/2022/09/04/fix-nuxt-node-fs-resolver-problem"/>
        <updated>2022-09-04T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[描述信息，默认为文章第一段]]></summary>
        <content type="html"><![CDATA[<p>修改 <code>nuxt.config.js</code> 中的 webpack 配置:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">nuxt.config.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ... 其他配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Build Configuration: https://go.nuxtjs.dev/config-build</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">build</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">extend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// #region 解决日志模块fs依赖问题</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">       * ref: https://stackoverflow.com/questions/40959835/webpack-express-cannot-resolve-module-fs-request-dependency-is-expression#40998972</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">       * ref: https://blog.csdn.net/guyue_01/article/details/125298203</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">       * ref: https://maikelveen.com/blog/how-to-solve-module-not-found-cant-resolve-fs-in-nextjs</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">       */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">node</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">fs</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"empty"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// #endregion</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="nuxt" term="nuxt"/>
        <category label="javascript" term="javascript"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Caching Tutorial for Web Authors and Webmasters]]></title>
        <id>/2022/08/21/cache-docs</id>
        <link href="https://blog.alanwei.com/blog/2022/08/21/cache-docs"/>
        <updated>2022-08-21T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[原文 Caching Tutorial for Web Authors and Webmasters]]></summary>
        <content type="html"><![CDATA[<p><a href="https://www.mnot.net/cache_docs/" target="_blank" rel="noopener noreferrer">原文 Caching Tutorial for Web Authors and Webmasters</a></p><p>This is an informational document. Although technical in nature, it attempts to make the concepts involved understandable and applicable in real-world situations. Because of this, some aspects of the material are simplified or omitted, for the sake of clarity. If you are interested in the minutia of the subject, please explore the <a href="https://www.mnot.net/cache_docs/#REF" target="_blank" rel="noopener noreferrer">References and Further Information</a> at the end.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="whats-a-web-cache-why-do-people-use-them">What’s a Web Cache? Why do people use them?<a class="hash-link" href="#whats-a-web-cache-why-do-people-use-them" title="Direct link to heading">​</a></h2><p>A Web cache sits between one or more Web servers (also known as <em>origin servers</em>) and a client or many clients, and watches requests come by, saving copies of the responses — like HTML pages, images and files (collectively known as <em>representations</em>) — for itself. Then, if there is another request for the same URL, it can use the response that it has, instead of asking the origin server for it again.</p><p>There are two main reasons that Web caches are used:</p><ul><li>To <strong>reduce latency</strong> — Because the request is satisfied from the cache (which is closer to the client) instead of the origin server, it takes less time for it to get the representation and display it. This makes the Web seem more responsive.</li><li><strong>To reduce network traffic</strong> — Because representations are reused, it reduces the amount of bandwidth used by a client. This saves money if the client is paying for traffic, and keeps their bandwidth requirements lower and more manageable.</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="kinds-of-web-caches">Kinds of Web Caches<a class="hash-link" href="#kinds-of-web-caches" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="browser-caches">Browser Caches<a class="hash-link" href="#browser-caches" title="Direct link to heading">​</a></h3><p>If you examine the preferences dialog of any modern Web browser (like Internet Explorer, Safari or Mozilla), you’ll probably notice a “cache” setting. This lets you set aside a section of your computer’s hard disk to store representations that you’ve seen, just for you. The browser cache works according to fairly simple rules. It will check to make sure that the representations are fresh, usually once a session (that is, the once in the current invocation of the browser).</p><p>This cache is especially useful when users hit the “back” button or click a link to see a page they’ve just looked at. Also, if you use the same navigation images throughout your site, they’ll be served from browsers’ caches almost instantaneously.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="proxy-caches">Proxy Caches<a class="hash-link" href="#proxy-caches" title="Direct link to heading">​</a></h3><p>Web proxy caches work on the same principle, but a much larger scale. Proxies serve hundreds or thousands of users in the same way; large corporations and ISPs often set them up on their firewalls, or as standalone devices (also known as <em>intermediaries</em>).</p><p>Because proxy caches aren’t part of the client or the origin server, but instead are out on the network, requests have to be routed to them somehow. One way to do this is to use your browser’s proxy setting to manually tell it what proxy to use; another is using interception. Interception proxies have Web requests redirected to them by the underlying network itself, so that clients don’t need to be configured for them, or even know about them.</p><p>Proxy caches are a type of shared cache; rather than just having one person using them, they usually have a large number of users, and because of this they are very good at reducing latency and network traffic. That’s because popular representations are reused a number of times.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="gateway-caches">Gateway Caches<a class="hash-link" href="#gateway-caches" title="Direct link to heading">​</a></h3><p>Also known as “reverse proxy caches” or “surrogate caches,” gateway caches are also intermediaries, but instead of being deployed by network administrators to save bandwidth, they’re typically deployed by Webmasters themselves, to make their sites more scalable, reliable and better performing.</p><p>Requests can be routed to gateway caches by a number of methods, but typically some form of load balancer is used to make one or more of them look like the origin server to clients.</p><p>Content delivery networks (CDNs) distribute gateway caches throughout the Internet (or a part of it) and sell caching to interested Web sites. Speedera and Akamai are examples of CDNs.</p><p>This tutorial focuses mostly on browser and proxy caches, although some of the information is suitable for those interested in gateway caches as well.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="arent-web-caches-bad-for-me-why-should-i-help-them">Aren’t Web Caches bad for me? Why should I help them?<a class="hash-link" href="#arent-web-caches-bad-for-me-why-should-i-help-them" title="Direct link to heading">​</a></h2><p>Web caching is one of the most misunderstood technologies on the Internet. Webmasters in particular fear losing control of their site, because a proxy cache can “hide” their users from them, making it difficult to see who’s using the site.</p><p>Unfortunately for them, even if Web caches didn’t exist, there are too many variables on the Internet to assure that they’ll be able to get an accurate picture of how users see their site. If this is a big concern for you, this tutorial will teach you how to get the statistics you need without making your site cache-unfriendly.</p><p>Another concern is that caches can serve content that is out of date, or stale. However, this tutorial can show you how to configure your server to control how your content is cached.</p><blockquote><p>CDNs are an interesting development, because unlike many proxy caches, their gateway caches are aligned with the interests of the Web site being cached, so that these problems aren’t seen. However, even when you use a CDN, you still have to consider that there will be proxy and browser caches downstream.</p></blockquote><p>On the other hand, if you plan your site well, caches can help your Web site load faster, and save load on your server and Internet link. The difference can be dramatic; a site that is difficult to cache may take several seconds to load, while one that takes advantage of caching can seem instantaneous in comparison. Users will appreciate a fast-loading site, and will visit more often.</p><p>Think of it this way; many large Internet companies are spending millions of dollars setting up farms of servers around the world to replicate their content, in order to make it as fast to access as possible for their users. Caches do the same for you, and they’re even closer to the end user. Best of all, you don’t have to pay for them.</p><p>The fact is that proxy and browser caches will be used whether you like it or not. If you don’t configure your site to be cached correctly, it will be cached using whatever defaults the cache’s administrator decides upon.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-web-caches-work">How Web Caches Work<a class="hash-link" href="#how-web-caches-work" title="Direct link to heading">​</a></h2><p>All caches have a set of rules that they use to determine when to serve a representation from the cache, if it’s available. Some of these rules are set in the protocols (HTTP 1.0 and 1.1), and some are set by the administrator of the cache (either the user of the browser cache, or the proxy administrator).</p><p>Generally speaking, these are the most common rules that are followed (don’t worry if you don’t understand the details, it will be explained below):</p><ul><li>If the response’s headers tell the cache not to keep it, it won’t.</li><li>If the request is authenticated or secure (i.e., HTTPS), it won’t be cached by shared caches.</li><li>A cached representation is considered fresh (that is, able to be sent to a client without checking with the origin server) if:<ul><li>It has an expiry time or other age-controlling header set, and is still within the fresh period, or</li><li>If the cache has seen the representation recently, and it was modified relatively long ago.</li><li>Fresh representations are served directly from the cache, without checking with the origin server.</li></ul></li><li>If a representation is stale, the origin server will be asked to validate it, or tell the cache whether the copy that it has is still good.</li><li>Under certain circumstances — for example, when it’s disconnected from a network — a cache can serve stale responses without checking with the origin server.</li></ul><p>If no validator (an <code>ETag</code> or <code>Last-Modified</code> header) is present on a response, <em>and</em> it doesn't have any explicit freshness information, it will usually — but not always — be considered uncacheable.</p><p>Together, freshness and validation are the most important ways that a cache works with content. A fresh representation will be available instantly from the cache, while a validated representation will avoid sending the entire representation over again if it hasn’t changed.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-and-how-not-to-control-caches">How (and how not) to Control Caches<a class="hash-link" href="#how-and-how-not-to-control-caches" title="Direct link to heading">​</a></h2><p>There are several tools that Web designers and Webmasters can use to fine-tune how caches will treat their sites. It may require getting your hands a little dirty with your server’s configuration, but the results are worth it. For details on how to use these tools with your server, see the <a href="https://www.mnot.net/cache_docs/#IMP-SERVER" target="_blank" rel="noopener noreferrer">Implementation</a> sections below.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="html-meta-tags-and-http-headers">HTML Meta Tags and HTTP Headers<a class="hash-link" href="#html-meta-tags-and-http-headers" title="Direct link to heading">​</a></h2><p>HTML authors can put tags in a document’s <code>&lt;HEAD&gt;</code> section that describe its attributes. These <em>meta tags</em> are often used in the belief that they can mark a document as uncacheable, or expire it at a certain time.</p><p>Meta tags are easy to use, but aren’t very effective. That’s because they’re only honored by a few browser caches, not proxy caches (which almost never read the HTML in the document). While it may be tempting to put a Pragma: no-cache meta tag into a Web page, it won’t necessarily cause it to be kept fresh.</p><blockquote><p>If your site is hosted at an ISP or hosting farm and they don’t give you the ability to set arbitrary HTTP headers (like <code>Expires</code> and <code>Cache-Control</code>), complain loudly; these are tools necessary for doing your job.</p></blockquote><p>On the other hand, true <em>HTTP</em> headers give you a lot of control over how both browser caches and proxies handle your representations. They can’t be seen in the HTML, and are usually automatically generated by the Web server. However, you can control them to some degree, depending on the server you use. In the following sections, you’ll see what HTTP headers are interesting, and how to apply them to your site.</p><p>HTTP headers are sent by the server before the HTML, and only seen by the browser and any intermediate caches. Typical HTTP 1.1 response headers might look like this:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 200 OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Date: Fri, 30 Oct 1998 13:19:41 GMT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Server: Apache/1.3.3 (Unix)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Cache-Control: max-age=3600, must-revalidate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Expires: Fri, 30 Oct 1998 14:19:41 GMT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Last-Modified: Mon, 29 Jun 1998 02:28:12 GMT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ETag: "3e86-410-3596fbbc"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Length: 1040</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: text/html</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The HTML would follow these headers, separated by a blank line. See the <a href="https://www.mnot.net/cache_docs/#IMP-SERVER" target="_blank" rel="noopener noreferrer">Implementation</a> sections for information about how to set HTTP headers.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="pragma-http-headers-and-why-they-dont-work">Pragma HTTP Headers (and why they don’t work)<a class="hash-link" href="#pragma-http-headers-and-why-they-dont-work" title="Direct link to heading">​</a></h2><p>Many people believe that assigning a Pragma: no-cache HTTP header to a representation will make it uncacheable. This is not necessarily true; the HTTP specification does not set any guidelines for Pragma response headers; instead, Pragma request headers (the headers that a browser sends to a server) are discussed. Although a few caches may honor this header, the majority won’t, and it won’t have any effect. Use the headers below instead.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="controlling-freshness-with-the-expires-http-header">Controlling Freshness with the Expires HTTP Header<a class="hash-link" href="#controlling-freshness-with-the-expires-http-header" title="Direct link to heading">​</a></h2><p>The Expires HTTP header is a basic means of controlling caches; it tells all caches how long the associated representation is fresh for. After that time, caches will always check back with the origin server to see if a document is changed. Expires headers are supported by practically every cache.</p><p>Most Web servers allow you to set Expires response headers in a number of ways. Commonly, they will allow setting an absolute time to expire, a time based on the last time that the client retrieved the representation (last access time), or a time based on the last time the document changed on your server (last <em>modification time</em>).</p><p>Expires headers are especially good for making static images (like navigation bars and buttons) cacheable. Because they don’t change much, you can set extremely long expiry time on them, making your site appear much more responsive to your users. They’re also useful for controlling caching of a page that is regularly changed. For instance, if you update a news page once a day at 6am, you can set the representation to expire at that time, so caches will know when to get a fresh copy, without users having to hit ‘reload’.</p><p>The <strong>only</strong> value valid in an Expires header is a HTTP date; anything else will most likely be interpreted as ‘in the past’, so that the representation is uncacheable. Also, remember that the time in a HTTP date is Greenwich Mean Time (GMT), not local time.</p><p>For example:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Expires: Fri, 30 Oct 1998 14:19:41 GMT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>It’s important to make sure that your Web server’s clock is accurate if you use the <code>Expires</code> header. One way to do this is using the <a href="http://www.ntp.org/" target="_blank" rel="noopener noreferrer">Network Time Protocol</a> (NTP); talk to your local system administrator to find out more.</p></blockquote><p>Although the <code>Expires</code> header is useful, it has some limitations. First, because there’s a date involved, the clocks on the Web server and the cache must be synchronised; if they have a different idea of the time, the intended results won’t be achieved, and caches might wrongly consider stale content as fresh.</p><p>Another problem with <code>Expires</code> is that it’s easy to forget that you’ve set some content to expire at a particular time. If you don’t update an <code>Expires</code> time before it passes, each and every request will go back to your Web server, increasing load and latency.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cache-control-http-headers">Cache-Control HTTP Headers<a class="hash-link" href="#cache-control-http-headers" title="Direct link to heading">​</a></h2><p>HTTP 1.1 introduced a new class of headers, Cache-Control response headers, to give Web publishers more control over their content, and to address the limitations of Expires.</p><p>Useful <code>Cache-Control</code> response headers include:</p><ul><li><code>max-age=</code>[seconds]<!-- --> — specifies the maximum amount of time that a representation will be considered fresh. Similar to <code>Expires</code>, this directive is relative to the time of the request, rather than absolute. <code>[seconds]</code> is the number of seconds from the time of the request you wish the representation to be fresh for.</li><li><code>s-maxage=</code>[seconds]<!-- --> — similar to <code>max-age</code>, except that it only applies to shared (e.g., proxy) caches.</li><li><code>public</code> — marks authenticated responses as cacheable; normally, if HTTP authentication is required, responses are automatically private.</li><li><code>private</code> — allows caches that are specific to one user (e.g., in a browser) to store the response; shared caches (e.g., in a proxy) may not.</li><li><code>no-cache</code> — forces caches to submit the request to the origin server for validation before releasing a cached copy, every time. This is useful to assure that authentication is respected (in combination with public), or to maintain rigid freshness, without sacrificing all of the benefits of caching.</li><li><code>no-store</code> — instructs caches not to keep a copy of the representation under any conditions.</li><li><code>must-revalidate</code> — tells caches that they must obey any freshness information you give them about a representation. HTTP allows caches to serve stale representations under special conditions; by specifying this header, you’re telling the cache that you want it to strictly follow your rules.</li><li><code>proxy-revalidate</code> — similar to <code>must-revalidate</code>, except that it only applies to proxy caches.</li></ul><p>For example:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Cache-Control: max-age=3600, must-revalidate</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When both <code>Cache-Control</code> and <code>Expires</code> are present, <code>Cache-Control</code> takes precedence. If you plan to use the <code>Cache-Control</code> headers, you should have a look at the excellent documentation in HTTP 1.1; see <a href="https://www.mnot.net/cache_docs/#REF" target="_blank" rel="noopener noreferrer">References and Further Information</a>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="validators-and-validation">Validators and Validation<a class="hash-link" href="#validators-and-validation" title="Direct link to heading">​</a></h2><p>In <a href="https://www.mnot.net/cache_docs/#WORK" target="_blank" rel="noopener noreferrer">How Web Caches Work</a>, we said that validation is used by servers and caches to communicate when a representation has changed. By using it, caches avoid having to download the entire representation when they already have a copy locally, but they’re not sure if it’s still fresh.</p><p>Validators are very important; if one isn’t present, and there isn’t any freshness information (<code>Expires</code> or <code>Cache-Control</code>) available, caches will not store a representation at all.</p><p>The most common validator is the time that the document last changed, as communicated in <code>Last-Modified</code> header. When a cache has a representation stored that includes a <code>Last-Modified</code> header, it can use it to ask the server if the representation has changed since the last time it was seen, with an <code>If-Modified-Since</code> request.</p><p>HTTP 1.1 introduced a new kind of validator called the <code>ETag</code>. ETags are unique identifiers that are generated by the server and changed every time the representation does. Because the server controls how the ETag is generated, caches can be sure that if the ETag matches when they make a <code>If-None-Match</code> request, the representation really is the same.</p><p>Almost all caches use Last-Modified times as validators; ETag validation is also becoming prevalent.</p><p>Most modern Web servers will generate both <code>ETag</code> and <code>Last-Modified</code> headers to use as validators for static content (i.e., files) automatically; you won’t have to do anything. However, they don’t know enough about dynamic content (like CGI, ASP or database sites) to generate them; see <a href="https://www.mnot.net/cache_docs/#SCRIPT" target="_blank" rel="noopener noreferrer">Writing Cache-Aware Scripts</a>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="tips-for-building-a-cache-aware-site">Tips for Building a Cache-Aware Site<a class="hash-link" href="#tips-for-building-a-cache-aware-site" title="Direct link to heading">​</a></h2><p>Besides using freshness information and validation, there are a number of other things you can do to make your site more cache-friendly.</p><ul><li>Use URLs consistently — this is the golden rule of caching. If you serve the same content on different pages, to different users, or from different sites, it should use the same URL. This is the easiest and most effective way to make your site cache-friendly. For example, if you use “/index.html” in your HTML as a reference once, always use it that way.</li><li>Use a common library of images and other elements and refer back to them from different places.</li><li>Make caches store images and pages that don’t change often by using a Cache-Control: max-age header with a large value.</li><li>Make caches recognise regularly updated pages by specifying an appropriate max-age or expiration time.</li><li>If a resource (especially a downloadable file) changes, change its name. That way, you can make it expire far in the future, and still guarantee that the correct version is served; the page that links to it is the only one that will need a short expiry time.</li><li>Don’t change files unnecessarily. If you do, everything will have a falsely young Last-Modified date. For instance, when updating your site, don’t copy over the entire site; just move the files that you’ve changed.</li><li>Use cookies only where necessary — cookies are difficult to cache, and aren’t needed in most situations. If you must use a cookie, limit its use to dynamic pages.</li><li>Check your pages with <a href="https://redbot.org/" target="_blank" rel="noopener noreferrer">REDbot</a> — it can help you apply many of the concepts in this tutorial.</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="writing-cache-aware-scripts">Writing Cache-Aware Scripts<a class="hash-link" href="#writing-cache-aware-scripts" title="Direct link to heading">​</a></h2><p>By default, most scripts won’t return a validator (a <code>Last-Modified</code> or <code>ETag</code> response header) or freshness information (<code>Expires</code> or <code>Cache-Control</code>). While some scripts really are dynamic (meaning that they return a different response for every request), many (like search engines and database-driven sites) can benefit from being cache-friendly.</p><p>Generally speaking, if a script produces output that is reproducible with the same request at a later time (whether it be minutes or days later), it should be cacheable. If the content of the script changes only depending on what’s in the URL, it is cacheable; if the output depends on a cookie, authentication information or other external criteria, it probably isn’t.</p><ul><li>The best way to make a script cache-friendly (as well as perform better) is to dump its content to a plain file whenever it changes. The Web server can then treat it like any other Web page, generating and using validators, which makes your life easier. Remember to only write files that have changed, so the <code>Last-Modified</code> times are preserved.</li><li>Another way to make a script cacheable in a limited fashion is to set an age-related header for as far in the future as practical. Although this can be done with <code>Expires</code>, it’s probably easiest to do so with <code>Cache-Control: max-age</code>, which will make the request fresh for an amount of time after the request.</li><li>If you can’t do that, you’ll need to make the script generate a validator, and then respond to <code>If-Modified-Since</code> and/or <code>If-None-Match</code> requests. This can be done by parsing the HTTP headers, and then responding with <code>304 Not Modified</code> when appropriate. Unfortunately, this is not a trival task.</li></ul><p>Some other tips;</p><ul><li><strong>Don’t use POST</strong> unless it’s appropriate. Responses to the POST method aren’t kept by most caches; if you send information in the path or query (via GET), caches can store that information for the future.</li><li><strong>Don’t embed user-specific information in the URL</strong> unless the content generated is completely unique to that user.</li><li><strong>Don’t count on all requests from a user coming from the same host</strong>, because caches often work together.</li><li><strong>Generate <code>Content-Length</code> response headers</strong>. It’s easy to do, and it will allow the response of your script to be used in a <em>persistent connection</em>. This allows clients to request multiple representations on one TCP/IP connection, instead of setting up a connection for every request. It makes your site seem much faster.</li></ul><p>See the <a href="https://www.mnot.net/cache_docs/#IMP-SCRIPT" target="_blank" rel="noopener noreferrer">Implementation Notes</a> for more specific information.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="frequently-asked-questions">Frequently Asked Questions<a class="hash-link" href="#frequently-asked-questions" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="what-are-the-most-important-things-to-make-cacheable">What are the most important things to make cacheable?<a class="hash-link" href="#what-are-the-most-important-things-to-make-cacheable" title="Direct link to heading">​</a></h3><p>A good strategy is to identify the most popular, largest representations (especially images) and work with them first.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-can-i-make-my-pages-as-fast-as-possible-with-caches">How can I make my pages as fast as possible with caches?<a class="hash-link" href="#how-can-i-make-my-pages-as-fast-as-possible-with-caches" title="Direct link to heading">​</a></h3><p>The most cacheable representation is one with a long freshness time set. Validation does help reduce the time that it takes to see a representation, but the cache still has to contact the origin server to see if it’s fresh. If the cache already knows it’s fresh, it will be served directly.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="i-understand-that-caching-is-good-but-i-need-to-keep-statistics-on-how-many-people-visit-my-page">I understand that caching is good, but I need to keep statistics on how many people visit my page!<a class="hash-link" href="#i-understand-that-caching-is-good-but-i-need-to-keep-statistics-on-how-many-people-visit-my-page" title="Direct link to heading">​</a></h3><p>If you must know every time a page is accessed, select ONE small item on a page (or the page itself), and make it uncacheable, by giving it a suitable headers. For example, you could refer to a 1x1 transparent uncacheable image from each page. The Referer header will contain information about what page called it.</p><p>Be aware that even this will not give truly accurate statistics about your users, and is unfriendly to the Internet and your users; it generates unnecessary traffic, and forces people to wait for that uncached item to be downloaded. For more information about this, see On Interpreting Access Statistics in the <a href="https://www.mnot.net/cache_docs/#REF" target="_blank" rel="noopener noreferrer">references</a>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-can-i-see-a-representations-http-headers">How can I see a representation’s HTTP headers?<a class="hash-link" href="#how-can-i-see-a-representations-http-headers" title="Direct link to heading">​</a></h3><p>Many Web browsers let you see the <code>Expires</code> and <code>Last-Modified</code> headers are in a “page info” or similar interface. If available, this will give you a menu of the page and any representations (like images) associated with it, along with their details.</p><p>To see the full headers of a representation, you can manually connect to the Web server using a Telnet client.</p><p>To do so, you may need to type the port (be default, 80) into a separate field, or you may need to connect to <code>www.example.com:80</code> or <code>www.example.com 80</code> (note the space). Consult your Telnet client’s documentation.</p><p>Once you’ve opened a connection to the site, type a request for the representation. For instance, if you want to see the headers for <a href="http://www.example.com/foo.html" target="_blank" rel="noopener noreferrer">http://www.example.com/foo.html</a>, connect to <a href="http://www.example.com" target="_blank" rel="noopener noreferrer">www.example.com</a>, port 80, and type:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /foo.html HTTP/1.1 [return]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Host: www.example.com [return][return]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Press the Return key every time you see <code>[return];</code> make sure to press it twice at the end. This will print the headers, and then the full representation. To see the headers only, substitute HEAD for GET.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="my-pages-are-password-protected-how-do-proxy-caches-deal-with-them">My pages are password-protected; how do proxy caches deal with them?<a class="hash-link" href="#my-pages-are-password-protected-how-do-proxy-caches-deal-with-them" title="Direct link to heading">​</a></h3><p>By default, pages protected with HTTP authentication are considered private; they will not be kept by shared caches. However, you can make authenticated pages public with a Cache-Control: public header; HTTP 1.1-compliant caches will then allow them to be cached.</p><p>If you’d like such pages to be cacheable, but still authenticated for every user, combine the <code>Cache-Control: public</code> and <code>no-cache</code> headers. This tells the cache that it must submit the new client’s authentication information to the origin server before releasing the representation from the cache. This would look like:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Cache-Control: public, no-cache</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Whether or not this is done, it’s best to minimize use of authentication; for example, if your images are not sensitive, put them in a separate directory and configure your server not to force authentication for it. That way, those images will be naturally cacheable.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="should-i-worry-about-security-if-people-access-my-site-through-a-cache">Should I worry about security if people access my site through a cache?<a class="hash-link" href="#should-i-worry-about-security-if-people-access-my-site-through-a-cache" title="Direct link to heading">​</a></h3><p><code>https://</code> pages are not cached (or decrypted) by proxy caches, so you don’t have to worry about that. However, because caches store <code>http:// </code>responses and URLs fetched through them, you should be conscious about unsecured sites; an unscrupulous administrator could conceivably gather information about their users, especially in the URL.</p><p>In fact, any administrator on the network between your server and your clients could gather this type of information. One particular problem is when CGI scripts put usernames and passwords in the URL itself; this makes it trivial for others to find and use their login.</p><p>If you’re aware of the issues surrounding Web security in general, you shouldn’t have any surprises from proxy caches.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="im-looking-for-an-integrated-web-publishing-solution-which-ones-are-cache-aware">I’m looking for an integrated Web publishing solution. Which ones are cache-aware?<a class="hash-link" href="#im-looking-for-an-integrated-web-publishing-solution-which-ones-are-cache-aware" title="Direct link to heading">​</a></h3><p>It varies. Generally speaking, the more complex a solution is, the more difficult it is to cache. The worst are ones which dynamically generate all content and don’t provide validators; they may not be cacheable at all. Speak with your vendor’s technical staff for more information, and see the Implementation notes below.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="my-images-expire-a-month-from-now-but-i-need-to-change-them-in-the-caches-now">My images expire a month from now, but I need to change them in the caches now!<a class="hash-link" href="#my-images-expire-a-month-from-now-but-i-need-to-change-them-in-the-caches-now" title="Direct link to heading">​</a></h3><p>The Expires header can’t be circumvented; unless the cache (either browser or proxy) runs out of room and has to delete the representations, the cached copy will be used until then.</p><p>The most effective solution is to change any links to them; that way, completely new representations will be loaded fresh from the origin server. Remember that any page that refers to these representations will be cached as well. Because of this, it’s best to make static images and similar representations very cacheable, while keeping the HTML pages that refer to them on a tight leash.</p><p>If you want to reload a representation from a specific cache, you can either force a reload (in Firefox, holding down shift while pressing ‘reload’ will do this by issuing a Pragma: no-cache request header) while using the cache. Or, you can have the cache administrator delete the representation through their interface.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="i-run-a-web-hosting-service-how-can-i-let-my-users-publish-cache-friendly-pages">I run a Web Hosting service. How can I let my users publish cache-friendly pages?<a class="hash-link" href="#i-run-a-web-hosting-service-how-can-i-let-my-users-publish-cache-friendly-pages" title="Direct link to heading">​</a></h3><p>If you’re using Apache, consider allowing them to use .htaccess files and providing appropriate documentation.</p><p>Otherwise, you can establish predetermined areas for various caching attributes in each virtual server. For instance, you could specify a directory /cache-1m that will be cached for one month after access, and a /no-cache area that will be served with headers instructing caches not to store representations from it.</p><p>Whatever you are able to do, it is best to work with your largest customers first on caching. Most of the savings (in bandwidth and in load on your servers) will be realized from high-volume sites.
I’ve marked my pages as cacheable, but my browser keeps requesting them on every request. How do I force the cache to keep representations of them?</p><p>Caches aren’t required to keep a representation and reuse it; they’re only required to not keep or use them under some conditions. All caches make decisions about which representations to keep based upon their size, type (e.g., image vs. html), or by how much space they have left to keep local copies. Yours may not be considered worth keeping around, compared to more popular or larger representations.</p><p>Some caches do allow their administrators to prioritize what kinds of representations are kept, and some allow representations to be “pinned” in cache, so that they’re always available.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="implementation-notes--web-servers">Implementation Notes — Web Servers<a class="hash-link" href="#implementation-notes--web-servers" title="Direct link to heading">​</a></h3><p>Generally speaking, it’s best to use the latest version of whatever Web server you’ve chosen to deploy. Not only will they likely contain more cache-friendly features, new versions also usually have important security and performance improvements.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="apache-http-server">Apache HTTP Server<a class="hash-link" href="#apache-http-server" title="Direct link to heading">​</a></h3><p>Apache uses optional modules to include headers, including both Expires and Cache-Control. Both modules are available in the 1.2 or greater distribution.</p><p>The modules need to be built into Apache; although they are included in the distribution, they are not turned on by default. To find out if the modules are enabled in your server, find the httpd binary and run httpd -l; this should print a list of the available modules (note that this only lists compiled-in modules; on later versions of Apache, use httpd -M to include dynamically loaded modules as well). The modules we’re looking for are expires_module and headers_module.</p><ul><li>If they aren’t available, and you have administrative access, you can recompile Apache to include them. This can be done either by uncommenting the appropriate lines in the Configuration file, or using the <code>-enable-module=expires</code> and -enable-module=headers arguments to configure (1.3 or greater). Consult the INSTALL file found with the Apache distribution.</li></ul><p>Once you have an Apache with the appropriate modules, you can use mod_expires to specify when representations should expire, either in .htaccess files or in the server’s access.conf file. You can specify expiry from either access or modification time, and apply it to a file type or as a default. See the module documentation for more information, and speak with your local Apache guru if you have trouble.</p><p>To apply Cache-Control headers, you’ll need to use the mod_headers module, which allows you to specify arbitrary HTTP headers for a resource. See the <a href="http://www.apache.org/docs/mod/mod_expires.html" target="_blank" rel="noopener noreferrer">mod_headers documentation</a>.</p><p>Here’s an example .htaccess file that demonstrates the use of some headers.</p><ul><li><code>.htaccess</code> files allow web publishers to use commands normally only found in configuration files. They affect the content of the directory they’re in and their subdirectories. Talk to your server administrator to find out if they’re enabled.</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">### activate mod_expires</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExpiresActive On</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Expire .gif's 1 month from when they're accessed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExpiresByType image/gif A2592000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Expire everything else 1 day from when it's last modified</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### (this uses the Alternative syntax)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExpiresDefault "modification plus 1 day"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Apply a Cache-Control header to index.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;Files index.html&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Header append Cache-Control "public, must-revalidate"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/Files&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Note that mod_expires automatically calculates and inserts a <code>Cache-Control:max-age</code> header as appropriate.</li></ul><p>Apache 2’s configuration is very similar to that of 1.3; see the 2.2 <a href="http://httpd.apache.org/docs/2.2/mod/mod_expires.html" target="_blank" rel="noopener noreferrer">mod_expires</a> and <a href="http://httpd.apache.org/docs/2.2/mod/mod_headers.html" target="_blank" rel="noopener noreferrer">mod_headers</a> documentation for more information.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="microsoft-iis">Microsoft IIS<a class="hash-link" href="#microsoft-iis" title="Direct link to heading">​</a></h2><p>Microsoft’s Internet Information Server makes it very easy to set headers in a somewhat flexible way. Note that this is only possible in version 4 of the server, which will run only on NT Server.</p><p>To specify headers for an area of a site, select it in the Administration Tools interface, and bring up its properties. After selecting the HTTP Headers tab, you should see two interesting areas; Enable Content Expiration and Custom HTTP headers. The first should be self-explanatory, and the second can be used to apply Cache-Control headers.</p><p>See the ASP section below for information about setting headers in Active Server Pages. It is also possible to set headers from ISAPI modules; refer to MSDN for details.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="netscapeiplanet-enterprise-server">Netscape/iPlanet Enterprise Server<a class="hash-link" href="#netscapeiplanet-enterprise-server" title="Direct link to heading">​</a></h2><p>As of version 3.6, Enterprise Server does not provide any obvious way to set Expires headers. However, it has supported HTTP 1.1 features since version 3.0. This means that HTTP 1.1 caches (proxy and browser) will be able to take advantage of Cache-Control settings you make.</p><p>To use Cache-Control headers, choose Content Management | Cache Control Directives in the administration server. Then, using the Resource Picker, choose the directory where you want to set the headers. After setting the headers, click ‘OK’. For more information, see the NES manual.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="implementation-notes--server-side-scripting">Implementation Notes — Server-Side Scripting<a class="hash-link" href="#implementation-notes--server-side-scripting" title="Direct link to heading">​</a></h2><blockquote><p>One thing to keep in mind is that it may be easier to set HTTP headers with your Web server rather than in the scripting language. Try both.</p></blockquote><p>Because the emphasis in server-side scripting is on dynamic content, it doesn’t make for very cacheable pages, even when the content could be cached. If your content changes often, but not on every page hit, consider setting a Cache-Control: max-age header; most users access pages again in a relatively short period of time. For instance, when users hit the ‘back’ button, if there isn’t any validator or freshness information available, they’ll have to wait until the page is re-downloaded from the server to see it.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cgi">CGI<a class="hash-link" href="#cgi" title="Direct link to heading">​</a></h2><p>CGI scripts are one of the most popular ways to generate content. You can easily append HTTP response headers by adding them before you send the body; Most CGI implementations already require you to do this for the Content-Type header. For instance, in Perl;</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/usr/bin/perl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print "Content-type: text/html\n";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print "Expires: Thu, 29 Oct 1998 17:04:19 GMT\n";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print "\n";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### the content body follows...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Since it’s all text, you can easily generate Expires and other date-related headers with in-built functions. It’s even easier if you use Cache-Control: max-age;</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">print "Cache-Control: max-age=600\n";</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will make the script cacheable for 10 minutes after the request, so that if the user hits the ‘back’ button, they won’t be resubmitting the request.</p><p>The CGI specification also makes request headers that the client sends available in the environment of the script; each header has ‘HTTP_’ prepended to its name. So, if a client makes an If-Modified-Since request, it will show up as HTTP_IF_MODIFIED_SINCE.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="server-side-includes">Server Side Includes<a class="hash-link" href="#server-side-includes" title="Direct link to heading">​</a></h2><p>SSI (often used with the extension .shtml) is one of the first ways that Web publishers were able to get dynamic content into pages. By using special tags in the pages, a limited form of in-HTML scripting was available.</p><p>Most implementations of SSI do not set validators, and as such are not cacheable. However, Apache’s implementation does allow users to specify which SSI files can be cached, by setting the group execute permissions on the appropriate files, combined with the XbitHack full directive. For more information, see the mod_include documentation.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="php">PHP<a class="hash-link" href="#php" title="Direct link to heading">​</a></h3><p>PHP is a server-side scripting language that, when built into the server, can be used to embed scripts inside a page’s HTML, much like SSI, but with a far larger number of options. PHP can be used as a CGI script on any Web server (Unix or Windows), or as an Apache module.</p><p>By default, representations processed by PHP are not assigned validators, and are therefore uncacheable. However, developers can set HTTP headers by using the Header() function.</p><p>For example, this will create a Cache-Control header, as well as an Expires header three days in the future:</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Header("Cache-Control: must-revalidate");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> $offset = 60 * 60 * 24 * 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> $ExpStr = "Expires: " . gmdate("D, d M Y H:i:s", time() + $offset) . " GMT";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Header($ExpStr);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">?&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Remember that the Header() function MUST come before any other output.</p><p>As you can see, you’ll have to create the HTTP date for an Expires header by hand; PHP doesn’t provide a function to do it for you (although recent versions have made it easier; see the PHP's date documentation). Of course, it’s easy to set a Cache-Control: max-age header, which is just as good for most situations.</p><p>For more information, see the manual entry for header.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cold-fusion">Cold Fusion<a class="hash-link" href="#cold-fusion" title="Direct link to heading">​</a></h3><p>Cold Fusion, by Macromedia is a commercial server-side scripting engine, with support for several Web servers on Windows, Linux and several flavors of Unix.</p><p>Cold Fusion makes setting arbitrary HTTP headers relatively easy, with the CFHEADER tag. Unfortunately, their example for setting an Expires header, as below, is a bit misleading.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;CFHEADER NAME="Expires" VALUE="#Now()#"&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It doesn’t work like you might think, because the time (in this case, when the request is made) doesn’t get converted to a HTTP-valid date; instead, it just gets printed as a representation of Cold Fusion’s Date/Time object. Most clients will either ignore such a value, or convert it to a default, like January 1, 1970.</p><p>However, Cold Fusion does provide a date formatting function that will do the job; GetHttpTimeString. In combination with DateAdd, it’s easy to set Expires dates; here, we set a header to declare that representations of the page expire in one month;</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;cfheader name="Expires" </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value="#GetHttpTimeString(DateAdd('m', 1, Now()))#"&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can also use the CFHEADER tag to set Cache-Control: max-age and other headers.</p><p>Remember that Web server headers are passed through in some deployments of Cold Fusion (such as CGI); check yours to determine whether you can use this to your advantage, by setting headers on the server instead of in Cold Fusion.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="asp-and-aspnet">ASP and ASP.NET<a class="hash-link" href="#asp-and-aspnet" title="Direct link to heading">​</a></h3><p>When setting HTTP headers from ASPs, make sure you either place the Response method calls before any HTML generation, or use Response.Buffer to buffer the output. Also, note that some versions of IIS set a Cache-Control: private header on ASPs by default, and must be declared public to be cacheable by shared caches.</p><p>Active Server Pages, built into IIS and also available for other Web servers, also allows you to set HTTP headers. For instance, to set an expiry time, you can use the properties of the Response object;</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;% Response.Expires=1440 %&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>specifying the number of minutes from the request to expire the representation. <code>Cache-Control</code> headers can be added like this:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;% Response.CacheControl="public" %&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In ASP.NET, Response.Expires is deprecated; the proper way to set cache-related headers is with Response.Cache;</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Response.Cache.SetExpires ( DateTime.Now.AddMinutes ( 60 ) ) ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Response.Cache.SetCacheability ( HttpCacheability.Public ) ;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="references-and-further-information">References and Further Information<a class="hash-link" href="#references-and-further-information" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="http-11-specification"><a href="http://www.ietf.org/rfc/rfc2616.txt" target="_blank" rel="noopener noreferrer">HTTP 1.1 Specification</a><a class="hash-link" href="#http-11-specification" title="Direct link to heading">​</a></h3><p>The HTTP 1.1 spec has many extensions for making pages cacheable, and is the authoritative guide to implementing the protocol. See sections 13, 14.9, 14.21, and 14.25.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="web-cachingcom"><a href="http://www.web-caching.com/" target="_blank" rel="noopener noreferrer">Web-Caching.com</a><a class="hash-link" href="#web-cachingcom" title="Direct link to heading">​</a></h3><p>An excellent introduction to caching concepts, with links to other online resources.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="on-interpreting-access-statistics"><a href="http://www.goldmark.org/netrants/webstats/" target="_blank" rel="noopener noreferrer">On Interpreting Access Statistics</a><a class="hash-link" href="#on-interpreting-access-statistics" title="Direct link to heading">​</a></h3><p>Jeff Goldberg’s informative rant on why you shouldn’t rely on access statistics and hit counters.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redbot"><a href="https://redbot.org/" target="_blank" rel="noopener noreferrer">REDbot</a><a class="hash-link" href="#redbot" title="Direct link to heading">​</a></h3><p>Examines HTTP resources to determine how they will interact with Web caches, and generally how well they use the protocol.
About This Document</p><p>This document is Copyright © 1998-2013 Mark Nottingham <em><a href="mailto:mnot@mnot.net" target="_blank" rel="noopener noreferrer">mnot@mnot.net</a></em>. This work is licensed under a Creative Commons Attribution-Noncommercial-No Derivative Works 3.0 Unported License.</p><p>All trademarks within are property of their respective holders.</p><p>Although the author believes the contents to be accurate at the time of publication, no liability is assumed for them, their application or any consequences thereof. If any misrepresentations, errors or other need for clarification is found, please contact the author immediately.</p><p>The latest revision of this document can always be obtained from <a href="https://www.mnot.net/cache_docs/" target="_blank" rel="noopener noreferrer">https://www.mnot.net/cache_docs/</a></p><p>Translations are available in: Chinese, Czech, German, and French.</p>]]></content>
        <author>
            <name>Mark Nottingham</name>
        </author>
        <category label="HTTP" term="HTTP"/>
        <category label="Cache" term="Cache"/>
        <category label="CDN" term="CDN"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[GraphQL 项目搭建]]></title>
        <id>/2022/07/21/graphql-intro</id>
        <link href="https://blog.alanwei.com/blog/2022/07/21/graphql-intro"/>
        <updated>2022-07-21T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[GraphQL 简介, 最佳实践]]></summary>
        <content type="html"><![CDATA[<blockquote><p>本文转摘自公众号文章: <a href="https://mp.weixin.qq.com/s/TjfmpwFbL4gvznc06T30-A" target="_blank" rel="noopener noreferrer">GraphQL实践 </a></p></blockquote><p>随着业务的增长，页面涉及的业务线越来越多, 为了实现一个需求, 需要调用多个接口组合数据, 然后绑定到 UI 组件上. 每个接口返回的数据会有很多字段是不会使用的, 浪费了网络流量. 为了解决该问题, 我们小组引入了 GraphQL 作为 BFF 层, 利用 GraphQL 服务减少网络请求次数, 以及数据裁减能力减少网络响应数据量.</p><p>下面简单介绍一下我们组的 GraphQL Node 服务端项目的搭建过程.</p><p>我们在搭建 GraphQL 项目时, 采用了 <a href="https://expressjs.com/" target="_blank" rel="noopener noreferrer">Express</a> 搭配 <a href="https://www.apollographql.com/docs/apollo-server" target="_blank" rel="noopener noreferrer">Apollo GraphQL</a> 方式.</p><blockquote><p>GraphQL 社区的 Node 方案除了 Apollo GraphQL, 还有个<a href="https://www.graphql-yoga.com/docs/integrations/integration-with-express" target="_blank" rel="noopener noreferrer">Yoga</a> 可以使用. 当然也可以直接使用 Facebook 的 <a href="https://github.com/graphql/graphql-js" target="_blank" rel="noopener noreferrer">GraphQL.js</a></p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="express--apollo-graphql">Express + Apollo GraphQL<a class="hash-link" href="#express--apollo-graphql" title="Direct link to heading">​</a></h2><p><strong>安装依赖</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> apollo-server-express apollo-server-core express graphql</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>启动代码</strong></p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">server.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> ApolloServer </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"apollo-server-express"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> ApolloServerPluginDrainHttpServer </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"apollo-server-core"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> express </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"express"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> http </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"http"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">startApolloServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">typeDefs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resolvers</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">void</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 创建expres实例</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">express</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> http </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 初始化 ApolloServer, 并添加 ApolloServerPluginDrainHttpServer 插件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 该插件能让你的HTTP服务器优雅关闭</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> server </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ApolloServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    typeDefs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resolvers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cache</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"bounded"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plugins</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token function" style="color:#d73a49">ApolloServerPluginDrainHttpServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> http </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 必须等待 Apollo Server启动完成之后, 再执行 server.applyMiddleware</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">applyMiddleware</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    app</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> app</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 设置 GraphQL 监听的URL路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/graphql"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Modified server startup</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name builtin">Promise</span><span class="token class-name operator" style="color:#393A34">&lt;</span><span class="token class-name keyword" style="color:#00009f">void</span><span class="token class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resolve</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">listen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> port</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4000</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resolve</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Server ready at http://localhost:4000/</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>Apollo Server 也可以单独使用, 也可以使用对应 Web 框架的集成包, <code>ApolloServer</code> 需要从对应的集成包里导入.</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="自动加载合并-schema-和-resolvers">自动加载合并 schema 和 resolvers<a class="hash-link" href="#自动加载合并-schema-和-resolvers" title="Direct link to heading">​</a></h2><p>随着项目越来越大, 如果 GraphQL 类型文件和对应的 resolver 都放在一个文件里会变的难以维护, 可以使用 <a href="https://www.npmjs.com/package/@graphql-tools/merge" target="_blank" rel="noopener noreferrer">@graphql-tools/merge</a> 缓解该问题. </p><p>下面的配置代码, 会自动加载 <code>src/schema/graphqls</code> 目录下的所有后缀名为 <code>.gql</code>和<code>.graphql</code> 的schema文件, 以及 <code>src/schema/resolvers</code> 下所有扩展名为 <code>.ts</code>和<code>.js</code> 的JS代码文件作为resolver:</p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/schema/index.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> loadFilesSync </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@graphql-tools/load-files"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> mergeTypeDefs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> mergeResolvers </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@graphql-tools/merge"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> ApolloServer </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"apollo-server-express"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 这里会加载合并目录 src/schema/graphqls 及其子目录下的所有扩展名为 gql 和 graphql 的GraphQL文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> typeDefsArray </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">loadFilesSync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"./schema/graphqls"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  recursive</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  extensions</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"gql"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"graphql"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 这里会加载 src/schema/resolvers 目录及子目录下的所有扩展名为 ts 和 js 的文件作为 resolver</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 扩展名包含 ts 是为了方便本地开发, 实际部署之后不会有 ts 文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * exportNames 表示 resolver 文件需要导出名为 resolvers 的对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> resolversArray </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">loadFilesSync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"./schema/resolvers"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  recursive</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  extensions</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"ts"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"js"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ignoreIndex</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  exportNames</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"resolvers"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> typeDefs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mergeTypeDefs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">typeDefsArray</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> resolvers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mergeResolvers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resolversArray</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 下面就可以直接使用上面加载的 typeDefs 和 resolvers</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> server </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ApolloServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  typeDefs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resolvers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ... 其他选项</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者调用 <code>@graphql-tools/schema</code> 包里的 <code>makeExecutableSchema</code> 方法处理之后再传给 <code>ApolloServer</code>:</p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/server.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> makeExecutableSchema </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@graphql-tools/schema"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> server </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ApolloServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  schema</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">makeExecutableSchema</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    typeDefs</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> typeDefs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resolvers</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> resolvers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ... 其他选项</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="代理">代理<a class="hash-link" href="#代理" title="Direct link to heading">​</a></h2><p>本地开发调试, 有时需要 Mock 某个后端接口, 或者查看实际应用发起了哪些网络请求, 可以通过配置 Node.js 应用代理来解决. 或者应用部署之后使用代理访问受限资源.</p><p>虽然 Apollo Server 支持 Node.js 标准的代理配置: <a href="https://nodejs.org/api/https.html#https_https_globalagent" target="_blank" rel="noopener noreferrer">https.globalAgent</a> 和 <a href="https://nodejs.org/api/http.html#http_http_globalagent" target="_blank" rel="noopener noreferrer">http.globalAgent</a>, 不过推荐使用更加方便的第三方类库 <a href="https://github.com/gajus/global-agent#global-agent" target="_blank" rel="noopener noreferrer">global-agent</a>， 该类库支持使用环境变量(<code>HTTP_PROXY</code>, <code>NO_AGENT</code>)设置代理(而 Node.js 是不支持的, 而且<a href="https://github.com/nodejs/node/issues/15620" target="_blank" rel="noopener noreferrer">也许以后也不打算支持</a>.).</p><p><strong>安装</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> global-agent</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>使用</strong></p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> ApolloServer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gql </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"apollo-server"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> bootstrap </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"global-agent"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 设置代理</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">bootstrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 创建服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> server </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ApolloServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  typesDefs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resolvers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cache</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"bounded"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后启动项目时设置环境变量 <code>GLOBAL_AGENT_HTTP_PROXY=http://localhost:3210</code> 即可设置代理.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="http-cache">HTTP Cache<a class="hash-link" href="#http-cache" title="Direct link to heading">​</a></h2><p>关于 HTTP 缓存有两个重要的概念: 新鲜度 和 有效性. 服务器通过输出<code>Cache-Control</code>和<code>Expires</code>响应头来标识资源在多长时间内是新鲜的. 比如服务器端输出 <code>Cache-Control: max-age=300</code> 告诉客户端 5 分钟内资源都是新鲜的, 无需重复向服务器请求该资源. 对于不常变化的资源使用该方式是一种不错的选择. 然后 5 分钟之后, 客户端就会再次向服务器发送请求获取资源, 即便资源并没有发生变化.</p><p>为了避免客户端因为无法知晓资源是否新鲜而重新下载资源, 可以使用<code>Last-Modified</code>, <code>ETag</code>响应头标识资源的有效性. 如果服务器设置了响应头<code>Last-Modified</code>, 客户端可以发送请求头 <code>If-Modifies-Since</code> 避免再次下载已经缓存但未发生变化的资源. 也可以使用响应头 <code>ETag</code> 标识资源版本来避免重复下载.</p><p>利用新鲜度和有效性相关的响应头可以有效控制浏览器端缓存和 CDN 缓存.</p><p>由于 GraphQL 服务默认使用 <code>POST</code> 请求, 而<code>POST</code>请求无法利用上述提到的 HTTP 响应头缓存资源, 导致 GraphQL 给人们的第一印象是缓存不友好.</p><p>虽然技术上, GraphQL 也支持<code>GET</code>请求, 但是由于客户端请求 GraphQL 服务的时候需要传递 query schema, 如果使用<code>GET</code>请求有可能导致 URL 长度超过浏览器或者服务器端的最大限制.</p><p>所以要想 GraphQL 服务使用 HTTP 缓存, 就必须解决<code>GET</code>请求的 URL 长度问题.</p><p>对于<code>GET</code>请求问题, GraphQL 社区提出了<a href="https://www.apollographql.com/blog/apollo-client/persisted-graphql-queries/" target="_blank" rel="noopener noreferrer">持久化查询</a>的解决方案. 下面简单介绍一下我们基于此思路搭建的持久化查询实现:</p><ul><li>客户端<ol><li>开发人员直接在前端项目里编写 query schema 文件</li><li>通过命令行和集成工具自动将 query schema 文件生成一个文件名为内容 hash 的文件, 然后将 hash 文件名对应的文件上传到一个远端存储空间(可以是数据库、文件系统等), 同时脚本会生成一个包含 query schema 文件名和对应文件内容 hash 的配置文件</li><li>在实际业务代码里通过文件名引用 query schema, 封装的请求 GraphQL 服务的代码会将文件名替换成真正的 hash 文件名, 传给 GraphQL 服务, 实际发起的网络请求为: <code>/graphql?query-hash=5d41402abc4b2a76b9719d911017c592&amp;variables=xxxx</code></li></ol></li><li>服务器端<ol><li>服务器端接收到<code>GET</code>请求之后, 解析<code>query-hash</code>参数, 然后根据该参数值去存储空间获取真正的 query schema.</li><li>服务器端拿到 query schema 之后就可以响应资源了</li></ol></li></ul><p>流程图如下(<a href="https://gitee.com/alanway/resources/raw/master/images/GraphQL-diagram-persist-query.png" target="_blank" rel="noopener noreferrer">查看大图</a>):</p><img src="https://gitee.com/alanway/resources/raw/master/images/GraphQL-diagram-persist-query.png" alt="https://gitee.com/alanway/resources/raw/master/images/GraphQL-diagram-persist-query.png" referrerpolicy="no-referrer"><p>使用该方式即解决了 URL 长度问题, 也能保证 query schema 是可信的, 防止恶意用户查询嵌套层级很深的 schema.</p><p>由于GraphQL的一次查询请求, 可能会涉及多个后端接口, 而每个后端接口根据业务场景可缓存时长是不同的, 那么本次查询的可缓存时间取决于后端接口中最小的缓存时长. 虽然可以利用GraphQL的指令特性, 细粒度控制缓存响应头, 但是我们目前并没有这么做, 因为给每个type增加缓存指令, 是一件很繁琐的事情. 我们目前的解决方式是由前端请求GraphQL服务时通过URL参数指定本次查询的缓存时长, 比如 <code>/graphql?query-hash=xxx&amp;variables=xxx&amp;_cache=300</code>, 这里的URL参数 <code>_cache=300</code> 表示GraphQL响应数据的时候设置响应头 <code>Cache-Control: max-age=300</code>. </p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="请求后端接口">请求后端接口<a class="hash-link" href="#请求后端接口" title="Direct link to heading">​</a></h2><p>GraphQL 服务器端调用后端接口时, 可以使用<a href="https://github.com/apollographql/apollo-server/tree/main/packages/apollo-datasource-rest" target="_blank" rel="noopener noreferrer">RESTDataSource</a>和<a href="https://github.com/graphql/dataloader" target="_blank" rel="noopener noreferrer">DataLoader</a>优化网络请求次数.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="restdatasource">RESTDataSource<a class="hash-link" href="#restdatasource" title="Direct link to heading">​</a></h3><p><code>RESTDataSource</code>实例内部会自动缓存<code>GET</code>请求, URL 相同的<code>GET</code>请求会只会发起一次(具体实现代码参考<a href="https://github.com/apollographql/apollo-server/blob/8cc8437d011800aac1b6e79d4561bc6019186bfe/packages/apollo-datasource-rest/src/RESTDataSource.ts#L273" target="_blank" rel="noopener noreferrer">RESTDataSource.ts#L273</a>). 比如以下代码虽然请求了两次后端接口, 但是实际后端只会接收到一次请求:</p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">RESTDataSource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> user_1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/user"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> user_2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/user"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 这里的 user_1 和 user_2 实际是同一个 Promise 对象</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="dataloader">DataLoader<a class="hash-link" href="#dataloader" title="Direct link to heading">​</a></h3><p><code>DataLoader</code>对于批量查询很有帮助, 考虑以下场景:</p><p>服务器端有以下 Schema 定义, 并支持商品列表查询:</p><div class="language-graphql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-graphql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">Query</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token description string" style="color:#e3116c">"</span><span class="token description string language-markdown" style="color:#e3116c">商品列表</span><span class="token description string" style="color:#e3116c">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">goodsPagingList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">pageSize</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token scalar">Int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">pageIndex</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token scalar">Int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token class-name">Good</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token description string" style="color:#e3116c">"</span><span class="token description string language-markdown" style="color:#e3116c">商品信息</span><span class="token description string" style="color:#e3116c">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">Good</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">skuId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token scalar">ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">title</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token scalar">String</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">price</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token scalar">Float</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">seriesId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token scalar">Int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token description string" style="color:#e3116c">"</span><span class="token description string language-markdown" style="color:#e3116c">商品关联的车系信息</span><span class="token description string" style="color:#e3116c">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">series</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">SeriesInfo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token description string" style="color:#e3116c">"</span><span class="token description string language-markdown" style="color:#e3116c">车系信息</span><span class="token description string" style="color:#e3116c">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">SeriesInfo</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">seriesId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token scalar">Int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">seriesName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token scalar">String</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">seriesImage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token scalar">String</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>对应 resolver 实现如下:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> resolvers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">Query</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function-variable function" style="color:#d73a49">goodsPagingList</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">parent</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> args</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">dataSources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/goods"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">Good</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function-variable function" style="color:#d73a49">series</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter"> seriesId </span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> args</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">dataSources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/series"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">seriesId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> seriesId </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果列表有 10 条商品数据, 上述的<code>context.dataSources.series.getSeriesInfo</code>会调用 10 次接口, 加上商品列表接口, 总共向后端请求了 11 次接口. 利用 <code>DataLoader</code> 可以实现批量查询, 减少接口调用次数:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> loader </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">DataLoader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">seriesIds</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/series"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">seriesIds</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> seriesIds</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">","</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 假设 /series 接口支持批量查询, 多个车系id用逗号分割</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后上述 <code>Good.series</code> 的 resolver 就可以使用 <code>loader.load(seriesId)</code> 读取单个车系信息, <code>DataLoader</code>内部会维护一个队列, 使用 <a href="https://github.com/graphql/dataloader/blob/main/src/index.js#L232" target="_blank" rel="noopener noreferrer">process.nextTick</a>(Node 环境)延迟批量调用后端接口. 使用<code>DataLoader</code>之后, 上述实际只会调用 2 次后端接口.</p><p>使用<code>DataLoader</code>需要注意以下两点:</p><ol><li><code>DataLoader</code>要求第一个参数<code>batchLoadFn</code>返回的数据顺序和入参的 id 顺序(即上述示例代码里的<code>seriesIds</code>参数)必须保持一致, 因为<code>DataLoader</code>内部利用这个顺序来和 id 对应起来, 用于<code>load</code>/<code>loadMany</code>方法返回正确的数据.</li><li>上述示例比较简单, 接口只需要 id 参数, 但是在实际业务场景中, 有可能除了 id 还有很多其他参数, 比如接口<code>/series?seriesIds=1,2,3&amp;cityId=110100&amp;seriesLevel=5</code>, 这个时候就需要重写 <code>DataLoader</code> 第二个参数里的<code>cacheKeyFn</code>函数, 默认情况下该参数使用 id 作为 key.</li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="apollo-server-plugin">Apollo Server Plugin<a class="hash-link" href="#apollo-server-plugin" title="Direct link to heading">​</a></h2><p>借助 Apollo Server 插件系统, 可以很方便扩展一些功能</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="其他技巧">其他技巧<a class="hash-link" href="#其他技巧" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="自动生成-typescript-类型定义代码">自动生成 TypeScript 类型定义代码<a class="hash-link" href="#自动生成-typescript-类型定义代码" title="Direct link to heading">​</a></h3><p>为了方便开发, 可以借助<a href="https://www.graphql-code-generator.com/docs/getting-started/installation" target="_blank" rel="noopener noreferrer">@graphql-codegen/cli</a>自动生成GraphQL schema文件中定义的类型.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="集成测试">集成测试<a class="hash-link" href="#集成测试" title="Direct link to heading">​</a></h3><p>Apollo Server 提供了两种e2e测试方法:</p><ul><li>使用 <code>ApolloServer</code> 的 <code>executeOperation</code></li><li>直接向Apollo Server发起HTTP请求</li></ul><p>下面是使用 <code>ApolloServer.executeOperation</code> 方法的测试示例:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">ApolloServer</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> gql </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"apollo-server"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">describe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"sample"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"e2e demo"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> server </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ApolloServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">typeDefs</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> gql</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string graphql language-graphql"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string graphql language-graphql">      </span><span class="token template-string graphql language-graphql keyword" style="color:#00009f">type</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql class-name">Query</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql punctuation" style="color:#393A34">{</span><span class="token template-string graphql language-graphql"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string graphql language-graphql">        </span><span class="token template-string graphql language-graphql attr-name" style="color:#00a4db">hello</span><span class="token template-string graphql language-graphql punctuation" style="color:#393A34">(</span><span class="token template-string graphql language-graphql attr-name" style="color:#00a4db">name</span><span class="token template-string graphql language-graphql punctuation" style="color:#393A34">:</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql scalar">String</span><span class="token template-string graphql language-graphql punctuation" style="color:#393A34">)</span><span class="token template-string graphql language-graphql punctuation" style="color:#393A34">:</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql scalar">String</span><span class="token template-string graphql language-graphql operator" style="color:#393A34">!</span><span class="token template-string graphql language-graphql"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string graphql language-graphql">      </span><span class="token template-string graphql language-graphql punctuation" style="color:#393A34">}</span><span class="token template-string graphql language-graphql"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string graphql language-graphql">      </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">resolvers</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">Query</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token function-variable function" style="color:#d73a49">hello</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">_</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> </span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter"> name </span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Hello </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">name</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">executeOperation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">query</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">query Say($name: String) { hello(name: $name) }</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">variables</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"world"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">errors</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toBeUndefined</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">data</span><span class="token operator" style="color:#393A34">?.</span><span class="token plain">hello</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toBe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Hello world"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="references">References<a class="hash-link" href="#references" title="Direct link to heading">​</a></h2><ul><li><a href="https://www.zhihu.com/question/264563447/answer/282533202" target="_blank" rel="noopener noreferrer">为什么互联网公司开始用 node.js 做 web 服务的中间层？有什么好处吗？</a></li><li><a href="https://samnewman.io/patterns/architectural/bff/" target="_blank" rel="noopener noreferrer">Pattern: Backends For Frontends</a></li><li><a href="https://www.apollographql.com/blog/backend/caching/graphql-caching-the-elephant-in-the-room/" target="_blank" rel="noopener noreferrer">GraphQL &amp; Caching: The Elephant in the Room</a></li><li><a href="https://www.graphql-tools.com/docs/schema-merging" target="_blank" rel="noopener noreferrer">Schema merging - GraphQL Tools</a></li><li><a href="https://www.apollographql.com/blog/backend/caching/graphql-caching-the-elephant-in-the-room/" target="_blank" rel="noopener noreferrer">GraphQL &amp; Caching: The Elephant in the Room</a></li><li><a href="https://www.apollographql.com/blog/community/5-benefits-of-static-graphql-queries/" target="_blank" rel="noopener noreferrer">5 benefits of static GraphQL queries</a></li><li><a href="https://www.apollographql.com/blog/community/graphql-dx-d35bcf51c943/" target="_blank" rel="noopener noreferrer">An enhanced GraphQL developer experience with TypeScript</a></li></ul>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="javascript" term="javascript"/>
        <category label="graphql" term="graphql"/>
        <category label="typescript" term="typescript"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[为什么try catch能捕捉await后promise错误？ 和执行栈有关系吗？]]></title>
        <id>/2022/07/12/await-try-catch</id>
        <link href="https://blog.alanwei.com/blog/2022/07/12/await-try-catch"/>
        <updated>2022-07-12T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[为什么try catch 中promise的错误catch不了。 await后就可以catch了？  普通函数不能try catch promise，因为其throw error时的执行栈，和try catch它的函数无关了。   而async await能像generate一样在控制执行流，触发时，函数执行栈恢复到 try catch它时的函数执行栈，所以能try catch。]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="问题">问题<a class="hash-link" href="#问题" title="Direct link to heading">​</a></h2><p><strong>为什么try catch能捕捉await后promise错误？ 和执行栈有关系吗？</strong></p><p>为什么try catch 中promise的错误catch不了。 await后就可以catch了？</p><p>普通函数不能try catch promise，因为其throw error时的执行栈，和try catch它的函数无关了。</p><p>而async await能像generate一样在控制执行流，触发时，函数执行栈恢复到 try catch它时的函数执行栈，所以能try catch。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="回答">回答<a class="hash-link" href="#回答" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cat-chen">Cat Chen<a class="hash-link" href="#cat-chen" title="Direct link to heading">​</a></h3><blockquote><p>来源 <a href="https://www.zhihu.com/question/522726685/answer/2397695233" target="_blank" rel="noopener noreferrer">Cat Chen</a></p></blockquote><p>因为这是 <code>await</code> 的功能的一部分，而且必须设计成这样。没有 <code>await</code> 时，你的表达式返回一个 <code>Promise</code> ，然后代码就继续往前执行了，不会等这个 <code>Promise</code> resolve 或 reject 。有了 <code>await</code> 之后，代码不会立即继续往前执行，而是停下来等 Promise 的返回值，有返回值才能继续往前执行。 Promise 有返回值的本质是什么？是 Promise resolve 了。所以 <code>await</code> 可以简单理解为把 <code>await</code> 之后的代码放进了这个 Promise 的 then 里面，这是大多数人可以理解的。很多人没有意识到的是，这个设计还必须考虑 Promise reject 了该怎么办。还继续往前执行吗？这样设计显然有问题，因为代码无法区分 resolve 和 reject。那如何才能让 await 之后的代码区分出到底 Promise 是 resolve 了还是 reject 了呢？最符合直觉的设计是把 reject 看作 throw，把 reject 传递的值用作 throw 表达式需要的值。这种直观的设计使得 await 表达式跟没有 await 一样，成功了就继续往前执行，出错了就 throw 然后外面可以 catch。当然，实际发生的事情并不是这么简单，因为 await 只能用在 async 函数里面，async 函数本质是返回一个 Promise，所以如果 await 进行了 throw，没有 catch 的话 throw 出来的东西就变成 async 函数层面的 reject。如果 catch 了呢？你可以把整个 try-catch 表达式看作另外一层 await，如果 catch 了那 try-catch 后面的代码就继续往前执行。</p>]]></content>
        <author>
            <name>知乎</name>
        </author>
        <category label="知乎" term="知乎"/>
        <category label="JavaScript" term="JavaScript"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Pass all props to children in Vue]]></title>
        <id>/2022/07/12/pass-all-props-to-children</id>
        <link href="https://blog.alanwei.com/blog/2022/07/12/pass-all-props-to-children"/>
        <updated>2022-07-12T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[将父组件的所有属性传递给子组件]]></summary>
        <content type="html"><![CDATA[<p>在Vue中，将父组件的所有属性透传给子组件.</p><p>原文 <a href="https://dev.to/jwkicklighter/pass-all-props-to-children-in-vue-9on" target="_blank" rel="noopener noreferrer">Pass all props to children in Vue </a></p><p>传给父组件的的属性数据, 如果没有在父组件的<code>props</code>里声明，都会包含在了<code>$attrs</code>里, 使用下面方式可以将属性头传给子组件:</p><div class="language-vue codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-vue codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;template&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;comp2 v-bind="$props" v-bind="$attrs" /&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/template&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;script&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  export default {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    components: Comp2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/script&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者</p><div class="language-vue codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-vue codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;template&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;comp2 v-bind="{ ...$props, ...$attrs }" /&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/template&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;script&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  export default {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    components: Comp2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/script&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Jordan Kicklighter</name>
            <uri>https://dev.to/jwkicklighter/pass-all-props-to-children-in-vue-9on</uri>
        </author>
        <category label="vue" term="vue"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[async/await异步模型是否优于stackful coroutine模型？]]></title>
        <id>/2022/07/12/why-async-await-better-stackful-coroutine</id>
        <link href="https://blog.alanwei.com/blog/2022/07/12/why-async-await-better-stackful-coroutine"/>
        <updated>2022-07-12T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[这里说的coroutine是stackful的，可以对比js的async/await和fibjs，还有c#的async/await对比go的goroutine。 async/await的优点是不需要为每个coroutine分配单独的栈内存，只需要一个闭包保存状态，避免了内存浪费；在调度上也更加灵活，可以让用户手动调度；另外在实现上也不需要改动虚拟机，只要在语言层面加上generator的支持就可以实现。那么是不是可以认为async/await是一个更好的异步方案呢？]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="问题">问题<a class="hash-link" href="#问题" title="Direct link to heading">​</a></h2><p><strong>async/await异步模型是否优于stackful coroutine模型？</strong></p><p>这里说的coroutine是stackful的，可以对比js的async/await和fibjs，还有c#的async/await对比go的goroutine。</p><p>async/await的优点是不需要为每个coroutine分配单独的栈内存，只需要一个闭包保存状态，避免了内存浪费；在调度上也更加灵活，可以让用户手动调度；另外在实现上也不需要改动虚拟机，只要在语言层面加上generator的支持就可以实现。那么是不是可以认为async/await是一个更好的异步方案呢？</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="回答">回答<a class="hash-link" href="#回答" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="乔捷">乔捷<a class="hash-link" href="#乔捷" title="Direct link to heading">​</a></h3><blockquote><p>原文 <a href="https://www.zhihu.com/question/65647171/answer/233781797" target="_blank" rel="noopener noreferrer">乔捷</a>
自答一波，好多答案里似乎都搞错了概念，导致了一些无谓的争议。这里谈一下我的理解。</p></blockquote><p>首先coroutine
是个很宽泛的概念，async/await</p><p>也属于coroutine的一种。但是问题是拿async/await和stackful coroutine比较。所谓stackful是指每个coroutine有独立的运行栈，比如每个goroutine会分配一个4k的内存来做为运行栈，切换goroutine的时候运行栈也会切换。stackful的好处在于这种coroutine是完整的，coroutine可以嵌套、循环。</p><p>与stackful对应的是stackless coroutine，比如generator,continuation
，这类coroutine不需要分配单独的栈空间，coroutine状态保存在闭包里，但缺点是功能比较弱，不能被嵌套调用，也没办法和异步函数</p><p>配合使用进行控制流的调度，所以基本上没办法跟stackful coroutine做比较。</p><p>但是async/await的出现，实现了基于stackless coroutine的完整coroutine。在特性上已经非常接近stackful coroutine了，不但可以嵌套使用也可以支持try catch。所以是不是可以认为async/await是一个更好的方案？</p><p>最后有个匿名用户死活在哪里纠结并发需要多线程，这里我统一做个回复。很多人是从多核时代入行的，看到的异步框架都是使用了线程池，所以想当然的认为并发必须依赖多线程去处理，更有人连并发和并行的概念都搞混，认为单核CPU就不能并发了。实际上并发这个概念在没有多核CPU甚至没有线程的年代（早期的Linux是没有线程的）就有了。并发一般特指IO，IO是独立于CPU的设备，IO设备通常远远慢于CPU，所以我们引入了并发的概念，让CPU可以一次性发起多个IO操作而不用等待IO设备做完一个操作再做令一个。怎么实现呢？原理就是非阻塞操作+事件通知，在核心态非阻塞操作对应的是读写端口和DMA，而事件通知则有专门的术语叫中断响应。过程有2种，一种是IO设备发起中断告诉CPU现在可以进行IO操作，然后CPU进行相应的操作，还有一种是CPU先发起IO操作，然后IO设备完成处理后发起中断告诉CPU操作完成。在核心态是不存在多线程这种概念的，一切都是异步的事件驱动（中断响应），线程是核心给用户态提供的高层概念，线程本身也依赖中断来进行调度。早期的用户态IO并发处理是用poll(select)模型去轮询IO状态，然后发起相应的IO操作，称之为事件响应式的异步模型，这种方式并不容易使用，所以又发展出了阻塞式IO操作，让逻辑挂起并等待IO完成，为了让阻塞式IO能够并发就必须依赖多线程或者多进程模型来实现。但是线程的开销是非常大的，当遇到大规模并发的时候多线程模型就无法胜任了。所以大规模并发时我们又退回去使用事件响应，epoll在本质上还是poll模型，只是在算法上优化了实现，此时我们只用单线程就可以处理上万的并发请求了。直到多核CPU的出现，我们发现只用一个线程是无法发挥多核CPU的威力的，所以再次引入线程池来分摊IO操作的CPU消耗，甚至CPU的中断响应也可以由多个核来分摊执行，此时的线程数量是大致等于CPU的核心数而远小于并发IO数的（这时CPU能处理百万级的并发），线程的引入完全是为了负载均衡而跟并发没有关系。所以不管是用select/epoll/iocp在逻辑层都绕不开基于事件响应的异步操作，面对异步逻辑本身的复杂性，我们才引入了async/await以及coroutine来降低复杂性。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="朱元">朱元<a class="hash-link" href="#朱元" title="Direct link to heading">​</a></h3><blockquote><p>原文 <a href="https://www.zhihu.com/question/65647171/answer/233495694" target="_blank" rel="noopener noreferrer">朱元</a></p></blockquote><p>我们要先想清楚:问题是什么？</p><p>当代码遇到一个“暂时不能完成”的流程时（例如建立一个tcp链接，可能需要5ms才能建立），他不想阻塞在这里睡眠，想暂时离开现场yield</p><p>去干点别的事情（例如看看另外一个已经建立的链接是否可以收包了）。问题是：离开现场后，当你回来的时候，上下文还像你走的时候吗？</p><p>跳转离开，在任何语言里都有2种最基本的方法：1）从当前函数返回； 2）调用一个新的函数。 前者会把上下文中的局部变量和函数参数全部摧毁，除非他返回前把这些变量找个别的地方保存起来；后者则能保护住整个上下文的内存（除了函数返回之后会摧毁一些我们高级语言所看不见的寄存器），而且跳转回来也是常规方法：函数返回。</p><p>async/await和有栈协程的区别就在于，在这里分别选用了这2种方法：</p><p>前者（async/await）在函数返回前把那些变量临时保存在堆的某个地方，然后把存放地址传回去，当你想返回现场的时候，把这些变量恢复，并跳转回离开时候那个语句；持有指针语义的c/c++语言则略麻烦：因为可能这些局部变量中有谁持有另一个局部变量的地址，这样“值语义”的恢复就会把他们变成野指针，所以需要在进入函数时所有的局部变量和函数参数都在堆上分配，这样就不会有谁持有离开时栈上下文的指针了，换句话说，对c/c++来说，这是一种无栈协程(有些自己写的无栈协程库提供你在堆上面分配局部变量的接口，或者强迫你在进入这个函数前把要用到的所有局部变量在堆上面分配好内存)，其它语言只要没有值语义或变量天生不放栈上就没这个概念。如果使用闭包语法返回现场，可以只需要恢复闭包中捕获的变量；对于c++，在离开现场时不能提前析构掉那些没有被捕获的变量（否则析构顺序未必是构造顺序的反序，其实这个c++规则真是没必要）。所以从C++的观点来说，这是一种彻头彻尾的“假”函数返回(有垃圾回收器的语言倒是有可能走到async之后的语句后，回收前面已经不用的临时变量)。</p><p>后者（有栈协程）在离开前只需要把函数调用中可能被破坏的callee-saved 寄存器给保存在当前栈就完事了（别的协程和当前协程栈是完全隔离的，不会破坏自己堆栈），跳转回来的时候把在栈中保存的寄存器</p><p>都恢复了并跳转回离开时候那个语句就行了。</p><p>综上：前者（尤其是c、c++）需要编译器的特殊支持，对使用了async/await语义的函数中的局部变量的分配，恢复进行些特殊的处理；后者则只需要写写汇编就搞定了（一般需要给 进入协程入口函数，协程间切换，协程函数入口函数返回后回收协程资源并切换去另一个协程 这3个地方写点汇编，也有的协程库把这3种情况都统一起来处理）。</p><p>谁优谁劣呢？</p><p>语法友好度：衡量这个玩意儿的标准，莫过于“逻辑聚合性”：逻辑相关的代码能否写在相近的代码处。例如 redis/nginx中处处可见这种上下文被分割的代码，因为任何一个“暂时不能完成“的场景都会把场景前后代码逻辑写在完全不同的两个函数里。。对于async/await 或无栈协程语义，c/c++在没有闭包之前的，还需要达夫设备跳转回离开现场的那行代码，有了闭包之后，上下文之间就只被<code>return ( [xxx](){</code> 分开了，代码可以认为基本没有被分割( C# 新版js, VC和clang实验性的resumable function连这点分开都没有了)；不过依然远远比不上有栈协程，因为他语法完全是常规的函数调用/函数返回，使用hook之类的手法甚至可以把已有的阻塞代码自动yield加无阻塞化（参见libco, libgo）。可以认为在这一项：前者在得到现代化编译器辅助后，和后者相近但依然有差距且容易对一些常识产生挑战；后者语法非常适合传统编程逻辑。</p><p>时间/空间效率：async/await 语义执行的是传统的函数调用函数返回流程，没有对栈指针进行手工修改操作，cpu对return stack buffer的跳转预测优化继续有效；有栈协程需要在创建时根据协程代码执行的最坏情况提前分配好协程函数的栈，这往往都分配的过大而缺乏空间效率，而且在协程间切换的时候手工切换栈，从而破坏了return stack buffer跳转预测，协程切换后函数的每一次返回都意味着一次跳转预测失效，所以流程越复杂有栈协程的切换开销越大（非对称调度的有栈协程会降低一些这方面的开销，boost新版有栈协程彻底抛弃了对称协程）。对于async/await 语义实践的无栈协程，如果允许提前析构不被捕获的C++变量，或者你返回前手工销毁或者你用的是带垃圾回收器的语言，空间效率会更佳。 可以认为在这一项：前者远胜后者，而且后者会随着你业务复杂度加深以及cpu流水线的变长（还好奔4过后的架构不怎么涨了）而不断变差。笔者写的yuanzhubi/call_in_stack yuanzhubi/local_hook， 以及一个没有开源的jump assembler（把有栈协程切换后的代码输出的汇编语句中的ret指令全部换成pop+jmp指令再编译，避开return stack buffer 预测失败）都是来优化有栈协程在时间/空间的表现的 。</p><p>调度：其实2者都是允许用户自己去管理调度事宜的，不过前者必须返回由调度函数选择下一个无栈协程的切入，后者允许”深度优先调度“：即当某个协程发现有“暂时不能完成“的场景时自己可以根据当前场景选择一个逻辑相关的协程进行切入，提升内存访问局部性，不过这对使用者的要求和业务侵入度非常高。。整体而言的话，可以认为在这一项：前者和后者大致持平，前者是集中式管理而后者是分布式管理</p><p>，后者可以挖掘的潜力更高但对使用者要求很高且未必能适应业务的变更。</p><p>结论：性能上，前者有一定时间优势但不是精雕细琢的多用途公共开源组件完全可以忽略，而空间上前者超越后者很多；易用度上，前者正在快速演进 慢慢的追上后者（c#这样的async/await鼻祖已经完全不存在这个问题）；和已有组件的可结合度上，后者始终保持优势（不管已有组件是源码还是二进制）。孰优孰劣，如何侧重，如何选择（如果你们有选择的机会的话），，也许 纯属你头儿的口味问题吧 哈哈哈。</p><p>看到很多同学提状态机，其实这种理解没有什么问题，而是人和编译器的观点有所不同：人会抽象出很多状态，在痛苦这些状态如何在各种上下文跳转中传递和保存（状态机）; 编译器则在痛苦怪异的上下文跳转中，局部变量的保存和恢复(无栈协程)。 前者会自行决定某些局部变量是“真的局部”变量，后续无需恢复了；后者会把他们全盘考虑下来，把所有的量都要在各个状态间传递和保存（当然有的语言可以智能些，按需传递）。从本质来说，如果是由编译器来玩状态机实现的async/await和无栈协程的，概念上没有什么区别。 人才说状态，机器只说变量，内存这些。</p>]]></content>
        <category label="知乎" term="知乎"/>
        <category label="JavaScript" term="JavaScript"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[TypeScript禁用规则]]></title>
        <id>/2022/06/17/typescript-ignore-rules</id>
        <link href="https://blog.alanwei.com/blog/2022/06/17/typescript-ignore-rules"/>
        <updated>2022-06-17T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[原文 - How to Ignore and Disable TypeScript Rules]]></summary>
        <content type="html"><![CDATA[<p><a href="https://smartdevpreneur.com/typescript-eslint-ignore-and-disable-type-rules/" target="_blank" rel="noopener noreferrer">原文 - How to Ignore and Disable TypeScript Rules</a></p><p>在TypeScript文件中禁用规则:</p><ul><li><code>@ts-ignore</code> – TypeScript-ESLint syntax for ignoring TypeScript rules</li><li><code>eslint-disable-next-line</code> – ESLint and TypeScript-ESLint syntax for disabling non-ts rules</li><li><code>tslint:disable-next-line</code> – deprecated TSLint syntax</li></ul><p>例如:</p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// @ts-ignore</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> num </span><span class="token operator" style="color:#393A34">:</span><span class="token builtin">number</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'A'</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="typescript" term="typescript"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[解决 TypeScript 中出现的 'this' implicitly has type 'any' error 问题]]></title>
        <id>/2022/06/17/typescript-this-implicitly-has-type-any</id>
        <link href="https://blog.alanwei.com/blog/2022/06/17/typescript-this-implicitly-has-type-any"/>
        <updated>2022-06-17T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[解决 TypeScript 中出现的 'this' implicitly has type 'any' error 问题]]></summary>
        <content type="html"><![CDATA[<p><a href="https://bobbyhadz.com/blog/typescript-this-implicitly-has-type-any" target="_blank" rel="noopener noreferrer">原文 - Fix - 'this' implicitly has type 'any' error in TypeScript</a></p><p>在TypeScript中, 如果在class外部或者function内部使用<code>this</code>时, TypeScript无法推导出<code>this</code>类型, 导致提示以下错误:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">'this' implicitly has type 'any' error</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>要解决这个问题需要在函数的第一个参数指定<code>this</code>的类型即可:</p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Employee</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">constructor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> salary</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">salary </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> salary</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">Employee</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">getSalary</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Employee</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">prototype</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function-variable function" style="color:#d73a49">getSalary</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Employee</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// add a parameter to type `this`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">salary</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="typescript" term="typescript"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[计算两个矩形重叠面积]]></title>
        <id>/2022/06/11/calculate-tow-square-overlap</id>
        <link href="https://blog.alanwei.com/blog/2022/06/11/calculate-tow-square-overlap"/>
        <updated>2022-06-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[计算两个矩形是否重叠, 以及重叠面积]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="算法解释">算法解释<a class="hash-link" href="#算法解释" title="Direct link to heading">​</a></h2><p>算法逻辑来自 <a href="https://www.zhihu.com/question/28854765/answer/42331859" target="_blank" rel="noopener noreferrer">两个矩形的相交面积，怎么求算法效率相对较高？ - ying xiong的回答 - 知乎</a></p><p>假设矩形的边都平行于坐标轴，分别表示为<code>(left1,top1,right1,bottom1)</code>, <code>(left2,top2,right2,bottom2)</code>，则相交部分必定也是矩形，算 <em>长 x 宽</em> 就可以.</p><p>相交部分的宽，可以看成两个矩形的宽，在x轴上的投影的长度, 也就是两条线段的总长度，减去重叠之后新线段的长度. 按下图示意，算出 A+B-W 就可以了:
<img loading="lazy" src="https://pic4.zhimg.com/80/90abf969396e4b3110419bfd2f24a56d_720w.jpg?source=1940ef5c" alt="示意图" class="img_ev3q"></p><p>用矩形坐标套进去，就是 <code>overlapX = (right1-left1)+(right2-left2) - ( max(right1,right2) - min(left1,left2) )</code>不管A B两条线段怎么移来移去，谁长谁短，这个式子都不变的，如果是 &lt;=0，自然是没有相交.</p><p>同理再算出高就可以了。</p><blockquote><p>作者：ying xiong
链接：<a href="https://www.zhihu.com/question/28854765/answer/42331859" target="_blank" rel="noopener noreferrer">https://www.zhihu.com/question/28854765/answer/42331859</a>
来源：知乎
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="javascript实现">JavaScript实现<a class="hash-link" href="#javascript实现" title="Direct link to heading">​</a></h2><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 计算重叠面积</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {{left: number, right: number, top: number, bottom: number}} pos1 </span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {{left: number, right: number, top: number, bottom: number}} pos2 </span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">elementInterectArea</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">pos1</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> pos2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> pos1Width </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pos1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">right</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> pos1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">left</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> pos1Height </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pos1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">bottom</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> pos1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">top</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> pos2Width </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pos2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">right</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> pos2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">left</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> pos2Height </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pos2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">bottom</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> pos2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">top</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> axisOverlap </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pos1Width </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> pos2Width </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pos1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">right</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pos2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pos1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">left</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pos2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">left</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> crossOverlap </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pos1Height </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> pos2Height </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pos1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">bottom</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pos2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">bottom</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pos1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">top</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pos2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">top</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">axisOverlap </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> crossOverlap </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> axisOverlap </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> crossOverlap</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 下面计算两个HTML元素的重叠面积</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> area </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">elementInterectArea</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">element1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getBoundingClientRect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> element2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getBoundingClientRect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>将遮住元素全部删除JS <a target="_blank" href="/assets/files/hide-overlap-360229f673b3aa73edf902c6fd35748c.js">hide-verlap.js</a>.</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="javascript" term="javascript"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[如何设置Ubuntu 20.04 的时区]]></title>
        <id>/2022/05/22/how-to-change-ubuntu-timezone</id>
        <link href="https://blog.alanwei.com/blog/2022/05/22/how-to-change-ubuntu-timezone"/>
        <updated>2022-05-22T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[文章来源 How To Set or Change Timezone on Ubuntu 20.04]]></summary>
        <content type="html"><![CDATA[<blockquote><p>文章来源 <a href="https://linuxize.com/post/how-to-set-or-change-timezone-on-ubuntu-20-04/" target="_blank" rel="noopener noreferrer">How To Set or Change Timezone on Ubuntu 20.04</a></p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="检查当前时区">检查当前时区<a class="hash-link" href="#检查当前时区" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">timedatectl show</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>输出如下:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Timezone=Asia/Shanghai</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LocalRTC=no</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CanNTP=yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NTP=yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NTPSynchronized=yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TimeUSec=Sun 2022-05-22 09:21:19 CST</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RTCTimeUSec=Sun 2022-05-22 09:21:19 CST</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>系统时区被配置成软连接(symlink)方式, 当前时区对应软连接 <code>/etc/localtime</code>, 该软连接指向 <code>/usr/share/zoneinfo</code> 目录下的某个二进制时区文件:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ls -al /etc/localtime </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lrwxrwxrwx 1 root root 33 Mar 25 06:26 /etc/localtime -&gt; /usr/share/zoneinfo/Asia/Shanghai</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>系统时区同时也会写入到文件<code>/etc/timezone</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ cat /etc/timezone </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Asia/Shanghai</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用命令-timedatectl-修改时区">使用命令 <code>timedatectl</code> 修改时区<a class="hash-link" href="#使用命令-timedatectl-修改时区" title="Direct link to heading">​</a></h2><p>可以使用命令 <code>timedatectl list-timezones</code> 显示所有可用时区名称, 该命令相当于列出<code>/usr/share/zoneinfo</code>目录下所有文件.</p><p>一旦找到自己想要设置的时区名称, 可以使用以下命令设置当前系统的时区:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> timedatectl set-timezone your_time_zone</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="linux" term="linux"/>
        <category label="ubuntu" term="ubuntu"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[使用Linux命令行检测硬件信息]]></title>
        <id>/2022/05/21/linux-devices-info</id>
        <link href="https://blog.alanwei.com/blog/2022/05/21/linux-devices-info"/>
        <updated>2022-05-21T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[使用命令行查看系统硬件信息, 文章摘自Check Ubuntu Hardware Info.]]></summary>
        <content type="html"><![CDATA[<p>使用命令行查看系统硬件信息, 文章摘自<a href="https://linuxhint.com/check_ubuntu_hardware_info/" target="_blank" rel="noopener noreferrer">Check Ubuntu Hardware Info</a>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="dmidecode">dmidecode<a class="hash-link" href="#dmidecode" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> dmidecode -t4 </span><span class="token comment" style="color:#999988;font-style:italic"># CPU硬件信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> dmidecode -t17 </span><span class="token comment" style="color:#999988;font-style:italic"># 内存条硬件信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> dmidecode -t2 </span><span class="token comment" style="color:#999988;font-style:italic"># 显示主板(Motherboard)信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> dmidecode -t10 </span><span class="token comment" style="color:#999988;font-style:italic"># 显示主板上的显卡活声卡信息</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="lshw">lshw<a class="hash-link" href="#lshw" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> lshw -short </span><span class="token comment" style="color:#999988;font-style:italic"># 列出所有硬件的摘要信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 显示硬盘详细信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># -class 参数支持 system, bus, memory, processor, disk, storage, bridge, generic, display, volume, bus, network, multimedia, input.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> lshw -class disk </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="inxi">inxi<a class="hash-link" href="#inxi" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 安装 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -y inxi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> inxi -bxx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="其他">其他<a class="hash-link" href="#其他" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">free</span><span class="token plain"> -h </span><span class="token comment" style="color:#999988;font-style:italic"># 显示内存大小及占用信息</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="linux" term="linux"/>
        <category label="ubuntu" term="ubuntu"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Dockerfile 指定 entrypoint 之后运行报 exec format error 错误]]></title>
        <id>/2022/05/15/docker-entrypoint-exec-format-error</id>
        <link href="https://blog.alanwei.com/blog/2022/05/15/docker-entrypoint-exec-format-error"/>
        <updated>2022-05-15T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Dockerfile 指定 entrypoint 脚本后, 运行提示一下错误:]]></summary>
        <content type="html"><![CDATA[<p><code>Dockerfile</code> 指定 <code>entrypoint</code> 脚本后, 运行提示一下错误:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">standard_init_linux.go:228: exec user process caused: exec format error</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这种情况尝试给 <code>entrypoint</code> 指定的shell脚本添加shebang:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">entrypoint.sh</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">code-server --config /code-server/config.yaml /app </span><span class="token comment" style="color:#999988;font-style:italic"># 你的脚本内容</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>来源: <a href="https://bobcares.com/blog/docker-exec-format-error/" target="_blank" rel="noopener noreferrer">Docker exec format error – How we sort it out?</a>: </p></blockquote><blockquote><p>The shebang is always on the first line of the script, and is composed of <code>#!</code> Characters. So the Shebang (<code>#!/bin/bash</code>) should be put on the first line of the script because the first bytes were checked by kernel. So we add the shebang in the script.</p></blockquote>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="docker" term="docker"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[开放 docker daemon TCP 端口号 2375]]></title>
        <id>/2022/05/14/docker-daemon-tcp-port</id>
        <link href="https://blog.alanwei.com/blog/2022/05/14/docker-daemon-tcp-port"/>
        <updated>2022-05-14T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[docker 默认会创建一个 socket(/var/run/docker.sock) 供 docker daemon 链接使用, 这个socket一般必须是root账号才能链接. docker daemon 同时支持开发一个tcp端口号供外部使用, 开放步骤如下:]]></summary>
        <content type="html"><![CDATA[<p>docker 默认会创建一个 socket(<em>/var/run/docker.sock</em>) 供 docker daemon 链接使用, 这个socket一般必须是root账号才能链接. docker daemon 同时支持开发一个tcp端口号供外部使用, 开放步骤如下:</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="重写-dockerservice-文件">重写 <em>docker.service</em> 文件<a class="hash-link" href="#重写-dockerservice-文件" title="Direct link to heading">​</a></h2><p>手动创建并编辑文件 <em>/etc/systemd/system/docker.service.d/override.conf</em> 或者使用命令 <code>sudo systemctl edit docker.service</code> 编辑保存, 修改文件内容如下:</p><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[Service]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExecStart=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExecStart=/usr/bin/dockerd -H fd:// -H tcp://127.0.0.1:2375</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>修改完成后保存文件</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="重启服务">重启服务<a class="hash-link" href="#重启服务" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl daemon-reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl restart docker.service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="参考资料">参考资料<a class="hash-link" href="#参考资料" title="Direct link to heading">​</a></h2><ul><li><a href="https://docs.docker.com/engine/install/linux-postinstall/#configuring-remote-access-with-systemd-unit-file" target="_blank" rel="noopener noreferrer">Configuring remote access with <code>systemd</code> unit file</a></li><li><a href="https://gist.github.com/styblope/dc55e0ad2a9848f2cc3307d4819d819f" target="_blank" rel="noopener noreferrer">Enable TCP port 2375 for external connection to Docker</a></li></ul>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="docker" term="docker"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[使用JS对用户选择视频进行截图]]></title>
        <id>/2022/05/11/javascript-video-screenshot</id>
        <link href="https://blog.alanwei.com/blog/2022/05/11/javascript-video-screenshot"/>
        <updated>2022-05-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[使用 JavaScript 对用户选择视频进行截图]]></summary>
        <content type="html"><![CDATA[<p>主要参考资源 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Manipulating_video_using_canvas" target="_blank" rel="noopener noreferrer">Manipulating video using canvas</a></p><p>直接访问 <a href="https://blog.alanwei.com/demo/video.html" target="_blank" rel="noopener noreferrer">截图示例</a> 在线查看效果.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="思路步骤">思路步骤<a class="hash-link" href="#思路步骤" title="Direct link to heading">​</a></h2><ol><li>监听<code>input[type=file]</code>的<code>change</code>事件, 读取 <code>event.target.files</code> 获得视频文件 <em>File</em></li><li>使用 <code>URL.createObjectURL(file)</code> 创建视频数据</li><li>创建 <code>video</code> 元素, 视频源使用上面创建的 object URL</li><li>使用 <code>canvas.getContext("2d").drawImage</code> 将视频截图绘画到 canvas 元素上</li><li>调用 <code>canvas.toDataURL</code> 转成base64图标数据, 供 <code>&lt;img /&gt;</code> 展示</li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="源码">源码<a class="hash-link" href="#源码" title="Direct link to heading">​</a></h2><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">video.html</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token doctype punctuation" style="color:#393A34;font-style:italic">&lt;!</span><span class="token doctype doctype-tag" style="color:#999988;font-style:italic">DOCTYPE</span><span class="token doctype" style="color:#999988;font-style:italic"> </span><span class="token doctype name" style="color:#999988;font-style:italic">html</span><span class="token doctype punctuation" style="color:#393A34;font-style:italic">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">html</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">lang</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">en</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">head</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">charset</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">UTF-8</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">http-equiv</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">X-UA-Compatible</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">content</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">IE=edge</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">viewport</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">content</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">width=device-width, initial-scale=1.0</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">title</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">视频截图</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">title</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">head</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">label</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      请先选择视频: </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">input</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">file</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">accept</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">video/*</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">label</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">button</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">点此截屏</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">button</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">h3</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">Canvas 截图</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">h3</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">canvas</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">screenshot</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag special-attr attr-name" style="color:#00a4db">style</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag special-attr attr-value punctuation" style="color:#393A34">"</span><span class="token tag special-attr attr-value value css language-css property" style="color:#36acaa">width</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:#393A34">:</span><span class="token tag special-attr attr-value value css language-css" style="color:#e3116c"> </span><span class="token tag special-attr attr-value value css language-css number" style="color:#36acaa">200</span><span class="token tag special-attr attr-value value css language-css unit" style="color:#e3116c">px</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:#393A34">;</span><span class="token tag special-attr attr-value value css language-css" style="color:#e3116c"> </span><span class="token tag special-attr attr-value value css language-css property" style="color:#36acaa">height</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:#393A34">:</span><span class="token tag special-attr attr-value value css language-css" style="color:#e3116c"> </span><span class="token tag special-attr attr-value value css language-css number" style="color:#36acaa">200</span><span class="token tag special-attr attr-value value css language-css unit" style="color:#e3116c">px</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:#393A34">;</span><span class="token tag special-attr attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">canvas</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">h3</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">图片截图</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">h3</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">img</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">./video.js</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">html</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">video.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">querySelector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"input[type=file]"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"change"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token parameter">e</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * 添加视频</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> video </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">files</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> ele </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"video"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ele</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">controls</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ele</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">height</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"200px"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ele</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">width</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"200px"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"source"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  source</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">src</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">URL</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createObjectURL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">video</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  source</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ele</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">appendChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">source</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ele</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">querySelector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"button"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"click"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * 截图</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> video </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">querySelector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"video"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> canvas </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"screenshot"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> ctx </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"2d"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">drawImage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">video</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> imgData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toDataURL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">querySelector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"img"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">src</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> imgData</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>或者选中文件自动截屏</strong></p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">querySelector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"input[type=file]"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"change"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token parameter">e</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * 添加视频</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> video </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">files</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">readVideoAlbum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">video</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> video</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">img</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">querySelector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"img"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">src</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> img</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * </span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {{video: File}} params </span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">readVideoAlbum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">params</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Promise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> reject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> eleVideo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"video"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eleVideo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">display</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"none"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eleVideo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">controls</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eleVideo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">autoplay</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eleVideo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">muted</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eleVideo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">playsInline</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eleVideo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">height</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"auto"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eleVideo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">width</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"auto"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"source"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">src</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">URL</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createObjectURL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">video</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> params</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eleVideo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">appendChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">source</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">eleVideo</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eleVideo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">play</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        canvas </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"canvas"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        canvas</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">width</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> eleVideo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">videoWidth</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        canvas</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">height</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> eleVideo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">videoHeight</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        canvas</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">display</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"none"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">canvas</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> ctx </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"2d"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword control-flow" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"canvas.getContext 异常"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">drawImage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">eleVideo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> eleVideo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">videoWidth</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> eleVideo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">videoHeight</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> base64 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toDataURL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">base64</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        eleVideo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">pause</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword control-flow" style="color:#00009f">catch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">reject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">           * 销毁创建的元素</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">           */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          canvas </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">removeChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">canvas</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">removeChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">eleVideo</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">500</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="javascript" term="javascript"/>
        <category label="web" term="web"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[解决 IDEA 打开Java项目提示 Cannot resolve symbol 问题]]></title>
        <id>/2022/05/08/idea-cannot-resolve-symbol</id>
        <link href="https://blog.alanwei.com/blog/2022/05/08/idea-cannot-resolve-symbol"/>
        <updated>2022-05-08T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[使用 IDEA 打开一个新的maven项目, 偶尔会遇到所有Java类都标红, 提示 Cannot resolve symbol xxx, 遇到类似错误, 可尝试参考以下步骤解决：]]></summary>
        <content type="html"><![CDATA[<p>使用 IDEA 打开一个新的maven项目, 偶尔会遇到所有Java类都标红, 提示 <em>Cannot resolve symbol xxx</em>, 遇到类似错误, 可尝试参考以下步骤解决：</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="确认项目设置">确认项目设置<a class="hash-link" href="#确认项目设置" title="Direct link to heading">​</a></h2><p>确认项目及maven module设置了正确的 JDK 版本, 依次点击 <strong>File &gt; Project Structure(Ctrl + Shift + Alt + S)...</strong>, 打开项目设置窗口.</p><p>确认 <strong>Project Settings &gt; Project</strong> 和 <strong>Project Settings &gt; Modules</strong> 里的JDK和语言级别设置正确.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="确认maven设置">确认Maven设置<a class="hash-link" href="#确认maven设置" title="Direct link to heading">​</a></h2><p>依次点击 <strong>File &gt; Settings(Ctrl + Alt + S)...</strong> 打开设置窗口, 定位到 <strong>Build, Execution, Deployment &gt; Build Tools &gt; Maven</strong>, 确认 <strong>Maven home path</strong> 设置正确.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="清理idea缓存">清理IDEA缓存<a class="hash-link" href="#清理idea缓存" title="Direct link to heading">​</a></h2><p>清理IDEA的项目缓存, 依次点击 <strong>File &gt; Invalidate Caches...</strong>, 把所有 <em>Optional</em> 都勾选了, 然后点击 <strong>Invalidate and Restart</strong>, 重启项目.</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="idea" term="idea"/>
        <category label="java" term="java"/>
        <category label="maven" term="maven"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[long 转 int - Java]]></title>
        <id>/2022/05/06/java-long-to-int</id>
        <link href="https://blog.alanwei.com/blog/2022/05/06/java-long-to-int"/>
        <updated>2022-05-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Java语言里将 long 转为 int 类型]]></summary>
        <content type="html"><![CDATA[<blockquote><p>原文 <a href="https://stackoverflow.com/questions/4355303/how-can-i-convert-a-long-to-int-in-java" target="_blank" rel="noopener noreferrer">How can I convert a long to int in Java?</a></p></blockquote><p><strong>Updated, in Java 8</strong></p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Math.toIntExact(value);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Original Answer:</strong></p><p>Simple type casting should do it:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">long l = 100000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int i = (int) l;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note, however, that large numbers (usually larger than <code>2147483647</code> and smaller than <code>-2147483648</code>) will lose some of the bits and would be represented incorrectly.</p><p>For instance, <code>2147483648</code> would be represented as <code>-2147483648</code>.</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="java" term="java"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[登录 Ubuntu 20.04 LTS 显示 There is 1 zombie process]]></title>
        <id>/2022/05/04/ubuntu-there-is-1-zombie-process</id>
        <link href="https://blog.alanwei.com/blog/2022/05/04/ubuntu-there-is-1-zombie-process"/>
        <updated>2022-05-04T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[解决 SSH 登录 Ubuntu 20.04 LTS 系统, 显示 There is 1 zombie process(有一个僵尸进程) 的问题]]></summary>
        <content type="html"><![CDATA[<p>使用 SSH 登录 Ubuntu 20.04 LTS 系统, 终端显示 There is 1 zombie process(有一个僵尸进程)</p><p><strong>找到僵尸进程</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> axo stat,ppid,pid,comm </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> -w defunct</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>结束进程</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">kill</span><span class="token plain"> -9 </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">parent_process_number</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>来源: <a href="https://www.devopsschool.com/blog/ubuntu-20-04-2-lts-displays-there-is-1-zombie-process-upon-login/" target="_blank" rel="noopener noreferrer">Ubuntu 20.04.2 LTS displays “There is 1 zombie process” upon login</a></p></blockquote><blockquote><p>更新信息参考 <a href="https://vitux.com/how-to-kill-zombie-processes-in-ubuntu-20-04/" target="_blank" rel="noopener noreferrer">How to Kill Zombie Processes in Ubuntu 20.04 LTS</a></p></blockquote>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="linux" term="linux"/>
        <category label="ubuntu" term="ubuntu"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Ubuntu 20.04 安装 KVM]]></title>
        <id>/2022/05/03/ubuntu-install-kvm</id>
        <link href="https://blog.alanwei.com/blog/2022/05/03/ubuntu-install-kvm"/>
        <updated>2022-05-03T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Ubuntu 20.04 安装KVM, Ubuntu Server 虚拟Windows系统]]></summary>
        <content type="html"><![CDATA[<p><a href="https://phoenixnap.com/kb/ubuntu-install-kvm" target="_blank" rel="noopener noreferrer">原文 How to Install KVM on Ubuntu 20.04</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="检查是否支持">检查是否支持<a class="hash-link" href="#检查是否支持" title="Direct link to heading">​</a></h2><p>如果以下命令返回值大于0，表示当前系统支持虚拟化: </p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">egrep</span><span class="token plain"> -c </span><span class="token string" style="color:#e3116c">'(vmx|svm)'</span><span class="token plain"> /proc/cpuinfo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>检查是否支持KVM加速:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> kvm-ok</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果<code>kvm-ok</code>返回错误, 尝试安装 <em>cpu-checker</em> 解决:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> cpu-checker</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上述检测完成后, 重新打开终端, 开始准备安装KVM。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装kvm">安装KVM<a class="hash-link" href="#安装kvm" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装kvm包">安装KVM包<a class="hash-link" href="#安装kvm包" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install -y qemu-kvm libvirt-daemon-system libvirt-clients bridge-utils</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="授权用户">授权用户<a class="hash-link" href="#授权用户" title="Direct link to heading">​</a></h3><p>安装完成后默认, 只有 <strong>libvirt</strong> 和 <strong>kvm</strong> 用户组的用户可以运行虚拟机, 可以使用以下命令把指定用户添加到 <strong>libvirt</strong> 和 <strong>kvm</strong> 用户组:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> adduser </span><span class="token string" style="color:#e3116c">"username"</span><span class="token plain"> libvirt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> adduser </span><span class="token string" style="color:#e3116c">"username"</span><span class="token plain"> kvm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>如果想从用户组删除用户, 把命令<code>adduser</code>替换成<code>deluser</code>即可.</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="验证安装情况">验证安装情况<a class="hash-link" href="#验证安装情况" title="Direct link to heading">​</a></h3><p>使用<code>virsh</code>命令验证安装成功:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">virsh</span><span class="token plain"> list --all</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者使用 <code>systemctl</code> 命令检查服务状态:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl status libvirtd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果虚拟化私服没有运行, 使用以下命令启动虚拟化服务:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl enable --now libvirtd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建虚拟机">创建虚拟机<a class="hash-link" href="#创建虚拟机" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="gui">GUI<a class="hash-link" href="#gui" title="Direct link to heading">​</a></h3><p>使用GUI用户界面管理创建管理虚拟机:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -y virt-manager</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Ubuntu系统执行以上命令, 安装完 <strong>virt-manager</strong> 之后，就可以使用该工具通过可视化界面创建虚拟机了。</p><blockquote><p>可以在另外一台Ubuntu工作机器上安装 <strong>virt-manager</strong> 工具, 然后远程连接(SSH)到安装虚拟机服务的机器上, 以远程方式管理虚拟机.</p></blockquote><p><a href="https://virt-manager.org/" target="_blank" rel="noopener noreferrer">virt-manager</a>是一个<a href="https://github.com/virt-manager/virt-manager" target="_blank" rel="noopener noreferrer">开源项目</a>, 其他Linux发行版安装参考:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> virt-manager </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Fedora</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> virt-manager </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Debian</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">emerge virt-manager </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Gentoo</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pkg_add virt-manager </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">OpenBSD</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cli">CLI<a class="hash-link" href="#cli" title="Direct link to heading">​</a></h3><p>使用命令行创建虚拟机</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> virt-install --name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Fedora33 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --description</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'Fedora 33'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --ram</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2048</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --vcpus</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --disk </span><span class="token assign-left variable" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/data/vm/fedora-33-ws.qcow2,size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">15</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --cdrom /data/vm/fedora-33.iso </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --graphics vn</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>参数解释:</p><table><thead><tr><th>选项</th><th>描述</th></tr></thead><tbody><tr><td><code>--name</code></td><td>The name you give to the VM</td></tr><tr><td><code>--description</code></td><td>A short description of the VM</td></tr><tr><td><code>--ram</code></td><td>The amount of RAM you wish to allocate to the VM</td></tr><tr><td><code>--vcpus</code></td><td>The number of virtual CPUs you wish to allocate to the VM</td></tr><tr><td><code>--disk</code></td><td>The location of the VM on your disk (if you specify a qcow2 disk file that does not exist, it will be automatically created)</td></tr><tr><td><code>--cdrom</code></td><td>The location of the ISO file you downloaded</td></tr><tr><td><code>--graphics</code></td><td>Specifies the display type</td></tr></tbody></table><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="其他命令">其他命令<a class="hash-link" href="#其他命令" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="显示虚拟机">显示虚拟机<a class="hash-link" href="#显示虚拟机" title="Direct link to heading">​</a></h3><p><strong>virsh list</strong> 命令格式:</p><p><em>domains</em> 指的是虚拟机</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  NAME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    list - list domains</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SYNOPSIS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    list [--inactive] [--all] [--transient] [--persistent] [--with-snapshot] [--without-snapshot] [--with-checkpoint] [--without-checkpoint] [--state-running] [--state-paused] [--state-shutoff] [--state-other] [--autostart] [--no-autostart] [--with-managed-save] [--without-managed-save] [--uuid] [--name] [--table] [--managed-save] [--title]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  DESCRIPTION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Returns list of domains.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  OPTIONS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --inactive       list inactive domains</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --all            list inactive &amp; active domains</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --transient      list transient domains</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --persistent     list persistent domains</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --with-snapshot  list domains with existing snapshot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --without-snapshot  list domains without a snapshot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --with-checkpoint  list domains with existing checkpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --without-checkpoint  list domains without a checkpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --state-running  list domains in running state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --state-paused   list domains in paused state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --state-shutoff  list domains in shutoff state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --state-other    list domains in other states</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --autostart      list domains with autostart enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --no-autostart   list domains with autostart disabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --with-managed-save  list domains with managed save state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --without-managed-save  list domains without managed save</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --uuid           list uuid's only</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --name           list domain names only</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --table          list table (default)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --managed-save   mark inactive domains with managed save state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --title          show domain title</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>常用命令</strong>:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">virsh</span><span class="token plain"> list </span><span class="token comment" style="color:#999988;font-style:italic"># 显示运行的虚拟机</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">virsh</span><span class="token plain"> list --all </span><span class="token comment" style="color:#999988;font-style:italic"># 显示所有虚拟机</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="启动关闭虚拟机">启动/关闭虚拟机<a class="hash-link" href="#启动关闭虚拟机" title="Direct link to heading">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">virsh</span><span class="token plain"> start VirtualMachineName </span><span class="token comment" style="color:#999988;font-style:italic"># 启动名为 VirtualMachineName 的虚拟机</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">virsh</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">shutdown</span><span class="token plain"> VirtualMachineName </span><span class="token comment" style="color:#999988;font-style:italic"># 关闭名为 VirtualMachineName 的虚拟机</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="linux" term="linux"/>
        <category label="ubuntu" term="ubuntu"/>
        <category label="kvm" term="kvm"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Windows 10 密钥查看及备份]]></title>
        <id>/2022/05/03/windows-10-key-backup</id>
        <link href="https://blog.alanwei.com/blog/2022/05/03/windows-10-key-backup"/>
        <updated>2022-05-03T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Windows 10 密钥查看及备份, 激活]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="查看当前系统激活密钥">查看当前系统激活密钥<a class="hash-link" href="#查看当前系统激活密钥" title="Direct link to heading">​</a></h2><p>打开注册表( Win+R &gt; regedit ), 定位到 <em>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SoftwareProtectionPlatform</em>, 然后查看 <strong>BackupProductKeyDefault</strong> 的值即可</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="vk7jg-nphtm-c97jm-9mpgt-3v66t">VK7JG-NPHTM-C97JM-9MPGT-3V66T<a class="hash-link" href="#vk7jg-nphtm-c97jm-9mpgt-3v66t" title="Direct link to heading">​</a></h2><p><a href="http://www.winwin7.com/JC/8567.html" target="_blank" rel="noopener noreferrer">为什么Win10激活密钥都是VK7JG-NPHTM-C97JM-9MPGT-3V66T</a></p><p>其实<code>VK7JG-NPHTM-C97JM-9MPGT-3V66T</code>这个产品秘钥并不能称为激活秘钥，只不过Win7、Win8.1系统升级Win10的用户微软都会默认使用这个秘钥，对于激活win10使用的是数字权利激活方试，3v66t是大批量许可 使用它并不会对大家造成影响。</p><p>Win10政府版产品通用密钥：<code>YYVX9-NTFWV-6MDM3-9PT4T-4M68B</code> ，来源 <a href="http://www.winwin7.com/JC/8511.html" target="_blank" rel="noopener noreferrer">winwin7</a></p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="windows" term="windows"/>
        <category label="windows 10" term="windows 10"/>
        <category label="key" term="key"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[埋点使用Gif图片的优点]]></title>
        <id>/2022/04/27/front-end-pv-gif</id>
        <link href="https://blog.alanwei.com/blog/2022/04/27/front-end-pv-gif"/>
        <updated>2022-04-27T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[埋点使用Gif图片的优点 埋点使用Gif图片的优点]]></summary>
        <content type="html"><![CDATA[<blockquote><p>原文摘自: <a href="https://www.cnblogs.com/songyao666/p/15899263.html" target="_blank" rel="noopener noreferrer">为什么大厂前端监控都在用GIF做埋点？</a></p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="防止跨域">防止跨域<a class="hash-link" href="#防止跨域" title="Direct link to heading">​</a></h2><p>如果调用接口上报数据, 需要处理跨域问题. 图片的<code>src</code>属性并不会跨域, 并且同样可以发起请求.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="防止阻塞页面加载">防止阻塞页面加载<a class="hash-link" href="#防止阻塞页面加载" title="Direct link to heading">​</a></h2><p>通常, 创建资源节点后只有将对象注入到浏览器DOM树后, 浏览器才会实际发送资源请求. 反复操作DOM不仅会引发性能问题, 而且载入js/css资源还会阻塞页面渲染, 影响用户体验. </p><p>但是图片请求例外. 构造图片打点不仅不用插入DOM, 只要在js中new出Image对象就能发起请求, 而且还没有阻塞问题. </p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="gif的体积更小">GIF的体积更小<a class="hash-link" href="#gif的体积更小" title="Direct link to heading">​</a></h2><p>最小的BMP文件需要74个字节, PNG需要67个字节, 而合法的GIF, 只需要43个字节.  同样的响应, GIF可以比BMP节约41%的流量, 比PNG节约35%的流量. 并且大多采用的是1*1像素的透明GIF来上报, 1x1像素是最小的合法图片.</p>]]></content>
        <author>
            <name>前端南玖</name>
            <uri>https://home.cnblogs.com/u/songyao666/</uri>
        </author>
        <category label="web" term="web"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[查看Linux系统开机时间]]></title>
        <id>/2022/04/25/linux-reboot-time</id>
        <link href="https://blog.alanwei.com/blog/2022/04/25/linux-reboot-time"/>
        <updated>2022-04-25T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[使用命令行查看系统开机时间]]></summary>
        <content type="html"><![CDATA[<p><a href="https://www.cnblogs.com/kerrycode/p/3759395.html" target="_blank" rel="noopener noreferrer">via Linux查看系统开机时间</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="who"><code>who</code><a class="hash-link" href="#who" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">who</span><span class="token plain"> -b </span><span class="token comment" style="color:#999988;font-style:italic"># 查看最新一次系统启动时间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">who</span><span class="token plain"> -r </span><span class="token comment" style="color:#999988;font-style:italic"># 查看当前系统运行时间</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>输出如下:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">system boot  2022-04-25 18:51</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run-level 5  2022-04-25 18:51</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="last-reboot"><code>last reboot</code><a class="hash-link" href="#last-reboot" title="Direct link to heading">​</a></h2><p>查看系统历史启动时间 <code>last reboot</code>, 输出如下:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reboot   system boot  5.13.0-40-generi Mon Apr 25 18:51   still running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reboot   system boot  5.13.0-39-generi Sat Apr 16 09:36   still running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reboot   system boot  5.13.0-39-generi Tue Apr  5 11:27   still running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reboot   system boot  5.13.0-37-generi Sun Mar 27 20:34   still running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reboot   system boot  5.13.0-37-generi Sun Mar 27 18:32 - 20:34  (02:02)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reboot   system boot  5.13.0-35-generi Mon Mar 21 09:23 - 20:34 (6+11:11)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reboot   system boot  5.13.0-35-generi Sun Mar 20 09:59 - 09:23  (23:23)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reboot   system boot  5.13.0-30-generi Wed Mar  9 21:21 - 09:23 (11+12:01)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reboot   system boot  5.13.0-30-generi Mon Mar  7 19:42 - 21:21 (2+01:38)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="top"><code>top</code><a class="hash-link" href="#top" title="Direct link to heading">​</a></h2><p>Linux的<code>top</code>命令第一行的 <em>up</em> 后面表示系统到目前运行了多久时间:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">top - 22:25:08 up  3:33,  2 users,  load average: 0.76, 0.44, 0.28</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tasks: 361 total,   1 running, 360 sleeping,   0 stopped,   0 zombie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%Cpu(s):  2.3 us,  1.2 sy,  0.0 ni, 96.4 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MiB Mem :  31970.3 total,  25747.4 free,   3651.6 used,   2571.3 buff/cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MiB Swap:   2048.0 total,   2048.0 free,      0.0 used.  27779.7 avail Mem </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  27115 alan      20   0 1008116 167408  38960 S   7.9   0.5   0:06.21 node             </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上面输出结果的第一行的 <code>22:25:08 up 3:33</code> 表示系统当前时间为 <em>22:25:08</em>, 运行了3个小时33分钟, <code>2 users</code> 表示两个用户登录了该系统.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="w"><code>w</code><a class="hash-link" href="#w" title="Direct link to heading">​</a></h2><p><code>w</code>命令用于输出谁(who)登录了当前系统, 以及在做什么, 输出如下:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> 22:37:11 up  3:45,  2 users,  load average: 0.52, 0.60, 0.44</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alan     :0       :0               18:51   ?xdm?  30:16   0.01s /usr/lib/gdm3/gdm-x-session --run-script env GNOME_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alan     pts/2    192.168.0.116    21:56    1.00s 10.72s  0.00s w</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上面表示了输出的<code>22:37:11 up 3:45, 2 users</code>表示当前系统时间为 <em>22:37:11</em>, 启动了3小时45分钟, 当前有两个用户登录了该系统. 下面输出的登录用户明细里, <strong>LOGIN@</strong> 表示用户登录时间点.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="procuptime"><code>/proc/uptime</code><a class="hash-link" href="#procuptime" title="Direct link to heading">​</a></h2><p>使用以下命令格式化输出系统启动时间:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">date</span><span class="token plain"> -d </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">`</span><span class="token string variable function" style="color:#d73a49">cut</span><span class="token string variable" style="color:#36acaa"> -f1 -d. /proc/uptime</span><span class="token string variable" style="color:#36acaa">`</span><span class="token string" style="color:#e3116c"> seconds ago"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="linux" term="linux"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[undici 简介 - Node.js]]></title>
        <id>/2022/04/22/nodejs-undici-intro</id>
        <link href="https://blog.alanwei.com/blog/2022/04/22/nodejs-undici-intro"/>
        <updated>2022-04-22T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[undici 一个 HTTP/1.1 客户端简介]]></summary>
        <content type="html"><![CDATA[<p>undici 是一款 HTTP/1.1 客户端, 用户HTTP请求. 相比较Node.js原生的<code>http</code>类库使用起来更加友好.</p><blockquote><p>本文翻译自 <a href="https://undici.nodejs.org/" target="_blank" rel="noopener noreferrer">undici官方文档</a>
Undici 是意大利语中的 11 的意思: HTTP/1.1 -&gt; 11 -&gt; Eleven -&gt; Undici.</p></blockquote><p>Node.js 刚刚发布的 v18.0.0 内置了 fetch 和 node:test 等标准模块, 其中 fetch 模块就来自 undici.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="install">Install<a class="hash-link" href="#install" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> i undici@5.0.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="quick-start">Quick Start<a class="hash-link" href="#quick-start" title="Direct link to heading">​</a></h2><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">quick-start.mjs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> request </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'undici'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  statusCode</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  headers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  trailers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  body </span><span class="token comment" style="color:#999988;font-style:italic">// body 是一种只读的stream</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'http://localhost:3000/foo'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'response received'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> statusCode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'headers'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> headers</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> data </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> body</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'data'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 这里 data 是 Buffer 类型, body内容可能被分多次读取</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'trailers'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> trailers</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="body-mixins">Body Mixins<a class="hash-link" href="#body-mixins" title="Direct link to heading">​</a></h2><p><code>body</code> mixins是格式化请求内容和响应内容最常用的方式, 常用mixins有:</p><ul><li><a href="https://fetch.spec.whatwg.org/#dom-body-formdata" target="_blank" rel="noopener noreferrer"><code>.formData()</code></a></li><li><a href="https://fetch.spec.whatwg.org/#dom-body-json" target="_blank" rel="noopener noreferrer"><code>.json()</code></a></li><li><a href="https://fetch.spec.whatwg.org/#dom-body-text" target="_blank" rel="noopener noreferrer"><code>.text()</code></a></li><li><code>.blob()</code></li></ul><p>示例:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">body-mixins.mjs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> request </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'undici'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> body </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"https://blog.alanwei.com/"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> text </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 响应内容</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-warning alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_S0QG"><p>body是一个只读流, 只能读取一次, 一旦调用mixin读取内容之后, body就不能再使用了. 如果在body上多次调用mixin, 比如 <code>body.json(); body.text();</code> 将会得到一个Promise reject, 异常内容为 <code>TypeError: unusable</code>. 如果需要多次使用body, 或者body不是JSON、Form格式, 最佳实践是使用mixin <code>.text()</code> 读取文本内容后, 再手动格式化成期望的格式. 更多body mixin参考 <a href="https://fetch.spec.whatwg.org/#body-mixin" target="_blank" rel="noopener noreferrer">Fetch Standard</a>.</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="common-api-methods">Common API Methods<a class="hash-link" href="#common-api-methods" title="Direct link to heading">​</a></h2><p>这个章节展示最常用的几个API方法的文档, 其他API文档访问<a href="https://undici.nodejs.org/#/docs/" target="_blank" rel="noopener noreferrer">docs</a></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="undicirequesturl-options-promise"><code>undici.request([url, options]): Promise</code><a class="hash-link" href="#undicirequesturl-options-promise" title="Direct link to heading">​</a></h3><p>参数</p><ul><li><strong>url</strong> <code>string | URL | UrlObject</code></li><li><strong>options</strong> <a href="https://undici.nodejs.org/#/docs/api/Dispatcher?id=parameter-requestoptions" target="_blank" rel="noopener noreferrer"><code>RequestOptions</code></a><ul><li><strong>dispatcher</strong> <code>Dispatcher</code> - 默认使用<a href="https://undici.nodejs.org/#/?id=undicigetglobaldispatcher" target="_blank" rel="noopener noreferrer">getGlobalDispatcher</a></li><li><strong>method</strong> <code>String</code> - 如果传了 <code>options.body</code>, 默认是 <code>PUT</code>, 否则默认是 <code>GET</code></li><li><strong>maxRedirections</strong> <code>Integer</code> - 默认 <code>0</code></li></ul></li></ul><p>返回一个promise结果</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="undicistreamurl-options-factory-promise"><code>undici.stream([url, options, ]factory): Promise</code><a class="hash-link" href="#undicistreamurl-options-factory-promise" title="Direct link to heading">​</a></h3><ul><li><strong>url</strong> <code>string | URL | UrlObject</code></li><li><strong>options</strong> <code>StreamOptions</code><ul><li><strong>dispatcher</strong> 同 <code>undici.request</code></li><li><strong>method</strong> 同 <code>undici.request</code></li><li><strong>maxRedirections</strong> 同 <code>undici.request</code></li></ul></li><li><strong>factory</strong> <code>Dispatcher.stream.factory</code> 参考以下代码</li></ul><p><code>undici.stream</code> 是 <code>Dispatcher.request</code>的快速版本, 该方法期望的<code>facotry</code>参数需要返回一个可写的流<a href="https://nodejs.org/api/stream.html#stream_class_stream_writable" target="_blank" rel="noopener noreferrer"><code>stream.Writable</code></a>, 用于写入响应内容.</p><p>当用户想把响应内容写入一个可写入流(<code>stream.Writable</code>)时, 借助<code>factory</code>, 可以避免创建中间的<code>stream.Readable</code>流, 用于改善性能.</p><p>示例1:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">undici-stream.mjs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> stream </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'undici'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Writable</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"stream"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> bufs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">stream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"https://blog.alanwei.com"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">method</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"GET"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">opaque</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> bufs </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter"> statusCode</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> headers</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> </span><span class="token parameter literal-property property" style="color:#36acaa">opaque</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> </span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter"> bufs </span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token parameter"> </span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Writable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">chunk</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> encoding</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      bufs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">chunk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> html </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Buffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bufs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"utf-8"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 请求响应内容</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> equals </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bufs </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">opaque</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">bufs</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// =&gt; true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>示例2:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">client-stream.mjs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Client</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'undici'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Writable</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"stream"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> buffers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Client</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"https://blog.alanwei.com"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/me/"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">method</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"GET"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">opaque</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> buffers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter"> </span><span class="token parameter literal-property property" style="color:#36acaa">opaque</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> </span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter"> data </span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token parameter"> </span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Writable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">chunk</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> encoding</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      buffers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">chunk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">Buffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">opaque</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"utf-8"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 打印响应内容</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buffers </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">opaque</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// =&gt; true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="node.js" term="node.js"/>
        <category label="undici" term="undici"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[取消 git reset 操作]]></title>
        <id>/2022/04/12/git-undo-reset</id>
        <link href="https://blog.alanwei.com/blog/2022/04/12/git-undo-reset"/>
        <updated>2022-04-12T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[取消类似 git reset --soft HEAD~1 操作:]]></summary>
        <content type="html"><![CDATA[<p>取消类似 <code>git reset --soft HEAD~1</code> 操作:</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="short-answer">Short answer<a class="hash-link" href="#short-answer" title="Direct link to heading">​</a></h2><div class="language-bahs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bahs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git reset 'HEAD@{1}'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="long-answer">Long answer<a class="hash-link" href="#long-answer" title="Direct link to heading">​</a></h2><p>Git keeps a log of all ref updates (e.g., checkout, reset, commit, merge). You can view it by typing:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> reflog</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Somewhere in this list is the commit that you lost. Let's say you just typed git reset HEAD~ and want to undo it. My reflog looks like this:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> reflog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3f6db14 HEAD@</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">: HEAD~: updating HEAD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">d27924e HEAD@</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">: checkout: moving from d27924e0fe16776f0d0f1ee2933a0334a4787b4c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The first line says that HEAD 0 positions ago (in other words, the current position) is 3f6db14; it was obtained by resetting to HEAD~. The second line says that HEAD 1 position ago (in other words, the state before the reset) is d27924e. It was obtained by checking out a particular commit (though that's not important right now). So, to undo the reset, run <code>git reset HEAD@{1}</code> (or git reset d27924e).</p><p>If, on the other hand, you've run some other commands since then that update HEAD, the commit you want won't be at the top of the list, and you'll need to search through the reflog.</p><p>One final note: It may be easier to look at the reflog for the specific branch you want to un-reset, say master, rather than HEAD:</p><div class="language-bahs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bahs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ git reflog show master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c24138b master@{0}: merge origin/master: Fast-forward</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">90a2bf9 master@{1}: merge origin/master: Fast-forward</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[...]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This should have less noise it in than the general HEAD reflog.</p><blockquote><p>来源<a href="https://stackoverflow.com/questions/2510276/how-to-undo-git-reset" target="_blank" rel="noopener noreferrer">How to undo 'git reset'?</a></p></blockquote>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="git" term="git"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[JavaScript数组乱序]]></title>
        <id>/2022/04/9/javascript-array-shuffle</id>
        <link href="https://blog.alanwei.com/blog/2022/04/9/javascript-array-shuffle"/>
        <updated>2022-04-09T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[如何将一个 JavaScript 数组打乱顺序？]]></summary>
        <content type="html"><![CDATA[<p>本文来自问题及答案<a href="https://www.zhihu.com/question/68330851/answer/266506621" target="_blank" rel="noopener noreferrer">如何将一个 JavaScript 数组打乱顺序？</a></p><p>1) 首先，毫无疑问： <a href="https://www.zhihu.com/people/596c0a5fdd9b36cea06bac348d418824" target="_blank" rel="noopener noreferrer">@顾轶灵</a> 轶灵大佬给出的 Fisher–Yates shuffle 洗牌算法 是最完美乱序的算法/方法之一了，正解无疑。</p><p>2) 同时，很多答案提到了：</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">.5</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">random</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样使用 sort 的方法。某些场景下，这样的方法可以使用。但是这不是真正意义上的完全乱序，一些需求中（比如抽奖）这样的写法会出大问题。</p><p>3) 也有答案提到了优秀的 lodash 库 <code>_.shuffle</code> 方法。这也是正解，事实上翻开 lodash 源码相关部分，这个方法正是采用了 Fisher–Yates shuffle 洗牌算法。感兴趣的同学可以进行参阅。</p><p>到此，这个回答应该已经有了相对完善的解释。但是最为优秀的码农，还是可以继续“追根问底”。正好现在有点时间，我来针对这几点，稍微解释并拓展一下。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-为什么借助-sort-方法不是真正意义上的完全乱序">1) 为什么借助 sort 方法不是真正意义上的完全乱序？<a class="hash-link" href="#1-为什么借助-sort-方法不是真正意义上的完全乱序" title="Direct link to heading">​</a></h2><p>先证明不完全性。为此实现一个脚本，我对</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> letters </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'A'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'B'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'C'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'D'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'E'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'F'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'G'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'H'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'I'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'J'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>letters 这样一个数组使用 array.sort 方法进行了 10000 次乱序处理，并把乱序的每一次结果可视化输出。每个元素（ABCD...）出现的位置次数进行记录:</p><p><img loading="lazy" src="https://pica.zhimg.com/50/v2-d82ef426dc5445185a27d46976896909_720w.jpg" class="img_ev3q"></p><p>具体脚本实现：<a href="https://link.zhihu.com/?target=https%3A//github.com/HOUCe/shuffle-array" target="_blank" rel="noopener noreferrer">HOUCe/shuffle-array</a></p><p>比如 A 元素大概率出现在数组的头部，J 元素大概率出现在数组的尾部，所有元素大概率停留在自己初始位置。</p><p>究其原因，在<a href="https://link.zhihu.com/?target=https%3A//github.com/v8/v8/blob/master/src/js/array.js" target="_blank" rel="noopener noreferrer">Chrome v8引擎源码</a>中，可以清晰看到。</p><blockquote><p>v8 在处理 sort 方法时，使用了插入排序和快排两种方案。当目标数组长度小于10时，使用插入排序；反之，使用快排。</p></blockquote><p>其实不管用什么排序方法，大多数排序算法的时间复杂度介于 O(n) 到 O(n2) 之间，元素之间的比较次数通常情况下要远小于 n(n-1)/2，也就意味着有一些元素之间根本就没机会相比较（也就没有了随机交换的可能），这些 sort 随机排序的算法自然也不能真正随机。</p><p>通俗的说，其实我们使用 array.sort 进行乱序，理想的方案或者说纯乱序的方案是：数组中每两个元素都要进行比较，这个比较有 50% 的交换位置概率。如此一来，总共比较次数一定为 n(n-1)。</p><p>而在 sort 排序算法中，大多数情况都不会满足这样的条件。因而当然不是完全随机的结果了。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-fisheryates-shuffle-洗牌算法是什么为什么满足需求">2) Fisher–Yates shuffle 洗牌算法是什么，为什么满足需求？<a class="hash-link" href="#2-fisheryates-shuffle-洗牌算法是什么为什么满足需求" title="Direct link to heading">​</a></h2><p>这里，我们简单借助图形来理解，非常简单直观。你接下来就会明白为什么这是理论上的完全乱序（图片来源于网络）。</p><p>首先我们有一个已经排好序的数组：
<img loading="lazy" src="https://pic3.zhimg.com/50/v2-c8c701f597c5b303af10478144b9c835_720w.jpg" class="img_ev3q"></p><p>Step1：
第一步需要做的就是，从数组末尾开始，选取最后一个元素。
<img loading="lazy" src="https://pica.zhimg.com/50/v2-975ee488313c20a4baff7eb9b4205f70_720w.jpg" class="img_ev3q"></p><p>在数组一共 9 个位置中，随机产生一个位置，该位置元素与最后一个元素进行交换。
<img loading="lazy" src="https://pic2.zhimg.com/50/v2-a354579de5bda322fb6b28fc59f91162_720w.jpg" class="img_ev3q">
<img loading="lazy" src="https://pic1.zhimg.com/50/v2-370bda27a1da89d1248431e5d9c21d19_720w.jpg" class="img_ev3q">
<img loading="lazy" src="https://pic1.zhimg.com/50/v2-52aed4647731b53b49467a745c5c2b7d_720w.jpg" class="img_ev3q"></p><p>Step2：上一步中，我们已经把数组末尾元素进行随机置换。</p><p>接下来，对数组倒数第二个元素动手。在除去已经排好的最后一个元素位置以外的8个位置中，随机产生一个位置，该位置元素与倒数第二个元素进行交换。
<img loading="lazy" src="https://pic3.zhimg.com/50/v2-9a12161b403e62b935c53e915ff4b8f3_720w.jpg" class="img_ev3q">
<img loading="lazy" src="https://pica.zhimg.com/50/v2-9a5755961db3121663950103b7ff9768_720w.jpg" class="img_ev3q">
<img loading="lazy" src="https://pic3.zhimg.com/50/v2-330ba583dcade811d0716356f1eb0768_720w.jpg" class="img_ev3q"></p><p>Step3：
理解了前两部，接下来就是依次进行，如此简单。
<img loading="lazy" src="https://pica.zhimg.com/50/v2-e0dd916f238e8dd87bac18e5ef974984_720w.jpg" class="img_ev3q"></p><p>最后，我们实现代码：</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token class-name">Array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">prototype</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method-variable function-variable method function property-access" style="color:#d73a49">shuffle</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> array </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> m </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">m</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">floor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">random</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> m</span><span class="token operator" style="color:#393A34">--</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> array</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">m</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        array</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">m</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> array</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        array</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> array</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当然这种代码不是纯净的，这就属于另一层面的问题了。纯函数与非纯，开发者可以依照自己的开发模式和习惯，自行考虑。</p><p>以上，前三段进行了总结。后面大篇幅进行了解释。读者可以根据需要进行阅读。很多内容都是拾人牙慧，探究精神对于程序员来说还是很必要的。</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>对于 Array.prototype.sort 不够随机问题, 评论区有人给出以下方案:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> random </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">random</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">shuffle</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token parameter">arr</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> arr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">item</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> item</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">key</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">random</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">a</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">key</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">item</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> item</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>]]></content>
        <author>
            <name>Lucas HC</name>
            <uri>https://www.zhihu.com/people/lucas-hc</uri>
        </author>
        <category label="javascript" term="javascript"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[TypeScript声明window全局变量]]></title>
        <id>/2022/04/9/typescript-declare-window-variables</id>
        <link href="https://blog.alanwei.com/blog/2022/04/9/typescript-declare-window-variables"/>
        <updated>2022-04-09T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[TypeScript项目如果用到了一些第三方JS类库，但是没有提供d.ts文件时, 可以自己手动声明.]]></summary>
        <content type="html"><![CDATA[<p>TypeScript项目如果用到了一些第三方JS类库，但是没有提供d.ts文件时, 可以自己手动声明.</p><p>一般是在源码的<code>src</code>目录下, 创建<code>global.d.ts</code>文件, 以下示例声明jQuery的<code>$</code>以及一个<a href="https://github.com/gitalk/gitalk" target="_blank" rel="noopener noreferrer">Gitalk</a>类库的类型:</p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/global.d.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">Window</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Gitalk</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Gitalk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  $</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">Gitalk</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">options</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clientID</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clientSecret</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    repo</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    owner</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    admin</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    distractionFreeMode</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> GitalkInstance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">GitalkInstance</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后就可以使用 <code>new window.Gitalk({ ... })</code> 创建实例了.</p><p>实际上任何<code>interface</code>声明的类型, 都可以自己手动扩展. 而<code>type</code>声明的类型则无法再次扩展. 这也是<code>interface</code>和<code>type</code>的一个主要区别.</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="typescript" term="typescript"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[JavaScript 取消事件绑定]]></title>
        <id>/2022/04/6/javascript-cancel-event</id>
        <link href="https://blog.alanwei.com/blog/2022/04/6/javascript-cancel-event"/>
        <updated>2022-04-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[JavaScript 取消事件绑定]]></summary>
        <content type="html"><![CDATA[<p>一般情况下使用<code>removeEventListener</code>移除事件绑定时, 需要把之前<code>addEventListener</code>传递的函数再传递一次:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">onClick</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">alert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"window"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 绑定事件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"click"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> onClick</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 移除事件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">removeEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"click"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> onClick</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这种情况下必须要把事件处理函数<code>onClick</code>存放到某个变量上, 下次移除时才能传递给移除事件函数, 给移除掉.</p><p>下面介绍一种官方的新方式, 解决移除匿名事件处理函数:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> controller </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">AbortController</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"click"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">alert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"window"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">signal</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> controller</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">signal</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"click"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">alert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"document"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">signal</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> controller</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">signal</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 批量取消监听</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">controller</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">abort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者自己实现类似发布订阅模式的时候还有个思路是, 把取消函数返回给调用方:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">element</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> type</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> handler</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> options</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 绑定事件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handler</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//取消事件绑定</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">removeHandler</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">removeEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handler</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> removeHandler</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 然后就可以这么使用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> cancel </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"click"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">alert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"window"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">signal</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> controller</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">signal</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cancel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 这就取消了事件绑定</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>上述解决方案和思路来自问题及其答案: <a href="https://www.zhihu.com/question/524996573/answer/2414818445" target="_blank" rel="noopener noreferrer">把addEventListener改成这样或许更好用，是否有什么弊端？</a></p></blockquote>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="javascript" term="javascript"/>
        <category label="web" term="web"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[JavaScript滚动到页面顶部]]></title>
        <id>/2022/04/4/javascript-scroll-top-smooth</id>
        <link href="https://blog.alanwei.com/blog/2022/04/4/javascript-scroll-top-smooth"/>
        <updated>2022-04-04T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[原生滚动到页面顶部的动画效果]]></summary>
        <content type="html"><![CDATA[<p>使用 <code>scrollTo({top: 0, behavior: 'smooth'})</code> 可以丝滑滚动到页面顶部, 不需要写动画效果:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">scrollTo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">top</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">behavior</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'smooth'</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果你的滚动条不在 <code>window</code> 上, 需要把<code>window</code>替换成你的元素, 比如: </p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">querySelector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"#scroll-element"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">scrollTo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">top</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">behavior</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'smooth'</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="web" term="web"/>
        <category label="javascript" term="javascript"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[如何用形象的比喻描述大数据的技术生态？Hadoop、Hive、Spark 之间是什么关系？]]></title>
        <id>/2022/03/31/hadoop-hive-spark-intro</id>
        <link href="https://blog.alanwei.com/blog/2022/03/31/hadoop-hive-spark-intro"/>
        <updated>2022-03-31T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[大数据本身是个很宽泛的概念，Hadoop生态圈（或者泛生态圈）基本上都是为了处理超过单机尺度的数据处理而诞生的。你可以把它比作一个厨房所以需要的各种工具。锅碗瓢盆，各有各的用处，互相之间又有重合。你可以用汤锅直接当碗吃饭喝汤，你可以用小刀或者刨子去皮。但是每个工具有自己的特性，虽然奇怪的组合也能工作，但是未必是最佳选择。]]></summary>
        <content type="html"><![CDATA[<p>大数据本身是个很宽泛的概念，Hadoop生态圈（或者泛生态圈）基本上都是为了处理超过单机尺度的数据处理而诞生的。你可以把它比作一个厨房所以需要的各种工具。锅碗瓢盆，各有各的用处，互相之间又有重合。你可以用汤锅直接当碗吃饭喝汤，你可以用小刀或者刨子去皮。但是每个工具有自己的特性，虽然奇怪的组合也能工作，但是未必是最佳选择。</p><p>大数据，首先你要能存的下大数据。</p><p>传统的文件系统是单机的，不能横跨不同的机器。HDFS（Hadoop Distributed FileSystem）的设计本质上是为了大量的数据能横跨成百上千台机器，但是你看到的是一个文件系统而不是很多文件系统。比如你说我要获取/hdfs/tmp/file1的数据，你引用的是一个文件路径，但是实际的数据存放在很多不同的机器上。你作为用户，不需要知道这些，就好比在单机上你不关心文件分散在什么磁道什么扇区一样。HDFS为你管理这些数据。</p><p>存的下数据之后，你就开始考虑怎么处理数据。虽然HDFS可以为你整体管理不同机器上的数据，但是这些数据太大了。一台机器读取成T上P的数据（很大的数据哦，比如整个东京热有史以来所有高清电影的大小甚至更大），一台机器慢慢跑也许需要好几天甚至好几周。对于很多公司来说，单机处理是不可忍受的，比如微博要更新24小时热博，它必须在24小时之内跑完这些处理。那么我如果要用很多台机器处理，我就面临了如何分配工作，如果一台机器挂了如何重新启动相应的任务，机器之间如何互相通信交换数据以完成复杂的计算等等。这就是MapReduce / Tez / Spark的功能。MapReduce是第一代计算引擎，Tez和Spark是第二代。MapReduce的设计，采用了很简化的计算模型，只有Map和Reduce两个计算过程（中间用Shuffle串联），用这个模型，已经可以处理大数据领域很大一部分问题了。</p><p>那什么是Map什么是Reduce？</p><p>考虑如果你要统计一个巨大的文本文件存储在类似HDFS上，你想要知道这个文本里各个词的出现频率。你启动了一个MapReduce程序。Map阶段，几百台机器同时读取这个文件的各个部分，分别把各自读到的部分分别统计出词频，产生类似（hello, 12100次），（world，15214次）等等这样的Pair（我这里把Map和Combine放在一起说以便简化）；这几百台机器各自都产生了如上的集合，然后又有几百台机器启动Reduce处理。Reducer机器A将从Mapper机器收到所有以A开头的统计结果，机器B将收到B开头的词汇统计结果（当然实际上不会真的以字母开头做依据，而是用函数产生Hash值以避免数据串化。因为类似X开头的词肯定比其他要少得多，而你不希望数据处理各个机器的工作量相差悬殊）。然后这些Reducer将再次汇总，（hello，12100）＋（hello，12311）＋（hello，345881）= （hello，370292）。每个Reducer都如上处理，你就得到了整个文件的词频结果。</p><p>这看似是个很简单的模型，但很多算法都可以用这个模型描述了。</p><p>Map＋Reduce 的简单模型很黄很暴力，虽然好用，但是很笨重。第二代的Tez和Spark除了内存Cache之类的新feature，本质上来说，是让Map/Reduce模型更通用，让Map和Reduce之间的界限更模糊，数据交换更灵活，更少的磁盘读写，以便更方便地描述复杂算法，取得更高的吞吐量。</p><p>有了MapReduce，Tez和Spark之后，程序员发现，MapReduce的程序写起来真麻烦。他们希望简化这个过程。这就好比你有了汇编语言，虽然你几乎什么都能干了，但是你还是觉得繁琐。你希望有个更高层更抽象的语言层来描述算法和数据处理流程。于是就有了Pig和Hive。Pig是接近脚本方式去描述MapReduce，Hive则用的是SQL。它们把脚本和SQL语言翻译成MapReduce程序，丢给计算引擎去计算，而你就从繁琐的MapReduce程序中解脱出来，用更简单更直观的语言去写程序了。</p><p>有了Hive之后，人们发现SQL对比Java有巨大的优势。一个是它太容易写了。刚才词频的东西，用SQL描述就只有一两行，MapReduce写起来大约要几十上百行。而更重要的是，非计算机背景的用户终于感受到了爱：我也会写SQL！于是数据分析人员终于从乞求工程师帮忙的窘境解脱出来，工程师也从写奇怪的一次性的处理程序中解脱出来。大家都开心了。Hive逐渐成长成了大数据仓库的核心组件。甚至很多公司的流水线作业集完全是用SQL描述，因为易写易改，一看就懂，容易维护。</p><p>自从数据分析人员开始用Hive分析数据之后，它们发现，Hive在MapReduce上跑，真鸡巴慢！流水线作业集也许没啥关系，比如24小时更新的推荐，反正24小时内跑完就算了。但是数据分析，人们总是希望能跑更快一些。比如我希望看过去一个小时内多少人在充气娃娃页面驻足，分别停留了多久，对于一个巨型网站海量数据下，这个处理过程也许要花几十分钟甚至很多小时。而这个分析也许只是你万里长征的第一步，你还要看多少人浏览了跳蛋多少人看了拉赫曼尼诺夫的CD，以便跟老板汇报，我们的用户是猥琐男闷骚女更多还是文艺青年／少女更多。你无法忍受等待的折磨，只能跟帅帅的工程师蝈蝈说，快，快，再快一点！</p><p>于是Impala，Presto，Drill诞生了（当然还有无数非著名的交互SQL引擎，就不一一列举了）。三个系统的核心理念是，MapReduce引擎太慢，因为它太通用，太强壮，太保守，我们SQL需要更轻量，更激进地获取资源，更专门地对SQL做优化，而且不需要那么多容错性保证（因为系统出错了大不了重新启动任务，如果整个处理时间更短的话，比如几分钟之内）。这些系统让用户更快速地处理SQL任务，牺牲了通用性</p><p>稳定性等特性。如果说MapReduce是大砍刀，砍啥都不怕，那上面三个就是剔骨刀，灵巧锋利，但是不能搞太大太硬的东西。</p><p>这些系统，说实话，一直没有达到人们期望的流行度。因为这时候又两个异类被造出来了。他们是Hive on Tez / Spark和SparkSQL。它们的设计理念是，MapReduce慢，但是如果我用新一代通用计算引擎Tez或者Spark来跑SQL，那我就能跑的更快。而且用户不需要维护两套系统。这就好比如果你厨房小，人又懒，对吃的精细程度要求有限，那你可以买个电饭煲，能蒸能煲能烧，省了好多厨具。</p><p>上面的介绍，基本就是一个数据仓库</p><p>的构架了。底层HDFS，上面跑MapReduce／Tez／Spark，在上面跑Hive，Pig。或者HDFS上直接跑Impala，Drill，Presto。这解决了中低速数据处理的要求。</p><p>那如果我要更高速的处理呢？</p><p>如果我是一个类似微博的公司，我希望显示不是24小时热博，我想看一个不断变化的热播榜，更新延迟在一分钟之内，上面的手段都将无法胜任。于是又一种计算模型被开发出来，这就是Streaming（流）计算。Storm是最流行的流计算平台。流计算的思路是，如果要达到更实时的更新，我何不在数据流进来的时候就处理了？比如还是词频统计的例子，我的数据流是一个一个的词，我就让他们一边流过我就一边开始统计了。流计算很牛逼，基本无延迟，但是它的短处是，不灵活，你想要统计的东西必须预先知道，毕竟数据流过就没了，你没算的东西就无法补算了。因此它是个很好的东西，但是无法替代上面数据仓库和批处理系统。</p><p>还有一个有些独立的模块是KV Store，比如Cassandra，HBase，MongoDB以及很多很多很多很多其他的（多到无法想象）。所以KV Store就是说，我有一堆键值，我能很快速滴获取与这个Key绑定的数据。比如我用身份证号，能取到你的身份数据。这个动作用MapReduce也能完成，但是很可能要扫描整个数据集。而KV Store专用来处理这个操作，所有存和取都专门为此优化了。从几个P的数据中查找一个身份证号，也许只要零点几秒。这让大数据公司的一些专门操作被大大优化了。比如我网页上有个根据订单号查找订单内容的页面，而整个网站的订单数量无法单机数据库存储，我就会考虑用KV Store来存。KV Store的理念是，基本无法处理复杂的计算，大多没法JOIN，也许没法聚合，没有强一致性保证（不同数据分布在不同机器上，你每次读取也许会读到不同的结果，也无法处理类似银行转账那样的强一致性要求的操作）。但是丫就是快。极快。</p><p>每个不同的KV Store设计都有不同取舍，有些更快，有些容量更高，有些可以支持更复杂的操作。必有一款适合你。</p><p>除此之外，还有一些更特制的系统／组件，比如Mahout是分布式机器学习库，Protobuf是数据交换的编码和库，ZooKeeper是高一致性的分布存取协同系统，等等。</p><p>有了这么多乱七八糟的工具，都在同一个集群上运转，大家需要互相尊重有序工作。所以另外一个重要组件是，调度系统。现在最流行的是Yarn。你可以把他看作中央管理，好比你妈在厨房监工，哎，你妹妹切菜切完了，你可以把刀拿去杀鸡了。只要大家都服从你妈分配，那大家都能愉快滴烧菜。</p><p>你可以认为，大数据生态圈就是一个厨房工具生态圈。为了做不同的菜，中国菜，日本菜，法国菜，你需要各种不同的工具。而且客人的需求正在复杂化，你的厨具不断被发明，也没有一个万用的厨具可以处理所有情况，因此它会变的越来越复杂。</p><section style="margin-top:1em"><hr><ul style="margin-left:-1em"><li>作者: <a href="https://www.zhihu.com/people/xiaoyu-ma" target="_blank">Xiaoyu Ma</a></li><li>来源: <a href="https://www.zhihu.com/people/xiaoyu-ma" target="_blank">https://www.zhihu.com/people/xiaoyu-ma</a></li><li>本文仅用于本人学习和存档, 文章所有权归作者 <a href="https://www.zhihu.com/people/xiaoyu-ma" target="_blank">Xiaoyu Ma</a> 所有, 如有侵权请发送邮件至 <a href="mailto:me@alanwei.com?subject=删除侵权文章" target="_top">me#alanwei.com(<i>#换成@</i>)</a> 删除此文.</li></ul><hr></section>]]></content>
        <author>
            <name>Xiaoyu Ma</name>
            <uri>https://www.zhihu.com/people/xiaoyu-ma</uri>
        </author>
        <category label="hadoop" term="hadoop"/>
        <category label="大数据" term="大数据"/>
        <category label="spark" term="spark"/>
        <category label="hive" term="hive"/>
        <category label="转摘" term="转摘"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[如何解决Git仓库 .git 文件过大问题]]></title>
        <id>/2022/03/31/large-git-repository.md</id>
        <link href="https://blog.alanwei.com/blog/2022/03/31/large-git-repository.md"/>
        <updated>2022-03-31T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[如何解决git仓库提交次数过多, .git 文件过大问题]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="方案1">方案1<a class="hash-link" href="#方案1" title="Direct link to heading">​</a></h2><p>只是为了clone小的话，用<code>--depth=1</code>只获取最新的commit即可</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="方案2">方案2<a class="hash-link" href="#方案2" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">一：常规办法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1.删除无用的分支</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ git branch -d &lt;branch_name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.删除无用的tag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ git tag -d &lt;tag_name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.清理本地版本库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ git gc --prune=now</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">二：高级办法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">注意高级办法会导致push冲突，需要强制提交，其他人pull也会遇到冲突，建议重新克隆。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">！！！注意这些操作都很危险，建议找个示例库进行测试，确保自己完全掌握之后再实际操作。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1.完全重建版本库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ rm -rf .git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ git init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ git add .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ git cm "first commit"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ git remote add origin &lt;your_github_repo_url&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ git push -f -u origin master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.有选择性的合并历史提交</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ git rebase -i &lt;first_commit&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">会进入一个如下所示的文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1 pick ba07c7d add bootstrap theme and format import  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2 pick 7d905b8 add newline at file last line</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  3 pick 037313c fn up_first_char rename to caps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  4 pick 34e647e add fn of &amp;&amp; use for index.jsp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  5 pick 0175f03 rename common include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  6 pick 7f3f665 update group name &amp;&amp; update config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">将想合并的提交的pick改成s，如</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1 pick ba07c7d add bootstrap theme and format import</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2 pick 7d905b8 add newline at file last line</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  3 pick 037313c fn up_first_char rename to caps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  4 s 34e647e add fn of &amp;&amp; use for index.jsp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  5 pick 0175f03 rename common include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  6 pick 7f3f665 update group name &amp;&amp; update config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">这样第四个提交就会合并进入第三个提交。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">等合并完提交之后再运行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ git push -f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ git gc --prune=now</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><ul><li>作者：Intopass</li><li>链接：<a href="https://www.zhihu.com/question/29769130/answer/45546231" target="_blank" rel="noopener noreferrer">https://www.zhihu.com/question/29769130/answer/45546231</a></li><li>来源：知乎</li><li>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</li></ul></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="git" term="git"/>
        <category label="转摘" term="转摘"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Intel CPU 名称和编号规范]]></title>
        <id>/2022/03/27/intel-cpu-numbers</id>
        <link href="https://blog.alanwei.com/blog/2022/03/27/intel-cpu-numbers"/>
        <updated>2022-03-27T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[英特尔® 处理器名称和编号]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="官方文档">官方文档<a class="hash-link" href="#官方文档" title="Direct link to heading">​</a></h2><p><img loading="lazy" src="https://www.intel.cn/content/dam/www/public/us/en/images/illustrations/RWD/10th-gen-sku-graphic-wht.png.rendition.intel.web.864.486.png" alt="sku" class="img_ev3q"></p><ul><li>Brand - 品牌, 如今，最常见的英特尔® 处理器名称以英特尔® 酷睿™、英特尔® 奔腾® 和英特尔® 赛扬® 开头</li><li>Brand Modifier - 品牌修饰符, 目前，英特尔® 酷睿™ 处理器系列的品牌修饰符包括 i3、i5、i7 和 i9。品牌修饰符数字越大表示其提供的性能级别更高</li><li>Generation Indicator - 代次指示符, 所有的英特尔® 酷睿™ 处理器品牌都在处理器编号中对英特尔® 处理器的代次进行了标记。在由四位数字组成的处理器编号中，第一个数字通常表示代次。例如，包含数字 9800 的处理器是第 9 代智能处理器，而标记为 8800 的处理器则属于第 8 代技术</li><li>SKU Numeric Digits - SKU 数值, 产品编号的最后三位数字是 SKU 编号, 在处理器品牌和代次的其他部分完全相同的前提下，较高的 SKU 一般表示具有更多功能</li><li>Product Line Suffix - 产品线后缀, SKU 后缀是处理器功能的另一个关键指示符, 例如，在英特尔® 酷睿™ 处理器系列中，U 表示专为高能效笔记本电脑或 2 合 1 电脑设计的处理器。而 XE 表示专为实现最高性能而设计的面向台式机的“至尊版”处理器。</li></ul><p>要理解处理器后缀的含义，请查看下面的列表。并非所有的处理器代次或家族都包含所有的产品后缀:</p><table><thead><tr><th>后缀</th><th>含义</th></tr></thead><tbody><tr><td>G1-G7</td><td>显卡级别（仅适用于采用全新集成显卡技术的处理器）</td></tr><tr><td>E</td><td>嵌入式</td></tr><tr><td>F</td><td>需要独立显卡</td></tr><tr><td>G</td><td>封装包中包含独立显卡</td></tr><tr><td>H</td><td>针对移动设备进行优化的高性能</td></tr><tr><td>HK</td><td>针对移动设备进行优化的高性能，未锁频</td></tr><tr><td>HQ</td><td>针对移动设备进行优化的高性能，四核</td></tr><tr><td>K</td><td>未锁频</td></tr><tr><td>S</td><td>特别版</td></tr><tr><td>T</td><td>经过功耗优化的生活方式</td></tr><tr><td>U</td><td>高能效移动设备</td></tr><tr><td>Y</td><td>极低功耗的移动设备</td></tr><tr><td>X/XE</td><td>未锁频，高端</td></tr><tr><td>B</td><td>球栅阵列 (BGA)</td></tr></tbody></table><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><ul><li>来源 <a href="https://www.intel.cn/content/www/cn/zh/processors/processor-numbers.html" target="_blank" rel="noopener noreferrer">英特尔® 处理器名称和编号</a></li></ul></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="inter-cpu-后面的kkff有什么区别">Inter CPU 后面的K、KF、F有什么区别<a class="hash-link" href="#inter-cpu-后面的kkff有什么区别" title="Direct link to heading">​</a></h2><p>Intel的MSDT桌面产品线，排除T标等面向低功耗的，正常DIY产品线包含：Intel的MSDT桌面产品线，排除T标等面向低功耗的，正常DIY产品线包含：</p><ul><li>无标：没有任何后缀，具备核显不可超频，例如Core i7 11700。</li><li>K标：后缀为K结尾，具备核显并且可以超频，例如Core i7 11700K。</li><li>KF标：后缀为KF结尾，不具备核显并但可以超频，例如Core i7 11700KF。</li><li>F标：后缀为F结尾，不具备核显并也不可以超频，例如Core i7 11700F。</li></ul><p>简而言之，有K表示可以超频，显有F表示没有核，所以K标定位最高，F标定位最低，无标和KF标在中间。</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><ul><li>作者：mengsen</li><li>链接：<a href="https://zhuanlan.zhihu.com/p/484057388" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/484057388</a> </li><li>来源：知乎 </li><li>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。 </li></ul></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="intel" term="intel"/>
        <category label="cpu" term="cpu"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Flutter QA]]></title>
        <id>/2022/03/24/flutter-qa</id>
        <link href="https://blog.alanwei.com/blog/2022/03/24/flutter-qa"/>
        <updated>2022-03-24T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[QA]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="qa">QA<a class="hash-link" href="#qa" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="flutter-run">flutter run<a class="hash-link" href="#flutter-run" title="Direct link to heading">​</a></h3><p><code>flutter run</code> 卡在 <em>Running Gradle task 'assembleDebug'...</em></p><p>执行<code>flutter run -v</code>查看卡在哪个步骤, 如果是卡在gradle环节, 尝试进入 <code>android</code> 目录执行 <code>./gradlew clean build</code> .</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="target-of-uri-doesnt-exist">Target of URI doesn't exist<a class="hash-link" href="#target-of-uri-doesnt-exist" title="Direct link to heading">​</a></h3><p>Target of URI doesn't exist 'package:flutter/material.dart'</p><p>Visual Studio Code 里的dart代码导入flutter类库标红失败, 提示 <em>Target of URI doesn't exist xxxxx</em>, 这是因为flutter代码没有还原, 尝试在项目根目录执行 <code>flutter pub get</code></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="flutter-doctor">flutter doctor<a class="hash-link" href="#flutter-doctor" title="Direct link to heading">​</a></h3><p>设置flutter检测Android sdk和Android studio的路径</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">flutter config --android-sdk="$HOME/Android/Sdk"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flutter config --android-studio-dir="/snap/android-studio/current/android-studio/"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="wrap-元素左对齐"><code>Wrap</code> 元素左对齐<a class="hash-link" href="#wrap-元素左对齐" title="Direct link to heading">​</a></h3><p><code>Wrap</code> 里的 <code>children</code> 默认是居中对齐, 可以借助使用<code>Align</code>设置成左对齐:</p><div class="language-dart codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dart codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Align(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  alignment: Alignment.topLeft, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  child: Wrap(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>来源: <a href="https://stackoverflow.com/questions/62696982/flutter-wrap-widget-align-left-inside-expansionpanel" target="_blank" rel="noopener noreferrer">Flutter Wrap widget align: left inside ExpansionPanel</a>, <a href="https://api.flutter.dev/flutter/widgets/Align-class.html" target="_blank" rel="noopener noreferrer">Align文档</a></p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="组件增加点击触摸事件">组件增加点击触摸事件<a class="hash-link" href="#组件增加点击触摸事件" title="Direct link to heading">​</a></h3><p>给任意组件增加 <code>onTap</code> 事件监听, 可以使用 <code>InkWell</code> 或者 <code>GestureDetector</code>, 两者的区别在于 <code>InkWell</code> 是 material 组件, 会有material风格的特效, 而<code>GestureDetector</code>就是通用的增加手势操作的组件, 以下是示例:</p><div class="language-dart codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dart codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 使用 InkWell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">InkWell(                        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  child: Container(...),                        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  onTap: () {                          </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print("tapped on container");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 使用 GestureDetector</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GestureDetector(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  onTap: () { print("Container was tapped"); },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  child: Container(...),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GestureDetector(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  onTap: () { print("Container was tapped"); },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  child: Text("Hello world."),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>来源: <a href="https://stackoverflow.com/questions/44317188/flutter-ontap-method-for-containers/44317228#44317228" target="_blank" rel="noopener noreferrer">Flutter onTap method for Containers</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="笔记">笔记<a class="hash-link" href="#笔记" title="Direct link to heading">​</a></h2></blockquote><p><code>Transform</code> 的变换是应用在绘制阶段，而并不是应用在布局(layout)阶段，所以无论对子组件应用何种变化，其占用空间的大小和在屏幕上的位置都是固定不变的，因为这些是在布局阶段就确定的.</p><p><code>RotatedBox</code>和<code>Transform.rotate</code>功能相似，它们都可以对子组件进行旋转变换，但是有一点不同: <code>RotatedBox</code>的变换是在layout阶段，会影响在子组件的位置和大小。</p><p>Flutter 中有两种布局模型:</p><ul><li>基于 <code>RenderBox</code> 的盒模型布局。</li><li>基于 <code>Sliver</code> ( <code>RenderSliver</code> ) 按需加载列表布局。</li></ul><p>Flutter 中的可滚动主要由三个角色组成: Scrollable、Viewport 和 Sliver: </p><ul><li><code>Scrollable</code>: 用于处理滑动手势，确定滑动偏移，滑动偏移变化时构建 Viewport 。</li><li><code>Viewport</code>: 显示的视窗，即列表的可视区域；</li><li><code>Sliver</code>: 视窗里显示的元素。</li></ul><p>具体布局过程:</p><ul><li><code>Scrollable</code> 监听到用户滑动行为后，根据最新的滑动偏移构建 Viewport 。</li><li><code>Viewport</code> 将当前视口信息和配置信息通过 SliverConstraints 传递给 Sliver。</li><li><code>Sliver</code> 中对子组件（RenderBox）按需进行构建和布局，然后确认自身的位置、绘制等信息，保存在 geometry 中（一个 SliverGeometry 类型的对象）。</li></ul><p>在可滚动组件的坐标描述中，通常将滚动方向称为主轴(main axis)，非滚动方向称为纵轴(cross axis)。由于可滚动组件的默认方向一般都是沿垂直方向，所以默认情况下主轴就是指垂直方向，水平方向同理。</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="flutter" term="flutter"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[.Net Script 简介]]></title>
        <id>/2022/03/16/dotnet-script-intro</id>
        <link href="https://blog.alanwei.com/blog/2022/03/16/dotnet-script-intro"/>
        <updated>2022-03-16T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[.Net Core 工具 dotnet-script 简介]]></summary>
        <content type="html"><![CDATA[<p>.Net Core 工具 <code>dotnet-script</code> 简介</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="总结">总结<a class="hash-link" href="#总结" title="Direct link to heading">​</a></h2><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> dotnet tool </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -g dotnet-script  </span><span class="token comment" style="color:#999988;font-style:italic"># 安装 dotnet-script</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> dotnet script --help </span><span class="token comment" style="color:#999988;font-style:italic"># 显示帮助文档</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> dotnet script init </span><span class="token comment" style="color:#999988;font-style:italic"># 创建脚手架脚本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> dotnet script </span><span class="token comment" style="color:#999988;font-style:italic"># 进入 REPL 模式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> dotnet script hello.csx -i </span><span class="token comment" style="color:#999988;font-style:italic"># 执行脚本 hell.csx 后进入 REPL 模式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> dotnet script hello.csx </span><span class="token comment" style="color:#999988;font-style:italic"># 执行脚本 hello.csx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> dotnet script -d hello.csx </span><span class="token comment" style="color:#999988;font-style:italic"># 以debug模式执行脚本 hello.csx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> dotnet script -d hello.csx -- arg1 arg2 </span><span class="token comment" style="color:#999988;font-style:italic"># 以debug模式执行脚本 hello.csx, 并传入两个参数: arg1, arg2. 脚本内部使用全局变量 Args 接收参数.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> dotnet script hello.csx -s https://SomePackageSource1 -s https://SomePackageSource2 </span><span class="token comment" style="color:#999988;font-style:italic"># 执行脚本时指定多个Nuget包源地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> dotnet script https://dwz.cn/xpsKTaoi </span><span class="token comment" style="color:#999988;font-style:italic"># 执行远程脚本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> -al </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> dotnet script UpperCase.csx </span><span class="token comment" style="color:#999988;font-style:italic"># 接收管道输入</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> dotnet script </span><span class="token builtin class-name">exec</span><span class="token plain"> path_to_dll -- arg1 arg2 </span><span class="token comment" style="color:#999988;font-style:italic"># 执行 dll 文件, 并传入两个参数: arg1, arg2.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> dotnet script publish main.csx -o publish_dir -c Release </span><span class="token comment" style="color:#999988;font-style:italic"># 编译脚本为独立可执行程序</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>脚本内指令:</p><ul><li>首行加入 <code>#!/usr/bin/env dotnet-script</code>, 并把脚本文件更改为可执行文件, 可以直接执行.</li><li><code>#r "nuget: Newtonsoft.Json, 12.0.2"</code> 引用nuget包</li><li><code>#load "nuget:simple-targets-csx, 6.0.0"</code> 引用nuget上的脚本包</li><li><code>#load "./other-script.csx"</code> 引用其他脚本文件</li></ul><p>来源 <a href="https://github.com/filipw/dotnet-script/blob/master/README.md" target="_blank" rel="noopener noreferrer">filipw/dotnet-script</a></p><p>使用.Net CLI运行C#脚本, 使用VS Code编辑脚本并引用Nuget包. 所有OmniSharp支持的语言都支持这些特性.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装">安装<a class="hash-link" href="#安装" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="要求">要求<a class="hash-link" href="#要求" title="Direct link to heading">​</a></h3><p>我们只需要安装 <a href="https://www.microsoft.com/net/download/core" target="_blank" rel="noopener noreferrer">.Net Core 2.1+ SDK</a> 即可.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="net-core-21-global-tool">.Net Core 2.1 Global Tool<a class="hash-link" href="#net-core-21-global-tool" title="Direct link to heading">​</a></h3><p>.Net Core 2.1 增加了全局工具(global tool)的概念, 这意味着你只需要.Net CLI就可以安装 <code>dotnet-script</code>. </p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> dotnet tool </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -g dotnet-script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tools directory </span><span class="token string" style="color:#e3116c">'/Users/alan/.dotnet/tools'</span><span class="token plain"> is not currently on the </span><span class="token environment constant" style="color:#36acaa">PATH</span><span class="token plain"> environment variable.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">If you are using bash, you can </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> it to your profile by running the following command:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">EOF </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> ~/.bash_profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Add .NET Core SDK tools</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:#36acaa">PATH</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string environment constant" style="color:#36acaa">$PATH</span><span class="token string" style="color:#e3116c">:/Users/alan/.dotnet/tools"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">You can </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> it to the current session by running the following command:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:#36acaa">PATH</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string environment constant" style="color:#36acaa">$PATH</span><span class="token string" style="color:#e3116c">:/Users/alan/.dotnet/tools"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">You can invoke the tool using the following command: dotnet-script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tool </span><span class="token string" style="color:#e3116c">'dotnet-script'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version </span><span class="token string" style="color:#e3116c">'0.29.1'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> was successfully installed.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这种方式的好处是你可跨平台使用相同的命令安装 <code>dotnet-script</code>.</p><blockquote><p><code>/Users/alan</code> 是我的用户目录, 安装完成后为了方便使用 <code>dotnet-script</code> 命令, 你可以把目录<code>/Users/alan/.dotnet/tools</code>添加到环境变量<code>PATH</code>中, 或者使用<code>ln -s /Users/alan/.dotnet/tools/dotnet-script /usr/local/bin/dotnet-script</code>添加到现有的<code>PATH</code>目录中.</p></blockquote><blockquote><p>使用 .Net CLI 安装完 <code>dotnet-script</code> 后, 需要检查是否添加了<code>DOTNET_ROOT</code>环境变量, 否则执行<code>dotnet-script</code>后会报以下错误: </p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ dotnet-script </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">A fatal error occurred, the required library libhostfxr.dylib could not be found.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">If this is a self-contained application, that library should exist </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">/Users/alan/.dotnet/tools/.store/dotnet-script/0.29.1/dotnet-script/0.29.1/tools/netcoreapp2.1/any/</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">If this is a framework-dependent application, </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> the runtime </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> the default location </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">/usr/local/share/dotnet</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> or use the DOTNET_ROOT environment variable to specify the </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> runtime location.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果你是使用官方安装包(Installer), 而不是下载二进制包(Binaries)安装的.Net Core, 那么安装完成后系统可能就已经增加了<code>DOTNET_ROOT</code>环境变量, 环境变量的值是.Net Core的安装目录, 比如我的系统可能就是 <code>export DOTNET_ROOT=/usr/local/dotnet-sdk-2.2.104</code>. </p></blockquote><p>.NET Core SDK 也支持查看已经安装的工具列表, 以及卸载功能: </p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dotnet tool list -g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Package Id         Version      Commands</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dotnet-script      </span><span class="token number" style="color:#36acaa">0.22</span><span class="token plain">.0       dotnet-script</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dotnet tool uninstall dotnet-script -g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tool </span><span class="token string" style="color:#e3116c">'dotnet-script'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version </span><span class="token string" style="color:#e3116c">'0.22.0'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> was successfully uninstalled.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="windows">Windows<a class="hash-link" href="#windows" title="Direct link to heading">​</a></h3><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">choco install dotnet.script</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们也提供了PowerShell安装脚本: </p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(new-object Net.WebClient).DownloadString("https://raw.githubusercontent.com/filipw/dotnet-script/master/install/install.ps1") | iex</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="linux-and-mac">Linux and Mac<a class="hash-link" href="#linux-and-mac" title="Direct link to heading">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -s https://raw.githubusercontent.com/filipw/dotnet-script/master/install/install.sh </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果权限不允许, 你可以尝试使用<code>sudo</code>: </p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -s https://raw.githubusercontent.com/filipw/dotnet-script/master/install/install.sh </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="docker">Docker<a class="hash-link" href="#docker" title="Direct link to heading">​</a></h3><p>在Linux容器中运行 <code>dotnet-script</code> 的 Dockerfile 也是被支持的. 开始构建镜像: </p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> build -t dotnet-script -f Dockerfile </span><span class="token punctuation" style="color:#393A34">..</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后执行: </p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -it dotnet-script --version</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="github">Github<a class="hash-link" href="#github" title="Direct link to heading">​</a></h3><p>你也可以从<a href="https://github.com/filipw/dotnet-script/releases" target="_blank" rel="noopener noreferrer">Github releases page</a>手动下载所有<code>zip</code>格式的版本.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="usage">Usage<a class="hash-link" href="#usage" title="Direct link to heading">​</a></h2><p>dotnet script中经典的 <code>helloworld.csx</code> 演示看起来像下面这样:</p><div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Console.WriteLine("Hello world!");</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这就已经完成了, 我们可以执行这段脚本了(参数列表可以通过全局的<code>Args</code>数组访问): </p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dotnet script helloworld.csx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="脚手架">脚手架<a class="hash-link" href="#脚手架" title="Direct link to heading">​</a></h3><p>在你的系统中创建一个文件夹, 然后执行以下命令: </p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dotnet script init</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这会创建一个 <code>main.csx</code> 文件, 和一个可以在VS Code中调试的启动配置文件.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── .vscode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── launch.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── main.csx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── omnisharp.json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们也可以使用自定义的文件名来初始化一个文件夹.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dotnet script init custom.csx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们现在有了一个名为 <code>custom.csx</code> 的文件, 取代了之前默认的 <code>main.csx</code> 文件.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── .vscode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── launch.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── custom.csx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── omnisharp.json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>备注: 在一个包含一个或多个脚本的文件夹执行 <code>dotnet script init</code> 不会创建 <code>main.csx</code> 文件.</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="运行脚本">运行脚本<a class="hash-link" href="#运行脚本" title="Direct link to heading">​</a></h3><p>如果脚本是可执行文件, 可以直接通过shell执行.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">foo.csx arg1 arg2 arg3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>OSX/Linux</p><p>就像所有其他脚本一样, 在 OSX/Linux 系统中, 脚本第一行需要有 <code>!#</code>, 而且必须通过命令 <strong>chmod +x foo.csx</strong> 使文件变成可执行文件.
使用 <strong>dotnet script init</strong> 创建的csx文件会自动添加指令 <code>!#</code> 并标记csx文件为可执行文件.</p></blockquote><p>OSX/Linux 系统的 shebang 指令为 <strong>#!/usr/bin/env dotnet-script</strong></p><div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/usr/bin/env dotnet-script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Console.WriteLine("Hello world");</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>你可以使用 <strong>dotnet script</strong> 或者 <strong>dotnet-script</strong> 来执行你的脚本, 这种方式允许你通过传递参数来控制脚本的执行.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">foo.csx arg1 arg2 arg3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dotnet script foo.csx -- arg1 arg2 arg3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dotnet-script foo.csx -- arg1 arg2 arg3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="向脚本中传递参数">向脚本中传递参数<a class="hash-link" href="#向脚本中传递参数" title="Direct link to heading">​</a></h4><p>所有 <code>--</code> 后的参数都会被传递给脚本:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dotnet script foo.csx -- arg1 arg2 arg3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后你在脚本的上下文中使用全局的<code>Args</code>集合来访问传递进来的参数:</p><div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">foreach (var arg in Args)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Console.WriteLine(arg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>所有 <code>--</code> 之前的参数都会交由 <code>dotnet script</code> 处理. 比如下面的命令: </p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dotnet script -d foo.csx -- -d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>--</code> 之前的参数 <code>-d</code> 传递给 <code>dotnet script</code> 用于开启debug模式, 而 <code>--</code> 后面的 <code>-d</code> 会被传递给脚本.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="nuget-包">NuGet 包<a class="hash-link" href="#nuget-包" title="Direct link to heading">​</a></h3><p><code>dotnet script</code> 支持直接在脚本中引用Nuget包(内置功能). </p><div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#r "nuget: AutoMapper, 6.1.0"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://user-images.githubusercontent.com/1034073/30176983-98a6b85e-9404-11e7-8855-4ae65a20d6b1.gif" alt="package" class="img_ev3q"></p><blockquote><p>备注: 在添加了包引用之后需要重启 Omnisharp .</p></blockquote><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="nuget包源">Nuget包源<a class="hash-link" href="#nuget包源" title="Direct link to heading">​</a></h4><p>我们可以直接在脚本根目录的 <code>NuGet.Config</code> 文件中定义包源. 另外在脚本执行时, 会借助提供语言服务的 <code>OmniSharp</code> 进行从包源中进行包解析.</p><p>我们可以在用户级别或者系统级别定义Nuget包源(这里有相关介绍 <a href="https://docs.microsoft.com/en-us/nuget/reference/nuget-config-file" target="_blank" rel="noopener noreferrer">Configuring NuGet Behaviour</a> )来替代本地<code>Nuget.Config</code>维护.</p><p>也可以在执行脚本的时候指定包源.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dotnet script foo.csx -s https://SomePackageSource</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>同时指定多个包源: </p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dotnet script foo.csx -s https://SomePackageSource -s https://AnotherPackageSource</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="从csx文件创建dll或者可执行文件">从CSX文件创建DLL或者可执行文件<a class="hash-link" href="#从csx文件创建dll或者可执行文件" title="Direct link to heading">​</a></h3><p>Dotnet-Script 可以为你的脚本创建独立的可执行文件或者DLL文件.</p><p>比如 <code>dotnet script publish main.csx -o publish_dir -c Release -d</code></p><table><thead><tr><th>开关</th><th>对应全称开关名称</th><th>描述</th></tr></thead><tbody><tr><td>-o</td><td>--output</td><td>Directory where the published executable should be placed.  Defaults to a 'publish' folder in the current directory.</td></tr><tr><td>-n</td><td>--name</td><td>The name for the generated DLL (executable not supported at this time).  Defaults to the name of the script.</td></tr><tr><td></td><td>--dll</td><td>Publish to a .dll instead of an executable.</td></tr><tr><td>-c</td><td>--configuration</td><td>Configuration to use for publishing the script <!-- -->[Release/Debug]<!-- -->. Default is "Debug"</td></tr><tr><td>-d</td><td>--debug</td><td>Enables debug output.</td></tr><tr><td>-r</td><td>--runtime</td><td>The runtime used when publishing the self contained executable. Defaults to your current runtime.</td></tr></tbody></table><p>发布后的可执行文件无需依赖 <code>dotnet install</code> 即可执行. DLL可以使用 .Net CLI 执行:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dotnet script </span><span class="token builtin class-name">exec</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">path_to_dll</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> -- arg1 arg2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="缓存">缓存<a class="hash-link" href="#缓存" title="Direct link to heading">​</a></h3><p>我们提供了两种类型的缓存 <code>dependency cache</code> 和 <code>execution cache</code>. 为了使缓存能够开启, 要求NuGet包引用必须指定确切的版本号. 这个限制的原因是 <del>我们无法执行过时依赖树的脚本?</del> (The reason for this constraint is that we need to make sure that we don't execute a script with a stale dependency graph.)</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="依赖缓存-dependency-cache">依赖缓存 Dependency Cache<a class="hash-link" href="#依赖缓存-dependency-cache" title="Direct link to heading">​</a></h4><p>为了解决脚本依赖, 在生成 <code>project.assets.json</code> 文件的回调中执行 <code>dotnet restore</code>. <code>project.assets.json</code> 文件指定了所有添加到编译的依赖.</p><p>This is an out-of-process operation and represents a significant overhead to the script execution. So this cache works by looking at all the dependencies specified in the script(s) either in the form of NuGet package references or assembly file references. If these dependencies matches the dependencies from the last script execution, we skip the restore and read the dependencies from the already generated <code>project.assets.json</code> file. If any of the dependencies has changed, we must restore again to obtain the new dependency graph.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="execution-cache">Execution cache<a class="hash-link" href="#execution-cache" title="Direct link to heading">​</a></h4><p>In order to execute a script it needs to be compiled first and since that is a CPU and time consuming operation, we make sure that we only compile when the source code has changed. This works by creating a SHA256 hash from all the script files involved in the execution. This hash is written to a temporary location along with the DLL that represents the result of the script compilation. When a script is executed the hash is computed and compared with the hash from the previous compilation. If they match there is no need to recompile and we run from the already compiled DLL. If the hashes don't match, the cache is invalidated and we recompile.</p><blockquote><p>You can override this automatic caching by passing <strong>--nocache</strong> flag, which will bypass both caches and cause dependency resolution and script compilation to happen every time we execute the script.</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="调试">调试<a class="hash-link" href="#调试" title="Direct link to heading">​</a></h3><p>使用 <code>Console.WriteLine</code> 进行调试的时代已经过去了. <code>dotnet script</code> 的一个主要特性是能够直接在VS Code中调试脚本. 只需要在你的脚本中设置好断点, 然后按下F5即可调试</p><p><img loading="lazy" src="https://user-images.githubusercontent.com/1034073/30173509-2f31596c-93f8-11e7-9124-ca884cf6564e.gif" alt="debug" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="脚本包-script-packages">脚本包 Script Packages<a class="hash-link" href="#脚本包-script-packages" title="Direct link to heading">​</a></h3><p>脚本包是把可复用脚本组织好发布到Nuget包管理, 让其他脚本消费使用. 这意味着我们现在就可以借助现有基础设施而不需要凭借自己的力量从头开始.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建脚本包">创建脚本包<a class="hash-link" href="#创建脚本包" title="Direct link to heading">​</a></h4><p>脚本包就是一个常规的Nuget包, 脚本文件包含在 <code>content</code> 或者 <code>contentFiles</code> 文件夹中.</p><p>下面的例子演示了根据<a href="https://docs.microsoft.com/en-us/nuget/schema/nuspec#including-content-files" target="_blank" rel="noopener noreferrer">standard convention</a>脚本包是如何在Nuget中展开的.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">└── contentFiles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── csx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        └── netstandard2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            └── main.csx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这个例子仅仅在根目录包含一个 <code>main.csx</code> 文件. 但是脚本包也许在跟目录或根目录下的子目录中中包含多个文件.</p><p>当加载一个脚本包的时候, 会先寻找入口去加载. 入口脚本是下面其中之一: </p><ul><li>根目录中叫 <code>main.csx</code> 的脚本</li><li>根目录中仅有的脚本文件 </li></ul><p>如果依据以上规则没有找到入口脚本, 会加载包中的所有脚本文件</p><blockquote><p>提供入口脚本的好处是我们可以控制包中其他脚本加载. </p></blockquote><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="消费脚本包">消费脚本包<a class="hash-link" href="#消费脚本包" title="Direct link to heading">​</a></h4><p>消费脚本包, 我们只需要在 <code>#locad </code> 指令中指定Nuget包.</p><p>下面的例子加载 <a href="https://www.nuget.org/packages/simple-targets-csx" target="_blank" rel="noopener noreferrer">simple-targets</a> 包中包含的脚本文件到我们的脚本中. </p><div class="language-C# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-C# codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#! "netcoreapp2.1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#load "nuget:simple-targets-csx, 6.0.0"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using static SimpleTargets;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var targets = new TargetDictionary();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">targets.Add("default", () =&gt; Console.WriteLine("Hello, world!"));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Run(Args, targets);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>备注: 调试脚本包也是支持的, 我们可以很容易进入 <code>#load </code> 指令引入的脚本.</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="远程脚本">远程脚本<a class="hash-link" href="#远程脚本" title="Direct link to heading">​</a></h3><p>脚本不需要存在于本机. 我们可以执行<code>http(s)</code>可访问的脚本. </p><p>这意味着我们可以创建Gist, 然后执行: </p><p>这个 <a href="https://gist.githubusercontent.com/seesharper/5d6859509ea8364a1fdf66bbf5b7923d/raw/0a32bac2c3ea807f9379a38e251d93e39c8131cb/HelloWorld.csx" target="_blank" rel="noopener noreferrer">Gist</a> 包含打印 "Hello World" 字符串的脚本</p><p>我们可以像以下这样执行脚本:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dotnet script https://gist.githubusercontent.com/seesharper/5d6859509ea8364a1fdf66bbf5b7923d/raw/0a32bac2c3ea807f9379a38e251d93e39c8131cb/HelloWorld.csx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>URL 太长了, 我们可以借助短链服务 <a href="https://tinyurl.com/" target="_blank" rel="noopener noreferrer">TinyURL</a>: </p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dotnet script https://tinyurl.com/y8cda9zt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="script-location">Script Location<a class="hash-link" href="#script-location" title="Direct link to heading">​</a></h3><p>一个非常常见的场景是我们的逻辑需要关联脚本路径. 我们不想让用户来确定这些路径, 下面提供了脚本当前执行的路径和文件夹: </p><div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public static string GetScriptPath([CallerFilePath] string path = null) =&gt; path;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static string GetScriptFolder([CallerFilePath] string path = null) =&gt; Path.GetDirectoryName(path);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>提示: 把这些方法放到一个独立脚本, 作为顶层方法. 然后在你需要访问的脚本文件里通过 <code>#load </code> 指令引用. </p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="repl">REPL<a class="hash-link" href="#repl" title="Direct link to heading">​</a></h2><p>这个版本中包含了C# REPL (Read-Evaluate-Print-Loop). 执行无参数的 <code>dotnet-script</code> 开启 REPL 模式.</p><p>这个交互模式允许你提供单独的C#代码块, 然后按下<kbd>Enter</kbd>立即执行. REPL 和 常规的 CSX 脚本一样使用相同的装配集引用和using语句.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="基本使用">基本使用<a class="hash-link" href="#基本使用" title="Direct link to heading">​</a></h3><p>Once <code>dotnet-script</code> starts you will see a prompt for input. You can start typing C# code there.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">~$ dotnet script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; var x = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; x+x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you submit an unterminated expression into the REPL (no <code>;</code> at the end), it will be evaluated and the result will be serialized using a formatter and printed in the output. This is a bit more interesting than just calling <code>ToString()</code> on the object, because it attempts to capture the actual structure of the object. For example:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">~$ dotnet script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; var x = new List&lt;string&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; x.Add("foo");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;string&gt;(1) { "foo" }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; x.Add("bar");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;string&gt;(2) { "foo", "bar" }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="inline-nuget-packages">Inline Nuget packages<a class="hash-link" href="#inline-nuget-packages" title="Direct link to heading">​</a></h3><p>REPL also supports inline Nuget packages - meaning the Nuget packages can be installed into the REPL from <em>within the REPL</em>. This is done via our <code>#r</code> and <code>#load</code> from Nuget support and uses identical syntax.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">~$ dotnet script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; #r "nuget: Automapper, 6.1.1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; using AutoMapper;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; typeof(MapperConfiguration)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[AutoMapper.MapperConfiguration]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; #load "nuget: simple-targets-csx, 6.0.0";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; using static SimpleTargets;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; typeof(TargetDictionary)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Submission#0+SimpleTargets+TargetDictionary]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="multiline-mode">Multiline mode<a class="hash-link" href="#multiline-mode" title="Direct link to heading">​</a></h3><p>Using Roslyn syntax parsing, we also support multiline REPL mode. This means that if you have an uncompleted code block and press <kbd>Enter</kbd>, we will automatically enter the multiline mode. The mode is indicated by the <code>*</code> character. This is particularly useful for declaring classes and other more complex constructs.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">~$ dotnet script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; class Foo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* public string Bar {get; set;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; var foo = new Foo();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="repl-commands">REPL commands<a class="hash-link" href="#repl-commands" title="Direct link to heading">​</a></h3><p>Aside from the regular C# script code, you can invoke the following commands (directives) from within the REPL:</p><table><thead><tr><th>Command</th><th>Description</th></tr></thead><tbody><tr><td><code>#load</code></td><td>Load a script into the REPL (same as <code>#load</code> usage in CSX)</td></tr><tr><td><code>#r</code></td><td>Load an assembly into the REPL (same as <code>#r</code> usage in CSX)</td></tr><tr><td><code>#reset</code></td><td>Reset the REPL back to initial state (without restarting it)</td></tr><tr><td><code>#cls</code></td><td>Clear the console screen without resetting the REPL state</td></tr><tr><td><code>#exit</code></td><td>Exits the REPL</td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="seeding-repl-with-a-script">Seeding REPL with a script<a class="hash-link" href="#seeding-repl-with-a-script" title="Direct link to heading">​</a></h3><p>You can execute a CSX script and, at the end of it, drop yourself into the context of the REPL. This way, the REPL becomes "seeded" with your code - all the classes, methods or variables are available in the REPL context. This is achieved by running a script with an <code>-i</code> flag.</p><p>For example, given the following CSX script:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">var msg = "Hello World";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Console.WriteLine(msg);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When you run this with the <code>-i</code> flag, <code>Hello World</code> is printed, REPL starts and <code>msg</code> variable is available in the REPL context.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">~$ dotnet script foo.csx -i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello World</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can also seed the REPL from inside the REPL - at any point - by invoking a <code>#load</code> directive pointed at a specific file. For example:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">~$ dotnet script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; #load "foo.csx"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello World</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="管道">管道<a class="hash-link" href="#管道" title="Direct link to heading">​</a></h2><p>下面的例子演示了如何在脚本中使用输入/输出的管道数据.</p><p><code>UpperCase.csx</code> 脚本简单地把标准输入转换成大写后写入到标准输出中.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#! "netcoreapp2.1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using (var streamReader = new StreamReader(Console.OpenStandardInput()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Write(streamReader.ReadToEnd().ToUpper());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们现在简单地把一个命令的输出转入到我们的脚本中:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"This is some text"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> dotnet script UpperCase.csx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">THIS IS SOME TEXT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="调试-1">调试<a class="hash-link" href="#调试-1" title="Direct link to heading">​</a></h3><p>The first thing we need to do add the following to the <code>launch.config</code> file that allows VS Code to debug a running process.</p><div class="language-JSON codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-JSON codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "name": ".NET Core Attach",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "type": "coreclr",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "request": "attach",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "processId": "${command:pickProcess}"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To debug this script we need a way to attach the debugger in VS Code and to the simplest thing we can do here is to wait for the debugger to attach by adding this method somewhere.</p><div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public static void WaitForDebugger()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Console.WriteLine("Attach Debugger (VS Code)");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    while(!Debugger.IsAttached)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To debug the script when executing it from the command line we can do something like</p><div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#! "netcoreapp2.0"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#r "nuget: NetStandard.Library, 2.0.0"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WaitForDebugger();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using (var streamReader = new StreamReader(Console.OpenStandardInput()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Write(streamReader.ReadToEnd().ToUpper()); // &lt;- SET BREAKPOINT HERE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now when we run the script from the command line we will get</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"This is some text"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> dotnet script UpperCase.csx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Attach Debugger </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">VS Code</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This now gives us a chance to attach the debugger before stepping into the script and from VS Code, select the  <code>.NET Core Attach</code> debugger and pick the process that represents the executing script.</p><p>Once that is done we should see out breakpoint being hit.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="configurationdebugrelease">Configuration(Debug/Release)<a class="hash-link" href="#configurationdebugrelease" title="Direct link to heading">​</a></h2><p>By default, scripts will be compiled using the <code>debug</code> configuration. This is to ensure that we can debug a script in VS Code as well as attaching a debugger for long running scripts.</p><p>There are however situations where we might need to execute a script that is compiled with the <code>release</code> configuration. For instance, running benchmarks using <a href="http://benchmarkdotnet.org/" target="_blank" rel="noopener noreferrer">BenchmarkDotNet</a> is not possible unless the script is compiled with the <code>release</code> configuration.</p><p>We can specify this when executing the script.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dotnet script foo.csx -c release</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="team">Team<a class="hash-link" href="#team" title="Direct link to heading">​</a></h2><ul><li><a href="https://github.com/seesharper" target="_blank" rel="noopener noreferrer">Bernhard Richter</a> (<a href="https://twitter.com/bernhardrichter" target="_blank" rel="noopener noreferrer">@bernhardrichter</a>)</li><li><a href="https://github.com/filipw" target="_blank" rel="noopener noreferrer">Filip W</a> (<a href="https://twitter.com/filip_woj" target="_blank" rel="noopener noreferrer">@filip_woj</a>)</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="license">License<a class="hash-link" href="#license" title="Direct link to heading">​</a></h2><p><a href="https://github.com/filipw/dotnet-script/blob/master/LICENSE" target="_blank" rel="noopener noreferrer">MIT License</a></p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label=".net" term=".net"/>
        <category label=".net core" term=".net core"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[.Net Core QA]]></title>
        <id>/2022/03/16/dotnet-starter</id>
        <link href="https://blog.alanwei.com/blog/2022/03/16/dotnet-starter"/>
        <updated>2022-03-16T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[.Net Core QA]]></summary>
        <content type="html"><![CDATA[<p>.Net Core QA</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="introduction">Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">​</a></h2><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="environment">Environment<a class="hash-link" href="#environment" title="Direct link to heading">​</a></h2><ul><li><code>DOTNET_ROOT</code> 设置.Net Core的安装目录</li></ul>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label=".net" term=".net"/>
        <category label=".net core" term=".net core"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[使用curl命令行获取当前机器公网IP]]></title>
        <id>/2022/03/16/get-public-ip-using-curl</id>
        <link href="https://blog.alanwei.com/blog/2022/03/16/get-public-ip-using-curl"/>
        <updated>2022-03-16T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[使用命令行或者脚本获取当前机器的公网IP地址]]></summary>
        <content type="html"><![CDATA[<p>使用命令行或者脚本获取当前机器的公网IP地址: </p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> icanhazip.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># OR</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -4 icanhazip.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># OR</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -6 icanhazip.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 其他提供公网IP查询的地址:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> ifconfig.me</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> api.ipify.org</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> bot.whatismyipaddress.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> ipinfo.io/ip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> ipecho.net/plain</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>来源: <a href="https://linuxconfig.org/how-to-use-curl-to-get-public-ip-address" target="_blank" rel="noopener noreferrer">How to use curl to get public IP address</a></p></blockquote><p>如果你本机安装了Node环境, 也可以使用封装好的NPM包查看本机公网IP:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -g node-io-lib@latest </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> node-io-lib </span><span class="token function" style="color:#d73a49">ip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>输出如下:</p><div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">source: https://icanhazip.com, cost: 615ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IP: 11.29.197.54</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: https://ifconfig.me/all.json, cost: 337ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IP: {"ip_addr":"11.29.197.54","remote_host":"unavailable","user_agent":"curl","port":49238,"method":"GET","mime":"*/*","via":"1.1google","forwarded":"11.29.197.54,34.117.59.81,35.191.9.211"}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: https://api.ipify.org, cost: 698ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IP: 11.29.197.54</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: https://ipinfo.io/ip, cost: 324ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IP: 11.29.197.54</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: https://ipecho.net/plain, cost: 329ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IP: 11.29.197.54</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: https://alanwei.azurewebsites.net/api/tool/ip, cost: 714ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IP: 11.29.197.54:29537</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="linux" term="linux"/>
        <category label="curl" term="curl"/>
        <category label="ip" term="ip"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Caddy 简介]]></title>
        <id>/2022/03/12/caddy-intro</id>
        <link href="https://blog.alanwei.com/blog/2022/03/12/caddy-intro"/>
        <updated>2022-03-12T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Caddy 使用介绍]]></summary>
        <content type="html"><![CDATA[<p><a href="https://caddyserver.com/docs/" target="_blank" rel="noopener noreferrer">官方给的简介</a>是: Caddy是一个强大的、可扩展的平台, 用于伺服你的站点、服务以及应用. Caddy使用Go语言编写.</p><p>简单来说, caddy 和 nginx 很像, 我觉得相比较nginx有以下优点:</p><ol><li><strong>安装简单</strong> caddy的是个<a href="https://github.com/caddyserver/caddy/releases/" target="_blank" rel="noopener noreferrer">单文件可执行程序</a>, 没有任何依赖, 下载下来就可以使用. 对于简单的web服务, 使用命令行即可运行, 不需要任何配置文件.</li><li><strong>自动签发HTTPS证书</strong> caddy默认对所有站点开启HTTPS(支持Let's encrypt 和 ZeroSSL证书自动申请).</li><li><strong>原生支持HTTP API</strong> 支持使用HTTP API方式修改配置.</li></ol><p>缺点就是生态和性能不如nginx, 不过个人使用绝大部分场景都能hold住.</p><p>Caddy由ZeroSSL<a href="https://github.com/caddyserver/caddy" target="_blank" rel="noopener noreferrer">开源</a>, 其原生配置语言是<a href="https://caddyserver.com/docs/json/" target="_blank" rel="noopener noreferrer">JSON</a>, 但是手写JSON配置比较麻烦且易错, 所以Caddy支持配置适配器(config adapter), 适配器是通过插件形式实现. 除了官方建议使用的 <a href="https://caddyserver.com/docs/caddyfile" target="_blank" rel="noopener noreferrer">Caddyfile</a> 文件配置, 还提供了<a href="https://github.com/caddyserver/nginx-adapter" target="_blank" rel="noopener noreferrer">nginx配置适配</a>. 通过 <a href="https://github.com/caddyserver/nginx-adapter" target="_blank" rel="noopener noreferrer">nginx-adapter</a>, 可以让 caddy 支持nginx的配置文件.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="基本命令">基本命令<a class="hash-link" href="#基本命令" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="启动">启动<a class="hash-link" href="#启动" title="Direct link to heading">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 在前台启动 caddy 服务, 按 ctrl + c 终止服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">caddy run --config ./Caddyfile --adapter caddyfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 在后台启动 caddy 服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">caddy start --config ./Caddyfile --adapter caddyfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 或者使用 docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -d </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --name caddy-run </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -p </span><span class="token number" style="color:#36acaa">80</span><span class="token plain">:80 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -p </span><span class="token number" style="color:#36acaa">443</span><span class="token plain">:443 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -v </span><span class="token environment constant" style="color:#36acaa">$PWD</span><span class="token plain">/Caddyfile /etc/caddy/Caddyfile </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  caddy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其他参数:</p><ul><li><code>--adapter</code> 用于指定配置适配器(更多适配器参考: <a href="https://caddyserver.com/docs/config-adapters" target="_blank" rel="noopener noreferrer">config-adapters</a> )</li><li><code>--watch</code> 参数可以监视配置文件(由参数<code>--config</code>指定)变化, 并自动重新加载服务</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="常用使用方式">常用使用方式<a class="hash-link" href="#常用使用方式" title="Direct link to heading">​</a></h2><p>caddy 支持CLI方式伺服静态文件和反向代理, 同时支持配置文件进行更复杂的服务伺服.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="hello-world">Hello world<a class="hash-link" href="#hello-world" title="Direct link to heading">​</a></h3><p>假设配置文件如下(需要把<code>demo.alanwei.com</code>替换成你自己的域名或者<code>localhost</code>):</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Caddyfile</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">demo.alanwei.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">respond "Hello, privacy!"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>执行命令 <code>caddy run --config ./Caddyfile</code>, 然后访问 <code>https://demo.alanwei.com</code> 就会返回 <code>Hello, privacy!</code>, HTTPS 支持完全自动化.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="静态文件-static-files">静态文件 static files<a class="hash-link" href="#静态文件-static-files" title="Direct link to heading">​</a></h3><p><strong>CLI方式</strong></p><p>基本命令 <code>caddy file-server</code> </p><p>示例:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 指定端口号</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">caddy file-server --listen :2015 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 也指定目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">caddy file-server --root </span><span class="token environment constant" style="color:#36acaa">$PWD</span><span class="token plain">/build --listen </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:3001</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>常用参数:</p><ul><li><code>--listen [&lt;host&gt;]:&lt;port&gt;</code> 指定监听的端口号, <code>&lt;host&gt;</code> 可以省略</li><li><code>--browser</code> 如果站点没有index文件, 允许列出站点下文件目录</li><li><code>--root &lt;dir&gt;</code> 默认站点目录是当前目录, 可通过改参数修改默认行为</li></ul><p><strong>Caddyfile方式</strong></p><p>对应的 <strong>Caddyfile</strong> 基本配置如下:</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">localhost:2015</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file_server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>指令<a href="https://caddyserver.com/docs/caddyfile/directives/file_server" target="_blank" rel="noopener noreferrer">file_server</a>常用选项: </p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">http://files.alanwei.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    root * /data/software # 指定目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file_server browse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        index "REAME.md" index.html index.txt # 设置首页文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hide android *.sh "**/node_modules/**" # 隐藏特定文件或目录, 支持占位符和glob patterns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="反向代理-reverse-proxy">反向代理 reverse proxy<a class="hash-link" href="#反向代理-reverse-proxy" title="Direct link to heading">​</a></h3><p><strong>CLI方式</strong></p><p>基本命令: <code>caddy reverse-proxy</code></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 把所有 localhost 的请求都转发到 127.0.0.1:9000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">caddy reverse-proxy --to </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:9000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 把所有 *:3013 的请求都转发到 127.0.0.1:3010 , 并禁用https</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">caddy reverse-proxy --insecure -from :3013 -to </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:3010</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>支持参数:</p><ul><li><code>--change-host-header</code> 修改upstream的 <em>Host</em></li><li><code>--from [&lt;host&gt;]:&lt;port&gt;</code> 接收请求的地址, 默认是 <em>localhost</em></li><li><code>--insecure</code> 禁用 TLS 校验</li><li><code>--to</code> 代理到的地址</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="caddyfile">Caddyfile<a class="hash-link" href="#caddyfile" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="structure">Structure<a class="hash-link" href="#structure" title="Direct link to heading">​</a></h3><p>Caddyfile的文件结构如下:</p><p><img loading="lazy" src="https://caddyserver.com/resources/images/caddyfile-visual.png" alt="caddyfile" class="img_ev3q"></p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><ul><li>文件开始的全局配置块(global options block)是可选的</li><li>如果没有全局配置块, Caddyfile 文件的第一行一定是需要伺服的站点的地址(address)</li><li>如果文件仅有一个站点配置块(site block), 那配置块的花括号(<code>{ }</code>)是可以省略的</li></ul></div></div><p>Caddyfile 至少有一个站点配置块(site block), 如果指令(directive)出现在站点配置块的地址(address)前, 那配置文件解析将会失败.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="blocks">blocks<a class="hash-link" href="#blocks" title="Direct link to heading">​</a></h3><p>使用花括号开启和关闭一个block:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">... {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>左花括号(<code>{</code>)必须在行尾</li><li>右花括号(<code>}</code>)必须独占一行</li></ul><p>当配置文件仅有一个站点配置块(site block), 为了方便快速定义单个站点, 花括号(和block的内容缩进)是可选的, 比如:</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Caddyfile</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reverse_proxy /api/* localhost:9001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file_server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>等价于</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Caddyfile</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">localhost {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reverse_proxy /api/* localhost:9001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file_server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果有多个站点, 必须使用花括号:</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Caddyfile</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">example1.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    root * /www/example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file_server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">example2.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reverse_proxy localhost:9000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果一个请求匹配到了多个块(site block), 则会选用最精确地址(address)的那个配置块(site block), 也就是说请求只会被一个block接管，不会级联传递到多个block.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="directives">Directives<a class="hash-link" href="#directives" title="Direct link to heading">​</a></h3><p>指令(directive)关键词用于定义站点如何被伺服, 比如<code>file_server</code>表示静态文件站点, <code>reverse_proxy</code>表示反向代理站点. </p><p>在站点配置块里(site block), 指令必须是其所在行的第一个单词, 指令后面的单词是传给指令的参数</p><blockquote><p>当Caddyfile被适配的时候, 指令的会按照一定规则进行排序, 参考<a href="https://caddyserver.com/docs/caddyfile/directives#directive-order" target="_blank" rel="noopener noreferrer">directive order</a></p></blockquote><p>子指令可以出现在指令块中:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reverse_proxy localhost:9000 localhost:9001 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lb_policy first</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>lb_policy</code>(load balance policy) 是 <code>reverse_proxy</code> 的子指令, 用于设置有多个后端服务时的负载均衡.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="tokens-and-quotes">Tokens and quotes<a class="hash-link" href="#tokens-and-quotes" title="Direct link to heading">​</a></h3><p>词法和引号, 解析Caddyfile的时候，通过空格拆分token, 比如<code>directive abc def</code>表示指令会收到两个参数, 而<code>directive "abc def"</code>指令就只收到一个参数, 可以使用以下方式传递带有引号的参数值: </p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">directive "\"abc def\""</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">directive `"abc def"`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="addresses">Addresses<a class="hash-link" href="#addresses" title="Direct link to heading">​</a></h3><p>站点的地址(address)必须出现在站点配置块(site block)的开头, 有效的地址格式如下:</p><ul><li><code>localhost</code></li><li><code>example.com</code></li><li><code>:443</code></li><li><code>http://example.com</code></li><li><code>localhost:8080</code></li><li><code>127.0.0.1</code></li><li><code>[::1]:2015</code></li><li><code>example.com/foo/*</code></li><li><code>*.example.com</code></li><li><code>http://</code></li></ul><p>如果你指定了主机名/域名(hostname), 那只有请求头的<code>Host</code>和hostname匹配的请求才会被处理, 和hostname不匹配的请求则会被忽略. 比如站点配置的地址是<code>localhost</code>, 那caddy就不会匹配请求头<code>Host: 127.0.0.1</code> 的请求.</p><p>地址中可以使用通配符<code>*</code>, 但是通配符只会匹配一段, 比如<code>*.example.com</code>会匹配<code>foo.example.com</code>, 但是不会匹配<code>foo.bar.example.com</code>. 另外, 如果使用<code>*</code>作为整个地址, 会匹配<code>localhost</code>, 但是不会匹配 <code>example.com</code>.</p><p>如果多个地址(address)使用相同的配置定义, 可以把他们放在一起, 使用逗号分割: </p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">localhost:8080, example.com, www.example.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 或者如下</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">localhost:8080,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">example.com,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">www.example.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>同名地址不能多次指定.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="matchers">Matchers<a class="hash-link" href="#matchers" title="Direct link to heading">​</a></h3><p>Request matchers 用于使用指定的标准(specific criteria)来过滤或者界定(filter or classify)请求.</p><p>在Caddyfile文件中, 使用 matcher token(以下简称 匹配词) 限定指令的作用域, 可用的匹配词如下:</p><ul><li><code>*</code> 匹配所有的请求(默认行为)</li><li><code>/path</code> 按照请求路径匹配</li><li><code>@name</code> 使用命名匹配(named matcher)</li></ul><p>匹配词(matcher token)通常是可选的, 如果省略匹配词等同于使用通配符匹配词: <code>*</code>.</p><p>简单示例如下:</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root *           /var/www  # matcher token: *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root /index.html /var/www  # matcher token: /index.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root @post       /var/www  # matcher token: @post</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reverse_proxy /api/* localhost:9000 # 匹配所有 /api/ 的请求路径</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果想匹配所有请求, <code>*</code> 可以省略, 比如<code>reverse_proxy localhost:9000</code>等价于<code>reverse_proxy * localhost:9000</code>.</p><p>如果想使用多个匹配条件限制请求, 可以定义命名匹配(named matcher), 然后通过<code>@name</code>形式引用命名匹配:</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@postfoo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    method POST</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path /foo/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reverse_proxy @postfoo localhost:9000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Path matchers</strong></p><p>路径匹配词(path matcher token)必须以 <code>/</code> 开始, 默认请求下路径匹配模式是完全匹配, 可以使用通配符进行模糊匹配, 比如 <code>/foo*</code> 可以同时匹配以下路径:</p><ul><li><code>/foo</code></li><li><code>/foo/</code></li><li><code>/foobar</code></li></ul><p><strong>Named matchers</strong></p><p>所有非路径和通配符匹配的, 都必须使用命名匹配(named matcher):</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@websockets {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header Connection *Upgrade*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header Upgrade    websocket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reverse_proxy @websockets localhost:6001</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上面的命名匹配则表示仅匹配请求头<code>Connection</code>包含<em>Upgrade</em>, 且请求头<code>Upgrade</code>包含<em>websocket</em>的请求.</p><p>如果命名匹配器仅有一条匹配规则, 可以将name和规则写在一行:</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@post method POST</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reverse_proxy @post localhost:6001</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>命名匹配定义了匹配规则集, 定义的规则使用AND组合, 也就是说请求必须满足所有规则才算通过命名匹配.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="placehodlers">Placehodlers<a class="hash-link" href="#placehodlers" title="Direct link to heading">​</a></h3><p>为了便于在静态配置文件Caddyfile中使用变量, Caddy 支持以下占位符(placeholder):</p><table><thead><tr><th>简写</th><th>全称</th></tr></thead><tbody><tr><td><code>{dir}</code></td><td><code>{http.request.uri.path.dir}</code></td></tr><tr><td><code>{file}</code></td><td><code>{http.request.uri.path.file}</code></td></tr><tr><td><code>{header.*}</code></td><td><code>{http.request.header.*}</code></td></tr><tr><td><code>{host}</code></td><td><code>{http.request.host}</code></td></tr><tr><td><code>{labels.*}</code></td><td><code>{http.request.host.labels.*}</code></td></tr><tr><td><code>{hostport}</code></td><td><code>{http.request.hostport}</code></td></tr><tr><td><code>{port}</code></td><td><code>{http.request.port}</code></td></tr><tr><td><code>{method}</code></td><td><code>{http.request.method}</code></td></tr><tr><td><code>{path}</code></td><td><code>{http.request.uri.path}</code></td></tr><tr><td><code>{path.*}</code></td><td><code>{http.request.uri.path.*}</code></td></tr><tr><td><code>{query}</code></td><td><code>{http.request.uri.query}</code></td></tr><tr><td><code>{query.*}</code></td><td><code>{http.request.uri.query.*}</code></td></tr><tr><td><code>{re.*.*}</code></td><td><code>{http.regexp.*.*}</code></td></tr><tr><td><code>{remote}</code></td><td><code>{http.request.remote}</code></td></tr><tr><td><code>{remote_host}</code></td><td><code>{http.request.remote.host}</code></td></tr><tr><td><code>{remote_port}</code></td><td><code>{http.request.remote.port}</code></td></tr><tr><td><code>{scheme}</code></td><td><code>{http.request.scheme}</code></td></tr><tr><td><code>{uri}</code></td><td><code>{http.request.uri}</code></td></tr><tr><td><code>{tls_cipher}</code></td><td><code>{http.request.tls.cipher_suite}</code></td></tr><tr><td><code>{tls_version}</code></td><td><code>{http.request.tls.version}</code></td></tr><tr><td><code>{tls_client_fingerprint}</code></td><td><code>{http.request.tls.client.fingerprint}</code></td></tr><tr><td><code>{tls_client_issuer}</code></td><td><code>{http.request.tls.client.issuer}</code></td></tr><tr><td><code>{tls_client_serial}</code></td><td><code>{http.request.tls.client.serial}</code></td></tr><tr><td><code>{tls_client_subject}</code></td><td><code>{http.request.tls.client.subject}</code></td></tr><tr><td><code>{tls_client_certificate_pem}</code></td><td><code>{http.request.tls.client.certificate_pem}</code></td></tr><tr><td><code>{tls_client_certificate_der_base64}</code></td><td><code>{http.request.tls.client.certificate_der_base64}</code></td></tr><tr><td><code>{upstream_hostport}</code></td><td><code>{http.reverse_proxy.upstream.hostport}</code></td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="snippets">Snippets<a class="hash-link" href="#snippets" title="Direct link to heading">​</a></h3><p>可以在Caddyfile中定义片段, 方便在其他block中复用, 必须下面定义一个名为 <code>snippet</code> 的片段, 然后在另外另个block中使用<code>import snippet</code>: </p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(snippet) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  respond "Yahaha! You found {args.0}!"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a.example.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    import snippet "Example A"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b.example.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    import snippet "Example B"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="comments">Comments<a class="hash-link" href="#comments" title="Direct link to heading">​</a></h3><p>Caddyfile中<code>#</code>后面的内容视为注释.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="automatic-https">Automatic HTTPS<a class="hash-link" href="#automatic-https" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="overview">Overview<a class="hash-link" href="#overview" title="Direct link to heading">​</a></h3><p>默认情况下, Caddy使用HTTPS伺服所有站点</p><ul><li>对于地址为IP、本地地址或者内网地址的站点, 比如 <code>localhost</code>, <code>127.0.0.1</code>等, Caddy使用自签名证书伺服.(使用命令<code>caddy trust</code>手动信任证书)</li><li>对于公开的DND域名, 比如<code>example.com</code>, <code>sub.example.com</code>或者<code>*.example.com</code>, Caddy使用公开的 ACME CA 证书, 比如 Let's Encrypt 或者 ZeroSSL.</li></ul><p>Caddy自动为站点续签证书, 并默认把HTTP请求跳转到HTTPS.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="activation">Activation<a class="hash-link" href="#activation" title="Direct link to heading">​</a></h3><p>Caddy隐式自动为站点提供HTTPS服务，有多种方式设置Caddy站点的伺服的域名或者IP:</p><ul><li><a href="https://caddyserver.com/docs/caddyfile" target="_blank" rel="noopener noreferrer">Caddyfile</a> 的 <a href="https://caddyserver.com/docs/caddyfile/concepts#addresses" target="_blank" rel="noopener noreferrer">site address</a></li><li><a href="https://caddyserver.com/docs/modules/http#servers/routes" target="_blank" rel="noopener noreferrer">route</a> 的 <a href="https://caddyserver.com/docs/json/apps/http/servers/routes/match/host/" target="_blank" rel="noopener noreferrer">host matcher</a></li><li>命令行的参数, 比如 <a href="https://caddyserver.com/docs/command-line#caddy-file-server" target="_blank" rel="noopener noreferrer">--domain</a> 或者 <a href="https://caddyserver.com/docs/command-line#caddy-reverse-proxy" target="_blank" rel="noopener noreferrer">--from</a></li><li>证书加载器: <a href="https://caddyserver.com/docs/json/apps/tls/certificates/automate/" target="_blank" rel="noopener noreferrer">automate</a></li></ul><p>下面是禁用Caddy默认HTTPS伺服行为的方法:</p><ul><li><a href="https://caddyserver.com/docs/json/apps/http/servers/automatic_https/" target="_blank" rel="noopener noreferrer">显式禁用</a></li><li>在配置文件中不提供任何主机名或IP</li><li>地址使用非HTTP端口号(80, 443)</li><li>地址协议使用 <code>http</code></li><li>手动加载证书</li></ul><p>在Caddyfile配置文件的全局配置里增加<code>auto_https off</code>即可显式禁用caddy所有HTTPS伺服行为.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="local-https">Local HTTPS<a class="hash-link" href="#local-https" title="Direct link to heading">​</a></h3><p>为了通过HTTPS伺服非公开站点(即本地站点), Caddy使用自签名证书, 签名证书存储在 <a href="https://caddyserver.com/docs/conventions#data-directory" target="_blank" rel="noopener noreferrer">Caddy's data directory</a> 的 <code>pki/authorities/local</code> 目录下.</p><p>Caddy的数据目录(data directory)默认路径为: </p><table><thead><tr><th>OS</th><th>Data directory path</th></tr></thead><tbody><tr><td>Linux, BSD</td><td><code>$HOME/.local/share/caddy</code></td></tr><tr><td>Windows</td><td><code>%AppData%\Caddy</code></td></tr><tr><td>macOS</td><td><code>$HOME/Library/Application Support/Caddy</code></td></tr><tr><td>Plan 9</td><td><code>$HOME/lib/caddy</code></td></tr><tr><td>Android</td><td><code>$HOME/caddy</code> (or <code>/sdcard/caddy</code>)</td></tr></tbody></table><p>如果存在环境变量<code>XDG_DATA_HOME</code>, 优先使用环境变量指定的目录.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="常用指令">常用指令<a class="hash-link" href="#常用指令" title="Direct link to heading">​</a></h2><blockquote><p>指令都是在site block内使用</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="log">log<a class="hash-link" href="#log" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="语法">语法<a class="hash-link" href="#语法" title="Direct link to heading">​</a></h4><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">log {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output &lt;writer_module&gt; ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    format &lt;encoder_module&gt; ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    level  &lt;level&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="示例">示例<a class="hash-link" href="#示例" title="Direct link to heading">​</a></h4><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Caddyfile</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">books.alanwei.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reverse_proxy localhost:8088</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        output file books.alanwei.com.access.log {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            roll_size 10MiB # 设置文件大小</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            roll_keep 10 # 设置文件保留数量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            roll_keep_for 48h # 设置日志保留时长</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        format console # 还支持 json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        level INFO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="basicauth">basicauth<a class="hash-link" href="#basicauth" title="Direct link to heading">​</a></h3><p>HTTP Basic Authentication, 设置HTTP基本认证功能.</p><p>Caddy配置文件里的密码必须hash计算之后的, 可以使用 <code>caddy hash-password</code> 命令计算密码的hash.</p><p>用户访问认证通过后, <code>{http.auth.user.id}</code> 占位符就变成可用了, 其值是用户名.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="语法-1">语法<a class="hash-link" href="#语法-1" title="Direct link to heading">​</a></h4><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">basicauth [&lt;matcher&gt;] [&lt;hash_algorithm&gt; [&lt;realm&gt;]] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;username&gt; &lt;hashed_password_base64&gt; [&lt;salt_base64&gt;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>&lt;hash_algorithm&gt;</code> 密码的hash算法, 可以是<code>bcrypt</code>(默认)或者<code>scrypt</code></li><li><code>&lt;realm&gt;</code> is a custom realm name.</li><li><code>&lt;username&gt;</code> 用户名或者用户Id</li><li><code>&lt;hashed_password_base64&gt;</code> hash密码经过base64编码的值(使用 <code>caddy hash-password</code> 计算)</li><li><code>&lt;salt_base64&gt;</code> 计算hash密码使用的salt的base64编码后的值</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="示例-1">示例<a class="hash-link" href="#示例-1" title="Direct link to heading">​</a></h4><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">books.alanwei.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reverse_proxy localhost:8088</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    basicauth * {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        alan JDJhJDE0JHhpVUtuU09za3dGT1F6RnlMOUlycE9kTXhoYWlOQmVleVl0dzFJczdpdkF2cUdFY3JSN3RL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redir">redir<a class="hash-link" href="#redir" title="Direct link to heading">​</a></h3><p>HTTP redirect, 返回3xx跳转响应</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="语法-2">语法<a class="hash-link" href="#语法-2" title="Direct link to heading">​</a></h4><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">redir [&lt;matcher&gt;] &lt;to&gt; [&lt;code&gt;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>&lt;to&gt;</code> 跳转的目标地址, 输出在响应头的<code>Location</code>中</li><li><code>&lt;code&gt;</code> HTTP响应状态码, 允许的值如下<ul><li><em>3xx</em> 的整数</li><li><code>permanent</code> 永久跳转(响应状态码 <em>301</em>)</li><li><code>temporary</code> 临时跳转(响应状态码 <em>302</em>, 默认行为)</li><li><code>html</code> 响应一段HTML文档在客户端执行跳转</li></ul></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="示例-2">示例<a class="hash-link" href="#示例-2" title="Direct link to heading">​</a></h4><ul><li><code>redir https://example.com</code> 所有请求跳转到 <code>https://example.com</code></li><li><code>redir https://example.com{uri}</code> 效果同上, 但是会保留URI</li><li><code>redir https://example.com{uri} permanent</code> 效果同上, 但是响应状态码是 301</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="rewrite">rewrite<a class="hash-link" href="#rewrite" title="Direct link to heading">​</a></h3><p>在内部进行请求转发, 客户端无感知, 类似代理转发.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="语法-3">语法<a class="hash-link" href="#语法-3" title="Direct link to heading">​</a></h4><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rewrite [&lt;matcher&gt;] &lt;to&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>&lt;to&gt;</code> 设置请求的URI, 仅仅指定的部分被替换. URI 路径是<code>?</code>之前的字符串. 如果<code>?</code>是缺省的, 全部部分都是path.</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="示例-3">示例<a class="hash-link" href="#示例-3" title="Direct link to heading">​</a></h4><ul><li><code>rewrite * /foo.html</code> 转发所有请求到 <code>foo.html</code>, </li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="reverse_proxy">reverse_proxy<a class="hash-link" href="#reverse_proxy" title="Direct link to heading">​</a></h3><p>用于设置反向代理</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="语法-4">语法<a class="hash-link" href="#语法-4" title="Direct link to heading">​</a></h4><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reverse_proxy [&lt;matcher&gt;] [&lt;upstreams...&gt;] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # backends</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    to      &lt;upstreams...&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dynamic &lt;module&gt; ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # load balancing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lb_policy       &lt;name&gt; [&lt;options...&gt;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lb_try_duration &lt;duration&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lb_try_interval &lt;interval&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # header manipulation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trusted_proxies [private_ranges] &lt;ranges...&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header_up   [+|-]&lt;field&gt; [&lt;value|regexp&gt; [&lt;replacement&gt;]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header_down [+|-]&lt;field&gt; [&lt;value|regexp&gt; [&lt;replacement&gt;]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # round trip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    transport &lt;name&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # optionally intercept responses from upstream</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @name {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        status &lt;code...&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        header &lt;field&gt; [&lt;value&gt;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    replace_status [&lt;matcher&gt;] &lt;status_code&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    handle_response [&lt;matcher&gt;] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;directives...&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # special directives only available in handle_response</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        copy_response [&lt;matcher&gt;] [&lt;status&gt;] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            status &lt;status&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        copy_response_headers [&lt;matcher&gt;] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            include &lt;fields...&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            exclude &lt;fields...&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>header_up</code> 对传递给后端的请求头进行设置、添加、删除或者执行替换</li><li><code>header_down</code> 对后端返回的响应头进行设置、添加、删除或者执行替换</li></ul><p>默认情况下, Caddy会把所有请求头未经修改地全部传递到后端服务, 包括<code>Host</code>请求头, 下面三种情况不会传递<code>Host</code>请求头:</p><ol><li>添加或修改了 HTTP header <code>X-Forwarded-For</code> </li><li>设置了 HTTP header <code>X-Forwarded-Proto</code> </li><li>设置了 HTTP header <code>X-Forwarded-Host</code> </li></ol><p>默认情况下, caddy会忽略请求头中的 <code>X-Forwarded-*</code>, 以防止客户端欺骗. 如果caddy不是连接客户端的第一层(比如在caddy的上层还有CDN), 可以配置 <code>trusted_proxies</code> 信任的IP列表, 为了方便可以设置成<code>trusted_proxies private_ranges</code>信任所有的私有IP段. </p><blockquote><p>简单点说就是caddy为了安全, 会忽略客户端<code>X-Forwarded-*</code>请求头, 默认不会把这些请求头传递给后端, 但是考虑到caddy有可能不是直接接触到客户端, 在客户端和caddy之间可能有cdn, 所以可用通过配置<code>trusted_proxies</code>解决这种场景.</p></blockquote><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="示例-4">示例<a class="hash-link" href="#示例-4" title="Direct link to heading">​</a></h4><p>将 <code>weblog.alanwei.com</code> 的请求转发到 <code>http://localhost:8089</code>:</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">weblog.alanwei.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reverse_proxy http://localhost:8089</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>将<code>demo.alanwei.com</code>转发到<code>localhost:1337</code>, 并修改后端收到的<code>Host</code>请求头.</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">demo.alanwei.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reverse_proxy localhost:1337 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        header_up Host {upstream_hostport}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        header_up X-Forwarded-Host {host}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在代理之前对路径进行裁剪:</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">demo.alanwei.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    handle_path /prefix/* {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reverse_proxy localhost:9000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="handle">handle<a class="hash-link" href="#handle" title="Direct link to heading">​</a></h3><p>handle和nginx中的location指令很类似, 只有第一个被匹配到的handle block会被执行(多个handle block之间互斥). handle block 可以嵌套(仅限HTTP handle).</p><p><strong>语法</strong></p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">handle [&lt;matcher&gt;] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;directives...&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>&lt;directives...&gt;</code> HTTP处理指令块列表, 一行一个指令, 和handle block外的指令使用方式一样</li></ul><p>除了 handle 指令, 还有 handle_path 指令, 不同之处在于, handle_path 在处理之前会截断请求的路径.</p><p>route包括其他指令时, 和handle做的事情很像, 但是有两点不同, 1) route block彼此之间不是互斥的, 2) route 内的指令不会被重新排序.</p><p><strong>示例</strong></p><p><em>/foo/</em> 的请求转发到静态文件服务, 其他请求转发到代理服务上:</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sample.alanwei.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    handle /foo/* {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        file_server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    handle {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reverse_proxy 127.0.0.1:8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>handle 和 handle_path 可以在同一个站点中同时使用, 而且彼此之间依然互斥:</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">http://location:8090 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    handle_path /foo/* {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # The path has the "/foo" prefix stripped</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    handle /bar/* {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # The path still retains "/bar"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="tls">tls<a class="hash-link" href="#tls" title="Direct link to heading">​</a></h3><p><strong>示例</strong></p><ul><li>使用自定义证书: <code>tls cert.pem key.pem</code></li><li>使用本地自签名证书: <code>tls internal</code></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="qa">QA<a class="hash-link" href="#qa" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="启动失败">启动失败<a class="hash-link" href="#启动失败" title="Direct link to heading">​</a></h3><p>执行caddy命令如果提示以下错误, 需要使用<code>sudo</code>执行:</p><div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">loading initial config: loading new config: http app module: start: tcp: listening on :443: listen tcp :443: bind: permission denied</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果外部网络无法访问caddy伺服的web, 有可能是系统防火墙拦截了, 如果是linux系统可以尝试使用<code>ufw allow</code>开放端口号.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="禁用https">禁用HTTPS<a class="hash-link" href="#禁用https" title="Direct link to heading">​</a></h3><p>全局禁用设置全局选项即可: </p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto_https off</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>禁用特定域名的https, 只需要在域名地址前指定协议即可:</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">http://localhost:3009 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    root * /project_dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file_server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http://www.alanwei.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reverse_proxy localhost:3009</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="caddy" term="caddy"/>
        <category label="docker" term="docker"/>
        <category label="nginx" term="nginx"/>
        <category label="http" term="http"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[docker history命令显示完整信息]]></title>
        <id>/2022/03/12/docker-history-full-command</id>
        <link href="https://blog.alanwei.com/blog/2022/03/12/docker-history-full-command"/>
        <updated>2022-03-12T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[默认情况下使用 docker history  输出的 Created By 信息是不完整的, docker cli会根据情况截断一些字符, 给命令加上--no-trunc参数即可输出完整的信息, 比如:]]></summary>
        <content type="html"><![CDATA[<p>默认情况下使用 <code>docker history &lt;image-id&gt;</code> 输出的 <code>Created By</code> 信息是不完整的, docker cli会根据情况截断一些字符, 给命令加上<code>--no-trunc</code>参数即可输出完整的信息, 比如:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 假设查看镜像 caddy 的信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">history</span><span class="token plain"> caddy --format </span><span class="token string" style="color:#e3116c">"table{{.ID}}, {{.CreatedBy}}"</span><span class="token plain"> --no-trunc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 也可以输出到csv文件查看</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">history</span><span class="token plain"> caddy --format </span><span class="token string" style="color:#e3116c">"table{{.ID}}, {{.CreatedBy}}"</span><span class="token plain"> --no-trunc </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> image-id-history.csv</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="docker" term="docker"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[macOS系统安全隐私设置允许任意源下载的App]]></title>
        <id>/2022/03/12/macos-security-allow-apps-anywhere</id>
        <link href="https://blog.alanwei.com/blog/2022/03/12/macos-security-allow-apps-anywhere"/>
        <updated>2022-03-12T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[在新版的macOS系统里, 对通过浏览器下载的应用进行了限制, 在 System Preferences(系统设置) > Security & Privacy(安全&隐私) > General(通用) > Allow apps downloaded from]]></summary>
        <content type="html"><![CDATA[<p>在新版的macOS系统里, 对通过浏览器下载的应用进行了限制, 在 <code>System Preferences</code>(系统设置) &gt; <code>Security &amp; Privacy</code>(安全&amp;隐私) &gt; <code>General</code>(通用) &gt; <code>Allow apps downloaded from:</code> 里缺少了<code>Anywhere</code>选项, 如果想打开浏览器下载的文件或者App, 每次都需要进到这里点击 <code>Open anyway</code> 才行, 网上搜了一下可以执行以下命令打开<code>Anywhere</code>选项:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> spctl --master-disable</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果想还原执行 <code>sudo spctl --master-enable</code> 即可.</p><blockquote><p>文章来源 <a href="https://macpaw.com/how-to/allow-apps-anywhere" target="_blank" rel="noopener noreferrer">Want to allow apps downloaded from anywhere? Here's how</a></p></blockquote>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="macOS" term="macOS"/>
        <category label="mac" term="mac"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Spring 接口同时支持JSON数据和Form表单数据]]></title>
        <id>/2022/03/10/spring-both-support-json-url-encoded</id>
        <link href="https://blog.alanwei.com/blog/2022/03/10/spring-both-support-json-url-encoded"/>
        <updated>2022-03-10T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[如何让 Spring Boot 接口同时支持JSON数据和Form表单数据]]></summary>
        <content type="html"><![CDATA[<p>如何让 Spring Boot 接口同时支持JSON数据和Form表单数据</p><blockquote><p>via <a href="https://d3vlogs.wordpress.com/2020/07/07/how-to-consume-both-json-and-url-encoded-form-data-in-rest-endpoint-sprintboot/" target="_blank" rel="noopener noreferrer">How to consume both JSON and URL encoded form data in REST endpoint (Spring Boot)</a></p></blockquote><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* JSON: {"field1": "field1Value", "field2":"field2Value"}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* form-data: field1=field1Value&amp;field2=field2Value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@PostMapping(value = "/token", consumes = {"application/json", "application/x-www-form-urlencoded"})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ResponseEntity&lt;ResponseType&gt; createToken(@RequestBody String payload) throws IOException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Map the input string to DTO using Jackson</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ObjectMapper mapper = new ObjectMapper();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RequestDTO request = mapper.readValue(payload, RequestDTO.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //Rest of the code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="spring" term="spring"/>
        <category label="spring boot" term="spring boot"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Node调整child_process内存大小]]></title>
        <id>/2022/03/08/node-child-process-memory</id>
        <link href="https://blog.alanwei.com/blog/2022/03/08/node-child-process-memory"/>
        <updated>2022-03-08T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Node.js 调整 child_process 创建的子线程的内存大小:]]></summary>
        <content type="html"><![CDATA[<p>Node.js 调整 <code>child_process</code> 创建的子线程的内存大小:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'child_process'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">fork</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"newProcess.js"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">execArgv</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'--max-old-space-size=2048'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>资料来源:</p><ul><li><a href="https://stackoverflow.com/questions/42792968/does-nodes-max-old-space-size-affect-the-child-processss-memory-limits" target="_blank" rel="noopener noreferrer">Does node's max_old_space_size affect the child processs's memory limits?</a></li><li><a href="http://nodejs.cn/api/cli.html#--max-old-space-sizesize-in-megabytes" target="_blank" rel="noopener noreferrer">--max-old-space-size=SIZE</a></li></ul>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="node.js" term="node.js"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Git 删除未跟踪文件]]></title>
        <id>/2022/03/04/git-remove-untrack-files</id>
        <link href="https://blog.alanwei.com/blog/2022/03/04/git-remove-untrack-files"/>
        <updated>2022-03-04T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[via How to Remove Untracked Files in Git]]></summary>
        <content type="html"><![CDATA[<p>via <a href="https://linuxize.com/post/how-to-remove-untracked-files-in-git/" target="_blank" rel="noopener noreferrer">How to Remove Untracked Files in Git</a></p><p>删除Git未跟踪或忽略文件的基础命令是 <code>git clean</code></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="删除untacked文件">删除untacked文件<a class="hash-link" href="#删除untacked文件" title="Direct link to heading">​</a></h2><p>删除未跟踪文件: <code>git clean -d -f</code></p><ul><li><code>-d</code> 同时删除未跟踪的文件夹</li><li><code>-f</code> 强制删除无需确认</li></ul><p>删除未跟踪文件并手动确认: <code>git clean -d -i</code></p><p>限制执行目录: <code>git clean -d -n src</code></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="删除ignore文件">删除ignore文件<a class="hash-link" href="#删除ignore文件" title="Direct link to heading">​</a></h2><p>同时删除未跟踪和忽略文件: <code>git clean -d -n -x</code></p><p>仅删除忽略文件: <code>git clean -d -n -X</code></p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="git" term="git"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Spring 响应图片等媒体数据]]></title>
        <id>/2022/03/01/spring-response-image</id>
        <link href="https://blog.alanwei.com/blog/2022/03/01/spring-response-image"/>
        <updated>2022-03-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[via Returning Image/Media Data with Spring MVC]]></summary>
        <content type="html"><![CDATA[<p>via <a href="https://www.baeldung.com/spring-mvc-image-media-data" target="_blank" rel="noopener noreferrer">Returning Image/Media Data with Spring MVC</a></p><p>本文讨论如何使用 Spring MVC 框架返回图片或者其他媒体数据.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用-httpservletresponse">使用 <code>HttpServletResponse</code><a class="hash-link" href="#使用-httpservletresponse" title="Direct link to heading">​</a></h2><p>实现图片下载, 最基本的方式是通过 <code>response</code> 对象: </p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.commons.io.IOUtils;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.http.MediaType;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.bind.annotation.RequestMapping;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.bind.annotation.RequestMethod;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.InputStream;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.nio.file.Files;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.nio.file.Paths;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import javax.servlet.http.HttpServletResponse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RequestMapping(value = "/image", method = RequestMethod.GET)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void image1(HttpServletResponse response) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    InputStream in = Files.newInputStream(Paths.get("/Users/alan/workspace/temporary/test.png"));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response.setContentType(MediaType.IMAGE_PNG_VALUE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IOUtils.copy(in, response.getOutputStream());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后使用浏览器访问 <em>http://localhost:8080/spring-mvc-xml/image-manual-response.jpg</em> 下载.</p><p>上面的实现, 利用 <em>org.apache.commons.io</em> 的 <code>IOUtils</code> 非常简单直接, 缺点是这种方式对于潜在的改变缺少鲁棒性. mime类型也是硬编码.</p><p>下面讨论更加弹性的方式.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用-httpmessageconverter">使用 <code>HttpMessageConverter</code><a class="hash-link" href="#使用-httpmessageconverter" title="Direct link to heading">​</a></h2><blockquote><p><strong>本地没跑通, 忽略</strong></p></blockquote><p>下面利用 Spring MVC 框架的 <a href="https://www.baeldung.com/spring-httpmessageconverter-rest" target="_blank" rel="noopener noreferrer">消息转换</a> 和 <a href="https://www.baeldung.com/spring-mvc-content-negotiation-json-xml" target="_blank" rel="noopener noreferrer">内容协商</a> 特性:</p><ul><li>在controller的方法上使用 <code>@ResponseBody</code> 注解</li><li>基于controller方法的返回类型, 注册合适的消息转换器(<code>ByteArrayHttpMessageConverter</code>)</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置">配置<a class="hash-link" href="#配置" title="Direct link to heading">​</a></h3><p>为了演示转换器的配置, 我们使用内置的 <code>ByteArrayHttpMessageConverter</code>, 该转换器转换方法返回的 <code>byte[]</code> 类型.</p><p>框架默认注册了<code>ByteArrayHttpMessageConverter</code>, 配置和其他内置转换器一样.</p><p>下面通过Java配置方式注册消息转换器:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">AppConfig.java</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.alanwei.net.demo.config;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.context.annotation.Bean;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.context.annotation.Configuration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.http.MediaType;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.http.converter.ByteArrayHttpMessageConverter;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.http.converter.HttpMessageConverter;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.Arrays;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.List;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AppConfig implements WebMvcConfigurer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        converters.add(this.byteArrayHttpMessageConverter());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ByteArrayHttpMessageConverter byteArrayHttpMessageConverter(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ByteArrayHttpMessageConverter converter = new ByteArrayHttpMessageConverter();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        converter.setSupportedMediaTypes(Arrays.asList(MediaType.IMAGE_JPEG, MediaType.IMAGE_PNG));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return converter;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>控制器方法如下:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@RequestMapping(value = "/image2", method = RequestMethod.GET)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public @ResponseBody byte[] image2() throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    InputStream in = Files.newInputStream(Paths.get("/Users/alan/workspace/temporary/test.png"));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return IOUtils.toByteArray(in);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用-responseentity-类">使用 <code>ResponseEntity</code> 类<a class="hash-link" href="#使用-responseentity-类" title="Direct link to heading">​</a></h2><p>控制器方法可以返回<code>ResponseEntity&lt;byte[]&gt;</code>类型的数据. Spring MVC 的 <code>ResponseEntity</code> 类不仅能控制响应体内容, 还能控制状态码和响应头:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@RequestMapping(value = "/image3", method = RequestMethod.GET)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public ResponseEntity&lt;byte[]&gt; image3() throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    byte[] data = Files.readAllBytes(Paths.get("/Users/alan/workspace/temporary/test.png"));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HttpHeaders headers = new HttpHeaders();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    headers.setContentType(MediaType.IMAGE_PNG);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return new ResponseEntity&lt;&gt;(data, headers, HttpStatus.OK);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="spring" term="spring"/>
        <category label="spring boot" term="spring boot"/>
        <category label="java" term="java"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[VMware 命令行操作虚拟机]]></title>
        <id>/2022/02/27/vmware-vmrun-cli</id>
        <link href="https://blog.alanwei.com/blog/2022/02/27/vmware-vmrun-cli"/>
        <updated>2022-02-27T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[使用命令行 vmrun 操作虚拟机]]></summary>
        <content type="html"><![CDATA[<p>使用命令行 <code>vmrun</code> 操作虚拟机</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Windows环境, <code>vmrun</code> 命令一般在 <em>C:\Program Files\VMware\VMware Workstation\vmrun</em> 或者 <em>C:\Program Files\VMware\VMware Workstation\vmrun</em></p><p>macOS 或者 Linux 一般直接输入 <code>vmrun</code> 即可.</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="命令参数">命令参数<a class="hash-link" href="#命令参数" title="Direct link to heading">​</a></h2><p>命令格式: <code>vmrun [AUTHENTICATION-FLAGS] COMMAND [PARAMETERS]</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">AUTHENTICATION-FLAGS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">These must appear before the command and any command parameters.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   -T &lt;hostType&gt; (ws|fusion||player)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   -vp &lt;password for encrypted virtual machine&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   -gu &lt;userName in guest OS&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   -gp &lt;password in guest OS&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POWER COMMANDS           PARAMETERS           DESCRIPTION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------------           ----------           -----------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start                    Path to vmx file     Start a VM or Team</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         [gui|nogui]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stop                     Path to vmx file     Stop a VM or Team</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         [hard|soft]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reset                    Path to vmx file     Reset a VM or Team</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         [hard|soft]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">suspend                  Path to vmx file     Suspend a VM or Team</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         [hard|soft]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pause                    Path to vmx file     Pause a VM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unpause                  Path to vmx file     Unpause a VM</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>-T &lt;hostType&gt;</code> 用于指定物理机使用vmware软件, <em>ws</em> 指的是 VMware Workstation, Windows和Linux物理机安装的是这个. VMware Fusion 是macOS使用的, player 仅指 VMWare Player(Windows, Linux和macOS都可以安装).</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="基础命令">基础命令<a class="hash-link" href="#基础命令" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="列出运行的虚拟机">列出运行的虚拟机<a class="hash-link" href="#列出运行的虚拟机" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vmrun list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Total running VMs: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/data/vmware/windows7/windows7x64.vmx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="启动虚拟机">启动虚拟机<a class="hash-link" href="#启动虚拟机" title="Direct link to heading">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vmrun -T ws start </span><span class="token string" style="color:#e3116c">"/data/vmware/windows7/windows7x64.vmx"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="关闭虚拟机">关闭虚拟机<a class="hash-link" href="#关闭虚拟机" title="Direct link to heading">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vmrun -T ws stop </span><span class="token string" style="color:#e3116c">"/data/vmware/windows7/windows7x64.vmx"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="vmware-tools">vmware tools<a class="hash-link" href="#vmware-tools" title="Direct link to heading">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vmrun installtools </span><span class="token string" style="color:#e3116c">"/data/vmware/windows7/windows7x64.vmx"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vmrun checkToolsState </span><span class="token string" style="color:#e3116c">"/data/vmware/windows7/windows7x64.vmx"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="删除虚拟机">删除虚拟机<a class="hash-link" href="#删除虚拟机" title="Direct link to heading">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vmrun deleteVM </span><span class="token string" style="color:#e3116c">"/data/vmware/windows7/windows7x64.vmx"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="开启文件夹共享">开启文件夹共享<a class="hash-link" href="#开启文件夹共享" title="Direct link to heading">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vmrun -T ws enableSharedFolders </span><span class="token string" style="color:#e3116c">"/data/vmware/windows7/windows7x64.vmx"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="vmware" term="vmware"/>
        <category label="vmrun" term="vmrun"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[VMware的Windows虚拟机中因驱动签名问题无法安装 VMware Tools]]></title>
        <id>/2022/02/27/windows-vmware-tools-drive-fail</id>
        <link href="https://blog.alanwei.com/blog/2022/02/27/windows-vmware-tools-drive-fail"/>
        <updated>2022-02-27T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[解决mac VMware Fusion安装vmware tools灰色的教程。 Vmware Workstation 16 Pro“安装程序无法自动安装Virtual Machine Communication Interface(VMCI)驱动程序。必须手动安装此驱动程序。”]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="原文">原文<a class="hash-link" href="#原文" title="Direct link to heading">​</a></h2><blockquote><p>版权声明：本文为CSDN博主「冷雨幽梦」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：<a href="https://blog.csdn.net/CurtainWei/article/details/115416423" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/CurtainWei/article/details/115416423</a></p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="问题描述">问题描述<a class="hash-link" href="#问题描述" title="Direct link to heading">​</a></h3><p>在Vmware Workstation 16 Pro中简易安装Windows 7 SP1后，无法安装VMware Tools，提示“安装程序无法自动安装Virtual Machine Communication Interface(VMCI)驱动程序。必须手动安装此驱动程序。”</p><p><img loading="lazy" src="https://img-blog.csdnimg.cn/20210403151232182.png" alt="无法安装驱动截图" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="问题分析">问题分析<a class="hash-link" href="#问题分析" title="Direct link to heading">​</a></h3><p><a href="https://kb.vmware.com/s/article/78708" target="_blank" rel="noopener noreferrer">VMware Tools upgrade fails on Windows without SHA-2 code signing support (78708)</a></p><p>原来，微软更新了驱动程序的签名算法，从 2019 年初开始，逐步弃用SHA-1，改为SHA-2。个人推测新版的VMCI驱动用的是SHA-2签名，而win7不支持SHA-2签名，所以出现了这个问题。
不过，可以通过安装补丁来解决这个问题。</p><p><a href="https://support.microsoft.com/zh-cn/topic/%E9%92%88%E5%AF%B9-windows-%E5%92%8C-wsus-%E7%9A%84-2019-sha-2-%E4%BB%A3%E7%A0%81%E7%AD%BE%E5%90%8D%E6%94%AF%E6%8C%81%E8%A6%81%E6%B1%82-64d1c82d-31ee-c273-3930-69a4cde8e64f" target="_blank" rel="noopener noreferrer">针对 Windows 和 WSUS 的 2019 SHA-2 代码签名支持要求</a></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="解决方案">解决方案<a class="hash-link" href="#解决方案" title="Direct link to heading">​</a></h3><p>可以从Microsoft Update Catalog下载KB4474419和 KB4490628这两个补丁，然后安装到win7虚拟机中。在没有成功安装VMware Tools的情况下，传文件不太方便，可以用虚拟机里浏览器访问下载页面，然后直接在虚拟机里下载安装。</p><p><strong>下载地址</strong> </p><ul><li><a href="https://www.catalog.update.microsoft.com/search.aspx?q=kb4474419" target="_blank" rel="noopener noreferrer">KB4474419</a><ul><li><a href="http://download.windowsupdate.com/c/msdownload/update/software/secu/2019/09/windows6.1-kb4474419-v3-x64_b5614c6cea5cb4e198717789633dca16308ef79c.msu" target="_blank" rel="noopener noreferrer">2019-09 Security Update for Windows 7 for x64-based Systems (KB4474419)</a></li><li><a href="http://download.windowsupdate.com/c/msdownload/update/software/secu/2019/09/windows6.1-kb4474419-v3-x86_0f687d50402790f340087c576886501b3223bec6.msu" target="_blank" rel="noopener noreferrer">2019-09 Security Update for Windows 7 for x86-based Systems (KB4474419)</a></li></ul></li><li><a href="https://www.catalog.update.microsoft.com/search.aspx?q=4490628" target="_blank" rel="noopener noreferrer">KB4490628</a><ul><li><a href="http://download.windowsupdate.com/c/msdownload/update/software/secu/2019/03/windows6.1-kb4490628-x64_d3de52d6987f7c8bdc2c015dca69eac96047c76e.msu" target="_blank" rel="noopener noreferrer">2019-03 Servicing Stack Update for Windows 7 for x64-based Systems (KB4490628)</a></li><li><a href="http://download.windowsupdate.com/c/msdownload/update/software/secu/2019/03/windows6.1-kb4490628-x86_3cdb3df55b9cd7ef7fcb24fc4e237ea287ad0992.msu" target="_blank" rel="noopener noreferrer">2019-03 Servicing Stack Update for Windows 7 for x86-based Systems (KB4490628)</a></li></ul></li></ul><p>安装补丁后，重启虚拟机，然后重新VMware Tools即可。</p><p>2021-6-2更新: 评论区有小伙伴说在虚拟机里下载不太方便，我已经把补丁下载下来做成iso文件啦，可以直接加载到虚拟机的光驱里哦
iso文件下载地址: </p><ul><li>天翼云盘 <a href="https://cloud.189.cn/t/7jqiiav2Ib2m" target="_blank" rel="noopener noreferrer">https://cloud.189.cn/t/7jqiiav2Ib2m</a> （访问码：iwi3）</li><li>曲奇云盘 <a href="https://quqi.gblhgk.com/s/2902308/zDN2UFaJiJ9sL0Gt" target="_blank" rel="noopener noreferrer">https://quqi.gblhgk.com/s/2902308/zDN2UFaJiJ9sL0Gt</a> （查阅码 ：YWWJkd）</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="博主备注">博主备注<a class="hash-link" href="#博主备注" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="iso-其他网盘下载链接">ISO 其他网盘下载链接<a class="hash-link" href="#iso-其他网盘下载链接" title="Direct link to heading">​</a></h3><ul><li>和彩云分享 链接: <a href="https://caiyun.139.com/m/i?175Cksk3bZ0PL" target="_blank" rel="noopener noreferrer">https://caiyun.139.com/m/i?175Cksk3bZ0PL</a>  提取码:72Cr  复制内容打开和彩云手机APP，操作更方便哦</li><li>阿里云盘 <a href="https://www.aliyundrive.com/s/N29hfJ2LQ62" target="_blank" rel="noopener noreferrer">https://www.aliyundrive.com/s/N29hfJ2LQ62</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="install-vmwarel-tools-灰色不可点击">Install VMwarel Tools 灰色不可点击<a class="hash-link" href="#install-vmwarel-tools-灰色不可点击" title="Direct link to heading">​</a></h3><p>安装完驱动, 重启虚拟机之后如果还是无法安装 Tools, 可以手动将虚拟机的 <strong>CD/DVD</strong> 指向 <strong>/Applications/VMware Fusion.app/Contents/Library/isoimages/windows.iso</strong>.</p><blockquote><p>参考 <a href="https://www.jingxialai.com/3809.html" target="_blank" rel="noopener noreferrer">解决mac VMware Fusion安装vmware tools灰色的教程</a></p></blockquote>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="vmware" term="vmware"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Dockerfile 常用指令介绍]]></title>
        <id>/2022/02/26/docker-dockerfile-intro</id>
        <link href="https://blog.alanwei.com/blog/2022/02/26/docker-dockerfile-intro"/>
        <updated>2022-02-26T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Dockerfile常用指令介绍]]></summary>
        <content type="html"><![CDATA[<p>常用<code>Dockerfile</code>文件指令介绍</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="arg">ARG<a class="hash-link" href="#arg" title="Direct link to heading">​</a></h2><ul><li><a href="https://docs.docker.com/engine/reference/builder/#arg" target="_blank" rel="noopener noreferrer">Dockerfile Reference - ARG</a></li><li><a href="https://www.geeksforgeeks.org/docker-arg-instruction/" target="_blank" rel="noopener noreferrer">Docker – ARG Instruction</a></li><li><a href="https://www.thegeekdiary.com/run-docker-as-a-non-root-user/" target="_blank" rel="noopener noreferrer">Run Docker as a non-root user</a></li></ul><p>Dockerfile中的<code>ARG</code>指令用于定义用户变量, 这些变量在用户构建镜像(<code>docker build</code>)的时候使用<code>--build-arg &lt;var_name&gt;=&lt;value&gt;</code>可以修改, 通过镜像创建容器的系统中, 是无法访问到这些变量的. 也就是说<code>ARG</code>定义的变量, 仅在构建阶段起作用. 如果使用<code>docker build --build-arg</code> 使用了在 <code>Dockerfile</code>中未定义的参数, 在构建的时候会输出警告.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="示例">示例<a class="hash-link" href="#示例" title="Direct link to heading">​</a></h3><p>下面是一个示例, 在构建镜像的时候可以修改镜像里的用户名: </p><div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Dockerfile</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM alanway/code-server:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 设置两个变量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ARG USER=editor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ARG USER_ID=1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 创建用户</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 创建 /app 目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. 修改 /app 目录所有者, 如果不修改, 创建的用户对 /app 目录没有读写权限</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN useradd --create-home --uid $USER_ID --user-group --shell /bin/bash $USER \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &amp;&amp; mkdir /app \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &amp;&amp; chown $USER:$USER /app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 设置镜像的当前用户</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USER $USER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR /app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 拷贝文件的默认所有者为root, 加上 --chown=$USER 修改文件所有者为上面新创建的用户</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --chown=$USER ./src ./</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>开始构建</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">build.sh</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> build --file Dockerfile --tag blog-editor --build-arg </span><span class="token assign-left variable environment constant" style="color:#36acaa">USER</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">alan ./</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-warning alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_S0QG"><p>不推荐在镜像构建阶段传递安全密钥信息(比如github keys, user credentials等). 构建阶段的变量对用户是可见的, 使用<code>docker history</code>命令即可看到构建时的变量.</p></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="dockerfile预置-arg">Dockerfile预置 ARG<a class="hash-link" href="#dockerfile预置-arg" title="Direct link to heading">​</a></h3><p>Docker提供了一批预先定义的<code>ARG</code>, 无需在Dockerfile中定义即可使用:</p><ul><li>HTTP_PROXY</li><li>http_proxy</li><li>HTTPS_PROXY</li><li>https_proxy</li><li>FTP_PROXY</li><li>ftp_proxy</li><li>NO_PROXY</li><li>no_proxy</li></ul><p>直接使用 <code>--build-arg</code> 标识即可使用: <code>docker build --build-arg HTTPS_PROXY=https://my-proxy.example.com .</code></p><p>默认情况下, 上面预置的指令在<code>docker history</code>命令中是不会输出的, 这样做是为了减少类似下面使用方式带来的安全风险:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> build --build-arg </span><span class="token assign-left variable" style="color:#36acaa">HTTP_PROXY</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">http://user:pass@proxy.lon.example.com ./</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上面的 <code>HTTP_PROXY</code> 参数值有敏感信息, 使用 <code>docker history</code> 是无法看到这个敏感信息的. 如果上述<code>ARG</code>在<code>docker history</code>中出现, 可以在Dockerfile中声明一次:</p><div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Dockerfile</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM ubuntu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ARG HTTP_PROXY</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="env">ENV<a class="hash-link" href="#env" title="Direct link to heading">​</a></h2><p><code>ENV</code>指令可以用来定义系统环境变量, 这些变量可以在创建容器(<code>docker run</code>)的时候使用<code>-e</code>参数修改环境变量. 这些环境变量在容器启动后仍然可以访问.</p><p><strong>格式如下</strong></p><div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ENV &lt;key&gt;=&lt;value&gt; ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="示例-1">示例<a class="hash-link" href="#示例-1" title="Direct link to heading">​</a></h3><div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Dockerfile</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM ubuntu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV TZ=Asia/Shanghai</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV MY_NAME="John Doe"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV MY_DOG=Rex\ The\ Dog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV MY_CAT=fluffy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以使用 <code>docker inspect</code> 查看环境变量的值, 在<code>docker run</code>创建容器的时候使用<code>--env</code> 修改环境变量的值:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -it --rm --env </span><span class="token assign-left variable" style="color:#36acaa">TZ</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">test_value -e </span><span class="token assign-left variable" style="color:#36acaa">MY_NAME</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"Alan Wei"</span><span class="token plain"> ubuntu </span><span class="token function" style="color:#d73a49">bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="docker" term="docker"/>
        <category label="dockerfile" term="dockerfile"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[解决IDEA使用低版本lombok没有get/set方法问题]]></title>
        <id>/2022/02/24/idea-lombok</id>
        <link href="https://blog.alanwei.com/blog/2022/02/24/idea-lombok"/>
        <updated>2022-02-24T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[依次打开IDEA设置:]]></summary>
        <content type="html"><![CDATA[<p>依次打开IDEA设置:</p><p><code>Settings &gt; Build, Execution, Deployment &gt; Compiler</code></p><p>然后在 <code>Shared build process VM options</code> 增加 <code>-Djps.track.ap.dependencies=false</code> 即可.</p><p>也可以针对项目设置. 原理就是使用增加JVM环境变量.</p><p>如果还未生效, 需要执行以下<code>mvn clean</code>命令清理 <em>target</em></p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="idea" term="idea"/>
        <category label="lombok" term="lombok"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Mock Retrofit http request]]></title>
        <id>/2022/02/23/retrofit-mock-server</id>
        <link href="https://blog.alanwei.com/blog/2022/02/23/retrofit-mock-server"/>
        <updated>2022-02-23T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[keywords:  mockwebserver retrofit]]></summary>
        <content type="html"><![CDATA[<p>keywords:  mockwebserver retrofit</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="java" term="java"/>
        <category label="retrofit" term="retrofit"/>
        <category label="spring boot" term="spring boot"/>
        <category label="mock" term="mock"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Flutter远程调试Android设备]]></title>
        <id>/2022/02/20/flutter-remote-debug-android-device</id>
        <link href="https://blog.alanwei.com/blog/2022/02/20/flutter-remote-debug-android-device"/>
        <updated>2022-02-20T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Flutter远程无线调试 zAndroid App:]]></summary>
        <content type="html"><![CDATA[<p>Flutter远程无线调试 zAndroid App:</p><ol><li>手机号电脑要在同一无线网络(SSID)</li><li>手机开启开发者模式(一般是连续点击Android版本号或者MIUI版本号), </li><li>进入开发者选项里, 开启 <strong>Wireless debugging</strong> 并进入</li><li>点击 <strong>Pair device with pairing code</strong>, 生成一个pair code, 然后电脑上执行 <code>adb pair [host]:[port] [pair code]</code> 连接设备.(<em>adb</em>命令位于 android sdk 的 <em>platform-tools</em> 文件夹)</li><li>继续执行 <code>adb connect [host]:[port]</code>, 这里的<em>host</em>和<em>port</em>是 <strong>Wireless debugging</strong> 设置里的 <strong>IP address &amp; Port</strong></li><li>然后执行 <code>flutter devices</code> 就可以看到连上 android 设备.</li></ol><blockquote><p>参考 <a href="https://docs.microsoft.com/en-us/xamarin/android/get-started/installation/set-up-device-for-development" target="_blank" rel="noopener noreferrer">Set Up Device for Development</a></p></blockquote>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="flutter" term="flutter"/>
        <category label="adb" term="adb"/>
        <category label="android" term="android"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Dart Visual Studio Code 推荐设置]]></title>
        <id>/2022/02/19/dart-visual-studio-code-settings</id>
        <link href="https://blog.alanwei.com/blog/2022/02/19/dart-visual-studio-code-settings"/>
        <updated>2022-02-19T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Dart Visual Studio Code 推荐设置]]></summary>
        <content type="html"><![CDATA[<p><a href="https://dartcode.org/docs/recommended-settings/" target="_blank" rel="noopener noreferrer">Dart Visual Studio Code 推荐设置</a></p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Causes the debug view to automatically appear when a breakpoint is hit. This</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// setting is global and not configurable per-language.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"debug.openDebug"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"openOnDebugBreak"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"[dart]"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Automatically format code on save and during typing of certain characters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// (like `;` and `}`).</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.formatOnSave"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.formatOnType"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Draw a guide line at 80 characters, where Dart's formatting will wrap code.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.rulers"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Disables built-in highlighting of words that match your selection. Without</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// this, all instances of the selected text will be highlighted, interfering</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// with Dart's ability to highlight only exact references to the selected variable.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.selectionHighlight"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// By default, VS Code prevents code completion from popping open when in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// "snippet mode" (editing placeholders in inserted code). Setting this option</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// to `false` stops that and allows completion to open as normal, as if you</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// weren't in a snippet placeholder.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.suggest.snippetsPreventQuickSuggestions"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// By default, VS Code will pre-select the most recently used item from code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// completion. This is usually not the most relevant item.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// "first" will always select top item</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// "recentlyUsedByPrefix" will filter the recently used items based on the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//     text immediately preceding where completion was invoked.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.suggestSelection"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"first"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Allows pressing &lt;TAB&gt; to complete snippets such as `for` even when the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// completion list is not visible.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.tabCompletion"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"onlySnippets"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// By default, VS Code will populate code completion with words found in the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// current file when a language service does not provide its own completions.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// This results in code completion suggesting words when editing comments and</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// strings. This setting will prevent that.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.wordBasedSuggestions"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="dart" term="dart"/>
        <category label="vsc" term="vsc"/>
        <category label="visual studio code" term="visual studio code"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[GitHub QA]]></title>
        <id>/2022/02/18/github-qa</id>
        <link href="https://blog.alanwei.com/blog/2022/02/18/github-qa"/>
        <updated>2022-02-18T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[GitHub 使用介绍]]></summary>
        <content type="html"><![CDATA[<p>GitHub 使用介绍</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="github-action">GitHub Action<a class="hash-link" href="#github-action" title="Direct link to heading">​</a></h2><ul><li><a href="http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html" target="_blank" rel="noopener noreferrer">阮一峰 - GitHub Actions 入门教程</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="获取分支名">获取分支名<a class="hash-link" href="#获取分支名" title="Direct link to heading">​</a></h3><p><a href="https://stackoverflow.com/questions/60300169/how-to-get-branch-name-on-github-action" target="_blank" rel="noopener noreferrer">via How to get branch name on GitHub action?</a></p><p>You can create a step output of the last part of <code>GITHUB_REF</code> like the following:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> push</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">example</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Set output</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> vars</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> echo </span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">set</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">output name=short_ref</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">GITHUB_REF</span><span class="token comment" style="color:#999988;font-style:italic">#refs/*/}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Check output</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> echo $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> steps.vars.outputs.short_ref </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 这个地方就可以拿到上一步骤 vars 创建的输出了</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="添加action徽章">添加Action徽章<a class="hash-link" href="#添加action徽章" title="Direct link to heading">​</a></h3><p><a href="https://docs.github.com/en/actions/monitoring-and-troubleshooting-workflows/adding-a-workflow-status-badge" target="_blank" rel="noopener noreferrer">via Adding a workflow status badge</a></p><p>徽章URL格式为: <code>https://github.com/&lt;OWNER&gt;/&lt;REPOSITORY&gt;/actions/workflows/&lt;WORKFLOW_FILE&gt;/badge.svg</code></p><p>假设工作流文件路径为 <code>.github/workflows/main.yml</code>, 仓库的 <code>OWNER</code> 为 <code>github</code> 组织, <code>REPOSITORY</code> 名称为 <code>docs</code>, 其徽章为 <code>https://github.com/github/docs/actions/workflows/main.yml/badge.svg</code></p><p>也可以加上分支名称: <code>https://github.com/github/docs/actions/workflows/main.yml/badge.svg?branch=feature-1</code></p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="github" term="github"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Windows 虚拟桌面快捷键]]></title>
        <id>/2022/02/18/windows-virtual-desktop</id>
        <link href="https://blog.alanwei.com/blog/2022/02/18/windows-virtual-desktop"/>
        <updated>2022-02-18T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Windows 虚拟桌面快捷键列表:]]></summary>
        <content type="html"><![CDATA[<p>Windows 虚拟桌面快捷键列表:</p><ul><li><strong>Win + Tab</strong>: 打开「任务视图」，相当于点击「可视化入口」。</li><li><strong>Win + Ctrl + D</strong>: 创建新的虚拟桌面。</li><li><strong>Win + Ctrl + F4</strong>: 删除当前虚拟桌面。</li><li><strong>Win + Ctrl + 左键</strong>: 切换到相邻左侧的虚拟桌面。</li><li><strong>Win + Ctrl + 右键</strong>: 切换到相邻右侧的虚拟桌面。</li></ul>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="windows" term="windows"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[解决Ubuntu使用dpkg安装deb软件包提示缺少依赖问题]]></title>
        <id>/2022/02/16/ubuntu-dpkg-install-dependency</id>
        <link href="https://blog.alanwei.com/blog/2022/02/16/ubuntu-dpkg-install-dependency"/>
        <updated>2022-02-16T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[解决Ubuntu使用dpkg安装deb软件包提示缺少依赖问题]]></summary>
        <content type="html"><![CDATA[<p>如果你使用 <code>dpkg -i xxx.deb</code> 提示类似以下信息:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dpkg: dependency problems prevent configuration of nautilus-nutstore-public:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> nautilus-nutstore-public depends on gir1.2-appindicator3-0.1 (&gt;= 0.4.1); however:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Package gir1.2-appindicator3-0.1 is not installed.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以执行 <code>sudo apt-get -f install</code> 安装缺失的依赖.</p><p>或者直接使用 <code>dpkg -f xxxx.deb</code> 安装deb包, <code>-f</code>参数会自动安装依赖.</p><blockquote><p>参考</p><ul><li><a href="https://fedingo.com/how-to-install-dpkg-dependencies-automatically/" target="_blank" rel="noopener noreferrer">How to Install Dpkg dependencies automatically</a></li><li><a href="https://fedingo.com/how-to-install-dependencies-with-apt" target="_blank" rel="noopener noreferrer">How to Install Dependencies with Apt</a></li><li><a href="https://linuxhint.com/install-dpkg-dependencies-automatically/" target="_blank" rel="noopener noreferrer">How to let dpkg Install Dependencies Automatically</a></li></ul></blockquote>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="linux" term="linux"/>
        <category label="ubuntu" term="ubuntu"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[蒲公英 X1 简介]]></title>
        <id>/2022/02/14/oray-box-intro</id>
        <link href="https://blog.alanwei.com/blog/2022/02/14/oray-box-intro"/>
        <updated>2022-02-14T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[记录几个网址，方便以后忘记。]]></summary>
        <content type="html"><![CDATA[<p>记录几个网址，方便以后忘记。</p><p>盒子使用网线联网之后, 使用浏览器访问 <a href="https://pgybox.oray.com" target="_blank" rel="noopener noreferrer">https://pgybox.oray.com</a>(参考 <a href="https://service.oray.com/question/12146.html?icn=help_x1-serial&amp;ici=guide_box-x1-serial" target="_blank" rel="noopener noreferrer">蒲公英X1 - 远程访问串口设备指南</a>), 选择 <em>SN码登陆</em> (默认密码是<em>admin</em>, SN在设备上查找)</p><p><img loading="lazy" src="https://upload-cdn.orayimg.com/upload/help/2101/202101251530529541.png" alt="oray login" class="img_ev3q"></p><p>登陆完成之后, 进到后台绑定自己的蒲公英账号. 后续就可以在<a href="https://console.sdwan.oray.com/smartNetwork?networkid=1550585" target="_blank" rel="noopener noreferrer">蒲公英网络管理平台</a>查看组网信息了.</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="oray" term="oray"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[容器内访问物理网络]]></title>
        <id>/2022/02/12/docker-connect-host</id>
        <link href="https://blog.alanwei.com/blog/2022/02/12/docker-connect-host"/>
        <updated>2022-02-12T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[概述]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="概述">概述<a class="hash-link" href="#概述" title="Direct link to heading">​</a></h2><p>如果安装的是最新版的 Docker, 在容器内部直接使用 <code>host.docker.internal</code> 即可访问主机网络, 比如在容器执行 <code>curl http://host.docker.internal:8080</code> 即可访问主机的<em>8080</em>端口. (对于Linux环境, 创建容器时需要增加<code>--add-host=host.docker.internal:host-gateway</code>参数)</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-to-access-host-port-from-docker-container">How to access host port from docker container<a class="hash-link" href="#how-to-access-host-port-from-docker-container" title="Direct link to heading">​</a></h2><p>参考: <a href="https://stackoverflow.com/questions/31324981/how-to-access-host-port-from-docker-container" target="_blank" rel="noopener noreferrer">How to access host port from docker container</a></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="linux">Linux<a class="hash-link" href="#linux" title="Direct link to heading">​</a></h3><p>Docker v20.10及以上版本</p><p>在Linux环境，执行docker命令时，增加<code>--add-host=host.docker.internal:host-gateway</code>参数开启此特性(Docker Compose 配置如下)，然后就可以在容器内部使 <code>host.docker.internal</code> 访问主机网络(可使用 <code>cat /etc/hosts</code> 查看此参数增加的DNS解析记录)。</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">等价的Docker Compose配置</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">extra_hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"host.docker.internal:host-gateway"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="macos-和-windows">macOS 和 Windows<a class="hash-link" href="#macos-和-windows" title="Direct link to heading">​</a></h3><p>Docker v18.03及以上版本</p><p>直接使用 <code>host.docker.internal</code> 即可访问主机网络。(该DNS Name，Linux默认尚不支持，进度参考 <a href="https://github.com/docker/for-linux/issues/264" target="_blank" rel="noopener noreferrer">https://github.com/docker/for-linux/issues/264</a> )</p><p>macOS低版本尝试使用 <code>docker.for.mac.host.internal</code> 或者 <code>docker.for.mac.localhost</code>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="i-want-to-connect-from-a-container-to-a-service-on-the-host">I want to connect from a container to a service on the host<a class="hash-link" href="#i-want-to-connect-from-a-container-to-a-service-on-the-host" title="Direct link to heading">​</a></h2><p>翻译自 <a href="https://docs.docker.com/desktop/mac/networking/" target="_blank" rel="noopener noreferrer">I want to connect from a container to a service on the host</a></p><p>主机(host)的IP是动态的(或者没有网络访问). 我们建议你(容器内)访问特定的DNS名称: <code>host.docker.internal</code>, 这个DNS名会被解析成主机(host)IP地址. 这是为了方便开发, 所以在非Mac版Docker的生产环境不可用.</p><p>你也可以在容器内部使用DNS名<code>gateway.docker.internal</code>访问网关(gateway)</p><p>假如你的物理机器安装了python, 使用下面的指令作为例子, 在容器里访问主机(host)服务.</p><ol><li>在主机(host)上使用<code>python -m http.server 8000</code>创建一个监听<em>8000</em>端口的web服务</li><li>执行以下命令创建一个容器, 并借助<code>curl</code>命令访问第一步在主机创建的web服务:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run --rm -it alpine </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apk </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://host.docker.internal:8000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>如果容器内部无法访问 <code>curl http://host.docker.internal:8000</code>, 有可能是防火墙限制了8000端口的访问, 对于支持<code>ufw</code>命令的Linux系统, 可以在主机(host machine)使用命令 <code>ufw allow 8000</code> 开放 <em>8000</em> 端口的访问, <code>ufw</code>命令参考<a href="https://bobcares.com/blog/ufw-allow-port-range/" target="_blank" rel="noopener noreferrer">UFW allow port range – How we do it?</a>.</p></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="docker" term="docker"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[安装或卸载 Docker]]></title>
        <id>/2022/02/12/install-docker</id>
        <link href="https://blog.alanwei.com/blog/2022/02/12/install-docker"/>
        <updated>2022-02-12T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[安装或者卸载Docker.]]></summary>
        <content type="html"><![CDATA[<p>安装或者卸载Docker.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="centos-安装">CentOS 安装<a class="hash-link" href="#centos-安装" title="Direct link to heading">​</a></h2><blockquote><p>参考:
<a href="https://linoxide.com/upgrade-docker-fedora-centos/" target="_blank" rel="noopener noreferrer">How to Upgrade Docker on CentOS</a></p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 如果系统上已经安装, 先卸载 Docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># yum remove docker docker-common docker-selinux docker-engine</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Install required packages</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -y yum-utils device-mapper-persistent-data lvm2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Use the following command to set up the stable repository </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo </span><span class="token comment" style="color:#999988;font-style:italic"># 增加仓库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Install the latest version of Docker CE and containerd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> docker-ce docker-ce-cli containerd.io -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ubuntu-安装">Ubuntu 安装<a class="hash-link" href="#ubuntu-安装" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 如果你过去安装过 docker，先删掉</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># apt-get remove docker docker-engine docker.io</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Update the apt package index</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Install packages to allow apt to use a repository over HTTPS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> apt-transport-https ca-certificates </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> gnupg-agent software-properties-common -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Add Docker’s official GPG key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -fsSL https://download.docker.com/linux/ubuntu/gpg </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> apt-key </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apt-key fingerprint 0EBFCD88</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Set up the stable repository</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add-apt-repository </span><span class="token string" style="color:#e3116c">"deb [arch=amd64] https://download.docker.com/linux/ubuntu </span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable" style="color:#36acaa">lsb_release -cs</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c"> stable"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># install</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> docker-ce docker-ce-cli containerd.io -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="清华大学开源镜像">清华大学开源镜像<a class="hash-link" href="#清华大学开源镜像" title="Direct link to heading">​</a></h2><blockquote><p>参考 <a href="https://mirrors.tuna.tsinghua.edu.cn/help/docker-ce/" target="_blank" rel="noopener noreferrer">Docker Community Edition 镜像使用帮助</a></p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="centos">CentOS<a class="hash-link" href="#centos" title="Direct link to heading">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 如果你之前安装过 docker，请先删掉</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum remove </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> docker-common docker-selinux docker-engine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 安装依赖</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -y yum-utils device-mapper-persistent-data lvm2 </span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 下载repo文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> -O /etc/yum.repos.d/docker-ce.repo https://download.docker.com/linux/centos/docker-ce.repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 把软件仓库地址替换为 TUNA:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -i </span><span class="token string" style="color:#e3116c">'s+download.docker.com+mirrors.tuna.tsinghua.edu.cn/docker-ce+'</span><span class="token plain"> /etc/yum.repos.d/docker-ce.repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 安装</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum makecache fast</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> docker-ce</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ubuntu">Ubuntu<a class="hash-link" href="#ubuntu" title="Direct link to heading">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 如果你过去安装过 docker，先删掉</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># apt-get remove docker docker-engine docker.io</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 安装依赖</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> apt-transport-https ca-certificates </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> gnupg2 software-properties-common</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 信任 Docker 的 GPG 公钥:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -fsSL https://download.docker.com/linux/ubuntu/gpg </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> apt-key </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 对于 amd64 架构的计算机，添加软件仓库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add-apt-repository </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token string" style="color:#e3116c">"deb [arch=amd64] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/ubuntu \</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">   </span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable" style="color:#36acaa">lsb_release -cs</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">   stable"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 如果你是树莓派或其它 ARM 架构计算机，请运行:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"deb [arch=armhf] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/ubuntu \</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">     </span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable" style="color:#36acaa">lsb_release -cs</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c"> stable"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tee</span><span class="token plain"> /etc/apt/sources.list.d/docker.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 安装</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> docker-ce</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="docker" term="docker"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Linux启动自动执行特定脚本]]></title>
        <id>/2022/02/12/linux-startup-script-crontab</id>
        <link href="https://blog.alanwei.com/blog/2022/02/12/linux-startup-script-crontab"/>
        <updated>2022-02-12T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[利用linux的crontab服务设置启动脚本]]></summary>
        <content type="html"><![CDATA[<p>参考 <a href="https://phoenixnap.com/kb/crontab-reboot" target="_blank" rel="noopener noreferrer">Crontab Reboot: How to Execute a Job Automatically at Boot</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cronservice">cron.service<a class="hash-link" href="#cronservice" title="Direct link to heading">​</a></h2><p>先确认 <code>cron.service</code> 服务是否已经启用:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl status cron.service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果没有启用, 执行 <code>systemctl enable cron.service</code> 启动该服务.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="增加启动脚本">增加启动脚本<a class="hash-link" href="#增加启动脚本" title="Direct link to heading">​</a></h2><p>执行 <code>crontab -e</code> 开始编辑启动启动任务, 语法如下:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@reboot [path to command] [argument1] [argument2] … [argument n]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@reboot [part to shell script]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>示例:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 启动日期保存到用户目录下的 date.txt 文件中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@reboot date &gt;&gt; ~/date.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 系统系统后执行特定shell脚本文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@reboot /root/backup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 系统启动后延迟5分钟执行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@reboot sleep 300 &amp;&amp; date &gt;&gt; ~/date.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="cron" term="cron"/>
        <category label="linux" term="linux"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Ubuntu 20.04 安装使用 SQLite]]></title>
        <id>/2022/02/6/ubuntu-sqlite3-starter</id>
        <link href="https://blog.alanwei.com/blog/2022/02/6/ubuntu-sqlite3-starter"/>
        <updated>2022-02-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[原文 How To Install and Use SQLite on Ubuntu 20.04]]></summary>
        <content type="html"><![CDATA[<p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-sqlite-on-ubuntu-20-04" target="_blank" rel="noopener noreferrer">原文 How To Install and Use SQLite on Ubuntu 20.04</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-1-安装">Step 1 安装<a class="hash-link" href="#step-1-安装" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> sqlite3 -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sqlite3 --version</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-2-创建数据库">Step 2 创建数据库<a class="hash-link" href="#step-2-创建数据库" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sqlite3 sharks.db</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上面命令会创建一个名为 <code>sharks</code> 的数据库, 如果文件<em>sharks.db</em>已经存在, 则是打开数据库文件.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="常用命令">常用命令<a class="hash-link" href="#常用命令" title="Direct link to heading">​</a></h2><p>进入 <code>sqlite&gt; </code> 模式之后:</p><ul><li><code>.help</code> 查看帮助信息</li><li><code>.databases</code> 显示数据库信息</li><li><code>.tables</code> 显示当前数据库所有的表名</li></ul>]]></content>
        <author>
            <name>author</name>
        </author>
        <category label="sqlite3" term="sqlite3"/>
        <category label="linux" term="linux"/>
        <category label="ubuntu" term="ubuntu"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Flutter JSON 序列化]]></title>
        <id>/2022/01/25/flutter-json-seriealize</id>
        <link href="https://blog.alanwei.com/blog/2022/01/25/flutter-json-seriealize"/>
        <updated>2022-01-25T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[flutter JSON 序列化和反序列化]]></summary>
        <content type="html"><![CDATA[<p><a href="https://flutter.cn/docs/development/data-and-backend/json" target="_blank" rel="noopener noreferrer">原文 - JSON 和序列化数据</a></p><p>因为Flutter中的dart不支持反射，所以没有类似 GSON/Jackson/Netonsoft.Net 那种类库，不支持反射的原因是为了支持 tree shake，减少App体积。</p><p>下面介绍如果使用<code>json_serializable</code>序列化:</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装依赖">安装依赖<a class="hash-link" href="#安装依赖" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">flutter pub </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> json_annotation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flutter pub </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> build_runner --dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flutter pub </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> json_model --dev </span><span class="token comment" style="color:#999988;font-style:italic"># 用于从JSON文件生成dart类</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flutter pub </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> json_serializable --dev</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="方式1-json文件生成实体类">方式1 JSON文件生成实体类<a class="hash-link" href="#方式1-json文件生成实体类" title="Direct link to heading">​</a></h2><p><a href="https://github.com/flutterchina/json_model" target="_blank" rel="noopener noreferrer">json_model</a></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用步骤">使用步骤<a class="hash-link" href="#使用步骤" title="Direct link to heading">​</a></h3><p>根据JSON文件自动创建实体类</p><ol><li>项目根目录创建 <em>jsons</em> 文件夹</li><li>创建JSON文件(文件内容示例参考下面)</li><li>执行命令生成 model: <code>flutter pub run json_model src=jsons</code></li></ol><div class="language-user.json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">jsons/user.json</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-user.json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "name":"wendux",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "father":"$user", //可以通过"$"符号引用其它model类, 这个是引用User类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "friends":"$[]user", // 可以通过"$[]"来引用数组</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "keywords":"$[]String", // 同上</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "age?": 20,  // 年龄，可能为null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "license?": { // 该项目的开源许可证</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "key": "mit",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "name": "MIT License",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "spdx_id": "MIT",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "url": "https://api.github.com/licenses/mit",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "node_id": "MDc6TGljZW5zZW1pdA=="</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="json文件特性">JSON文件特性<a class="hash-link" href="#json文件特性" title="Direct link to heading">​</a></h3><ul><li>可以通过 <strong>$</strong> 符号引用其他model类, 比如引用 <code>User</code>类: <code>"father": "$user"</code></li><li>可以通过 <strong>$[]</strong> 引用输入, 比如 <code>"array": "$[]User"</code> 或者 <code>"friends": "$[]String"</code></li><li>可为空字段: <code>"age?": 20</code></li><li>使用 <a href="https://pub.dev/packages/json_annotation" target="_blank" rel="noopener noreferrer">json_annotation</a>中的所有注解, 比如:</li></ul><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"@JsonKey(name: '+1') int?"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"loved"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//将“+1”映射为“loved”</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"name"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"wendux"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"age?"</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>可以在JSON文件增加 <code>@meta</code> 信息定制dart类生成规则:</li></ul><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"@meta"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"import"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 生成的Dart文件中需要额外import的文件，可以有多个</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"test_dir/profile.dart"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"comments"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Json文件中相应字段的注释</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"name"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"名字"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"nullable"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 是否生成的model字段都是可空的，如果为false，则字段为late</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"ignore"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// json-&gt;dart时是否跳过当前文件，默认为false，设为true时，生成时则会跳过本json文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"name"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"wendux"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"age?"</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>在实际ubuntu环境, 发现文件夹名必须是 <code>Jsons</code>. 自己根据实际情况调整.</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="方式2-手动编写实体类属性">方式2 手动编写实体类属性<a class="hash-link" href="#方式2-手动编写实体类属性" title="Direct link to heading">​</a></h2><p>手动编写实体类, 然后自动生成 <code>fromJson</code> 和 <code>toJson</code> 方法.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="编写实体类">编写实体类<a class="hash-link" href="#编写实体类" title="Direct link to heading">​</a></h3><div class="language-dart codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">user.dart</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dart codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import 'package:json_annotation/json_annotation.dart';</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// This allows the `User` class to access private members in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// the generated file. The value for this is *.g.dart, where</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// the star denotes the source file name.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">part 'user.g.dart';</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// An annotation for the code generator to know that this class needs the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// JSON serialization logic to be generated.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@JsonSerializable()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class User {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  User(this.name, this.email, this.age);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  String name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  String email;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @JsonKey(defaultValue: 18)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int age;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /// A necessary factory constructor for creating a new User instance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /// from a map. Pass the map to the generated `_$UserFromJson()` constructor.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /// The constructor is named after the source class, in this case, User.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  factory User.fromJson(Map&lt;String, dynamic&gt; json) =&gt; _$UserFromJson(json);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /// `toJson` is the convention for a class to declare support for serialization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /// to JSON. The implementation simply calls the private, generated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /// helper method `_$UserToJson`.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Map&lt;String, dynamic&gt; toJson() =&gt; _$UserToJson(this);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>如果有嵌套类，比如 <code>User.dart</code> 有个字段 <code>final Address address;</code>，这个<code>Address</code>是个类，那就需要把 <code>User</code> 类的注解 <code>@JsonSerializable()</code> 改成 <code>@JsonSerializable(explicitToJson: true)</code>.</p></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="执行命令生成">执行命令生成<a class="hash-link" href="#执行命令生成" title="Direct link to heading">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">flutter pub run build_runner build </span><span class="token comment" style="color:#999988;font-style:italic"># 执行该命令生成缺失的方法</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flutter pub run build_runner </span><span class="token function" style="color:#d73a49">watch</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 或者执行该命令监听文件变化自动生成</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="flutter" term="flutter"/>
        <category label="android" term="android"/>
        <category label="ios" term="ios"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[解决SSH no matching host key type found 问题]]></title>
        <id>/2022/01/24/ssh-no-matching-host-key-type-found</id>
        <link href="https://blog.alanwei.com/blog/2022/01/24/ssh-no-matching-host-key-type-found"/>
        <updated>2022-01-24T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[解决通过git协议克隆仓库到本地, 或者SSH远程机器时返回的 no matching host key type found]]></summary>
        <content type="html"><![CDATA[<p><a href="https://ttys3.dev/post/openssh-8-8-p1-no-matching-host-key-type-found-their-offer-ssh-rsa/" target="_blank" rel="noopener noreferrer">原文 Solution to openssh-8.8-p1 update: no matching host key type found. Their offer: ssh-rsa</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="解决办法">解决办法<a class="hash-link" href="#解决办法" title="Direct link to heading">​</a></h2><p>如果最近升级到了 <strong>openssh 8.8-p1</strong> 版, 你会发现连接某些之前连接得好好的服务器突然无法连接: </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Unable to negotiate with x.x.x.x port 2222: no matching host key type found. Their offer: ssh-rsa</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者仓库无法clone:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&gt; git clone git@github.com:user/repository.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Cloning into 'xxxx'...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Unable to negotiate with x.x.x.x port 22: no matching host key type found. Their offer: ssh-rsa,ssh-dss</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fatal: Could not read from remote repository.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Please make sure you have the correct access rights</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>解决办法是<code>ssh</code>命令指定算法:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa  user@host -p 2222</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上面比较麻烦, 可以修改ssh配置文件 <em>~/.ssh/config</em>, 对于无法成功连接的host, 增加配置项:</p><div class="language-config codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">~/.ssh/config</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-config codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HostKeyAlgorithms +ssh-rsa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PubkeyAcceptedKeyTypes +ssh-rsa</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>完整配置如下:</p><div class="language-config codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">~/.ssh/config</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-config codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Host ssh.alanwei.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HostName ssh.alanwei.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  User alan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Port 22</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HostKeyAlgorithms +ssh-rsa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PubkeyAcceptedKeyTypes +ssh-rsa</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>完整配置里的 <code>HostName</code>, <code>User</code>, <code>Port</code> 可以省略</p></div></div><p>或者对所有<code>Host</code>指定:</p><div class="language-config codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">~/.ssh/config</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-config codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Host *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ServerAliveInterval 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HostKeyAlgorithms +ssh-rsa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PubkeyAcceptedKeyTypes +ssh-rsa</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="为什么会有这个错误">为什么会有这个错误<a class="hash-link" href="#为什么会有这个错误" title="Direct link to heading">​</a></h2><p>根据 OpenSSH Release Notes:</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>Future deprecation notice
It is now possible<!-- -->[1]<!-- --> to perform chosen-prefix attacks against the SHA-1 algorithm for less than USD$50K.</p><p>In the SSH protocol, the “ssh-rsa” signature scheme uses the SHA-1 hash algorithm in conjunction with the RSA public key algorithm. OpenSSH will disable this signature scheme by default in the near future.</p><p>Note that the deactivation of “ssh-rsa” signatures does not necessarily require cessation of use for RSA keys. In the SSH protocol, keys may be capable of signing using multiple algorithms. In particular, “ssh-rsa” keys are capable of signing using “rsa-sha2-256” (RSA/SHA256), “rsa-sha2-512” (RSA/SHA512) and “ssh-rsa” (RSA/SHA1). Only the last of these is being turned off by default.</p></div></div><p>也就是说 8.8p1 版的 openssh 的 ssh 客户端默认禁用了 <code>ssh-rsa</code> 算法, 但是对方服务器只支持 <code>ssh-rsa</code>, 当你不能自己升级远程服务器的 openssh 版本或修改配置让它使用更安全的算法时, 在本地 ssh 针对这些旧的ssh server重新启用 <code>ssh-rsa</code> 也是一种权宜之法.</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="ssh" term="ssh"/>
        <category label="git" term="git"/>
        <category label="openssh" term="openssh"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[解决 Ubuntu/Debian SSH 连接时返回的 Connection refused]]></title>
        <id>/2022/01/15/ubuntu-ssh-connection-refused</id>
        <link href="https://blog.alanwei.com/blog/2022/01/15/ubuntu-ssh-connection-refused"/>
        <updated>2022-01-15T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[解决 Ubuntu/Debian SSH 连接时返回的 Connection refused]]></summary>
        <content type="html"><![CDATA[<p><a href="https://linuxhint.com/fix_connection_refused_ubuntu/#:~:text=One%20of%20the%20reasons%20you%20may%20receive%20a,which%20you%20are%20trying%20to%20access%20via%20SSH." target="_blank" rel="noopener noreferrer">原文 How to fix: Connection refused by port 22 Debian/Ubuntu</a></p><p>一般出现这种情况是因为系统没有安装<strong>openssh-server</strong>, 或者没有启用<strong>ssh</strong> 服务</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="检查依赖">检查依赖<a class="hash-link" href="#检查依赖" title="Direct link to heading">​</a></h2><p>执行以下脚本确定是否安装了 <strong>openssh-server</strong>: </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt list --installed | grep openssh-server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果没有安装, 执行以下脚本安装:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install openssh-server -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="检查服务">检查服务<a class="hash-link" href="#检查服务" title="Direct link to heading">​</a></h2><p>执行以下脚本检查<strong>ssh</strong>服务当前状态:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo service ssh status</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果不是 <em>Active: active(running)</em>, 执行以下脚本尝试启用服务:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo service ssh start</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="linux" term="linux"/>
        <category label="ssh" term="ssh"/>
        <category label="ubuntu" term="ubuntu"/>
        <category label="debian" term="debian"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[VSC常用代码片段]]></title>
        <id>/2022/01/10/visual-studio-code-snippets</id>
        <link href="https://blog.alanwei.com/blog/2022/01/10/visual-studio-code-snippets"/>
        <updated>2022-01-10T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Visual Studio Code 常用代码片段]]></summary>
        <content type="html"><![CDATA[<p>Visual Studio Code 常用代码片段收集:</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="react">React<a class="hash-link" href="#react" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="typescript-class-component">TypeScript Class Component<a class="hash-link" href="#typescript-class-component" title="Direct link to heading">​</a></h3><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">.vscode/react-ts-class-component.code-snippets</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"React TypeScript Class Component"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"prefix"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"react-ts-class-component"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"scope"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"tsx"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"body"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" import React from \"react\"; "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" /** "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  *  "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  * @date $CURRENT_YEAR-$CURRENT_MONTH-$CURRENT_DATE "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  */ "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" export class ${TM_FILENAME_BASE} extends React.Component&lt;${TM_FILENAME_BASE}Props, ${TM_FILENAME_BASE}State&gt; { "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"   constructor(props: ${TM_FILENAME_BASE}Props) { "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"     super(props); "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"     this.state = {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"     // 初始化状态"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"     };"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"   } "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"   render() {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"     return (&lt;div&gt;${1}&lt;/div&gt;)"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"   } "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" } "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" export type ${TM_FILENAME_BASE}Props = { }"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" export type ${TM_FILENAME_BASE}State = { }"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"description"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"create react typescript class component"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="typescript-function-component">TypeScript Function Component<a class="hash-link" href="#typescript-function-component" title="Direct link to heading">​</a></h3><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">.vscode/react-ts-fn-component.code-snippets</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"React TypeScript Function Component"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"prefix"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"react-ts-fn-component"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"body"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" import { FC, ReactElement, ReactChild } from \"react\"; "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" /** "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  *  "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  * @date $CURRENT_YEAR-$CURRENT_MONTH-$CURRENT_DATE "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  */ "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" const ${TM_FILENAME_BASE} : FC&lt;${TM_FILENAME_BASE}Props&gt; = (props): ReactElement =&gt; { "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"   return (&lt;div&gt;{props.children}&lt;/div&gt;)"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" } "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" export type ${TM_FILENAME_BASE}Props = { children: ReactChild }"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" export default ${TM_FILENAME_BASE};"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"description"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"create react typescript class component"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="typescript">TypeScript<a class="hash-link" href="#typescript" title="Direct link to heading">​</a></h2><p><strong>创建 TypeScript 函数</strong></p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">.vscode/ts-function.code-snippets</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"TS Function"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"prefix"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ts-function"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"scope"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"typescript"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"body"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"export type ${TM_FILENAME_BASE/^(\\w)(.*)/${1:/upcase}${2}/}Params = {}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"export interface ${TM_FILENAME_BASE/^(\\w)(.*)/${1:/upcase}${2}/}Result { }"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"/**"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" * "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" * @author ${1:创建人} "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" * @date $CURRENT_YEAR-$CURRENT_MONTH-$CURRENT_DATE"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" */"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"export function ${TM_FILENAME_BASE}(params: ${TM_FILENAME_BASE/^(\\w)(.*)/${1:/upcase}${2}/}Params): ${TM_FILENAME_BASE/^(\\w)(.*)/${1:/upcase}${2}/}Result {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"description"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"创建 TypeScript 函数"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">.vscode/ts-fn-override.code-snippets</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"TS Function Override"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"prefix"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ts-fn-override"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"scope"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"typescript"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"body"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"export type ${TM_FILENAME_BASE/^(\\w)(.*)/${1:/upcase}${2}/}Params = { }"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"export type ${TM_FILENAME_BASE/^(\\w)(.*)/${1:/upcase}${2}/}Result = { }"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"export type ${TM_FILENAME_BASE/^(\\w)(.*)/${1:/upcase}${2}/}Def = {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  (params: ${TM_FILENAME_BASE/^(\\w)(.*)/${1:/upcase}${2}/}Params): ${TM_FILENAME_BASE/^(\\w)(.*)/${1:/upcase}${2}/}Result"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  __cache?: ${TM_FILENAME_BASE/^(\\w)(.*)/${1:/upcase}${2}/}Result"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"/**"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" * "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" * @author ${1:创建人} "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" * @date $CURRENT_YEAR-$CURRENT_MONTH-$CURRENT_DATE"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" */"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"export const ${TM_FILENAME_BASE}: ${TM_FILENAME_BASE/^(\\w)(.*)/${1:/upcase}${2}/}Def = function(params: ${TM_FILENAME_BASE/^(\\w)(.*)/${1:/upcase}${2}/}Params): ${TM_FILENAME_BASE/^(\\w)(.*)/${1:/upcase}${2}/}Result {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"description"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"创建 TypeScript 函数"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="vue">Vue<a class="hash-link" href="#vue" title="Direct link to heading">​</a></h2><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">.vscode/ts-vue-component.code-snippets</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"Vue TypeScript Component"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"prefix"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"vue-typescript-component"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"scope"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"vue"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"body"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"&lt;template&gt;"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  &lt;div&gt; "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  &lt;/div&gt; "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"&lt;/template&gt; "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"&lt;script lang=\"ts\"&gt; "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"/** "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" * @author ${1:创建人} "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" * @date $CURRENT_YEAR-$CURRENT_MONTH-$CURRENT_DATE"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" * @see https://www.digitalocean.com/community/tutorials/vuejs-typescript-class-components "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" * @see https://github.com/ktsn/vuex-class "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" * @see https://github.com/vuejs/vue-class-component "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" * @see https://github.com/kaorun343/vue-property-decorator "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" */ "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"import { Component, Prop, Vue, Watch, Mixins } from \"vue-property-decorator\"; "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"// import ChildComponent from \"./ChildComponent.vue\"; "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"// const MixSample = Vue.extend(mixObject()); "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"@Component({ "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  // mixins: [MixSample], "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  // components: { ChildComponent }, "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"}) "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"export default class ${TM_FILENAME_BASE} extends Mixins() { "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  name: string = ${TM_FILENAME_BASE}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  /** "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"   * 定义属性 "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"   */ "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  @Prop({ required: false }) "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  propName1?: string; "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  @Prop({ required: true }) "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  propName2: string; "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  /** "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"   * 定义数据 "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"   */ "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  status: { "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"    showCity: boolean; "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  } = { "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"    showCity: false, "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  }; "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  data: { "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"    title: string; "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  } = { "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"    title: \"example\", "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  }; "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  created() { "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"    /** "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"     * 时机早于 mounted "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"     */ "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  } "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  mounted() { "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"    /** "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"     * mounted "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"     */ "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  } "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  /** "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"   * 定义方法 "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"   */ "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  methodName() { "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"    /** "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"     * 方法 "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"     */ "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  } "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  /** "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"   * 计算属性 "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"   */ "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  get computedField() { "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"    return this.propName1; "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  } "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  /** "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"   * Watch监视变化 "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"   */ "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  @Watch(`status.showCity`, { "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"    immediate: true, "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"    deep: false, "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  }) "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  onPropertyWatch(newVal: boolean) { "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"    console.log(`newVal: `, newVal); "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  } "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"} "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"&lt;/script&gt; "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"description"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"创建 TypeScript 类型组件"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="jest">jest<a class="hash-link" href="#jest" title="Direct link to heading">​</a></h2><p>创建普通的 jest node.js 单元测试</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">.vscode/jest-node-test.code-snippets</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"jest test"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"prefix"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"jest-node-test"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"body"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">" import { ${TM_FILENAME_BASE/^(\\w+).test/${1}/} } from \"../${TM_FILENAME_BASE/^(\\w+).test/${1}/}\";"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"describe(\"${TM_FILENAME_BASE}\", () =&gt; {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"    beforeEach(() =&gt; {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"    });"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"    afterEach(() =&gt; {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"    });"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"    test(\"${1}\", () =&gt; {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"    });"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"});"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"description"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"创建 jest 单测"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>创建涉及DOM的单元测试</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">.vscode/jest-dom-test.code-snippets</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"jest test"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"prefix"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"jest-dom-test"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"body"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"/**"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">" * @jest-environment jsdom"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">" */"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">" import { ${TM_FILENAME_BASE/^(\\w+).test/${1}/} } from \"../${TM_FILENAME_BASE/^(\\w+).test/${1}/}\";"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"describe(\"${TM_FILENAME_BASE}\", () =&gt; {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"    let ua: jest.SpyInstance&lt;string, []&gt;;"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"    beforeEach(() =&gt; {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"        ua = jest.spyOn(global.navigator, \"userAgent\", \"get\");"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"    });"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"    afterEach(() =&gt; {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"        ua.mockRestore();"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"    });"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"    test(\"测试内容\", () =&gt; {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"        ua.mockReturnValue(``);"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"    });"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"});"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"description"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"创建 jest-dom 单测"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="yargs">yargs<a class="hash-link" href="#yargs" title="Direct link to heading">​</a></h2><p>安装依赖:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> i yargs@16.2.0 --save</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>创建入口文件：</p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">bin/cli.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hashbang comment" style="color:#999988;font-style:italic">#!/usr/bin/env node</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> yargs </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"yargs"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> ext </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> __filename</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">__filename</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"js"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yargs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">commandDir</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"command-files-directory"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  recurse</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  extensions</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ext</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">demandCommand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">version</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"version"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"显示版本号"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"0.0.1"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">help</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"help"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"显示帮助"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">argv</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>创建命令模板:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">.vscode/yargs-command.code-snippets</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"yargs command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"prefix"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"yargs-command"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"scope"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"typescript"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"body"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" import { Options } from 'yargs'; "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" export const command = '${TM_FILENAME_BASE} [${1:input}]'; "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" export const desc = '命令说明'; "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" type OptionType = { "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"   ${1:input}: string, "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"   files?: Array&lt;string&gt; "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" } "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" export const builder: { [key in keyof OptionType]: Options } = { "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"   ${1:input}: { "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"     requiresArg: true, "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"     description: '参数描述', "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"     type: 'string' "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"   }, "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"   files: { "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"     requiresArg: false, "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"     description: '支持多个参数值', "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"     default: false, "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"     type: 'array', "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"     alias: 'f' "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"   } "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" }; "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" export const handler = function ({ ${1:input}, files }: OptionType) { "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" }"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"description"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"创建 yargs 命令"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="flutter">flutter<a class="hash-link" href="#flutter" title="Direct link to heading">​</a></h2><p>创建 Flutter 组件</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">.vscode/dart-widget.code-snippets</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"stateless scaffold"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"prefix"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"scaffold-stateless"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"scope"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"dart"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"body"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"import 'package:flutter/material.dart';"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"/**"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" * "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" * @date $CURRENT_YEAR-$CURRENT_MONTH-$CURRENT_DATE"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" */"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"class ${1:$TM_FILENAME_BASE} extends StatelessWidget {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  @override"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  Widget build(BuildContext context) {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"    return Scaffold("</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"      appBar: AppBar("</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"        title: Text('${TM_FILENAME_BASE}'),"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"      ),"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"      body: ${2|Text('Ctrl+v替换当前内容')|},"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"    );"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  }"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"description"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"创建无状态scaffold"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"scaffold statefull"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"prefix"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"scaffold-stateful"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"scope"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"dart"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"body"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"import 'package:flutter/material.dart';"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"/**"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" * "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" * @date $CURRENT_YEAR-$CURRENT_MONTH-$CURRENT_DATE"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" */"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"class ${1:$TM_FILENAME_BASE} extends StatefulWidget {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  @override"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  State&lt;StatefulWidget&gt; createState() {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"    return new _${1:$TM_FILENAME_BASE}State();"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  }"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"class _${1:$TM_FILENAME_BASE}State extends State&lt;${1:$TM_FILENAME_BASE}&gt; {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  @override"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  void initState() {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"    super.initState();"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  }"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  String _title = '${3:$TM_FILENAME_BASE}';"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"@override"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"Widget build(BuildContext context) {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  return Scaffold("</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"    appBar: AppBar("</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"      title: Text(_title),"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"    ),"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"    body: ${2:$CLIPBOARD},"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"    floatingActionButton: FloatingActionButton("</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"      onPressed: _onPress,"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"      child: Icon(Icons.change_circle),"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"    ),"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  );"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  void _onPress() {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  }"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"description"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"创建有状态的 Scaffold"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"stateful widget"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"prefix"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"widget-stateful"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"scope"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"dart"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"body"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"class ${1:$TM_FILENAME_BASE} extends StatefulWidget {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  ${1:$TM_FILENAME_BASE}({Key? key}) : super(key: key);"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  @override"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  State&lt;StatefulWidget&gt; createState() {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"    return _${1:TM_FILENAME_BASE}State();"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  }"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"class _${1:TM_FILENAME_BASE}State extends State&lt;${1:TM_FILENAME_BASE}&gt; {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  @override"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  Widget build(BuildContext context) {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"    return ${2|Text('Ctrl+v替换内容')|};"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  }"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"description"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"创建带有状态的组件"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"stateless widget"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"prefix"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"widget-stateless"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"scope"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"dart"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"body"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"class ${1:$TM_FILENAME_BASE} extends StatelessWidget {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  ${1:$TM_FILENAME_BASE}({Key? key}) : super(key: key);"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  @override"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  Widget build(BuildContext context) {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"    return ${2|Text('Ctrl+v替换内容')|};"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"  }"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"description"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"创建无状态的组件"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="vsc" term="vsc"/>
        <category label="visual studio code" term="visual studio code"/>
        <category label="snippets" term="snippets"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Ubuntu 20.04 LTS 安装多媒体解码库]]></title>
        <id>/2022/01/08/ubuntu-install-multimia-codecs</id>
        <link href="https://blog.alanwei.com/blog/2022/01/08/ubuntu-install-multimia-codecs"/>
        <updated>2022-01-08T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[解决安装 Ubuntu 20.04 LTS 完成后无法播放音频视频问题]]></summary>
        <content type="html"><![CDATA[<p><a href="https://linuxhint.com/install_multimedia_codecs_ubuntu/" target="_blank" rel="noopener noreferrer">原文</a></p><p>首先确认 <strong>Software &amp; Updates &gt; Ubuntu Software</strong> 里的 <code>main</code>, <code>restricted</code>, <code>universe</code> 和 <code>multiverse</code> 都已经开启, 然后执行以下操作</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 以下命令需要使用 sudo 执行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># add-apt-repository multiverse # 使用命令开启 multiverse</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> ubuntu-restricted-extras </span><span class="token comment" style="color:#999988;font-style:italic"># 安装媒体解码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> vlc </span><span class="token comment" style="color:#999988;font-style:italic"># 安装视频播放器(可忽略)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="linux" term="linux"/>
        <category label="ubuntu" term="ubuntu"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[解决Ubuntu系统启动 VMware Workstation Pro 提示 Kernel Module Updater 问题]]></title>
        <id>/2022/01/08/vmware-workstation-kernel-module-updater</id>
        <link href="https://blog.alanwei.com/blog/2022/01/08/vmware-workstation-kernel-module-updater"/>
        <updated>2022-01-08T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[解决Ubuntu系统初次安装 VMware Workstation Pro, 启动提示 kernel module updater, gcc 等问题]]></summary>
        <content type="html"><![CDATA[<p>需要执行以下命令安装 gcc compiler 和 linux header:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> build-essential linux-headers-</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">uname</span><span class="token variable" style="color:#36acaa"> -r</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"> -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>执行完上述命令后, 注销当前账号，登陆之后重新打开VMware即可。</p><p>参考 <a href="https://www.jianshu.com/p/64254f5a0c5e" target="_blank" rel="noopener noreferrer">Ubuntu18.04安装VMware出现“vmware-kernel-module-updater”</a></p><p>下载 <a href="https://download3.vmware.com/software/wkst/file/VMware-Workstation-Full-16.2.1-18811642.x86_64.bundle" target="_blank" rel="noopener noreferrer">Linux 版本 VMware Workstation 16.2.1</a></p><p>序列号: <code>ZF3R0-FHED2-M80TY-8QYGC-NPKYF</code> (来源<a href="https://vv1234.cn/archives/575.html" target="_blank" rel="noopener noreferrer">VMware Workstation 16 Pro + Key</a>)</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="linux" term="linux"/>
        <category label="ubuntu" term="ubuntu"/>
        <category label="vmware" term="vmware"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[JDK LTS 路线图及下载地址]]></title>
        <id>/2022/01/06/jdk-roadmap-download</id>
        <link href="https://blog.alanwei.com/blog/2022/01/06/jdk-roadmap-download"/>
        <updated>2022-01-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[JDK LTS 路线图, JDK 17 LTS下载地址]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="jdk-路线图">JDK 路线图<a class="hash-link" href="#jdk-路线图" title="Direct link to heading">​</a></h2><p><a href="https://www.oracle.com/java/technologies/java-se-support-roadmap.html" target="_blank" rel="noopener noreferrer">原文链接</a></p><table><thead><tr><th>Release</th><th>GA Date</th><th>Premier Support Until</th><th>Extended Support Until</th><th>Sustaining Support</th></tr></thead><tbody><tr><td>7 (LTS)</td><td>July 2011</td><td>July 2019</td><td>July 2022</td><td>Indefinite</td></tr><tr><td>8 (LTS)</td><td>March 2014</td><td>March 2022</td><td>December 2030</td><td>Indefinite</td></tr><tr><td>9 (non‑LTS)</td><td>September 2017</td><td>March 2018</td><td>Not Available</td><td>Indefinite</td></tr><tr><td>10 (non‑LTS)</td><td>March 2018</td><td>September 2018</td><td>Not Available</td><td>Indefinite</td></tr><tr><td>11 (LTS)</td><td>September 2018</td><td>September 2023</td><td>September 2026</td><td>Indefinite</td></tr><tr><td>12 (non‑LTS)</td><td>March 2019</td><td>September 2019</td><td>Not Available</td><td>Indefinite</td></tr><tr><td>13 (non‑LTS)</td><td>September 2019</td><td>March 2020</td><td>Not Available</td><td>Indefinite</td></tr><tr><td>14 (non‑LTS)</td><td>March 2020</td><td>September 2020</td><td>Not Available</td><td>Indefinite</td></tr><tr><td>15 (non‑LTS)</td><td>September 2020</td><td>March 2021</td><td>Not Available</td><td>Indefinite</td></tr><tr><td>16 (non-LTS)</td><td>March 2021</td><td>September 2021</td><td>Not Available</td><td>Indefinite</td></tr><tr><td>17 (LTS)</td><td>September 2021</td><td>September 2026</td><td>September 2029</td><td>Indefinite</td></tr><tr><td>18 (non-LTS)</td><td>March 2022</td><td>September 2022</td><td>Not Available</td><td>Indefinite</td></tr><tr><td>19 (non-LTS)</td><td>September 2022</td><td>March 2023</td><td>Not Available</td><td>Indefinite</td></tr><tr><td>20 (non-LTS)</td><td>March 2023</td><td>September 2023</td><td>Not Available</td><td>Indefinite</td></tr><tr><td>21 (LTS)</td><td>September 2023</td><td>September 2028</td><td>September 2031</td><td>Indefinite</td></tr></tbody></table><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="jdk-18-lts-download">JDK 1.8 LTS Download<a class="hash-link" href="#jdk-18-lts-download" title="Direct link to heading">​</a></h2><p><a href="https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html" target="_blank" rel="noopener noreferrer">原文链接</a></p><p><strong>Java SE Development Kit 8u202</strong></p><ul><li><a href="https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html#license-lightbox" target="_blank" rel="noopener noreferrer">Linux ARM v6/v7 Soft Float ABI - 72.86 MB</a></li><li><a href="https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html#license-lightbox" target="_blank" rel="noopener noreferrer">Linux ARM v6/v7 Soft Float ABI - 69.75 MB</a></li><li><a href="https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html#license-lightbox" target="_blank" rel="noopener noreferrer">Linux x86 - 173.08 MB</a></li><li><a href="https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html#license-lightbox" target="_blank" rel="noopener noreferrer">Linux x86 - 187.9 MB</a></li><li><a href="https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html#license-lightbox" target="_blank" rel="noopener noreferrer">Linux x64 - 170.15 MB</a></li><li><a href="https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html#license-lightbox" target="_blank" rel="noopener noreferrer">Linux x64 - 185.05 MB</a></li><li><a href="https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html#license-lightbox" target="_blank" rel="noopener noreferrer">Mac OS X x64 - 249.15 MB</a></li><li><a href="https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html#license-lightbox" target="_blank" rel="noopener noreferrer">Solaris SPARC 64-bit (SVR4 package) - 125.09 MB</a></li><li><a href="https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html#license-lightbox" target="_blank" rel="noopener noreferrer">Solaris SPARC 64-bit - 88.1 MB</a></li><li><a href="https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html#license-lightbox" target="_blank" rel="noopener noreferrer">Solaris x64 (SVR4 package) - 124.37 MB</a></li><li><a href="https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html#license-lightbox" target="_blank" rel="noopener noreferrer">Solaris x64 - 85.38 MB</a></li><li><a href="https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html#license-lightbox" target="_blank" rel="noopener noreferrer">Windows x86 - 201.64 MB</a></li><li><a href="https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html#license-lightbox" target="_blank" rel="noopener noreferrer">Windows x64 - 211.58 MB</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="jdk-17-lts-download">JDK 17 LTS Download<a class="hash-link" href="#jdk-17-lts-download" title="Direct link to heading">​</a></h2><p><a href="https://www.oracle.com/java/technologies/javase/jdk17-archive-downloads.html" target="_blank" rel="noopener noreferrer">原文链接</a></p><p><strong>Java SE Development Kit 17.0.1</strong></p><ul><li><a href="https://download.oracle.com/java/17/archive/jdk-17.0.1_linux-aarch64_bin.tar.gz" target="_blank" rel="noopener noreferrer">Linux Arm 64 Compressed Archive - 171.13 MB</a></li><li><a href="https://download.oracle.com/java/17/archive/jdk-17.0.1_linux-aarch64_bin.rpm" target="_blank" rel="noopener noreferrer">Linux Arm 64 RPM Package - 153.16 MB</a></li><li><a href="https://download.oracle.com/java/17/archive/jdk-17.0.1_linux-x64_bin.tar.gz" target="_blank" rel="noopener noreferrer">Linux x64 Compressed Archive - 172.35 MB</a></li><li><a href="https://download.oracle.com/java/17/archive/jdk-17.0.1_linux-x64_bin.deb" target="_blank" rel="noopener noreferrer">Linux x64 Debian Package - 148.02 MB</a></li><li><a href="https://download.oracle.com/java/17/archive/jdk-17.0.1_linux-x64_bin.rpm" target="_blank" rel="noopener noreferrer">Linux x64 RPM Package - 154.78 MB</a></li><li><a href="https://download.oracle.com/java/17/archive/jdk-17.0.1_macos-aarch64_bin.tar.gz" target="_blank" rel="noopener noreferrer">macOS Arm 64 Compressed Archive - 166.88 MB</a></li><li><a href="https://download.oracle.com/java/17/archive/jdk-17.0.1_macos-aarch64_bin.dmg" target="_blank" rel="noopener noreferrer">macOS 64 DMG Installer - 166.11 MB</a></li><li><a href="https://download.oracle.com/java/17/archive/jdk-17.0.1_macos-x64_bin.tar.gz" target="_blank" rel="noopener noreferrer">macOS x64 Compressed Archive - 169.42 MB</a></li><li><a href="https://download.oracle.com/java/17/archive/jdk-17.0.1_macos-x64_bin.dmg" target="_blank" rel="noopener noreferrer">macOS x64 DMG Installer - 168.81 MB</a></li><li><a href="https://download.oracle.com/java/17/archive/jdk-17.0.1_windows-x64_bin.zip" target="_blank" rel="noopener noreferrer">Windows x64 Compressed Archive - 170.66 MB</a></li><li><a href="https://download.oracle.com/java/17/archive/jdk-17.0.1_windows-x64_bin.exe" target="_blank" rel="noopener noreferrer">Windows x64 Installer - 152 MB</a></li><li><a href="https://download.oracle.com/java/17/archive/jdk-17.0.1_windows-x64_bin.msi" target="_blank" rel="noopener noreferrer">Windows x64 msi Installer - 150.89 MB</a></li></ul>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="java" term="java"/>
        <category label="jdk" term="jdk"/>
        <category label="jdk1.8" term="jdk1.8"/>
        <category label="jdk8" term="jdk8"/>
        <category label="jdk lts" term="jdk lts"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[微软拼音输入法自定义日期时间格式]]></title>
        <id>/2022/01/01/microsoft-pinyin-date</id>
        <link href="https://blog.alanwei.com/blog/2022/01/01/microsoft-pinyin-date"/>
        <updated>2022-01-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[微软拼音输入法自定义日期时间格式]]></summary>
        <content type="html"><![CDATA[<p>依次进入 <strong>设置 &gt; 时间和语言 &gt; 语言 &gt; 首选语言 &gt; 中文(选项) &gt; 微软拼音(选项) &gt; 词库和自学习 &gt; 用户定义的短语(添加或编辑自定义短语) &gt; 添加用户自定义的短语(添加)</strong></p><p>在<strong>添加短语</strong>的窗口里输入拼音（比如 <code>riqi</code>），然后<strong>短语</strong>里输入 <code>%yyyy%-%MM%-%dd%</code>。</p><p>支持的其他占位符如下:</p><ul><li><code>yyyy</code> 年</li><li><code>MM</code> 月</li><li><code>dd</code> 日</li><li><code>HH</code> 小时</li><li><code>mm</code> 分钟</li><li><code>ss</code> 秒</li></ul>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="windows" term="windows"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[PowerShell 常见问答]]></title>
        <id>/2022/01/01/powershell-qa</id>
        <link href="https://blog.alanwei.com/blog/2022/01/01/powershell-qa"/>
        <updated>2022-01-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[PowerShell 常见问答]]></summary>
        <content type="html"><![CDATA[<p>PowerShell 常见问题及解答</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="常用环境变量">常用环境变量<a class="hash-link" href="#常用环境变量" title="Direct link to heading">​</a></h2><ul><li><code>$PSHOME</code> 当前运行的PowerShell程序安装目录, 一般 <code>powershell.exe</code> 或者 <code>pwsh.exe</code> 文件在该目录.</li><li><code>$PROFILE</code> 每次启动 PowerShell 会话会执行的脚本, 功能类似于Linux上<code>.bashrc</code>或者<code>.bash_profile</code>功能的脚本.</li></ul>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="powershell" term="powershell"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[API Extractor 使用]]></title>
        <id>/2021/12/12/tsdoc-config</id>
        <link href="https://blog.alanwei.com/blog/2021/12/12/tsdoc-config"/>
        <updated>2021-12-12T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[使用API Extractor 和 tsdoc 生成 TypeScript 项目文档]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装eslint">安装eslint<a class="hash-link" href="#安装eslint" title="Direct link to heading">​</a></h2><p>参考<a href="https://www.npmjs.com/package/eslint-plugin-tsdoc" target="_blank" rel="noopener noreferrer">eslint-plugin-tsdoc</a></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> i -D @typescript-eslint/eslint-plugin @typescript-eslint/parser eslint-plugin-tsdoc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">.eslintrc.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">plugins</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"@typescript-eslint/eslint-plugin"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"eslint-plugin-tsdoc"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">extends</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'plugin:@typescript-eslint/recommended'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">parser</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">'@typescript-eslint/parser'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">parserOptions</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">project</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"./tsconfig.json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">tsconfigRootDir</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> __dirname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">ecmaVersion</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2018</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">sourceType</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"module"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">rules</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"tsdoc/syntax"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"warn"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="api-extractor-配置"><code>api extractor</code> 配置<a class="hash-link" href="#api-extractor-配置" title="Direct link to heading">​</a></h2><p>参考 <a href="https://api-extractor.com/pages/setup/invoking/" target="_blank" rel="noopener noreferrer">API Extractor: Invoking API Extractor</a></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> i -D @microsoft/api-extractor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npx api-extractor init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npx api-extractor run --local --verbose</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其他参考文档 <a href="https://zhuanlan.zhihu.com/p/434565485" target="_blank" rel="noopener noreferrer">前端开发者如何用 API Extractor 管理 API？</a></p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="typescript" term="typescript"/>
        <category label="tsdoc" term="tsdoc"/>
        <category label="api extractor" term="api extractor"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[TypeScript 类型定义小技巧]]></title>
        <id>/2021/11/28/typescript-type-define-skills</id>
        <link href="https://blog.alanwei.com/blog/2021/11/28/typescript-type-define-skills"/>
        <updated>2021-11-28T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[TypeScript 函数重载定义, 函数属性定义]]></summary>
        <content type="html"><![CDATA[<p>TypeScript定义小技巧</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="函数重载">函数重载<a class="hash-link" href="#函数重载" title="Direct link to heading">​</a></h2><p><a href="https://www.typescriptlang.org/docs/handbook/2/functions.html#function-overloads" target="_blank" rel="noopener noreferrer">引用文档</a></p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">makeDate.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">makeDate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timestamp</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Date</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">makeDate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">m</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> d</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Date</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">makeDate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mOrTimestamp</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> d</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Date </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">d </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">undefined</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">undefined</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> mOrTimestamp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mOrTimestamp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> d1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">makeDate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">12345678</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> d2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">makeDate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> d3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">makeDate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><ol><li>如果需要导出(export)函数, 那每个函数定义都要导出(export)</li><li>实际代码实现要写在参数最多那个重载定义里</li></ol></div></div><p>也可以借助<code>interface</code>或者<code>type</code>实现:</p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">makeDate.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">MakeDateDef</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">val</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Date</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">year</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> month</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Date</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> makeDate</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">MakeDateDef</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">valOrYear</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> month</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">  * 具体函数实现</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">  */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="函数属性字段定义">函数属性/字段定义<a class="hash-link" href="#函数属性字段定义" title="Direct link to heading">​</a></h2><p>使用 <code>type</code> 定义</p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">loadJs.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">LoadJsDef</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">src</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  __caches</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> loadJs</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">LoadJsDef</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">src</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** 函数实现*/</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  loadJs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__caches</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"url"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"values"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loadJs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__caches </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者使用 <code>interface</code>:</p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">loadJs.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">LoadJsDef</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">src</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  __caches</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> loadJs</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">LoadJsDef</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">src</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** 函数实现*/</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  loadJs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__caches</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"url"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"values"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loadJs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__caches </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="typescript" term="typescript"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[《图解HTTP》笔记]]></title>
        <id>/2021/11/18/book-tu-jie-http</id>
        <link href="https://blog.alanwei.com/blog/2021/11/18/book-tu-jie-http"/>
        <updated>2021-11-18T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[《图解HTTP》笔记]]></summary>
        <content type="html"><![CDATA[<p>《图解HTTP》笔记</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="62-http-首部字段">6.2 HTTP 首部字段<a class="hash-link" href="#62-http-首部字段" title="Direct link to heading">​</a></h2><p>当 HTTP 报文首部中出现了两个或两个以上具有相同首部字段名时会怎么样? 这种情况在规范内尚未明确，根据浏览器内部处理逻辑的不同，结果可能并不一致。有些浏览器会优先处理第一次出现的首部字段，而有些则会优先处理最后出现的首部字段。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="63-http11-通用首部字段">6.3 HTTP/1.1 通用首部字段<a class="hash-link" href="#63-http11-通用首部字段" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cache-control">Cache-Control<a class="hash-link" href="#cache-control" title="Direct link to heading">​</a></h3><p>通过<code>Cache-Control</code>指令可以操作缓存的工作机制. 指令的参数是可选的，多个指令之间通过逗号分割:</p><div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Cache-Control: private, max-age=0, no-cache</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong><code>Cache-Control</code> 支持的指令按请求和响应分类如下:</strong></p><p>缓存请求(Request)指令: </p><table><thead><tr><th>指令</th><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>no-cache</td><td>无</td><td>强制向源服务器再次验证</td></tr><tr><td>no-store</td><td>无</td><td>不缓存请求或响应的任何内容</td></tr><tr><td>max-age=<!-- -->[秒]</td><td>必需</td><td>响应的最大Age值</td></tr><tr><td>max-stale(=<!-- -->[秒]<!-- -->)</td><td>可省略</td><td>接收已过期的响应</td></tr><tr><td>min-fresh=<!-- -->[秒]</td><td>必需</td><td>期望在指定时间内的响应仍有效</td></tr><tr><td>no-transform</td><td>无</td><td>代理不可更改媒体类型</td></tr><tr><td>only-if-cached</td><td>无</td><td>从缓存获取资源</td></tr><tr><td>cache-extension</td><td>-</td><td>新指令标记（token）</td></tr></tbody></table><p>缓存响应(Response)指令:</p><table><thead><tr><th>指令</th><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>public</td><td>无</td><td>可向任意方提供响应的缓存</td></tr><tr><td>private</td><td>可省略</td><td>仅向特定用户返回响应</td></tr><tr><td>no-cache</td><td>可省略</td><td>缓存前必须先确认其有效性</td></tr><tr><td>no-store</td><td>无</td><td>不缓存请求或响应的任何内容</td></tr><tr><td>no-transform</td><td>无</td><td>代理不可更改媒体类型</td></tr><tr><td>must-revalidate</td><td>无</td><td>可缓存但必须再向源服务器进行确认</td></tr><tr><td>proxy-revalidate</td><td>无</td><td>要求中间缓存服务器对缓存的响应有效性再进行确认</td></tr><tr><td>max-age=<!-- -->[秒]</td><td>必需</td><td>响应的最大Age值</td></tr><tr><td>s-maxage=<!-- -->[秒]</td><td>必需</td><td>公共缓存服务器响应的最大Age值</td></tr><tr><td>cache-extension</td><td>-</td><td>新指令标记（token）</td></tr></tbody></table><p><strong>是否能缓存的指令</strong></p><p><code>Cache-Control: public</code> 指令, 则明确表明其他用户也可利用缓存(CDN服务器可以缓存资源, 并返回给所有用户.)</p><p><code>Cache-Control: private</code> 指令表示响应只以特定的用户作为对象, 这与 <code>public</code> 指令的行为相反. 缓存服务器(CDN)会对该特定用户提供资源缓存的服务. 对于其他用户发送过来的请求，代理服务器则不会返回缓存。</p><p><code>Cache-Control: no-cache</code> 指令的目的是为了防止从缓存中返回过期的资源:</p><ul><li>如果客户端发送的请求中如果包含 <code>no-cache</code> 指令，则表示客户端将不会接收缓存过的响应。于是，“中间”的缓存服务器必须把客户端请求转发给源服务器。</li><li>如果服务器返回的响应中包含 <code>no-cache</code> 指令，那么缓存服务器不能对资源进行缓存。源服务器以后也将不再对缓存服务器请求中提出的资源有效性进行确认，且禁止其对响应资源进行缓存操作。</li></ul><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意事项</div><div class="admonitionContent_S0QG"><p><code>no-cache</code> 表示不缓存过期的资源, 缓存会向源服务器进行有效期确认后处理资源, 也就是说CDN不会缓存该资源. </p></div></div><p><strong>控制可执行缓存的对象的指令</strong></p><p><code>Cache-Control: no-store</code> 指定规定缓存不能在本地存储请求或响应的任一部分</p><p><strong>指定缓存期限和认证的指令</strong></p><p><code>Cache-Control: maxage=604800</code>(单位 ：秒) 指定资源保存为缓存的最长时间:</p><ul><li>当服务器返回的响应中包含 <code>max-age</code> 指令时，缓存服务器将不对资源的有效性再作确认，而 <code>max-age</code> 数值代表资源保存为缓存的最长时间。</li><li>当客户端发送的请求中包含 <code>max-age</code> 指令时，如果判定缓存资源的缓存时间数值比指定时间的数值更小，那么客户端就接收缓存的资源。另外，当指定 <code>max-age</code> 值为 0，那么缓存服务器通常需要将请求转发给源服务器。</li></ul><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>max-age 和 Expires 优先级</div><div class="admonitionContent_S0QG"><p>应用 HTTP/1.1 版本的缓存服务器遇到同时存在 <code>Expires</code> 首部字段的情况时，会优先处理 <code>max-age</code> 指令，而忽略掉 <code>Expires</code> 首部字段。而 HTTP/1.0 版本的缓存服务器的情况却相反，<code>max-age</code> 指令会被忽略掉。</p></div></div><p><code>Cache-Control: s-maxage=604800</code> s-maxage 指令的功能和 max-age 指令的相同，它们的不同点是 s-maxage 指令只适用于供多位用户使用的公共缓存服务器。当使用 s-maxage 指令后，则直接忽略对 Expires 首部字段及 max-age 指令的处理。</p><p><code>Cache-Control: must-revalidate</code> 指令要求代理会向源服务器再次验证即将返回的响应缓存目前是否仍然有效</p><p><code>Cache-Control: proxy-revalidate</code> 指令要求所有的缓存服务器在接收到客户端带有该指令的请求返回响应之前，必须再次验证缓存的有效性。</p><p><code>Cache-Control: no-transform</code> 指令规定无论是在请求还是响应中，缓存都不能改变实体主体的媒体类型。</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="读书笔记" term="读书笔记"/>
        <category label="http" term="http"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[创建.Net Web API项目]]></title>
        <id>/2021/11/13/dotnet-web-api-starter</id>
        <link href="https://blog.alanwei.com/blog/2021/11/13/dotnet-web-api-starter"/>
        <updated>2021-11-13T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[使用.Net CLI创建一个简单的 Web API 项目]]></summary>
        <content type="html"><![CDATA[<p><a href="https://docs.microsoft.com/en-us/aspnet/core/tutorials/first-web-api?view=aspnetcore-6.0&amp;tabs=visual-studio-code" target="_blank" rel="noopener noreferrer">参考文档</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="设置环境">设置环境<a class="hash-link" href="#设置环境" title="Direct link to heading">​</a></h2><ol><li>下载安装 .Net Core Binary</li><li>设置以下环境变量</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">DOTNET_ROOT</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"/your_dotnet_binary_directory/"</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 注意这里替换成你解压后的.Net程序目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:#36acaa">PATH</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string environment constant" style="color:#36acaa">$PATH</span><span class="token string" style="color:#e3116c">:</span><span class="token string variable" style="color:#36acaa">$DOTNET_ROOT</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 添加.net到PATH，方便使用 dotnet cli</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:#36acaa">PATH</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string environment constant" style="color:#36acaa">$PATH</span><span class="token string" style="color:#e3116c">:</span><span class="token string environment constant" style="color:#36acaa">$HOME</span><span class="token string" style="color:#e3116c">/.dotnet/tools"</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 添加这个环境变量是方便后面使用 dotnet tool</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建项目">创建项目<a class="hash-link" href="#创建项目" title="Direct link to heading">​</a></h2><p>使用以下脚本创建一个新项目:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dotnet new webapi --no-https --name YourProjectName</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用脚手架创建控制器">使用脚手架创建控制器<a class="hash-link" href="#使用脚手架创建控制器" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dotnet </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> package Microsoft.VisualStudio.Web.CodeGeneration.Design --prerelease</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dotnet </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> package Microsoft.EntityFrameworkCore.Design --prerelease</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dotnet </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> package Microsoft.EntityFrameworkCore.SqlServer --prerelease</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dotnet tool </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -g dotnet-aspnet-codegenerator --version </span><span class="token number" style="color:#36acaa">6.0</span><span class="token plain">.0-preview.7.21413.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dotnet-aspnet-codegenerator controller -name TodoItemsController -async -api -m TodoItem -dc TodoContext -outDir Controllers</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="其他命令">其他命令<a class="hash-link" href="#其他命令" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dotnet tool -g list </span><span class="token comment" style="color:#999988;font-style:italic"># 显示全局安装的 .net tool</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label=".net" term=".net"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[VMware Fusion Pro 注册码 序列号]]></title>
        <id>/2021/10/16/VMware-fusion-pro</id>
        <link href="https://blog.alanwei.com/blog/2021/10/16/VMware-fusion-pro"/>
        <updated>2021-10-16T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Fusion Pro 下载地址]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="fusion-pro-下载地址">Fusion Pro 下载地址<a class="hash-link" href="#fusion-pro-下载地址" title="Direct link to heading">​</a></h2><ul><li><a href="https://www.vmware.com/cn/products/fusion/fusion-evaluation.html" target="_blank" rel="noopener noreferrer">Fusion Evaluation</a></li><li><a href="https://download3.vmware.com/software/fusion/file/VMware-Fusion-12.2.0-18760249_x86.dmg" target="_blank" rel="noopener noreferrer">直接下载链接</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="fusion-pro-12-许可证">Fusion Pro 12 许可证:<a class="hash-link" href="#fusion-pro-12-许可证" title="Direct link to heading">​</a></h2><ul><li><code>ZF3R0-FHED2-M80TY-8QYGC-NPKYF</code></li><li><code>YF390-0HF8P-M81RQ-2DXQE-M2UT6</code></li><li><code>ZF71R-DMX85-08DQY-8YMNC-PPHV8</code></li></ul>]]></content>
        <category label="vmware" term="vmware"/>
        <category label="fusion" term="fusion"/>
        <category label="mac" term="mac"/>
        <category label="key" term="key"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[React事件处理程序箭头函数造成的重复渲染问题]]></title>
        <id>/2021/10/10/react-loop-bind-event</id>
        <link href="https://blog.alanwei.com/blog/2021/10/10/react-loop-bind-event"/>
        <updated>2021-10-10T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[React事件处理程序箭头函数造成的重复渲染问题]]></summary>
        <content type="html"><![CDATA[<p>本文是以下文章的总结</p><ul><li><a href="https://zhuanlan.zhihu.com/p/29266705" target="_blank" rel="noopener noreferrer">原文 中文</a></li><li><a href="https://link.zhihu.com/?target=https%3A//medium.freecodecamp.org/why-arrow-functions-and-bind-in-reacts-render-are-problematic-f1c08b060e36" target="_blank" rel="noopener noreferrer">原文 英文</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="问题引入">问题引入<a class="hash-link" href="#问题引入" title="Direct link to heading">​</a></h2><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">components/User.jsx</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"react"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">User</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">React</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">PureComponent</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> onDeleteClick</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> id </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">name</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c"> just rendered</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">li</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">input</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">button</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">value</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">Delete</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">onDeleteClick</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">li</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token maybe-class-name">User</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">App.jsx</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"react"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">User</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"./components/User"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">App</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">React</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Component</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">constructor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">props</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">super</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">props</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">state</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">users</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Cory"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Meg"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Bob"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">deleteUser</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token parameter">id</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">prevState</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">users</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> prevState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">users</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">user</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">h1</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">Users</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">h1</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">ul</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">users</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">user</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">User</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">                </span><span class="token tag attr-name" style="color:#00a4db">key</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">user</span><span class="token tag script language-javascript punctuation" style="color:#393A34">.</span><span class="token tag script language-javascript property-access" style="color:#00009f">id</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">                </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">user</span><span class="token tag script language-javascript punctuation" style="color:#393A34">.</span><span class="token tag script language-javascript property-access" style="color:#00009f">name</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">                </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">user</span><span class="token tag script language-javascript punctuation" style="color:#393A34">.</span><span class="token tag script language-javascript property-access" style="color:#00009f">id</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">                </span><span class="token tag attr-name" style="color:#00a4db">onDeleteClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript punctuation" style="color:#393A34">(</span><span class="token tag script language-javascript punctuation" style="color:#393A34">)</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript arrow operator" style="color:#393A34">=&gt;</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript keyword" style="color:#00009f">this</span><span class="token tag script language-javascript punctuation" style="color:#393A34">.</span><span class="token tag script language-javascript method function property-access" style="color:#d73a49">deleteUser</span><span class="token tag script language-javascript punctuation" style="color:#393A34">(</span><span class="token tag script language-javascript" style="color:#00009f">user</span><span class="token tag script language-javascript punctuation" style="color:#393A34">.</span><span class="token tag script language-javascript property-access" style="color:#00009f">id</span><span class="token tag script language-javascript punctuation" style="color:#393A34">)</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">              </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">ul</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token maybe-class-name">App</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当<code>state</code>或者<code>props</code>发生变化时, React会执行组件的<code>render</code>方法. </p><p>用户点击删除按钮之后触发以下流程:</p><ol><li>触发 <code>onDeleteClick</code> 事件</li><li>执行 <code>() =&gt; this.deleteUser(id)</code></li><li><code>setState</code>方法修改<code>users</code>状态</li><li>状态发生变化, 触发 <code>&lt;App &gt;</code>组件的<code>render</code>方法</li><li><code>&lt;App /&gt;</code>组件的<code>render</code>方法会传递新的一个箭头函数给<code>&lt;User /&gt;</code>组件的<code>onDeleteClick</code>属性</li><li>导致<code>&lt;User /&gt;</code>的props发生变化, 重新执行<code>&lt;User /&gt;</code>组件的<code>render</code>方法</li></ol><p>原因就是箭头函数每次都是新的, 导致<code>&lt;App /&gt;</code>组件每次执行<code>render</code>发放时, <code>&lt;User /&gt;</code>的<code>props</code>都会发生变化.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="解决方案">解决方案<a class="hash-link" href="#解决方案" title="Direct link to heading">​</a></h2><p>文章开始引用的博文里给的解决方案是<code>&lt;User /&gt;</code>组件内部调用 <code>onDeleteClick</code>方法时把id传过去:</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">components/User.jsx</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">input</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">value</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">Delete</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript punctuation" style="color:#393A34">(</span><span class="token tag script language-javascript punctuation" style="color:#393A34">)</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript arrow operator" style="color:#393A34">=&gt;</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript keyword" style="color:#00009f">this</span><span class="token tag script language-javascript punctuation" style="color:#393A34">.</span><span class="token tag script language-javascript method function property-access" style="color:#d73a49">onDeleteClick</span><span class="token tag script language-javascript punctuation" style="color:#393A34">(</span><span class="token tag script language-javascript keyword" style="color:#00009f">this</span><span class="token tag script language-javascript punctuation" style="color:#393A34">.</span><span class="token tag script language-javascript property-access" style="color:#00009f">props</span><span class="token tag script language-javascript punctuation" style="color:#393A34">.</span><span class="token tag script language-javascript property-access" style="color:#00009f">id</span><span class="token tag script language-javascript punctuation" style="color:#393A34">)</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">App.jsx</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">User</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">key</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">user</span><span class="token tag script language-javascript punctuation" style="color:#393A34">.</span><span class="token tag script language-javascript property-access" style="color:#00009f">id</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">user</span><span class="token tag script language-javascript punctuation" style="color:#393A34">.</span><span class="token tag script language-javascript property-access" style="color:#00009f">name</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">user</span><span class="token tag script language-javascript punctuation" style="color:#393A34">.</span><span class="token tag script language-javascript property-access" style="color:#00009f">id</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">onDeleteClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript keyword" style="color:#00009f">this</span><span class="token tag script language-javascript punctuation" style="color:#393A34">.</span><span class="token tag script language-javascript property-access" style="color:#00009f">deleteUser</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>但是这个方案有个缺陷, 就是子组件需要关心入参, 而且那个入参可能是子组件不知道的.</p><p>为了解决这个问题, 可以给state上的每个user数据添加一个delete函数:</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">App.jsx</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">App</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">React</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Component</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">constructor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">users</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">item</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      item</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method-variable function-variable method function property-access" style="color:#d73a49">onDelete</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">deleteUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">item</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">User</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">key</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">user</span><span class="token tag script language-javascript punctuation" style="color:#393A34">.</span><span class="token tag script language-javascript property-access" style="color:#00009f">id</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">user</span><span class="token tag script language-javascript punctuation" style="color:#393A34">.</span><span class="token tag script language-javascript property-access" style="color:#00009f">name</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">user</span><span class="token tag script language-javascript punctuation" style="color:#393A34">.</span><span class="token tag script language-javascript property-access" style="color:#00009f">id</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">onDeleteClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">user</span><span class="token tag script language-javascript punctuation" style="color:#393A34">.</span><span class="token tag script language-javascript property-access" style="color:#00009f">onDelete</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="react" term="react"/>
        <category label="javascript" term="javascript"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[检测是否是puppeteer访问以及如何破解]]></title>
        <id>/2021/10/07/detect-puppeteer-browse</id>
        <link href="https://blog.alanwei.com/blog/2021/10/07/detect-puppeteer-browse"/>
        <updated>2021-10-07T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[使用JavaScript检测是否是puppeteer等自动化工具访问页面, 以及如何破解.]]></summary>
        <content type="html"><![CDATA[<p>有几个bilibili视频想下载下来, 网上找了个工具<a href="https://bilibili.iiilab.com/" target="_blank" rel="noopener noreferrer">哔哩哔哩视频解析下载</a>, 但是不支持多个视频下载, 为了快速下载, 打算利用puppeteer自动化下载.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="问题">问题<a class="hash-link" href="#问题" title="Direct link to heading">​</a></h2><p>简单写了一下puppeteer下载代码但是一直下载失败, 网页提示请使用推荐浏览器下载的错误信息, 排查了下代码，发现<a href="https://bilibili.iiilab.com/" target="_blank" rel="noopener noreferrer">哔哩哔哩视频解析下载</a>通过判断<code>navigator.webdriver</code>变量, 检测是否是自动化工具访问, 主要检测代码如下:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">u</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">t</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">navigator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">webdriver</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">documentElement</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getAttribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'webdriver'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">callPhantom</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">_phantom</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">md5</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">o </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> o</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> n </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">charAt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">charCodeAt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  r </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">charAt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">charCodeAt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">md5</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>问题就出在默认情况下, 使用puppeteer等UI自动化工具访问网页时, <code>navigator.webdriver</code>变量为<code>true</code>, 然后这个下载网站检测到这个变量为<code>true</code>时就使用特殊的md5值, 服务器端检测到这个值就返回给前端提示请使用推荐的浏览器.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="解决">解决<a class="hash-link" href="#解决" title="Direct link to heading">​</a></h2><p>于是网上搜了一下怎么破解, <a href="https://github.com/puppeteer/puppeteer/issues/6725" target="_blank" rel="noopener noreferrer">can't set webdriver #6725</a>, 其中<a href="https://github.com/puppeteer/puppeteer/issues/6725#issuecomment-770313953" target="_blank" rel="noopener noreferrer">vabaly</a>提到以下解决方案:</p><blockquote><p>You can try to add argument <code>--disable-blink-features=AutomationControlled</code> when launch the browser:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> browser </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">launch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">ignoreDefaultArgs</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'--enable-automation'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">args</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'--disable-blink-features=AutomationControlled'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="示例代码">示例代码<a class="hash-link" href="#示例代码" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="puppeteer">puppeteer<a class="hash-link" href="#puppeteer" title="Direct link to heading">​</a></h3><p>下面展示一下示例代码:</p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/main.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> puppeteer </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"puppeteer"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> axios</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> AxiosResponse </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"axios"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> Stream </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"stream"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> fs </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"fs"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> start</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">88</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> end</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">172</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> baseLink </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://www.bilibili.com/video/BV1sQ4y1X7o8?p="</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">download</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> browser </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> puppeteer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">launch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        headless</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ignoreDefaultArgs</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'--enable-automation'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        args</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'--disable-blink-features=AutomationControlled'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> page </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> browser</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">newPage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    page</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"response"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> req </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> url</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">url</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> method </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">method</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">method </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"POST"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> url</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">includes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/video/web/bilibili"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> body</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    text</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    video</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> fileName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">p</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">start</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">-</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">body</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">data</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">text</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">download url: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">body</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">data</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">video</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c"> -&gt; </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">fileName</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">saveAs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">video</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fileName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                start</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">access</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">page</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">body</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">warn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> page</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">goto</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"https://bilibili.iiilab.com/"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">access</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">page</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">access</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">page</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> puppeteer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Page</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">start </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// 下载结束</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> baseLink </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> start</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    page</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">reload</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> page</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">waitForTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    page</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">type</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"#app input.link-input"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> page</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">waitForTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    page</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"#app button.btn-default"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">seconds</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">void</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name builtin">Promise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resolve </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> seconds </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">saveAs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fileName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">void</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name builtin">Promise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resolve </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">fileName</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c"> download start</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">axios</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            method</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"GET"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            url</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> url</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            responseType</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"stream"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> AxiosResponse</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Stream</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createWriteStream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">./</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">fileName</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">.mp4</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"finish"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token function" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">fileName</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c"> download finish</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">text</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">[</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation keyword" style="color:#00009f">new</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation class-name">Date</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation function" style="color:#d73a49">toLocaleString</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">] </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">text</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">download</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 开始执行下载</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">package.json</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"dependencies"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"@msgpack/msgpack"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"^2.4.0"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"axios"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"^0.22.0"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"puppeteer"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"^8.0.0"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"tslib"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"^2.1.0"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"devDependencies"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"@types/axios"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"^0.14.0"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"@types/node"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"^16.10.3"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"ts-node"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"^9.1.1"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"typescript"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"^4.2.2"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">tsconfig.json</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"compilerOptions"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"module"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"commonjs"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"declaration"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"noImplicitAny"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"skipLibCheck"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"noUnusedLocals"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"importHelpers"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"removeComments"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"emitDecoratorMetadata"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"experimentalDecorators"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"target"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ES2017"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"sourceMap"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"allowJs"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"esModuleInterop"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"moduleResolution"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Node"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"baseUrl"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"./"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"resolveJsonModule"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"outDir"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"dist/"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"typeRoots"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"./node_modules/*"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"include"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"src/**/*.ts"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"exclude"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"node_modules"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cypress">Cypress<a class="hash-link" href="#cypress" title="Direct link to heading">​</a></h3><p>使用Cypress可能更方便一些:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">cypress/plugins/index.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method-variable function-variable method function property-access" style="color:#d73a49">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">on</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// `on` is used to hook into various events Cypress emits</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// `config` is the resolved Cypress config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'before:browser:launch'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">browser </span><span class="token parameter operator" style="color:#393A34">=</span><span class="token parameter"> </span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> launchOptions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// `args` is an array of all the arguments that will</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// be passed to browsers when it launches</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">launchOptions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// print all current args</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">browser</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">family</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'chromium'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> browser</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'electron'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// auto open devtools</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      launchOptions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">args</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'--auto-open-devtools-for-tabs'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      launchOptions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">args</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"--disable-blink-features=AutomationControlled"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// whatever you return here becomes the launchOptions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> launchOptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后就是写用例下载需要的视频就是, 代码类似上面的 puppeteer</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="node.js" term="node.js"/>
        <category label="puppeteer" term="puppeteer"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[如何知道 Node.js stream pipe 完成]]></title>
        <id>/2021/10/07/nodejs-stream-pipe-finish</id>
        <link href="https://blog.alanwei.com/blog/2021/10/07/nodejs-stream-pipe-finish"/>
        <updated>2021-10-07T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Node.js 的流调用 pipe 方法之后会返回一个新的流, 监听这个新流的finish事件就可以知道pipe完成了:]]></summary>
        <content type="html"><![CDATA[<p>Node.js 的流调用 <code>pipe</code> 方法之后会返回一个新的流, 监听这个新流的<code>finish</code>事件就可以知道pipe完成了:</p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">axios</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    method</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"GET"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    url</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://www.bilibili.com/"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    responseType</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"stream"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> AxiosResponse</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Stream</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> newStream </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createWriteStream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">./save-file.html</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  newStream</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"finish"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 这里流pipe已经完成</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="node.js" term="node.js"/>
        <category label="stream" term="stream"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[DOM Attributes in React 16]]></title>
        <id>/2021/10/06/dom-attributes-in-react-16</id>
        <link href="https://blog.alanwei.com/blog/2021/10/06/dom-attributes-in-react-16"/>
        <updated>2021-10-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[在过去， React通常忽略未知的DOM属性。 如果你写的JSX使用了React不能识别的属性， React将会跳过它， 比如：]]></summary>
        <content type="html"><![CDATA[<p>在过去， React通常忽略未知的DOM属性。 如果你写的JSX使用了React不能识别的属性， React将会跳过它， 比如：</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Your code:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">mycustomattribute</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">something</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>将会渲染成一个空的div元素，在React15中。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// React 15 输出:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在React 16中， 我们做了改变。 现在任何未知的属性都会在DOM中出现：</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// React 16 输出:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">mycustomattribute</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">something</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="为什么我们改变了这个行为">为什么我们改变了这个行为<a class="hash-link" href="#为什么我们改变了这个行为" title="Direct link to heading">​</a></h2><p>React提供了一套基于JS API来生成DOM。 因此React像DOM APIs一样使用 <em>canelCase</em> 约定来操作DOM相关的属性.</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">tabIndex</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript operator" style="color:#393A34">-</span><span class="token tag script language-javascript number" style="color:#36acaa">1</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然而之前, 我们在React DOM类库中维护了DOM白名单属性列表, 强制必须使用这些DOM属性:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">summary</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'summary'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">tabIndex</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'tabindex'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">target</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'target'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">title</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'title'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这导致两个弊端:</p><ul><li>你不能传递使用<a href="https://github.com/facebook/react/issues/140" target="_blank" rel="noopener noreferrer">自定义属性</a>. 对于使用浏览器专有的非标准属性, 尝试使用新的DOM APIs, 或者集成第三方类库等场景, 自定义属性是有用的.</li><li>随着时间维护的属性列表不停增长, 删除大部分白名单属性列表有助于减少类库尺寸.</li></ul><p>随着React 16的到来, 你现在可以向HTML或者SVG元素传递自定义属性, 而且React不再在生产环境包含整个白名单属性列表.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>你依然可以使用React提供的已知属性命名</p></div></div><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Yes, please</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">tabIndex</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript operator" style="color:#393A34">-</span><span class="token tag script language-javascript number" style="color:#36acaa">1</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Warning: Invalid DOM property `tabindex`. Did you mean `tabIndex`?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">tabindex</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript operator" style="color:#393A34">-</span><span class="token tag script language-javascript number" style="color:#36acaa">1</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>总而言之, React 16提供了一些兼容, 你在React中使用DOM组件的方式没有发生改变.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="我应该在自定义属性中保存数据吗">我应该在自定义属性中保存数据吗<a class="hash-link" href="#我应该在自定义属性中保存数据吗" title="Direct link to heading">​</a></h2><p>我们不鼓励你在DOM属性中保存数据. 即便不得已需要这么做, <code>data-</code> 属性也许是一个更好地方式, 但是大部分情况下, 属性应该保存在React组件的状态中, 或者外部存储.</p><p>如果你需要使用新的或者非标准DOM属性, 或者你需要集成第三方类库, 这个新特性带来了便利.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="data-和-aria-属性">Data 和 ARIA 属性<a class="hash-link" href="#data-和-aria-属性" title="Direct link to heading">​</a></h2><p>就像上面说的, React允许你自由传递使用 <code>data-</code> 和 <code>aria-</code> 属性:</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">data-foo</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">42</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">button</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">aria-label</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">Close</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">onClose</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>原文翻译自 <a href="https://reactjs.org/blog/2017/09/08/dom-attributes-in-react-16.html" target="_blank" rel="noopener noreferrer">DOM Attributes in React 16 - September 08, 2017 by Dan Abramov</a></p></blockquote>]]></content>
        <author>
            <name>Dan Abramov</name>
            <uri>https://twitter.com/dan_abramov</uri>
        </author>
        <category label="react" term="react"/>
        <category label="译文" term="译文"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[修改火狐浏览器开发者工具字体大小]]></title>
        <id>/2021/08/10/mozilla-firefox-devtool-zoom</id>
        <link href="https://blog.alanwei.com/blog/2021/08/10/mozilla-firefox-devtool-zoom"/>
        <updated>2021-08-10T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[修改火狐浏览器开发者工具字体大小]]></summary>
        <content type="html"><![CDATA[<p><a href="https://stackoverflow.com/questions/27273389/increase-code-font-size-in-firefox-developer-tool" target="_blank" rel="noopener noreferrer">修改火狐浏览器开发者工具字体大小</a></p><p>Maybe an easier way will be to open <code>about:config</code> and set <code>devtools.toolbox.zoomValue</code> to bigger value.</p>]]></content>
        <category label="mozilla" term="mozilla"/>
        <category label="firefox" term="firefox"/>
        <category label="browser" term="browser"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Event Emitters in TypeScript]]></title>
        <id>/2021/07/04/event-emitters-typescript</id>
        <link href="https://blog.alanwei.com/blog/2021/07/04/event-emitters-typescript"/>
        <updated>2021-07-04T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Ref: Event Emitters in TypeScript]]></summary>
        <content type="html"><![CDATA[<p><a href="https://rjzaworski.com/2019/10/event-emitters-in-typescript#:~:text=A%20TypeScript%20event%20emitter%20interface%20TypeScript%20can%20help,but%20it%E2%80%99s%20easy%20enough%20to%20implement%20your%20own." target="_blank" rel="noopener noreferrer">Ref: Event Emitters in TypeScript</a></p><p>从UI交互到Node.js的核心事件循环, 基于事件循环是JavaScript开发的一部分. </p><p>TypeScript可以让事件驱动的程序显式声明什么事件会被触发。有大量<a href="https://rjzaworski.com/2018/10/typescript-event-handlers" target="_blank" rel="noopener noreferrer">TypeScript event handlers</a>示例，不过自己也可以很容易实现一个。 关键点是使用一个已知的什么事件会触发的map作为<strong>Emitter</strong>。</p><p>通常一个 event emitter 的TypeScript类型定义看起来像这样:</p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">EventMap</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Record</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">EventKey</span><span class="token class-name operator" style="color:#393A34">&lt;</span><span class="token class-name constant" style="color:#36acaa">T</span><span class="token class-name"> </span><span class="token class-name keyword" style="color:#00009f">extends</span><span class="token class-name"> EventMap</span><span class="token class-name operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">keyof</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">EventReceiver</span><span class="token class-name operator" style="color:#393A34">&lt;</span><span class="token class-name constant" style="color:#36acaa">T</span><span class="token class-name operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">params</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">Emitter</span><span class="token class-name operator" style="color:#393A34">&lt;</span><span class="token class-name constant" style="color:#36acaa">T</span><span class="token class-name"> </span><span class="token class-name keyword" style="color:#00009f">extends</span><span class="token class-name"> EventMap</span><span class="token class-name operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token generic-function function" style="color:#d73a49">on</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name constant" style="color:#36acaa">K</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name keyword" style="color:#00009f">extends</span><span class="token generic-function generic class-name"> EventKey</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name constant" style="color:#36acaa">T</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">eventName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">K</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fn</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> EventReceiver</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">K</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token generic-function function" style="color:#d73a49">off</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name constant" style="color:#36acaa">K</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name keyword" style="color:#00009f">extends</span><span class="token generic-function generic class-name"> EventKey</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name constant" style="color:#36acaa">T</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">eventName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">K</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fn</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> EventReceiver</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">K</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token generic-function function" style="color:#d73a49">emit</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name constant" style="color:#36acaa">K</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name keyword" style="color:#00009f">extends</span><span class="token generic-function generic class-name"> EventKey</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name constant" style="color:#36acaa">T</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">eventName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">K</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> params</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">K</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>接下来写一个实现 <strong>Emitter</strong> 的小例子 <strong>eventEmitter</strong> :</p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// `listeners` are unbounded -- don't use this in practice!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token generic-function function" style="color:#d73a49">eventEmitter</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name constant" style="color:#36acaa">T</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name keyword" style="color:#00009f">extends</span><span class="token generic-function generic class-name"> EventMap</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Emitter</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> listeners</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">K</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">keyof</span><span class="token plain"> EventMap</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> EventMap</span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">K</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      listeners</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">listeners</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">off</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      listeners</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">listeners</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">f </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> f </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> fn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">emit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">listeners</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">fn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当我们使用 <strong>eventEmitter</strong> 产生一个新的 emitter 时， 我们可以提供一个emitter将会触发的事件列表: </p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> emitter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token generic-function function" style="color:#d73a49">eventEmitter</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name punctuation" style="color:#393A34">{</span><span class="token generic-function generic class-name"></span><br></span><span class="token-line" style="color:#393A34"><span class="token generic-function generic class-name">  data</span><span class="token generic-function generic class-name operator" style="color:#393A34">:</span><span class="token generic-function generic class-name"> Buffer </span><span class="token generic-function generic class-name operator" style="color:#393A34">|</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name builtin">string</span><span class="token generic-function generic class-name punctuation" style="color:#393A34">;</span><span class="token generic-function generic class-name"></span><br></span><span class="token-line" style="color:#393A34"><span class="token generic-function generic class-name">  end</span><span class="token generic-function generic class-name operator" style="color:#393A34">:</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name keyword" style="color:#00009f">undefined</span><span class="token generic-function generic class-name punctuation" style="color:#393A34">;</span><span class="token generic-function generic class-name"></span><br></span><span class="token-line" style="color:#393A34"><span class="token generic-function generic class-name"></span><span class="token generic-function generic class-name punctuation" style="color:#393A34">}</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>rjzaworski.com</name>
            <uri>https://rjzaworski.com/2019/10/event-emitters-in-typescript</uri>
        </author>
        <category label="typescript" term="typescript"/>
        <category label="javascript" term="javascript"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[JavaScript创建指定数量的重复元素]]></title>
        <id>/2021/06/27/javascript-create-an-array-with-repeat-element</id>
        <link href="https://blog.alanwei.com/blog/2021/06/27/javascript-create-an-array-with-repeat-element"/>
        <updated>2021-06-27T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[创建一个数组，包含指定数量的重复元素 Create an array with same element repeated multiple times]]></summary>
        <content type="html"><![CDATA[<p>JavaScript中，如果创建重复的元素, 原问题: <a href="https://stackoverflow.com/questions/12503146/create-an-array-with-same-element-repeated-multiple-times" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/12503146/create-an-array-with-same-element-repeated-multiple-times</a></p><p>下面的场景是创建一个数组，数组里包含<code>5</code>个重复的元素<code>2</code>:</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="arrayfrom">Array.from<a class="hash-link" href="#arrayfrom" title="Direct link to heading">​</a></h2><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token known-class-name class-name">Array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword module" style="color:#00009f">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">length</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">x</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token known-class-name class-name">Array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword module" style="color:#00009f">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">length</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token parameter">i</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token known-class-name class-name">Array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword module" style="color:#00009f">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">length</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">e</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// =&gt; 0, 1, 2, 3, 4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="fill"><a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Array/fill" target="_blank" rel="noopener noreferrer">fill</a><a class="hash-link" href="#fill" title="Direct link to heading">​</a></h2><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token known-class-name class-name">Array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">fill</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="arrayapply">Array.apply<a class="hash-link" href="#arrayapply" title="Direct link to heading">​</a></h2><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token known-class-name class-name">Array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="expand">Expand<a class="hash-link" href="#expand" title="Direct link to heading">​</a></h2><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token spread operator" style="color:#393A34">...</span><span class="token known-class-name class-name">Array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="join--split">join + split<a class="hash-link" href="#join--split" title="Direct link to heading">​</a></h2><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token known-class-name class-name">Array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"2"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="flat">flat<a class="hash-link" href="#flat" title="Direct link to heading">​</a></h2><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token known-class-name class-name">Array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">fill</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'a'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'b'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'c'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">flat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// =&gt; Array(9) [ "a", "b", "c", "a", "b", "c", "a", "b", "c" ]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="javascript" term="javascript"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[使用Docker运行Apache Kafka]]></title>
        <id>/2021/05/25/kafka-docker-setup</id>
        <link href="https://blog.alanwei.com/blog/2021/05/25/kafka-docker-setup"/>
        <updated>2021-05-25T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Ref Guide to Setting Up Apache Kafka Using Docker]]></summary>
        <content type="html"><![CDATA[<p><a href="https://www.baeldung.com/ops/kafka-docker-setup" target="_blank" rel="noopener noreferrer">Ref Guide to Setting Up Apache Kafka Using Docker</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="前言">前言<a class="hash-link" href="#前言" title="Direct link to heading">​</a></h2><p>在软件领域，Docker是创建、打包、部署应用的最受欢迎的容器引擎之一。本教程我们会学习如何使用Docker运行Kafka。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="单实例模式">单实例模式<a class="hash-link" href="#单实例模式" title="Direct link to heading">​</a></h2><p>在本地开发，单个Kafka broker更简单方便。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="docker-composeyml-配置"><em>docker-compose.yml</em> 配置<a class="hash-link" href="#docker-composeyml-配置" title="Direct link to heading">​</a></h2><p>为了启动一个kafka broker，需要先启动一个Zookeeper服务。 我们在<em>docker-compose.yml</em>文件中配置这个依赖， 这样保证在启动Kafka服务之前确保Zookeeper服务已经启动。</p><p>下面创建一个简单的<em>docker-compose.yml</em>文件，包含两个服务，命名为 <em>zookeeper</em> 和 <em>kafka</em>：</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">docker-compose.yml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'2'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">zookeeper</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> confluentinc/cp</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">zookeeper</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ZOOKEEPER_CLIENT_PORT</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2181</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ZOOKEEPER_TICK_TIME</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 22181</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2181</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">kafka</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> confluentinc/cp</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">kafka</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> zookeeper</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 29092</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">29092</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">KAFKA_BROKER_ID</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">KAFKA_ZOOKEEPER_CONNECT</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> zookeeper</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2181</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">KAFKA_ADVERTISED_LISTENERS</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PLAINTEXT</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//kafka</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">9092</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">PLAINTEXT_HOST</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">29092</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PLAINTEXT</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">PLAINTEXT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">PLAINTEXT_HOST</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">PLAINTEXT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">KAFKA_INTER_BROKER_LISTENER_NAME</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PLAINTEXT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在上面的配置中，对于同容器的<em>kafka</em>服务，zookeeper服务暴露的的是<em>2181</em>端口号。而对于运行在主机上的其他客户端，kafka暴露的是<em>22181</em>端口号。</p><p>类似的kafka通过端口号<em>29092</em>暴露给主机应用，但是在容器环境中使用<strong>KAFKA_ADVERTISED_LISTENERS</strong>配置项使用的是<em>9092</em>端口号。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="启动kafka服务">启动Kafka服务<a class="hash-link" href="#启动kafka服务" title="Direct link to heading">​</a></h3><p>下面使用 <em>docker-compose</em> 命令启动kafka服务:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker-compose</span><span class="token plain"> up -d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后使用<em>nc</em>命令验证两个服务监听了预期的端口号:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">nc</span><span class="token plain"> -z localhost </span><span class="token number" style="color:#36acaa">22181</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">nc</span><span class="token plain"> -z localhost </span><span class="token number" style="color:#36acaa">29092</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>也可以通过查看kafka启动日志查看是否运行了:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker-compose</span><span class="token plain"> logs kafka </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> -i started</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>现在kafka服务就绪可以使用了。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用kafka-tool连接kafka">使用Kafka Tool连接Kafka<a class="hash-link" href="#使用kafka-tool连接kafka" title="Direct link to heading">​</a></h3><p>可以使用<a href="https://kafkatool.com/download.html" target="_blank" rel="noopener noreferrer">Kafka Tool</a> GUI 客户端工具建立和Kafka服务的连接.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="kafka集群设置">Kafka集群设置<a class="hash-link" href="#kafka集群设置" title="Direct link to heading">​</a></h2><p>下面通过扩展 <em>docker-compose.yml</em> 文件创建配置多节点Kafka集群。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="docker-composeyml-配置-1"><em>docker-compose.yml</em> 配置<a class="hash-link" href="#docker-composeyml-配置-1" title="Direct link to heading">​</a></h3><p>下面配置多个Zookeeper和Kafka服务:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">docker-compose.yml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'2'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">zookeeper-1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> confluentinc/cp</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">zookeeper</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ZOOKEEPER_CLIENT_PORT</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2181</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ZOOKEEPER_TICK_TIME</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 22181</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2181</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">zookeeper-2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> confluentinc/cp</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">zookeeper</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ZOOKEEPER_CLIENT_PORT</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2181</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ZOOKEEPER_TICK_TIME</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 32181</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2181</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">kafka-1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> confluentinc/cp</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">kafka</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> zookeeper</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> zookeeper</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 29092</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">29092</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">KAFKA_BROKER_ID</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">KAFKA_ZOOKEEPER_CONNECT</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> zookeeper</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2181</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">zookeeper</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2181</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">KAFKA_ADVERTISED_LISTENERS</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PLAINTEXT</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//kafka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">9092</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">PLAINTEXT_HOST</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">29092</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PLAINTEXT</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">PLAINTEXT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">PLAINTEXT_HOST</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">PLAINTEXT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">KAFKA_INTER_BROKER_LISTENER_NAME</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PLAINTEXT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">kafka-2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> confluentinc/cp</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">kafka</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> zookeeper</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> zookeeper</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 39092</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">39092</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">KAFKA_BROKER_ID</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">KAFKA_ZOOKEEPER_CONNECT</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> zookeeper</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2181</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">zookeeper</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2181</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">KAFKA_ADVERTISED_LISTENERS</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PLAINTEXT</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//kafka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">9092</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">PLAINTEXT_HOST</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">39092</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PLAINTEXT</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">PLAINTEXT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">PLAINTEXT_HOST</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">PLAINTEXT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">KAFKA_INTER_BROKER_LISTENER_NAME</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PLAINTEXT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>服务名称和 <em>KAFKA_BROKER_ID</em> 必须是唯一的。每个服务必须暴露出一个唯一的端口号给主机。</p>]]></content>
        <author>
            <name>Baedldung</name>
            <uri>https://www.baeldung.com/ops/kafka-docker-setup</uri>
        </author>
        <category label="kafka" term="kafka"/>
        <category label="docker" term="docker"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Bash快捷键列表]]></title>
        <id>/2021/05/18/bash-shortcuts</id>
        <link href="https://blog.alanwei.com/blog/2021/05/18/bash-shortcuts"/>
        <updated>2021-05-18T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[bash快捷键列表]]></summary>
        <content type="html"><![CDATA[<p><a href="https://gist.github.com/tuxfight3r/60051ac67c5f0445efee" target="_blank" rel="noopener noreferrer">Ref Bash Shortcuts</a></p><h1>Bash Shortcuts</h1><p><img loading="lazy" src="https://raw.githubusercontent.com/fliptheweb/bash-shortcuts-cheat-sheet/master/moving_cli.png" alt="visual cheetsheet" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="moving">Moving<a class="hash-link" href="#moving" title="Direct link to heading">​</a></h2><table><thead><tr><th>command</th><th>description</th></tr></thead><tbody><tr><td>ctrl + a</td><td>Goto BEGINNING of command line</td></tr><tr><td>ctrl + e</td><td>Goto END of command line</td></tr><tr><td>ctrl + b</td><td>move back one character</td></tr><tr><td>ctrl + f</td><td>move forward one character</td></tr><tr><td>alt + f</td><td>move cursor FORWARD one word</td></tr><tr><td>alt + b</td><td>move cursor BACK one word</td></tr><tr><td>ctrl + xx</td><td>Toggle between the start of line and current cursor position</td></tr><tr><td>ctrl + ] + x</td><td>Where x is any character, moves the cursor forward to the next occurance of x</td></tr><tr><td>alt + ctrl + ] + x</td><td>Where x is any character, moves the cursor backwards to the previous occurance of x</td></tr></tbody></table><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="edit--other">Edit / Other<a class="hash-link" href="#edit--other" title="Direct link to heading">​</a></h2><table><thead><tr><th>command</th><th>description</th></tr></thead><tbody><tr><td>ctrl + d</td><td>Delete the character under the cursor</td></tr><tr><td>ctrl + h</td><td>Delete the previous character before cursor</td></tr><tr><td>ctrl + u</td><td>Clear all / cut BEFORE cursor</td></tr><tr><td>ctrl + k</td><td>Clear all / cut AFTER cursor</td></tr><tr><td>ctrl + w</td><td>delete the word BEFORE the cursor</td></tr><tr><td>alt + d</td><td>delete the word FROM the cursor</td></tr><tr><td>ctrl + y</td><td>paste (if you used a previous command to delete)</td></tr><tr><td>ctrl + i</td><td>command completion like Tab</td></tr><tr><td>ctrl + l</td><td>Clear the screen (same as clear command)</td></tr><tr><td>ctrl + c</td><td>kill whatever is running</td></tr><tr><td>ctrl + d</td><td>Exit shell (same as exit command when cursor line is empty)</td></tr><tr><td>ctrl + z</td><td>Place current process in background</td></tr><tr><td>ctrl + _</td><td>Undo</td></tr><tr><td>ctrl + x ctrl + u</td><td>Undo the last changes. ctrl+ _ does the same</td></tr><tr><td>ctrl + t</td><td>Swap the last two characters before the cursor</td></tr><tr><td>esc + t</td><td>Swap last two words before the cursor</td></tr><tr><td>alt + t</td><td>swap current word with previous</td></tr><tr><td>esc + .</td><td></td></tr><tr><td>esc + _</td><td></td></tr><tr><td>alt + <!-- -->[Backspace]</td><td>delete PREVIOUS word</td></tr><tr><td>alt + &lt;</td><td>Move to the first line in the history</td></tr><tr><td>alt + &gt;</td><td>Move to the end of the input history, i.e., the line currently being entered</td></tr><tr><td>alt + ?</td><td>display the file/folder names in the current path as help</td></tr><tr><td>alt + *</td><td>print all the file/folder names in the current path as parameter</td></tr><tr><td>alt + .</td><td>print the LAST ARGUMENT (ie "vim file1.txt file2.txt" will yield "file2.txt")</td></tr><tr><td>alt + c</td><td>capitalize the first character to end of word starting at cursor (whole word if cursor is at the beginning of word)</td></tr><tr><td>alt + u</td><td>make uppercase from cursor to end of word</td></tr><tr><td>alt + l</td><td>make lowercase from cursor to end of word</td></tr><tr><td>alt + n</td><td></td></tr><tr><td>alt + p</td><td>Non-incremental reverse search of history.</td></tr><tr><td>alt + r</td><td>Undo all changes to the line</td></tr><tr><td>alt + ctl + e</td><td>Expand command line.</td></tr><tr><td>~<!-- -->[TAB][TAB]</td><td>List all users</td></tr><tr><td>$<!-- -->[TAB][TAB]</td><td>List all system variables</td></tr><tr><td>@<!-- -->[TAB][TAB]</td><td>List all entries in your /etc/hosts file</td></tr><tr><td>[TAB]</td><td>Auto complete</td></tr><tr><td>cd -</td><td>change to PREVIOUS working directory</td></tr></tbody></table><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="history">History<a class="hash-link" href="#history" title="Direct link to heading">​</a></h2><table><thead><tr><th>command</th><th>description</th></tr></thead><tbody><tr><td>ctrl + r</td><td>Search backward starting at the current line and moving 'up' through the history as necessary</td></tr><tr><td>crtl + s</td><td>Search forward starting at the current line and moving 'down' through the history as necessary</td></tr><tr><td>ctrl + p</td><td>Fetch the previous command from the history list, moving back in the list (same as up arrow)</td></tr><tr><td>ctrl + n</td><td>Fetch the next command from the history list, moving forward in the list (same as down arrow)</td></tr><tr><td>ctrl + o</td><td>Execute the command found via Ctrl+r or Ctrl+s</td></tr><tr><td>ctrl + g</td><td>Escape from history searching mode</td></tr><tr><td>!!</td><td>Run PREVIOUS command (ie <code>sudo !!</code>)</td></tr><tr><td>!vi</td><td>Run PREVIOUS command that BEGINS with vi</td></tr><tr><td>!vi:p</td><td>Print previously run command that BEGINS with vi</td></tr><tr><td>!n</td><td>Execute nth command in history</td></tr><tr><td>!$</td><td>Last argument of last command</td></tr><tr><td>!^</td><td>First argument of last command</td></tr><tr><td>^abc^xyz</td><td>Replace first occurance of abc with xyz in last command and execute it</td></tr></tbody></table><h1>Kill a job</h1><p>n = job number, to list jobs, run <code>jobs</code></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">kill</span><span class="token plain"> %n</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Example:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">kill</span><span class="token plain"> %1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="references">References<a class="hash-link" href="#references" title="Direct link to heading">​</a></h2><ol><li><a href="http://cnswww.cns.cwru.edu/php/chet/readline/readline.html" target="_blank" rel="noopener noreferrer">http://cnswww.cns.cwru.edu/php/chet/readline/readline.html</a></li><li><a href="https://github.com/fliptheweb/bash-shortcuts-cheat-sheet/blob/master/README.md" target="_blank" rel="noopener noreferrer">https://github.com/fliptheweb/bash-shortcuts-cheat-sheet/blob/master/README.md</a></li></ol>]]></content>
        <author>
            <name>tuxfight3r</name>
            <uri>https://gist.github.com/tuxfight3r</uri>
        </author>
        <category label="bash" term="bash"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[解决 macOS 系统 xcrun error invalid active developer path 异常]]></title>
        <id>/2021/05/17/mac-xcrun-error</id>
        <link href="https://blog.alanwei.com/blog/2021/05/17/mac-xcrun-error"/>
        <updated>2021-05-17T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[ref How to fix Mac OS invalid active developer path, missing xcrun]]></summary>
        <content type="html"><![CDATA[<p><a href="https://www.bpetersen.dk/post/how-to-fix-mac-os-xcrun-error-invalid-active-developer-path-missing-xcrun" target="_blank" rel="noopener noreferrer">ref How to fix Mac OS: xcrun error: invalid active developer path, missing xcrun</a></p><p>升级完mac系统之后运行 zsh, python3, git 等命令提示以下错误:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">xcrun: error: invalid active developer path (/Library/Developer/CommandLineTools), missing xcrun at: /Library/Developer/CommandLineTools/usr/bin/xcrun</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>解决办法是打开终端执行: <code>xcode-select --install</code>, 或者手动安装 XCode.</p><p>如果已经安装了还是不行，执行 <code>sudo xcode-select --reset</code> 重置一下.</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="mac" term="mac"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Termux配置清华大学开源镜像]]></title>
        <id>/2021/05/17/termux-mirror</id>
        <link href="https://blog.alanwei.com/blog/2021/05/17/termux-mirror"/>
        <updated>2021-05-17T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[来源 Termux 镜像使用帮助]]></summary>
        <content type="html"><![CDATA[<p><a href="https://mirrors.tuna.tsinghua.edu.cn/help/termux/" target="_blank" rel="noopener noreferrer">来源 Termux 镜像使用帮助</a></p><p>打开 Termux , 输入以下命令:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">termux-change-repo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用上下键+空格选中三个源，然后按Tab键切换到 <strong>OK</strong>，在第二屏选中清华大学的镜像源即可。</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="android" term="android"/>
        <category label="termux" term="termux"/>
        <category label="mirror" term="mirror"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[一个TypeScript类型复用的小技巧]]></title>
        <id>/2021/05/09/typescript-type-reference</id>
        <link href="https://blog.alanwei.com/blog/2021/05/09/typescript-type-reference"/>
        <updated>2021-05-09T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[分享一个TypeScript类型复用的小技巧:]]></summary>
        <content type="html"><![CDATA[<p>分享一个TypeScript类型复用的小技巧:</p><p>为了复用<code>Brand</code>类型, 一般都是这么写, 单独定义<code>Brand</code>类型:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type </span><span class="token maybe-class-name">Brand</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">brandId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">brandName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> string </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type </span><span class="token maybe-class-name">DealerLogItem</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">city</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">cityName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">cityId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> string </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">brand</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Brand</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">dealers</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">Dealer</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> map </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Map</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token maybe-class-name">Brand</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其实还可以这么写:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type </span><span class="token maybe-class-name">DealerLogItem</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">city</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">cityName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">cityId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> string </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">brand</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">brandId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">brandName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> string </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">dealers</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">Dealer</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> map </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Map</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token maybe-class-name">DealerLogItem</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"brand"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样 <code>DealerLogItem</code> 上的字段定义就能复用了.</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="typescript" term="typescript"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[macOS 允许打开任何位置下载的App]]></title>
        <id>/2021/05/05/macos-allow-apps-from-anywhere</id>
        <link href="https://blog.alanwei.com/blog/2021/05/05/macos-allow-apps-from-anywhere"/>
        <updated>2021-05-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[macOS allow apps downloaded from anywhere]]></summary>
        <content type="html"><![CDATA[<p><a href="https://macpaw.com/how-to/allow-apps-anywhere" target="_blank" rel="noopener noreferrer">原文 - Want to allow apps downloaded from anywhere?</a></p><p>在macOS Sierra之前版本, 如果想允许打开任何地方下载的文件或者App, 只需要进入 <strong>System Preferences(系统设置) &gt; Security &amp; Privacy(安全性与隐私) &gt; General(通用)</strong>, 然后把<strong>Allow apps to be downloaded from(允许 Apple Watch 解锁 App 和 Mac)</strong>配置项设置成<strong>Anywhere(任何地址)</strong>.</p><p>但是新版的macOS已经没有这个选项了, 需要手动打开终端输入以下命令开启这个选项:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> spctl --master-disable</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>执行完之后再次进入上述的设置即可看到<strong>Anywhere</strong>选项.</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="mac" term="mac"/>
        <category label="macOS" term="macOS"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[使用自定义的Spring MVC处理程序拦截器管理会话]]></title>
        <id>/2021/05/05/spring-mvc-custom-handler-interceptor</id>
        <link href="https://blog.alanwei.com/blog/2021/05/05/spring-mvc-custom-handler-interceptor"/>
        <updated>2021-05-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[原文 - Using a Custom Spring MVC’s Handler Interceptor to Manage Sessions]]></summary>
        <content type="html"><![CDATA[<p><a href="https://www.baeldung.com/spring-mvc-custom-handler-interceptor" target="_blank" rel="noopener noreferrer">原文 - Using a Custom Spring MVC’s Handler Interceptor to Manage Sessions</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="简介">简介<a class="hash-link" href="#简介" title="Direct link to heading">​</a></h2><p>本教程专注Spring MVC的 <em>HandlerInterceptor</em>.</p><p>我们展示一个使用拦截器的高级示例 - 模拟一个会话超时的逻辑, 通过设置自定义次数手动跟踪会话.</p><p>如果你想越多更多关于Spring <em>HandlerInterceptor</em> 的基础知识<a href="https://www.baeldung.com/spring-mvc-handlerinterceptor" target="_blank" rel="noopener noreferrer">点击这里</a>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="maven依赖">Maven依赖<a class="hash-link" href="#maven依赖" title="Direct link to heading">​</a></h2><p>使用<em>Interceptors</em>需要在你的<em>pom.xml</em>文件中的<em>dependencies</em>配置节添加以下依赖:</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">pom.xml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.springframework</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">spring-web</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">5.2.8.RELEASE</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>最新版本可以在<a href="https://search.maven.org/classic/#search%7Cga%7C1%7Ca%3A%22spring-web%22" target="_blank" rel="noopener noreferrer">这里查看</a>. 这个依赖仅覆盖了Spring Web, 因此对于完整的Web应用, 不要忘记添加 <em>spring-core</em> 和 <em>spring-context</em> .</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="实现自定义的会话超时">实现自定义的会话超时<a class="hash-link" href="#实现自定义的会话超时" title="Direct link to heading">​</a></h2><p>在这个例子里, 我们将会设置一个用户在系统中最大的不活跃(inactive)时长. 超过这个时长之后, 用户将会自动被退出登录.</p><p>当用户不再是活跃状态后, 需要确保会话是无效的. 比如有个用户忘记退出登录了, 不活跃倒计时将会阻止未授权用户访问账号信息. 因此我们需要设置一个不活跃时长常量:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">private static final long MAX_INACTIVE_SESSION_TIME = 5 * 10000;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>为了测试, 我们设置了50秒(单位是毫秒).</p><p>现在我们需要在我们的应用里跟踪每个会话, 因此我们需要包含这个Spring接口:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private HttpSession session;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>让我们处理 <em>preHandle()</em> 方法.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="prehandle"><em>preHandle()</em><a class="hash-link" href="#prehandle" title="Direct link to heading">​</a></h2><p>在这个方法里我们包含以下操作:</p><ul><li>设置计时器检查处理请求时间</li><li>检查用户是否登录(使用<a href="https://www.baeldung.com/spring-model-parameters-with-handler-interceptor" target="_blank" rel="noopener noreferrer">这篇文章</a>提供的<em>UserInterceptor</em>方法)</li><li>如果用户的不活跃的会话时长超过最大值, 自动退出登录.</li></ul><p>让我们看下实现:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public boolean preHandle(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HttpServletRequest req, HttpServletResponse res, Object handler) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log.info("Pre handle method - check handling start time");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    long startTime = System.currentTimeMillis();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    request.setAttribute("executionTime", startTime);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在上面这个代码片段里, 我们设置请求执行的 <em>startTime</em>. 从这时开始, 我们会统计每个请求结束时的耗时秒数. 接下来我们提供会话时间的逻辑, 仅当有人登录:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if (UserInterceptor.isUserLogged()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    session = request.getSession();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log.info("Time since last request in this session: {} ms",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      System.currentTimeMillis() - request.getSession().getLastAccessedTime());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (System.currentTimeMillis() - session.getLastAccessedTime()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &gt; MAX_INACTIVE_SESSION_TIME) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.warn("Logging out, due to inactive session");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SecurityContextHolder.clearContext();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        request.logout();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        response.sendRedirect("/spring-rest-full/logout");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return true;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>首先我们需要从获取请求会话.</p><p>接下来我们打印了一些控制台日志, 包括谁登录、截止用户在应用中最后一次任意操作过去了多长时间. 我们使用<code>session.getLastAccessedTime()</code>获取信息, 减去当前时间和<code>MAX_INACTIVE_SESSION_TIME</code>比较.</p><p>如果超过我们允许的时长, 清空上下文, 退出登录, 然后响应一个跳转.</p><p>为了完成处理时长示例, 我们还需要实现 <em>postHandle()</em> 方法.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="posthandle">postHandle()<a class="hash-link" href="#posthandle" title="Direct link to heading">​</a></h2><p>实现这个方法是用来显示当前请求处理耗时信息. 再上一个代码片段中我们在Spring模型中设置了<em>executionTime</em>, 现在是时候使用它了:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void postHandle(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HttpServletRequest request, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HttpServletResponse response,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Object handler, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ModelAndView model) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log.info("Post handle method - check execution time of handling");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    long startTime = (Long) request.getAttribute("executionTime");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log.info("Execution time for handling the request was: {} ms",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      System.currentTimeMillis() - startTime);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置拦截器">配置拦截器<a class="hash-link" href="#配置拦截器" title="Direct link to heading">​</a></h2><p>添加我们新创建的拦截器到Spring配置中, 我们需要重写实现了<em>WebMvcConfigurer</em>的<em>WebConfig</em>类中的<em>addInterceptors()</em>方法.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="完整示例">完整示例<a class="hash-link" href="#完整示例" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="定义拦截类">定义拦截类<a class="hash-link" href="#定义拦截类" title="Direct link to heading">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.stereotype.Component;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.servlet.HandlerInterceptor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.servlet.ModelAndView;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import javax.servlet.http.HttpServletRequest;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import javax.servlet.http.HttpServletResponse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SampleHandlerInterceptor implements HandlerInterceptor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 在调用处理程序方法之前调用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 在调用处理程序方法之后调用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 在处理完请求后调用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用">使用<a class="hash-link" href="#使用" title="Direct link to heading">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.beans.factory.annotation.Autowired;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.stereotype.Component;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class YourWebConfiguration implements WebMvcConfigurer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SampleHandlerInterceptor interceptor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void addInterceptors(InterceptorRegistry registry) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        registry.addInterceptor(this.interceptor);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="java" term="java"/>
        <category label="spring" term="spring"/>
        <category label="转摘" term="转摘"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Spring MVC HandlerInterceptor 简介]]></title>
        <id>/2021/05/05/spring-mvc-handlerinterceptor</id>
        <link href="https://blog.alanwei.com/blog/2021/05/05/spring-mvc-handlerinterceptor"/>
        <updated>2021-05-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[原文 - Introduction to Spring MVC HandlerInterceptor]]></summary>
        <content type="html"><![CDATA[<p><a href="https://www.baeldung.com/spring-mvc-handlerinterceptor" target="_blank" rel="noopener noreferrer">原文 - Introduction to Spring MVC HandlerInterceptor</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="spring-mvc处理程序">Spring MVC处理程序<a class="hash-link" href="#spring-mvc处理程序" title="Direct link to heading">​</a></h2><p>为了理解拦截器, 让我们回头看一下<em>HandlerMapping</em>. 它把一个方法映射到一个URL上, 因此当一个请求进来时, <em>DispatcherServlet</em>能够调用对用的方法.</p><p>事实上, <em>DispatcherServlet</em>使用<em>HandlerAdapter</em>调用方法(Controller里定义的方法).</p><p>现在我们知道了全部上下文 - 拦截器是时候到来了. 我们使用<em>HandlerInterceptor</em>在HTTP请求之前、之后和完成(当视图被渲染)时分别执行一些操作.</p><p>拦截器使用了横切概念, 避免了一些重复性代码, 比如日志、改变Spring模型的一些全局参数等.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="maven依赖">Maven依赖<a class="hash-link" href="#maven依赖" title="Direct link to heading">​</a></h2><p>使用拦截器需要天机以下依赖:</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">pom.xml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.springframework</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">spring-web</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">5.2.8.RELEASE</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>最新版本<a href="https://search.maven.org/classic/#search%7Cga%7C1%7Ca%3A%22spring-web%22" target="_blank" rel="noopener noreferrer">点此查看</a>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="spring-handler-intercetpro">Spring Handler Intercetpro<a class="hash-link" href="#spring-handler-intercetpro" title="Direct link to heading">​</a></h2><p>拦截器和Spring框架提供的<em>HandlerMapping</em>一样, 必须实现<em>HandlerInterceptor</em>接口.</p><p>这个接口包含三个主要方法:</p><ul><li><em>preHanlde()</em> 在处理程序被调用之前执行, 此时视图还未生成</li><li><em>postHandle()</em> 在处理程序被调用之后执行</li><li><em>afterCompletion()</em> 在请求结束和视图生成之后执行</li></ul><p><em>HandlerInterceptor</em> 和 <em>HandlerInterceptorAdapter</em> 的区别在于, 第一个需要手动重写上述所有的三个方法, 而第二个只需要实现需要的方法就行.</p><p><em>preHandle()</em>简单实现:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public boolean preHandle(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HttpServletRequest request,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HttpServletResponse response, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Object handler) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // your code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>需要注意的是<em>preHandle</em>方法返回一个boolean值, 用来告诉Spring请求是否应该被后续继续处理.(<em>true</em>表示请求继续被处理, <em>false</em>表示终止后续处理.)</p><p><em>postHandle()</em>简单实现:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void postHandle(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HttpServletRequest request, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HttpServletResponse response,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Object handler, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ModelAndView modelAndView) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // your code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这个方法在 <strong>HTTP请求被<em>HandlerAdapter</em>处理完成且未生成视图之前</strong> 调用.</p><p>它可以被以多种场景使用, 比如把登录用的头像添加到model中.</p><p>实现<em>HandlerInterceptor</em>需要重写的最后一个方法<em>afterCompletion()</em>:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void afterCompletion(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HttpServletRequest request, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HttpServletResponse response,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Object handler, Exception ex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // your code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当视图被生成, 我们可以使用这个钩子方法做一些像收集请求额外诊断数据的事情.</p><p>最后需要记住的是<em>HandlerInterceptor</em>被注册成<em>DefaultAnnotationHandlerMapping</em> bean. <em>DefaultAnnotationHandlerMapping</em> bean被用来负责在所有使用<code>@Controller</code>注解的类上应用拦截器. 此外, 你可以在web应用中指定任意数量的拦截器.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="自定义日志拦截器">自定义日志拦截器<a class="hash-link" href="#自定义日志拦截器" title="Direct link to heading">​</a></h2><p>首先需要创建一个实现<code>HandlerInterceptorAdapter</code>的类:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class LoggerInterceptor extends HandlerInterceptorAdapter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在拦截器里开启日志:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">private static Logger log = LoggerFactory.getLogger(LoggerInterceptor.class);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>接下来关注拦截器的实现:</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="prehandle方法">preHandle方法<a class="hash-link" href="#prehandle方法" title="Direct link to heading">​</a></h3><p>这个方法在请求被处理之前执行, 如果返回<em>true</em>, Spring框架会把请求发送到下一个处理程序方法(或者下一个拦截器). 如果返回<em>false</em>, Spring假设请求被完成处理, 不再需要继续处理.</p><p>我们使用这个钩子(指<em>preHandle()</em>)但因请求参数信息:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public boolean preHandle(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HttpServletRequest request,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HttpServletResponse response, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Object handler) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log.info("[preHandle][" + request + "]" + "[" + request.getMethod()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      + "]" + request.getRequestURI() + getParameters(request));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在上面这个李自力我们把密码打印出来了，为了去除敏感数据, 下面是<em>getParameters()</em>方法的实现:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">private String getParameters(HttpServletRequest request) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    StringBuffer posted = new StringBuffer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Enumeration&lt;?&gt; e = request.getParameterNames();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (e != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        posted.append("?");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    while (e.hasMoreElements()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (posted.length() &gt; 1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            posted.append("&amp;");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String curr = (String) e.nextElement();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        posted.append(curr + "=");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (curr.contains("password") </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          || curr.contains("pass")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          || curr.contains("pwd")) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            posted.append("*****");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            posted.append(request.getParameter(curr));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String ip = request.getHeader("X-FORWARDED-FOR");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String ipAddr = (ip == null) ? getRemoteAddr(request) : ip;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (ipAddr!=null &amp;&amp; !ipAddr.equals("")) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        posted.append("&amp;_psip=" + ipAddr); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return posted.toString();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private String getRemoteAddr(HttpServletRequest request) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String ipFromHeader = request.getHeader("X-FORWARDED-FOR");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (ipFromHeader != null &amp;&amp; ipFromHeader.length() &gt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.debug("ip from proxy - X-FORWARDED-FOR : " + ipFromHeader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return ipFromHeader;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return request.getRemoteAddr();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="posthandle方法">postHandle方法<a class="hash-link" href="#posthandle方法" title="Direct link to heading">​</a></h3><p>这个钩子在<code>HandlerAdapter</code>调用了处理程序(指URL对应的Controller里的方法), 但是<em>DispatcherServlet</em>尚未渲染视图的时候调用.</p><p>我们可以使用这个方法给<code>ModelAndView</code>添加一些额外属性, 或者检查处理程序方法在处理客户端请求的耗时. </p><p>在我们的例子里, 我们简单打印一下请求:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void postHandle(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HttpServletRequest request, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HttpServletResponse response,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Object handler, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ModelAndView modelAndView) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log.info("[postHandle][" + request + "]");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="aftercoimpletion方法">afterCoimpletion方法<a class="hash-link" href="#aftercoimpletion方法" title="Direct link to heading">​</a></h3><p>当请求已经结束, 而且视图已经渲染, 我们可以获取到请求和响应数据, 以及异常信息(如果发生了异常):</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void afterCompletion(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HttpServletRequest request, HttpServletResponse response,Object handler, Exception ex) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (ex != null){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ex.printStackTrace();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log.info("[afterCompletion][" + request + "][exception: " + ex + "]");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置">配置<a class="hash-link" href="#配置" title="Direct link to heading">​</a></h2><p>为了把我们新创建的拦截器添加到Spring配置中, 我们需要重写实现了<em>WebMvcConfigurer</em>的<em>WebConfig</em>类中的<em>addInterceptors()</em>方法:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void addInterceptors(InterceptorRegistry registry) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    registry.addInterceptor(new LoggerInterceptor());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>配置被激活之后, 这个拦截器将会处理所有请求.</p><p>如果有多个Spring拦截器被配置, <em>preHandle</em> 方法将会被按照配置的顺序执行, 而<em>postHandle</em>和<em>afterCompletion</em>方法将会被按照相反的顺序执行.</p><p>如果你使用Spring Boot代替了 Spring, 需要注意的是不要忘了在配置类上使用 <code>@EnableWebMvc</code>, 否则我们会在启动时丢失自动配置.</p><div class="theme-admonition theme-admonition-warning alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_S0QG"><p>注意最新版已经不再建议使用<code>HandlerInterceptorAdapter</code>了, 而是实现<code>org.springframework.web.servlet.HandlerInterceptor</code>.</p><p>最新版也不再建议直接继承<code>WebConfig</code>, 而是实现<code>org.springframework.web.servlet.config.annotation.WebMvcConfigurer</code></p></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="java" term="java"/>
        <category label="spring" term="spring"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Spring Boot 使用 JSP]]></title>
        <id>/2021/05/04/spring-boot-jsp</id>
        <link href="https://blog.alanwei.com/blog/2021/05/04/spring-boot-jsp"/>
        <updated>2021-05-04T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Ref Spring Boot With JavaServer Pages (JSP)]]></summary>
        <content type="html"><![CDATA[<p>Ref <a href="https://www.baeldung.com/spring-boot-jsp" target="_blank" rel="noopener noreferrer">Spring Boot With JavaServer Pages (JSP)</a></p><p>以下代码是在 <em>start.spring.io</em> 站点生成的Spring Boot Web项目基础上改造的.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="添加引用">添加引用<a class="hash-link" href="#添加引用" title="Direct link to heading">​</a></h2><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">pom.xml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.apache.tomcat.embed</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">tomcat-embed-jasper</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">9.0.44</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">provided</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="新增控制器">新增控制器<a class="hash-link" href="#新增控制器" title="Direct link to heading">​</a></h2><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/main/java/com/alanwei/spb/demo/controllers/BasicController.java</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.alanwei.spb.demo.controllers;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.stereotype.Controller;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.bind.annotation.RequestMapping;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class BasicController {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @RequestMapping("/welcome-view")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String welcomeView() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return "welcome";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="新增jsp">新增JSP<a class="hash-link" href="#新增jsp" title="Direct link to heading">​</a></h2><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/main/webapp/WEB-INF/jsp/welcome.jsp</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">html</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">head</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">title</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">Welcome</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">title</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">head</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">p</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">Welcome! This is coming from a view - a JSP</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">p</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">html</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="更新配置">更新配置<a class="hash-link" href="#更新配置" title="Direct link to heading">​</a></h2><div class="language-properties codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/main/application.properties</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-properties codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring.mvc.view.prefix: /WEB-INF/jsp/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.mvc.view.suffix: .jsp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="运行">运行<a class="hash-link" href="#运行" title="Direct link to heading">​</a></h2><p>执行以下脚本查看效果:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mvn spring-boot:run</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="spring" term="spring"/>
        <category label="spring boot" term="spring boot"/>
        <category label="jsp" term="jsp"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[使用 Docusaurus 结合 GitHub 搭建个人站点]]></title>
        <id>/2021/05/01/docusaurus-github-starter</id>
        <link href="https://blog.alanwei.com/blog/2021/05/01/docusaurus-github-starter"/>
        <updated>2021-05-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[使用Docusaurus结合GitHub搭建个人站点]]></summary>
        <content type="html"><![CDATA[<p>介绍一下如何使用GitHub以及 Docusaurus(下面简称Doc) 免费搭建一个个人博客站点.</p><p><a href="https://docusaurus.io/docs/installation" target="_blank" rel="noopener noreferrer">Doc</a> 是一个支持将 Markdown 文件生成静态网页的工具(最棒的是支持<a href="https://docusaurus.io/docs/markdown-features/react" target="_blank" rel="noopener noreferrer">MDX</a>)，也支持将 React 组件生成静态网页(类似于服务器端渲染)。同时有良好的SEO支持。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建-github-仓库">创建 GitHub 仓库<a class="hash-link" href="#创建-github-仓库" title="Direct link to heading">​</a></h2><p>首先需要创建两个 <a href="https://github.com/" target="_blank" rel="noopener noreferrer">GitHub</a> 仓库:</p><ol><li>一个用于存放博客的源码(Markdown、JSX等文件): <a href="https://github.com/alan-wei/blog-sample" target="_blank" rel="noopener noreferrer">alan-wei/blog-sample</a>，下面简称 <code>blog-sample</code> </li><li>一个利用 <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a> 搭建Web站点的仓库: <a href="https://github.com/alan-wei/alan-wei.github.io" target="_blank" rel="noopener noreferrer">alan-wei/alan-wei.github.io</a>，这个仓库名字要用GitHub账号名加上<code>.github.io</code> ，下面简称 <code>alan-wei.github.io</code></li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="doc生成博客项目">Doc生成博客项目<a class="hash-link" href="#doc生成博客项目" title="Direct link to heading">​</a></h2><p>需要安装 <a href="https://nodejs.org/" target="_blank" rel="noopener noreferrer">Node.js</a>，然后执行以下命令<a href="https://docusaurus.io/docs/installation" target="_blank" rel="noopener noreferrer">生成博客项目</a>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx @docusaurus/init@latest init blog-sample classic</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后将生成的博客项目<code>blog-sample</code>推送到远程仓库.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> blog-sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> init </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> </span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> commit -m </span><span class="token string" style="color:#e3116c">"init project"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> remote </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> origin https://github.com/alan-wei/blog-sample.git </span><span class="token comment" style="color:#999988;font-style:italic"># 这里需要改成你的仓库地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> push --set-upstream origin master </span><span class="token comment" style="color:#999988;font-style:italic"># 推送到远程仓库</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置自动部署">配置自动部署<a class="hash-link" href="#配置自动部署" title="Direct link to heading">​</a></h2><p>可以借助 GitHub Actions 自动部署博客站点。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="自动发布脚本">自动发布脚本<a class="hash-link" href="#自动发布脚本" title="Direct link to heading">​</a></h3><p>在 <code>blog-sample</code> 项目创建文件 <code>.github/workflows/publish-blog.yml</code> (文件名可以随意修改):</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">.github/workflows/publish-blog.yml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Publish Blog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">push</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tags</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> v* </span><span class="token comment" style="color:#999988;font-style:italic"># 这里表示只有新增tag才会触发自动化脚本执行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">gh-release</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> github.event_name </span><span class="token tag" style="color:#00009f">!=</span><span class="token plain"> 'pull_request'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/setup</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">node@v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">node-version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'12.x'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> webfactory/ssh</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">agent@v0.5.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ssh-private-key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.GH_PAGES_DEPLOY </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Release to GitHub Pages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">USE_SSH</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">GIT_USER</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">DEPLOYMENT_BRANCH</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          git config --global user.email "actions@github.com"</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          git config --global user.name "gh-actions"</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          if [ -e yarn.lock ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          yarn install --frozen-lockfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          elif [ -e package-lock.json ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          npm ci</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          else</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          npm i</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          npm run deploy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>提交代码至远程仓库 <code>blog-sample</code>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="设置-secret">设置 Secret<a class="hash-link" href="#设置-secret" title="Direct link to heading">​</a></h3><p>Step 1. 生成一对SSH密钥: <code>ssh-keygen -f blog-ssh</code></p><p>Step 2. 复制第一步生成的公钥文件<code>blog-ssh.pub</code>内容，进入仓库<code>alan-wei.github.io</code> 的 <code>Settings &gt; Deploy keys &gt; add deploy key</code> 新增一个条目，粘贴进去，并勾选 <code>Allow write access</code></p><img src="https://gitee.com/alanway/resources/raw/master/files/docusaurus-github-starter/github-repo-blog-secret-key.png" alt="https://gitee.com/alanway/resources/raw/master/files/docusaurus-github-starter/github-repo-blog-secret-key.png" referrerpolicy="no-referrer"><p>Step 3. 复制第一步的私钥文件<code>blog-ssh</code>内容，进入仓库<code>blog-sample</code>的<code>Settings &gt; Secrets &gt; New repository secret</code>，新建的Secret名字要和上面提到的<code>publish-blog.yml</code>自动化配置文件里的一致，即: <code>GH_PAGES_DEPLOY</code></p><img src="https://gitee.com/alanway/resources/raw/master/files/docusaurus-github-starter/github-repo-blog-secret-key.png" alt="https://gitee.com/alanway/resources/raw/master/files/docusaurus-github-starter/github-repo-blog-secret-key.png" referrerpolicy="no-referrer"><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="修改-docusaurusconfigjs">修改 <code>docusaurus.config.js</code><a class="hash-link" href="#修改-docusaurusconfigjs" title="Direct link to heading">​</a></h3><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">docusaurus.config.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">url</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://alan-wei.github.io/"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 可选配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * 必须配置，是你的GitHub账号，执行 npm run deploy 时会用到</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   */</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">organizationName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'alan-wei'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * 必须配置，是你的博客部署到的那个仓库地址，执行 npm run deploy 时会用到</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   */</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">projectName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'alan-wei.github.io'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="提交tag自动部署">提交Tag自动部署<a class="hash-link" href="#提交tag自动部署" title="Direct link to heading">​</a></h2><p>因为上面配置的自动化脚本只有新增tag时才会执行自动化作业，下面提交一个tag，而且tag必须以<code>v</code>开头，就能就会自动部署了</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git tag -a v2021-05-01 -m "第一次发布"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git push --tags</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后访问 <code>https://github.com/alan-wei/blog-sample/actions</code> 查看作业执行情况。</p><p>作业执行完成之后访问 <a href="https://alan-wei.github.io/" target="_blank" rel="noopener noreferrer">https://alan-wei.github.io/</a> 即可查看博客内容。</p><p>Doc相关文档可以参考<a href="https://docusaurus.io/docs/creating-pages" target="_blank" rel="noopener noreferrer">官方教程</a>。</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="docusaurus" term="docusaurus"/>
        <category label="github" term="github"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[VSC指定类库文件增强智能感知]]></title>
        <id>/2021/04/27/visual-studio-code-intelligence</id>
        <link href="https://blog.alanwei.com/blog/2021/04/27/visual-studio-code-intelligence"/>
        <updated>2021-04-27T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[有的时候写个demo, 直接页面引用的类库, 导致有些智能感知缺失, 可以在JS的开头增加以下代码增加智能感知:]]></summary>
        <content type="html"><![CDATA[<p>有的时候写个demo, 直接页面引用的类库, 导致有些智能感知缺失, 可以在JS的开头增加以下代码增加智能感知:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/// &lt;reference path="../../scripts/vue/types/index.d.ts" /&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 接下来在使用Vue相关方法就会有智能感知了.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="vsc" term="vsc"/>
        <category label="visual studio code" term="visual studio code"/>
        <category label="editor" term="editor"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Termux远程访问]]></title>
        <id>/2021/04/26/termux-remote-access</id>
        <link href="https://blog.alanwei.com/blog/2021/04/26/termux-remote-access"/>
        <updated>2021-04-26T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[在电脑上远程访问Termux:]]></summary>
        <content type="html"><![CDATA[<p>在电脑上远程访问Termux: </p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 以下脚本在 Termux 终端上执行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pkg </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> openssh </span><span class="token comment" style="color:#999988;font-style:italic"># 安装包</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh-keygen </span><span class="token comment" style="color:#999988;font-style:italic"># 生成ssh的key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sshd </span><span class="token comment" style="color:#999988;font-style:italic"># 启动服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">passwd</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 设置当前账号密码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 以下脚本在电脑上执行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> -p </span><span class="token number" style="color:#36acaa">8022</span><span class="token plain"> user@termux_ip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Termux is capable of accessing remote devices by using some common tools. It is also possible to turn a device running Termux into remote controlled server.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ftp">FTP<a class="hash-link" href="#ftp" title="Direct link to heading">​</a></h2><p>Warning: plain FTP is deprecated and insecure anyway. Termux FTP server supports only anonymous login, there no any authentication and everyone on your network can access files on your device. Use SFTP (OpenSSH) instead!</p><p>Termux FTP server is based on busybox and service is managed by <!-- -->[Termux-services]<!-- -->. If you decided to use FTP server, install these packages:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pkg </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> busybox termux-services</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After installation you need to restart session or source this file:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">source $PREFIX/etc/profile.d/start-services.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now you ready to enable and start the FTP daemon service:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sv-enable ftpd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sv up ftpd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>FTP server will run on port 8021 in read-only mode.</p><p>If you need to stop server, run <code>sv down ftpd</code>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ssh">SSH<a class="hash-link" href="#ssh" title="Direct link to heading">​</a></h2><p>SSH provides a secure way for accessing remote hosts and replaces tools such as telnet, rlogin, rsh, ftp. Termux provides SSH via two packages: dropbear and openssh. If you never used these tools before, it is recommended to install 'openssh' as it is more common.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="using-the-ssh-client">Using the SSH client<a class="hash-link" href="#using-the-ssh-client" title="Direct link to heading">​</a></h3><p>You can obtain an SSH client by installing either <code>openssh</code> or <code>dropbear</code>.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="usage-example">Usage example<a class="hash-link" href="#usage-example" title="Direct link to heading">​</a></h4><p>To login to a remote machine where the ssh daemon is running at the standard port (22):</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> user@hostname_or_ip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Same as above, but if the ssh daemon running on different port, e.g. 8022:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> -p </span><span class="token number" style="color:#36acaa">8022</span><span class="token plain"> user@hostname_or_ip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Using public key authentication with ssh running on the standard port and a private key stored in the file <code>id_rsa</code>:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> -i id_rsa user@hostname_or_ip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note, that if <code>id_rsa</code> will be stored in <code>~/.ssh</code> directory, you can omit specifying it in the command. But if you have multiple keys, it is necessary to pick a specific key with <code>-i {path_to_privkey}</code>.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ssh-agent">SSH Agent<a class="hash-link" href="#ssh-agent" title="Direct link to heading">​</a></h4><p><strong>Important note</strong>: this does not work for Dropbear.</p><p>If you wish to use an SSH agent to avoid entering passwords, the Termux openssh package provides a wrapper script named <code>ssha</code> (note the <code>a</code> at the end) for ssh, which:</p><ul><li>Starts the ssh agent if necessary (or connect to it if already running).</li><li>Runs the <code>ssh-add</code> if necessary.</li><li>Runs the <code>ssh</code> with the provided arguments.</li></ul><p>This means that the agent will prompt for a key password at first run, but remember the authorization for subsequent runs.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="using-the-ssh-server">Using the SSH server<a class="hash-link" href="#using-the-ssh-server" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="openssh">OpenSSH<a class="hash-link" href="#openssh" title="Direct link to heading">​</a></h4><p>OpenSSH (also known as OpenBSD Secure Shell) is a suite of secure networking utilities based on the Secure Shell (SSH) protocol, which provides a secure channel over an unsecured network in a client–server architecture.</p><p>Default SSH port in Termux is 8022.</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="starting-and-stopping-openssh-server">Starting and stopping OpenSSH server<a class="hash-link" href="#starting-and-stopping-openssh-server" title="Direct link to heading">​</a></h5><p>Since Termux does not use initialization system, services are started manually from command line.</p><p>To start OpenSSH server, you need to execute this command:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sshd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you need to stop <code>sshd</code>, just kill it's process:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">pkill</span><span class="token plain"> sshd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>SSH daemon does logging to Android system log, you can view it by running <code>logcat -s 'sshd:*'</code>. You can do that either from Termux or ADB.</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="setting-up-password-authentication">Setting up password authentication<a class="hash-link" href="#setting-up-password-authentication" title="Direct link to heading">​</a></h5><p>Password authentication is enabled by default. This will allow you to get started with it much easier. Before proceeding, make sure that you understand that password authentication is less secure than a pubkey-based one.</p><ol><li>Ensure that everything is up to date and package <code>openssh</code> is installed:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pkg upgrade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pkg </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> openssh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Password authentication is enabled by default in configuration file. But you can still review it ($PREFIX/etc/ssh/sshd_config), it should be like this:</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PrintMotd yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PasswordAuthentication yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Subsystem sftp /data/data/com.termux/files/usr/libexec/sftp-server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Set new password. Execute command passwd. While program allows minimal password length is 1 character, the recommended password length is more than 8-10 characters. Passwords are not printed to console.</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">passwd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">New password:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Retype new password:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">New password was successfully set.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="setting-up-public-key-authentication">Setting up public key authentication<a class="hash-link" href="#setting-up-public-key-authentication" title="Direct link to heading">​</a></h5><p>Public key authentication is the recommended way for logging in using SSH. To use this type of authentication, you need to have a public/private key pair. For successful login, the public key must exist in the authorized keys list on remote machine while private key should be kept safe on your local host.</p><p>In the following example it will be assumed that you want to establish public key authentication between your PC (host) and your Android device running Termux (remote). It also will be assumed that you running Linux distribution on your PC.</p><ol><li>If you do not have keys, you can generate them. In this example we will generate RSA key. On PC, execute this command:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh-keygen -t rsa -b </span><span class="token number" style="color:#36acaa">2048</span><span class="token plain"> -f id_rsa</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The command shown above generates private RSA key with 2048 bit key length and saves it to file <code>id_rsa</code>. In the same directory you can find a file <code>id_rsa.pub</code> – it is a public key.</p><p>Important note: 2048 bit is the minimal key length that is considered safe. You can use higher values, but do not use higher than 4096 as remote server may not support big keys.</p><ol start="2"><li>Copy key to the remote machine (Termux). Password authentication has to be enabled in order to install pubkey on remote machine. Now do:</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh-copy-id -p 8022 -i id_rsa IP_ADDRESS</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Do not forget to replace <code>IP_ADDRESS</code> with the actual LAN IP address of your device. It can be determined by using command ifconfig.</p><p>If everything was okay, you will see a message like this one:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Number of key(s) added: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Now try logging into the machine, with:   "ssh -p '8022' '192.168.1.4'"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and check to make sure that only the key(s) you wanted were added.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>From this point password authentication can be disabled. Edit file $PREFIX/etc/ssh/sshd_config and replace line beginning with "PasswordAuthentication" by</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PasswordAuthentication no</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then execute command pkill sshd; sshd in order to restart server with updated configuration file.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="dropbear">Dropbear<a class="hash-link" href="#dropbear" title="Direct link to heading">​</a></h4><p>Dropbear is a software package written by Matt Johnston that provides a Secure Shell-compatible server and client. It is designed as a replacement for standard OpenSSH for environments with low memory and processor resources, such as embedded systems.</p><p><strong>Important note</strong>: Dropbear does not provide SFTP server.</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="starting-and-stopping-dropbear-server">Starting and stopping Dropbear server<a class="hash-link" href="#starting-and-stopping-dropbear-server" title="Direct link to heading">​</a></h5><p>Same as for OpenSSH, you will need to execute it's binary manually. Also, unlike OpenSSH, Dropbear does not use a configuration file but only command line arguments.</p><p>Server is running in background, both password and public key authentication available. To achieve this, just type in console:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dropbear</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you need only public key authentication, do this instead:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dropbear -s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Also, server can be started in foreground. For this purpose use a parameter <code>-F</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dropbear -F</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Server started in foreground can be stopped by just Ctrl-C key combination. If it is in the background, then you can use a <code>pkill</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pkill dropbear</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="setting-up-password-authentication-1">Setting up password authentication<a class="hash-link" href="#setting-up-password-authentication-1" title="Direct link to heading">​</a></h5><p>Same as for OpenSSH, password authentication is enabled by default.</p><p>Everything you have to do, is:</p><ol><li>Make sure that everything is up to date and dropbear is installed:</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pkg upgrade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pkg install dropbear</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li><p>Set password by executing command passwd.</p></li><li><p>Start dropbear server. You can execute either just dropbear to start it in background or dropbear -F to start it in the foreground.</p></li></ol><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="setting-up-public-key-authentication-1">Setting up public key authentication<a class="hash-link" href="#setting-up-public-key-authentication-1" title="Direct link to heading">​</a></h5><p>Same as for OpenSSH, you can put your keys by using ssh-copy-id. But if you consider to setup a public key authentication from Termux to something else, it is worth to mention some important differences between OpenSSH and Dropbear.</p><ol><li>Dropbear uses a different command for generating keys. Example of generating RSA key (2048 bit):</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dropbearkey -t rsa -f id_rsa -s 2048</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Public key should be obtained manually. To do this, you have to use 'dropbearkey' again, but in different way:</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dropbearkey -f id_rsa -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Dropbear and OpenSSH uses a different key formats. To use a Dropbear's key in OpenSSH, you will have to convert it:</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dropbearconvert dropbear openssh ./id_rsa ./id_rsa_openssh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This procedure can be done vice versa to obtain a key in Dropbear's format:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dropbearconvert openssh dropbear ./id_rsa_openssh ./id_rsa_dropbear</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="using-the-sftp">Using the SFTP<a class="hash-link" href="#using-the-sftp" title="Direct link to heading">​</a></h3><p>Package OpenSSH provides a tool for accessing remote hosts over SFTP. This will allow you to work with files in same way as via FTP but with better security.</p><p>Connecting to Termux (sshd listening on port 8022):</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ sftp -P 8022 192.168.1.20</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Connecting to somewhere else (sshd listening on standard port):</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ sftp sftp.example.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>However, to use command line SFTP client you should know some basic commands:</p><ul><li><code>cd PATH</code> - change current directory to <code>PATH</code>.</li><li><code>get REMOTE [LOCAL]</code> - download file <code>REMOTE</code> and rename it as <code>LOCAL</code> (optional).</li><li><code>mkdir PATH</code> - create directory <code>PATH</code>.</li><li><code>ls [PATH]</code> - list files in directory <code>PATH</code>. If no argument, files in current directory will be listed.</li><li><code>put LOCAL [REMOTE]</code> - Upload file <code>LOCAL</code> and rename it as <code>REMOTE</code> (optional).</li><li><code>rm FILE</code> - Delete file <code>FILE</code>.</li></ul><p>This is not a complete list of SFTP commands. To view all available commands, consider to view man page (man sftp) or view short help in interactive SFTP session by issuing command <code>help</code>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="mosh">MOSH<a class="hash-link" href="#mosh" title="Direct link to heading">​</a></h2><p>Mosh is a remote terminal application that allows roaming, supports intermittent connectivity, and provides intelligent local echo and line editing of user keystrokes.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="usage-example-1">Usage example<a class="hash-link" href="#usage-example-1" title="Direct link to heading">​</a></h3><p>Important note: Mosh should be installed on both client and server side.</p><p>Connecting to remote host (sshd listening on standard port):</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mosh user@ssh.example.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Connecting to Termux (sshd listening on port 8022):</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mosh --ssh="ssh -p 8022" 192.168.1.25</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="rsync">Rsync<a class="hash-link" href="#rsync" title="Direct link to heading">​</a></h2><p>Rsync is a tool for synchronizing files with remote hosts or local directories (or drives). For better experience of using rsync, make sure that package <code>openssh</code> (or <code>dropbear</code>) is installed.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="usage-example-2">Usage example<a class="hash-link" href="#usage-example-2" title="Direct link to heading">​</a></h3><p>Sync your photos with PC:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ rsync -av /sdcard/DCIM/ user@192.168.1.20:~/Pictures/Android/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Get photos from remote Android device:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ rsync -av -e 'ssh -p 8022' 192.168.1.3:/sdcard/DCIM/ /sdcard/DCIM/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Sync local directories (e.g. from external sdcard to Termux home):</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ rsync -av /storage/0123-4567/myfiles ~/files</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You may want to see man page (<code>man rsync</code>) to learn more about it's usage.</p>]]></content>
        <author>
            <name>Termux Wiki</name>
            <uri>https://wiki.termux.com/wiki/Main_Page</uri>
        </author>
        <category label="termux" term="termux"/>
        <category label="android" term="android"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[语文考试可以写负能量作文吗]]></title>
        <id>/2021/04/23/语文考试可以写负能量作文吗</id>
        <link href="https://blog.alanwei.com/blog/2021/04/23/语文考试可以写负能量作文吗"/>
        <updated>2021-04-23T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[语文考试可以写负能量作文吗？如果不能的话又是为什么？]]></summary>
        <content type="html"><![CDATA[<p>我真的是服你们这群崽子。</p><p>一个个的都是契科夫转世、莫泊桑临凡、欧亨利还魂，茨威格夺舍……</p><p>你们三天没洗的油头上散发的是莎士比亚时代遗留的思想圣光，一月未换的袜子里氤氲着文艺复兴时期的蓬勃蒸汽，龙飞凤舞的狗爬字体饱含着千年中华的伟大传承。</p><p>你们就是鲁迅后院子里的那两棵树，一棵是朴树，另一棵是村上春树，你们的根系绵延不绝，从白鹿原一直聊骚到挪威的森林，阿来匍匐在你们脚下，贾平凹仰望着你们的膝盖，刘慈欣率领的整个三体舰队，都被你们炫彩夺丽的文采所折服，把你们的大作顶在脑壳上一路跪着爬回去的。</p><p>我看你们就差脑壳上刷上几个金光闪闪的烫金大字——爷怀才不遇！</p><p>就一句话，只要你文笔好，三观正，不给法西斯洗地，不给罪犯挡枪，不为封建糟粕招魂，你们爱写什么写什么，想写什么写什么……这些都不是问题。</p><p>你要真的才比李太白，文盖托尔斯泰，你的老师也不会是那嫉贤妒能的张士贵，不会针对你这个人民代表大会上的应梦贤臣。</p><p>唯一的问题是:</p><p>锁了房门丢钥匙——您配吗？</p><p>我就想知道，您十八年的人生究竟度过的多么灰暗？才让您的脑子里充满了这宛如七月十五红衣上吊冤死鬼般的怨气，非要在一个人生比重前几名的考试里玩一把个性，赌一把人生？你是昭和日本在中国的遗孤吗？动不动就要皇国兴废，在此一举？</p><p>区区八百字的篇幅，您是打算用什么样的方式组织一个莫名其妙的负能量宣泄？喊麦吗？惊雷，这通天彻底紫金锤？</p><p>你失过业？下过岗？去过夹边沟农场？</p><p>你扛过枪？打过仗？家里上了一炷香？</p><p>你炼过钢？交过粮？吃过红薯拌高粱？</p><p>你贷过款？买过房？女友身边躺老王？</p><p>你有个卵子的负能量？</p><p>校花没喝你拿早餐钱买的奶茶，你就抑郁了？王者连掉十几个段位，你就顿悟了？你哥们放学拉稀没跟你一起走，你就觉得被背叛了？你爹妈随口叮嘱你一句，你就被全世界针对了？</p><p>醒醒吧，你见过什么负能量？奈何桥上你不喝汤孟婆还得掉业绩呢，满月时候嘴里啃坨屎你还乐的像喝了奶一样呢，穿着个开裆裤满床尿尿的时候也没见你单手托腮cos个沉思者啊？</p><p>高考作文的难度一降再降，从话题作文到材料作文再到近些年就差给你出个写作攻略的任务驱动型作文，考察的不过是你好好说话的本事。</p><p>可你就是不想好好说话！</p><p>国家贴着钱给你九年义务教育，补着款迎接你去高等学府，就想在作文里听你夸两句怎么了？过分吗？让你赞美个无私奉献夸耀个科技发达听一句积极向上要你的命吗？你就非给人找不痛快？你就非要大年三十送棺材，满月酒上做花圈？</p><p>平常懒得写随笔，模考字数凑不够，名著没翻过几本，拿起手机就忘了娘，掂起笔就石乐志，结果一到考场上你诗情画意全都来了，恨不得洋洋洒洒疾书去，一步三叹不回头？</p><p>你要真的是忧国忧民，文采斐然，就是能在八百字左右的篇幅里控诉出这黑暗的世界、不公的现实，让人读了悲从心起潸然泪下，老师看了齐声喝彩拍案叫绝，整个文学界为之震动……那你就不会再乎分数了，你都堪破红尘世俗，洞悉人心宇宙了，还纠结老师给不给你分干嘛？俗气！你追求的应该是"他年我若为青帝，报与桃花一处开"的豪迈或者"残躯徒留红尘里，此身不在五行中"的洒脱，不是吗？</p><p>你看我这篇负能量作文就很失败！字数超了一半多！友情给个20分吧。</p><p>核心观点就一句，你真要有把牛粪写成鲜花还让人忍不住给你浇水的本事，你写什么都没问题！可你要是故意刻奇，好高骛远，连普通的材料精神都领会不了，老老实实议论文弘扬正能量，难度低，分数高。</p><p>你想抨击现实讽刺人性？等你北大毕业了，有的是机会，不然只能跟我一样，在这网络平台上宣泄负能量，眼睛巴巴的盯着每一个没点赞的，仿佛七月十五穿红衣上吊的冤死鬼似的。</p><section style="margin-top:1em"><hr><ul style="margin-left:-1em"><li>作者: <a href="https://www.zhihu.com/question/272068457/answer/1302565494" target="_blank">红护</a></li><li>来源: <a href="https://www.zhihu.com/question/272068457/answer/1302565494" target="_blank">https://www.zhihu.com/question/272068457/answer/1302565494</a></li><li>本文仅用于本人学习和存档, 文章所有权归作者 <a href="https://www.zhihu.com/question/272068457/answer/1302565494" target="_blank">红护</a> 所有, 如有侵权请发送邮件至 <a href="mailto:me@alanwei.com?subject=删除侵权文章" target="_top">me#alanwei.com(<i>#换成@</i>)</a> 删除此文.</li></ul><hr></section>]]></content>
        <author>
            <name>红护</name>
            <uri>https://www.zhihu.com/people/tian-yuan-nan-quan-51</uri>
        </author>
        <category label="文章" term="文章"/>
        <category label="转摘" term="转摘"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Nginx 301重定向域名]]></title>
        <id>/2021/04/15/nginx-rewrite</id>
        <link href="https://blog.alanwei.com/blog/2021/04/15/nginx-rewrite"/>
        <updated>2021-04-15T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[设置Nginx 301重定向跳转]]></summary>
        <content type="html"><![CDATA[<p><a href="https://www.cnblogs.com/benio/archive/2010/08/16/1800584.html" target="_blank" rel="noopener noreferrer">原文 - Nginx 301重定向域名</a></p><p>下述配置会把<code>jefflei.com</code>域名的请求返回301跳转到<code>http://www.jefflei.com/</code></p><p>进行了301重定向，把<code>www .jefflei.com</code>和<code>jefflei.com</code>合并，并把之前的域名也一并合并. 有两种实现方法,第一种方法是判断nginx核心变量<code>host</code>(老版本是<code>http_host</code>)：</p><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name www.jefflei.com jefflei.com;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ($host != 'www.jefflei.com' ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rewrite ^/(.*)$ http://www.jefflei.com/$1 permanent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>第二种方法：</p><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name jefflei.com;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rewrite ^/(.*) http://www.jefflei.com/$1 permanent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>测试了第一种方法ok，这两种方法中， permanent是关键，详细说明见nginx重定向规则说明。</p><ul><li><code>last</code> – 基本上都用这个Flag。</li><li><code>break</code> – 中止Rewirte，不在继续匹配</li><li><code>redirect</code> – 返回临时重定向的HTTP状态302</li><li><code>permanent</code> – 返回永久重定向的HTTP状态301</li></ul>]]></content>
        <author>
            <name>郭振斌</name>
            <uri>https://www.cnblogs.com/benio/archive/2010/08/16/1800584.html</uri>
        </author>
        <category label="nginx" term="nginx"/>
        <category label="301" term="301"/>
        <category label="rewrite" term="rewrite"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[CentOS安装Nginx]]></title>
        <id>/2021/04/11/centos-install-nginx</id>
        <link href="https://blog.alanwei.com/blog/2021/04/11/centos-install-nginx"/>
        <updated>2021-04-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[CentOS安装Nginx]]></summary>
        <content type="html"><![CDATA[<p>以下是安装脚本: </p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># install dependency</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -y gcc  </span><span class="token comment" style="color:#999988;font-style:italic"># GNU compiler</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -y pcre pcre-devel  </span><span class="token comment" style="color:#999988;font-style:italic"># PCRE(Perl Compatible Regular Expression)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ubuntu system</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># apt-get install libpcre3 libpcre3-dev </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -y zlib zlib-devel  </span><span class="token comment" style="color:#999988;font-style:italic"># gzip compression library</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#ubuntu system</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># apt-get install zliblg zliblg-dev</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -y openssl openssl-devel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># download nginx </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> ~/downloads</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://launchpad.net/nginx/0.7/0.7.66/+download/nginx-0.7.66.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> xzvf nginx-0.7.66.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> nginx-0.7.66 </span><span class="token comment" style="color:#999988;font-style:italic"># change extracted directory </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># compile</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./configure --prefix</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/local/nginx-0.7.66 --with-cc-opt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">-Wno-error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">make</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> /usr/local/nginx-0.7.66/sbin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="centos" term="centos"/>
        <category label="linux" term="linux"/>
        <category label="nginx" term="nginx"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[创建Windows服务]]></title>
        <id>/2021/04/11/create-windows-service</id>
        <link href="https://blog.alanwei.com/blog/2021/04/11/create-windows-service"/>
        <updated>2021-04-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[创建Windows服务]]></summary>
        <content type="html"><![CDATA[<blockquote><p>参考 <a href="http://www.tacktech.com/display.cfm?ttid=197" target="_blank" rel="noopener noreferrer">Create your own user-defined services Windows NT/2000/XP/2003</a>, 和 <a href="https://www.iceflatline.com/2015/12/run-a-windows-application-as-a-service-with-srvany/" target="_blank" rel="noopener noreferrer">Run a Windows Application as a Service with srvany</a></p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="下载工具">下载工具<a class="hash-link" href="#下载工具" title="Direct link to heading">​</a></h2><p><a href="http://www.tacktech.com/display.cfm?ttid=197" target="_blank" rel="noopener noreferrer">srvany.zip</a>, 或者从<a title="https://gitee.com/alanway/resources/raw/master/files/create-windows-service/srvany.zip" href="https://gitee.com/alanway/resources/raw/master/files/create-windows-service/srvany.zip" target="_blank">[点此下载] <!-- -->本仓库下载</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建服务">创建服务<a class="hash-link" href="#创建服务" title="Direct link to heading">​</a></h2><p>使用管理员权限打开控制台, 假设服务名称为 <code>frpc</code>: </p><div class="language-dos codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dos codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">c:\srvany\instsrv.exe "frpc" c:\srvany\srvany.exe</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>instsrv.exe</code> 和 <code>srvany.exe</code> 一定要用绝对路径, 也就是 <code>c:\srvany\instsrv.exe</code>, 不能使用相对路径(比如<code>.\instsrv.exe</code>是不行的).</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="更改注册表">更改注册表<a class="hash-link" href="#更改注册表" title="Direct link to heading">​</a></h2><p>打开注册表, 定位到 <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services\frpc</code>, 然后新建一个名为 <code>Parameters</code> 的 Key( <em>Edit &gt; New &gt; Key</em>), 然后右击这个Key, 新建一个名为<code>Application</code>的 <strong>String Value</strong>, 双击这个Key, 值输入要执行的程序(比如: <code>"C:\frp_0.29.1_windows_amd64\frpc.exe" -c "C:\frp_0.29.1_windows_amd64\frpc.ini"</code>)</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="启动">启动<a class="hash-link" href="#启动" title="Direct link to heading">​</a></h2><div class="language-batch codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-batch codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sc start "frpc" REM 启动服务</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sc delete "frcp" REM 删除服务</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="设置windows启动自动登陆">设置Windows启动自动登陆:<a class="hash-link" href="#设置windows启动自动登陆" title="Direct link to heading">​</a></h2><p>运行输入 <code>Control Userpasswords2</code>, 在打开的窗口里选中要自动登陆的账号, 取消勾选用户登陆必须输入用户名和密码使用电脑, 然后点击保存输入账号的密码即可.</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="windows" term="windows"/>
        <category label="serivce" term="serivce"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[自定义Linux Bash终端提示符]]></title>
        <id>/2021/04/11/customize-bash-prompt</id>
        <link href="https://blog.alanwei.com/blog/2021/04/11/customize-bash-prompt"/>
        <updated>2021-04-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[自定义Linux Bash终端提示符]]></summary>
        <content type="html"><![CDATA[<p>Prompt is control via a special shell variable. You need to set <code>PS1</code>, <code>PS2</code>, <code>PS3</code> and <code>PS4</code> variable. If set, the value is executed as a command prior to issuing each primary prompt.</p><ul><li><code>PS1</code> – The value of this parameter is expanded (see PROMPTING below) and used as the primary prompt string. The default value is \s-\v\$ .</li><li><code>PS2</code> – The value of this parameter is expanded as with PS1 and used as the secondary prompt string. The default is &gt;</li><li><code>PS3</code> – The value of this parameter is used as the prompt for the select command</li><li><code>PS4</code> – The value of this parameter is expanded as with PS1 and the value is printed before each command bash displays during an execution trace. The first character of PS4 is replicated multiple times, as necessary, to indicate multiple levels of indirection. The default is <code>+</code></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-do-i-display-current-bash-shell-prompt-setting">How do I display current bash shell prompt setting?<a class="hash-link" href="#how-do-i-display-current-bash-shell-prompt-setting" title="Direct link to heading">​</a></h2><p>Simply use the echo command, enter:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token environment constant" style="color:#36acaa">$PS1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Sample output:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[\u@\h \W]\$</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-do-i-modify-or-change-the-prompt">How do I modify or change the prompt?<a class="hash-link" href="#how-do-i-modify-or-change-the-prompt" title="Direct link to heading">​</a></h3><p>Modifying the prompt is easy task. Just assign a new value to PS1 and hit enter key:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable environment constant" style="color:#36acaa">PS1</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"touch me : "</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Sample outputs:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">touch me : </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So when executing interactively, bash displays the primary prompt <code>PS1</code> when it is ready to read a command, and the secondary prompt <code>PS2</code> when it needs more input to complete a command. Bash allows these prompt strings to be customized by inserting a number of backslash-escaped special characters that are decoded as follows:</p><ul><li><code>\a</code> : an ASCII bell character (07)</li><li><code>\d</code> : the date in “Weekday Month Date” format (e.g., “Tue May 26”)</li><li><code>\D{format}</code> : the format is passed to strftime(3) and the result is inserted into the prompt string; an empty format results in a locale-specific time representation. The braces are required</li><li><code>\e</code> : an ASCII escape character (033)</li><li><code>\h</code> : the hostname up to the first ‘.’</li><li><code>\H</code> : the hostname</li><li><code>\j</code> : the number of jobs currently managed by the shell</li><li><code>\l</code> : the basename of the shellâ€™s terminal device name</li><li><code>\n</code> : newline</li><li><code>\r</code> : carriage return</li><li><code>\s</code> : the name of the shell, the basename of $0 (the portion following the final slash)</li><li><code>\t</code> : the current time in 24-hour HH:MM:SS format</li><li><code>\T</code> : the current time in 12-hour HH:MM:SS format</li><li><code>\@</code> : the current time in 12-hour am/pm format</li><li><code>\A</code> : the current time in 24-hour HH:MM format</li><li><code>\u</code> : the username of the current user</li><li><code>\v</code> : the version of bash (e.g., 2.00)</li><li><code>\V</code> : the release of bash, version + patch level (e.g., 2.00.0)</li><li><code>\w</code> : the current working directory, with $HOME abbreviated with a tilde</li><li><code>\W</code> : the basename of the current working directory, with $HOME abbreviated with a tilde</li><li><code>\!</code> : the history number of this command</li><li><code>\#</code> : the command number of this command</li><li><code>\$</code> : if the effective UID is 0, a #, otherwise a $</li><li><code>\nnn</code> : the character corresponding to the octal number nnn</li><li><code>\\</code> : a backslash</li><li><code>\[</code> : begin a sequence of non-printing characters, which could be used to embed a terminal control sequence into the prompt</li><li><code>\]</code> : end a sequence of non-printing characters</li></ul><p>Examples</p><p>Let us try to set the prompt so that it can display today’s date and hostname:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable environment constant" style="color:#36acaa">PS1</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"\d \h $ "</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Sample output:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Sat Jun 02 server $ </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now setup prompt to display date/time, hostname and the current working directory:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable environment constant" style="color:#36acaa">PS1</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"[\d </span><span class="token string entity" style="color:#36acaa">\t</span><span class="token string" style="color:#e3116c"> \u@\h:\w ] $ "</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Sample utputs:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[Sat Jun 02 14:24:12 vivek@server:~ ] $</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-do-i-add-colors-to-my-prompt">How do I add colors to my prompt?<a class="hash-link" href="#how-do-i-add-colors-to-my-prompt" title="Direct link to heading">​</a></h2><p>You can change the <a href="https://www.cyberciti.biz/faq/bash-shell-change-the-color-of-my-shell-prompt-under-linux-or-unix/" target="_blank" rel="noopener noreferrer">color of your shell prompt</a> to impress your friend or to make your own life quite easy while working at command prompt.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="putting-it-all-together">Putting it all together<a class="hash-link" href="#putting-it-all-together" title="Direct link to heading">​</a></h2><p>Let us say when you login as root/superuser, you want to get visual confirmation using red color prompt. To distinguish between superuser and normal user you use last character in the prompt, if it changes from $ to #, you have superuser privileges. So let us set your prompt color to RED when you login as root, otherwise display normal prompt.</p><p>Open <code>/etc/bashrc</code> (Redhat and friends) <code>/</code> or <code>/etc/bash.bashrc</code> (Debian/Ubuntu) or <code>/etc/bash.bashrc.local</code> (Suse and others) file and append following code:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">vi</span><span class="token plain"> /etc/bashrc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Append the code as follows</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># If id command returns zero, you got root access.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">id</span><span class="token variable" style="color:#36acaa"> -u</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"> -eq </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># you are root, set red colour prompt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token assign-left variable environment constant" style="color:#36acaa">PS1</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string entity" style="color:#36acaa">\\</span><span class="token string" style="color:#e3116c">[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable" style="color:#36acaa">tput setaf </span><span class="token string variable number" style="color:#36acaa">1</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string entity" style="color:#36acaa">\\</span><span class="token string" style="color:#e3116c">]</span><span class="token string entity" style="color:#36acaa">\\</span><span class="token string" style="color:#e3116c">u@</span><span class="token string entity" style="color:#36acaa">\\</span><span class="token string" style="color:#e3116c">h:</span><span class="token string entity" style="color:#36acaa">\\</span><span class="token string" style="color:#e3116c">w #</span><span class="token string entity" style="color:#36acaa">\\</span><span class="token string" style="color:#e3116c">[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable" style="color:#36acaa">tput sgr0</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string entity" style="color:#36acaa">\\</span><span class="token string" style="color:#e3116c">]"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># normal</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token assign-left variable environment constant" style="color:#36acaa">PS1</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"[</span><span class="token string entity" style="color:#36acaa">\\</span><span class="token string" style="color:#e3116c">u@</span><span class="token string entity" style="color:#36acaa">\\</span><span class="token string" style="color:#e3116c">h:</span><span class="token string entity" style="color:#36acaa">\\</span><span class="token string" style="color:#e3116c">w] $"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Close and save the file.</p><blockquote><p><a href="https://www.cyberciti.biz/tips/howto-linux-unix-bash-shell-setup-prompt.html" target="_blank" rel="noopener noreferrer">原文 - How To Customize Bash Prompt In Linux</a></p></blockquote>]]></content>
        <author>
            <name>网络</name>
            <uri>https://www.cyberciti.biz/tips/howto-linux-unix-bash-shell-setup-prompt.html</uri>
        </author>
        <category label="linux" term="linux"/>
        <category label="bash" term="bash"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[使用 Docker 部署 Sentry]]></title>
        <id>/2021/04/11/docker-sentry-deploy</id>
        <link href="https://blog.alanwei.com/blog/2021/04/11/docker-sentry-deploy"/>
        <updated>2021-04-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[使用 Docker 部署 Sentry]]></summary>
        <content type="html"><![CDATA[<p>参考 <a href="https://github.com/docker-library/docs/tree/master/sentry" target="_blank" rel="noopener noreferrer">Sentry Doc</a>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="初始化并设置账号密码">初始化并设置账号密码<a class="hash-link" href="#初始化并设置账号密码" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -d --name sentry-redis redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -d --name sentry-postgres -e </span><span class="token assign-left variable" style="color:#36acaa">POSTGRES_PASSWORD</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">secret -e </span><span class="token assign-left variable" style="color:#36acaa">POSTGRES_USER</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">sentry postgres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 可以执行以下命令获取key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># docker run --rm sentry config generate-secret-key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -it --rm -e </span><span class="token assign-left variable" style="color:#36acaa">SENTRY_SECRET_KEY</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'mg_wqo&amp;ziiaou_8#-=_3_d(8!y5o=8=_-d78qqytuie)xfkns5'</span><span class="token plain"> --link sentry-postgres:postgres --link sentry-redis:redis sentry upgrade</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="启动">启动<a class="hash-link" href="#启动" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 也可以使用 -P 随机分配端口号</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -d --name my-sentry -e </span><span class="token assign-left variable" style="color:#36acaa">SENTRY_SECRET_KEY</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'mg_wqo&amp;ziiaou_8#-=_3_d(8!y5o=8=_-d78qqytuie)xfkns5'</span><span class="token plain"> --link sentry-redis:redis --link sentry-postgres:postgres -p </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">:9000 sentry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -d --name sentry-cron -e </span><span class="token assign-left variable" style="color:#36acaa">SENTRY_SECRET_KEY</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'mg_wqo&amp;ziiaou_8#-=_3_d(8!y5o=8=_-d78qqytuie)xfkns5'</span><span class="token plain"> --link sentry-postgres:postgres --link sentry-redis:redis sentry run </span><span class="token function" style="color:#d73a49">cron</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -d --name sentry-worker-1 -e </span><span class="token assign-left variable" style="color:#36acaa">SENTRY_SECRET_KEY</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'mg_wqo&amp;ziiaou_8#-=_3_d(8!y5o=8=_-d78qqytuie)xfkns5'</span><span class="token plain"> --link sentry-postgres:postgres --link sentry-redis:redis sentry run worker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>现在就可以访问 <code>http://localhost:8080</code> 了.</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="docker" term="docker"/>
        <category label="sentry" term="sentry"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[How to Setup Reverse Proxy on IIS with URL-Rewrite]]></title>
        <id>/2021/04/11/iis-reverse-proxy-url-rewrite</id>
        <link href="https://blog.alanwei.com/blog/2021/04/11/iis-reverse-proxy-url-rewrite"/>
        <updated>2021-04-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[使用IIS的URL Rewrite设置反向代理]]></summary>
        <content type="html"><![CDATA[<p>Most of the system administrator is aware of the reverse proxy. It is a type of proxy server which fetches the resources from one or more computers on clients requests and send back to the client. In simple terms, it works as an intermediate server, which listens to clients query. Then requests to server bases of clients query and returns results to client sent by the server. This tutorial will help you to setup reverse proxy using IIS with URL rewrite and application request routing extension.</p><p>We can configure reverse proxy in IIS using URL Rewrite module. This is similar to the mod_rewrite module in Apache. Before starting work make sure you have installed and enabled URL Rewrite module in IIS server.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="what-is-url-rewrite-module">What is URL Rewrite Module?<a class="hash-link" href="#what-is-url-rewrite-module" title="Direct link to heading">​</a></h2><p>URL Rewrite Module is officially provided by IIS development tool to extend the functionality of IIS web server. It provides additional functionality to rewrite application URL. This helps to make clean and SEO friendly URLs.</p><p>You can visit below URL and download and install URL rewrite IIS extension:</p><a title="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS_ARR_requestRouter_amd64.msi" href="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS_ARR_requestRouter_amd64.msi" target="_blank">[点此下载] <!-- --> http://www.iis.net/downloads/microsoft/url-rewrite </a><p>You also need Application Request Routing extension to install on your system. Visit the following URL to download the extension and install on your system.</p><a title="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS_URL_Rewriter_rewrite_amd64_en-US.msi" href="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS_URL_Rewriter_rewrite_amd64_en-US.msi" target="_blank">[点此下载] <!-- --> https://www.iis.net/downloads/microsoft/application-request-routing </a><p>For more details, visit our other article here.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="set-up-reverse-proxy-using-iis">Set Up Reverse Proxy Using IIS<a class="hash-link" href="#set-up-reverse-proxy-using-iis" title="Direct link to heading">​</a></h2><p>Let’s start with the configuration of the reverse proxy. For this tutorial, I have created a dummy web application running on port 3000 using node.js. You can see the below screenshot of the web application.</p><img src="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/site-access-without-proxy.png" alt="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/site-access-without-proxy.png" referrerpolicy="no-referrer"><p>Now, open the IIS by typing “inetmgr” in run window. Select your website under sites in left side section. Now select “URL Rewrite” option.</p><img src="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/iis-url-rewrite.png" alt="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/iis-url-rewrite.png" referrerpolicy="no-referrer"><p>Now click on “Add Rule(s)…” in actions section on the right side. See below screenshot for this link.</p><img src="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/add-rule-iis-rewrite.png" alt="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/add-rule-iis-rewrite.png" referrerpolicy="no-referrer"><p>Now select Reverse Proxy under inbound and outbound section.</p><img src="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/select-reverse-proxy.png" alt="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/select-reverse-proxy.png" referrerpolicy="no-referrer"><p>The above option will open a window, Add the server name or IP address with port under inbound rules input box. This is the URL from where reverse proxy will server data on clients request.</p><img src="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/backend-server-url.png" alt="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/backend-server-url.png" referrerpolicy="no-referrer"><p>At this point, the reverse proxy setup has been done. Now access web site configured with IIS. You will see the backend application is accessible here. This is the reverse proxy in working.</p><img src="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/site-access-with-proxy.png" alt="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/site-access-with-proxy.png" referrerpolicy="no-referrer"><p>This is the reverse proxy in working.</p><blockquote><p><a href="https://tecadmin.net/set-up-reverse-proxy-using-iis/" target="_blank" rel="noopener noreferrer">原文</a></p></blockquote>]]></content>
        <author>
            <name>转摘</name>
            <uri>https://tecadmin.net/set-up-reverse-proxy-using-iis/</uri>
        </author>
        <category label="iis" term="iis"/>
        <category label="reverse proxy" term="reverse proxy"/>
        <category label="url rewrite" term="url rewrite"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[配置IIS反向代理教程]]></title>
        <id>/2021/04/11/iis-reverse-proxy</id>
        <link href="https://blog.alanwei.com/blog/2021/04/11/iis-reverse-proxy"/>
        <updated>2021-04-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[IIS配置反向代理]]></summary>
        <content type="html"><![CDATA[<p>假设将域名<code>www.helloworld.com</code>代理到本地的<code>8080</code>端口</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="准备工作">准备工作<a class="hash-link" href="#准备工作" title="Direct link to heading">​</a></h2><ul><li>安装IIS</li><li>安装 <a title="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS_ARR_requestRouter_amd64.msi" href="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS_ARR_requestRouter_amd64.msi" target="_blank">[点此下载] </a><a href="http://www.iis.net/downloads/microsoft/url-rewrite" target="_blank" rel="noopener noreferrer">www.iis.net/downloads/microsoft/url-rewrite</a></li><li>安装 <a title="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS_URL_Rewriter_rewrite_amd64_en-US.msi" href="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS_URL_Rewriter_rewrite_amd64_en-US.msi" target="_blank">[点此下载] </a><a href="http://www.iis.net/downloads/microsoft/application-request-routing" target="_blank" rel="noopener noreferrer">www.iis.net/downloads/microsoft/application-request-routing</a></li><li>在 <code>C:\Windows\System32\drivers\etc\hosts</code> 文件增加域名解析 <code>127.0.0.1 www.helloworld.com</code></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="设置">设置<a class="hash-link" href="#设置" title="Direct link to heading">​</a></h2><p>设置前: </p><img src="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS-Proxy-Tutorial-0.png" alt="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS-Proxy-Tutorial-0.png" referrerpolicy="no-referrer"><p>开启ARR代理:</p><img src="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS-Proxy-Tutorial-1.png" alt="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS-Proxy-Tutorial-1.png" referrerpolicy="no-referrer"><img src="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS-Proxy-Tutorial-2.png" alt="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS-Proxy-Tutorial-2.png" referrerpolicy="no-referrer"><img src="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS-Proxy-Tutorial-3.png" alt="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS-Proxy-Tutorial-3.png" referrerpolicy="no-referrer"><p>新建一个站点<code>helloworld</code>(站点名称随意), 并绑定域名<code>www.helloworld.com</code>:</p><img src="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS-Proxy-Tutorial-4.png" alt="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS-Proxy-Tutorial-4.png" referrerpolicy="no-referrer"><p>配置<code>helloworld</code>站点的URL Rewrite:</p><img src="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS-Proxy-Tutorial-5.png" alt="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS-Proxy-Tutorial-5.png" referrerpolicy="no-referrer"><img src="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS-Proxy-Tutorial-6.png" alt="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS-Proxy-Tutorial-6.png" referrerpolicy="no-referrer"><img src="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS-Proxy-Tutorial-7.png" alt="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS-Proxy-Tutorial-7.png" referrerpolicy="no-referrer"><img src="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS-Proxy-Tutorial-8.png" alt="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS-Proxy-Tutorial-8.png" referrerpolicy="no-referrer"><p>配置完成之后访问 <code>www.helloworld.com</code> 实际上访问的是IIS的站点<code>helloworld</code>, 然后IIS会将请求路由到<code>127.0.0.1:8080</code>, 看到的效果如下: </p><img src="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS-Proxy-Tutorial-9.png" alt="https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/IIS-Proxy-Tutorial-9.png" referrerpolicy="no-referrer">]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="iis" term="iis"/>
        <category label="reverse proxy" term="reverse proxy"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[查看当前机器的所有SSH连接]]></title>
        <id>/2021/04/11/linux-show-ssh-connection</id>
        <link href="https://blog.alanwei.com/blog/2021/04/11/linux-show-ssh-connection"/>
        <updated>2021-04-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[查看当前机器的所有SSH连接]]></summary>
        <content type="html"><![CDATA[<p><a href="https://www.golinuxcloud.com/list-check-active-ssh-connections-linux/" target="_blank" rel="noopener noreferrer">原文 - 6 commands to check and list active SSH connections in Linux</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="using-ss-command">Using <code>ss</code> command<a class="hash-link" href="#using-ss-command" title="Direct link to heading">​</a></h2><p><code>ss</code> is used to dump socket statistics. It allows showing information similar to netstat. It can display more TCP and state information than other tools. We will use grep function to only get the list of active SSH sessions on our local host</p><div class="language-tty codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tty codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@node3 ~]# ss | grep -i ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcp    ESTAB      0      0      10.0.2.32:ssh                  10.0.2.31:37802</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcp    ESTAB      0      64     10.0.2.32:ssh                  10.0.2.2:49966</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcp    ESTAB      0      0      10.0.2.32:ssh                  10.0.2.30:56088</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>From the above example we know that there are three hosts which are currently connected to our node3. We have active SSH connections from <em>10.0.2.31</em>, <em>10.0.2.30</em> and <em>10.0.2.2</em></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="using-last-command">Using <code>last</code> command<a class="hash-link" href="#using-last-command" title="Direct link to heading">​</a></h2><p><code>last</code> searches back through the file <code>/var/log/wtmp</code> (or the file designated by the <code>-f</code> flag) and displays a list of all users logged in (and out) since that file was created. Names of users and tty’s can be given, in which case last will show only those entries matching the arguments.</p><p>Using this command you can also get the information about the user using which the SSH connection was created between server and client. So below we know the connection from 10.0.2.31 is done using <code>deepak</code> user, while for other two hosts, <code>root</code> user was used for connecting to node3.</p><div class="language-tty codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tty codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@node3 ~]# last -a | grep -i still</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deepak   pts/1        Fri May 31 16:58   still logged in    10.0.2.31</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root     pts/2        Fri May 31 16:50   still logged in    10.0.2.30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root     pts/0        Fri May 31 09:17   still logged in    10.0.2.2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here I am grepping for a string “still” to get all the patterns with “still logged in“. So now we know we have three active SSH connections from <em>10.0.2.31</em>, <em>10.0.2.30</em> and <em>10.0.2.2</em></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="using-who-command">Using <code>who</code> command<a class="hash-link" href="#using-who-command" title="Direct link to heading">​</a></h2><p>who is used to show who is logged on on your Linux host. This tool can also give this information</p><div class="language-tty codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tty codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@node3 ~]# who</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root     pts/0        2019-05-31 09:17 (10.0.2.2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root     pts/1        2019-05-31 16:47 (10.0.2.31)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root     pts/2        2019-05-31 16:50 (10.0.2.30)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Using this command we also get similar information as from last command. Now you get the user details used for connecting to node3 from source host, also we have terminal information on which the session is still active.</p><p>We generally hear terminal as tty but here we see terminal is referenced as pts, but now:
What is the difference between tty and pts?
How to disable or enable individual tty terminal console in Linux?</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="using-w-command">Using <code>w</code> command<a class="hash-link" href="#using-w-command" title="Direct link to heading">​</a></h2><p><code>w</code> displays information about the users currently on the machine, and their processes. This gives more information than who and last command and also serves our purpose to get the list of active SSH connections. Additionally it also gives us the information of the running process on those sessions.</p><p>Using <code>w</code> command you will also get the idle time details, i.e. for how long the session is idle. If the SSH session is idle for long period then it is a security breach and it is recommended that such idle SSH session must be killed, you can configure your Linux host to automatically kill such idle SSH session.</p><div class="language-tty codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tty codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@node3 ~]# w</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 17:01:41 up  7:44,  3 users,  load average: 0.00, 0.01, 0.05</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root     pts/0    10.0.2.2         09:17    9:41   0.31s  0.00s less -s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deepak   pts/1    10.0.2.31        16:58    3:06   0.03s  0.03s -bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root     pts/2    10.0.2.30        16:50    5.00s  0.07s  0.02s w</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="using-netstat-command">Using <code>netstat</code> command<a class="hash-link" href="#using-netstat-command" title="Direct link to heading">​</a></h2><p>Similar to ss we have netstat command to show active ssh sessions. Actually we can also say that ss is the new version of netstat. Here we can see all the ESTABLISHED SSH sessions from remote hosts to our localhost node3. it is also possible that one or some of these active ssh connections are in hung state so you can configure your host to automatically disconnect or kill these hung or unresponsive ssh sessions in Linux.</p><div class="language-tty codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tty codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@node3 ~]# netstat -tnpa | grep 'ESTABLISHED.*sshd'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcp        0      0 10.0.2.32:22            10.0.2.31:37806         ESTABLISHED 10295/sshd: deepak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcp        0      0 10.0.2.32:22            10.0.2.2:49966          ESTABLISHED 4329/sshd: root@pts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcp        0      0 10.0.2.32:22            10.0.2.30:56088         ESTABLISHED 10125/sshd: root@pt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ALSO READ:</p><p><a href="https://www.golinuxcloud.com/disconnect-idle-ssh-session-tcpkeepaliv-linux/" target="_blank" rel="noopener noreferrer">How to disconnect idle ssh session or keep idle ssh session active in Linux</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="using-ps-command">Using <code>ps</code> command<a class="hash-link" href="#using-ps-command" title="Direct link to heading">​</a></h2><p>Now to show active ssh sessions, ps command may not give you accurate results like other commands we discussed in this article but it can give you some more additional information i.e. PID of the SSHD process which are currently active and connected.</p><div class="language-tty codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tty codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ps auxwww | grep sshd: | grep -v grep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root      4329  0.0  0.1 154648  5512 ?        Ss   09:17   0:00 sshd: root@pts/0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root     10125  0.0  0.1 154648  5532 ?        Ss   16:50   0:00 sshd: root@pts/2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root     10295  0.0  0.1 154648  5480 ?        Ss   16:58   0:00 sshd: deepak [priv]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deepak   10301  0.0  0.0 156732  2964 ?        S    16:58   0:00 sshd: deepak@pts/1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="check-ssh-connection-history">Check ssh connection history<a class="hash-link" href="#check-ssh-connection-history" title="Direct link to heading">​</a></h2><p>To get the ssh connection history you can always check your SSHD logs for more information on connected or disconnected SSH session. Now the sshd log file may vary from distribution to distribution. On my RHEL 7.4 my sshd logs are stored inside <code>/var/log/sshd</code></p><p>Lastly I hope the steps from the article to check active SSH connections and ssh connection history in Linux was helpful. So, let me know your suggestions and feedback using the comment section.</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="linux" term="linux"/>
        <category label="ssh" term="ssh"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[使用 Node.js 执行命令行程序]]></title>
        <id>/2021/04/11/node-exec-bash-cmd</id>
        <link href="https://blog.alanwei.com/blog/2021/04/11/node-exec-bash-cmd"/>
        <updated>2021-04-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[使用 Node.js 执行命令行程序]]></summary>
        <content type="html"><![CDATA[<p><a href="https://stackoverflow.com/questions/20643470/execute-a-command-line-binary-with-node-js" target="_blank" rel="noopener noreferrer">原文 - Execute a command line binary with Node.js</a></p><p>For even newer version of Node.js (v8.1.4), the events and calls are similar or identical to older versions, but it's encouraged to use the standard newer language features. Examples:</p><p>For buffered, non-stream formatted output (you get it all at once), use <code>child_process.exec</code>:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> exec </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'child_process'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">exec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'cat *.js bad_file | wc -l'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">err</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> stdout</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> stderr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// node couldn't execute the command</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// the *entire* stdout and stderr (buffered)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">stdout: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">stdout</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">stderr: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">stderr</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can also use it with Promises:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> util </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'util'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> exec </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> util</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">promisify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'child_process'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ls</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> stdout</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stderr </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">exec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'ls'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'stdout:'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stdout</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'stderr:'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stderr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ls</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you wish to receive the data gradually in chunks (output as a stream), use child_process.spawn:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> spawn </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'child_process'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> child </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">spawn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'ls'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'-lh'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'/usr'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// use child.stdout.setEncoding('utf8'); if you want text chunks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">child</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">stdout</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'data'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">chunk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// data from standard output is here as buffers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// since these are streams, you can pipe them elsewhere</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">child</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">stderr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">child</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'close'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">code</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">child process exited with code </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">code</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Both of these functions have a synchronous counterpart. An example for <code>child_process.execSync</code>:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> execSync </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'child_process'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// stderr is sent to stderr of parent process</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// you can set options.stdio if you want it to go elsewhere</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> stdout </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">execSync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'ls'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As well as <code>child_process.spawnSync</code>:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> spawnSync</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'child_process'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> child </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">spawnSync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'ls'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'-lh'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'/usr'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'error'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> child</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'stdout '</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> child</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">stdout</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'stderr '</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> child</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">stderr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note: The following code is still functional, but is primarily targeted at users of ES5 and before.</p><p>The module for spawning child processes with Node.js is well documented in the documentation (v5.0.0). To execute a command and fetch its complete output as a buffer, use child_process.exec:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> exec </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'child_process'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exec</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> cmd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'prince -v builds/pdf/book.html -o builds/pdf/book.pdf'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">exec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cmd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">error</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> stdout</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> stderr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// command output is in stdout</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">If</span><span class="token plain"> you need to use handle process </span><span class="token constant" style="color:#36acaa">I</span><span class="token operator" style="color:#393A34">/</span><span class="token constant" style="color:#36acaa">O</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> streams</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> such </span><span class="token keyword module" style="color:#00009f">as</span><span class="token plain"> when you are expecting large amounts </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> output</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> use child_process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">spawn</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> spawn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'child_process'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">spawn</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> child </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">spawn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'prince'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">'-v'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'builds/pdf/book.html'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">'-o'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'builds/pdf/book.pdf'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">child</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">stdout</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'data'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">chunk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// output will be here in chunks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// or if you want to send output elsewhere</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">child</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">stdout</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you are executing a file rather than a command, you might want to use <code>child_process.execFile</code>, which parameters which are almost identical to spawn, but has a fourth callback parameter like exec for retrieving output buffers. That might look a bit like this:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> execFile </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'child_process'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">execFile</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">execFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> args</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">error</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> stdout</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> stderr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// command output is in stdout</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As of v0.11.12, Node now supports synchronous spawn and exec. All of the methods described above are asynchronous, and have a synchronous counterpart. Documentation for them can be found here. While they are useful for scripting, do note that unlike the methods used to spawn child processes asynchronously, the synchronous methods do not return an instance of ChildProcess.</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="node.js" term="node.js"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Spring Boot Maven 插件使用]]></title>
        <id>/2021/04/11/spring-boot-maven-plugin</id>
        <link href="https://blog.alanwei.com/blog/2021/04/11/spring-boot-maven-plugin"/>
        <updated>2021-04-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Spring Boot Maven 插件使用]]></summary>
        <content type="html"><![CDATA[<p><a href="https://docs.spring.io/spring-boot/docs/2.2.0.BUILD-SNAPSHOT/maven-plugin/usage.html" target="_blank" rel="noopener noreferrer">Spring Boot Maven 插件</a>提供了 Maven 对 Spring Boot 的支持, 让你能打包成jar或者war包，以及原地运行应用。使用该插件需要Maven版本大于等于3.2。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="pomxml文件添加插件">pom.xml文件添加插件<a class="hash-link" href="#pomxml文件添加插件" title="Direct link to heading">​</a></h2><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">pom.xml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token prolog" style="color:#999988;font-style:italic">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">project</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">xmlns</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://maven.apache.org/POM/4.0.0</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xmlns:</span><span class="token tag attr-name" style="color:#00a4db">xsi</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://www.w3.org/2001/XMLSchema-instance</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xsi:</span><span class="token tag attr-name" style="color:#00a4db">schemaLocation</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">modelVersion</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">4.0.0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">modelVersion</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- ... --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">build</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugins</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">spring-boot-maven-plugin</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">2.2.0.BUILD-SNAPSHOT</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">executions</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">execution</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">goals</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">goal</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">repackage</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">goal</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">goals</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">execution</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">executions</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugins</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">build</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">project</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用 <a href="https://start.spring.io/" target="_blank" rel="noopener noreferrer">Spring Initializer</a> 创建的应用默认添加到了spring boot项目。</p><p>添加插件后，可以使用以下命令生成<code>jar</code>包:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mvn package</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> target/*.jar </span><span class="token comment" style="color:#999988;font-style:italic"># 生成后的jar包位于项目的target目录</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们也可以通过指定Maven goal <code>repackage</code> 来生成<code>jar</code>包:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mvn package spring-boot:repackage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> target/*.jar </span><span class="token comment" style="color:#999988;font-style:italic"># 生成后的jar包位于项目的target目录</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="打包可执行的jar或war文件">打包可执行的Jar或War文件<a class="hash-link" href="#打包可执行的jar或war文件" title="Direct link to heading">​</a></h2><p>一旦 <code>spring-boot-maven-plugin</code> 被添加到 <code>pom.xml</code>，就可以使用goal <code>spring-boot:repackage</code> 生成可执行文件。可以通过<code>pom.xml</code>文件的<code>packaging</code>配置节告诉插件生成的是<code>jar</code>包还是<code>war</code>包.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="生成后的jar包">生成后的jar包<a class="hash-link" href="#生成后的jar包" title="Direct link to heading">​</a></h3><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">pom.xml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token prolog" style="color:#999988;font-style:italic">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">project</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">xmlns</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://maven.apache.org/POM/4.0.0</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xmlns:</span><span class="token tag attr-name" style="color:#00a4db">xsi</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://www.w3.org/2001/XMLSchema-instance</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xsi:</span><span class="token tag attr-name" style="color:#00a4db">schemaLocation</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- ... --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">jar</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- ... --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">project</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="生成war包">生成war包<a class="hash-link" href="#生成war包" title="Direct link to heading">​</a></h3><p>生成一个可执行和部署的war不到外部容器(意思war包需要部署在tomcat这种容器下)，需要把内嵌的容器依赖的scope改成 <em>provided</em>：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">pom.xml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token prolog" style="color:#999988;font-style:italic">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">project</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">xmlns</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://maven.apache.org/POM/4.0.0</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xmlns:</span><span class="token tag attr-name" style="color:#00a4db">xsi</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://www.w3.org/2001/XMLSchema-instance</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xsi:</span><span class="token tag attr-name" style="color:#00a4db">schemaLocation</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- ... --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">war</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- ... --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependencies</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">spring-boot-starter-tomcat</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">provided</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 改成provided之后，tomcat 就不会打包进war文件  --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- ... --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependencies</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">project</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更多war文件部署参考<a href="http://www.javaguides.net/2018/09/spring-boot-deploy-war-file-to-external-tomcat.html" target="_blank" rel="noopener noreferrer">Spring Boot 2 Deploy WAR file to External Tomcat</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="spring-boot-maven插件更多信息">Spring Boot Maven插件更多信息<a class="hash-link" href="#spring-boot-maven插件更多信息" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="maven-gobals-概览">Maven gobals 概览<a class="hash-link" href="#maven-gobals-概览" title="Direct link to heading">​</a></h3><p>Spring boot 插件提供了以下goal:</p><ul><li><strong>spring-boot:run</strong> 运行Spring boot应用</li><li><strong>spring-boot:repackage</strong> 把应用打包成可执行的 jar/war 文件</li><li><strong>spring-boot:start</strong> 和 <strong>spring-boot:stop</strong> 管理Spring boot应用生命周期 (比如 集成测试).</li><li><strong>spring-boot:build-info</strong> 生成可被Actuator使用的构建信息</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用">使用<a class="hash-link" href="#使用" title="Direct link to heading">​</a></h3><p>比如 <code>mvn spring-boot:run</code> 运行Spring Boot应用。</p><p>更多信息参考<a href="https://docs.spring.io/spring-boot/docs/current/maven-plugin/usage.html" target="_blank" rel="noopener noreferrer">https://docs.spring.io/spring-boot/docs/current/maven-plugin/usage.html</a></p><p><a href="https://www.javaguides.net/2019/02/use-of-spring-boot-maven-plugin-with.html" target="_blank" rel="noopener noreferrer">原文 - Use of Spring Boot Maven Plugin with Example</a></p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="maven" term="maven"/>
        <category label="spring" term="spring"/>
        <category label="spring boot" term="spring boot"/>
        <category label="maven plugin" term="maven plugin"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Windows 上的TCP代理设置]]></title>
        <id>/2021/04/11/tcp-proxy-in-windows</id>
        <link href="https://blog.alanwei.com/blog/2021/04/11/tcp-proxy-in-windows"/>
        <updated>2021-04-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[目前我们出现一个需求是将外网来的TCP请求代理到内网的某个服务器上, 比如我们的 Windows 上需要部署一个 RabbitMQ 推送服务, 但因为某些原因我们无法使用 Windows 版本的 RabbitMQ, 想将 RabbitMQ 部署在Linux服务器上, 确实有很多其他方式来满足这个需求, 比如再加一个服务器, 然后分配一个公网IP, 最后我们选择在 Windows 服务器上安装 VMware 然后虚拟一个Ubuntu系统. 现在需要将外网的 RabbitMQ 请求映射到 Ubuntu 上, 大概请求途径如下:]]></summary>
        <content type="html"><![CDATA[<p>目前我们出现一个需求是将外网来的TCP请求代理到内网的某个服务器上, 比如我们的 Windows 上需要部署一个 RabbitMQ 推送服务, 但因为某些原因我们无法使用 Windows 版本的 RabbitMQ, 想将 RabbitMQ 部署在Linux服务器上, 确实有很多其他方式来满足这个需求, 比如再加一个服务器, 然后分配一个公网IP, 最后我们选择在 Windows 服务器上安装 VMware 然后虚拟一个Ubuntu系统. 现在需要将外网的 RabbitMQ 请求映射到 Ubuntu 上, 大概请求途径如下:</p><p>Client(120.80.123.226) -&gt; Windows(Public IP: 204.79.197.200, VMWare NAT IP: 192.168.60.1) -&gt; Ubuntu(VMware NAT IP: 192.168.60.128)</p><p>(RabbitMQ默认使用的端口号是5672)</p><p>现在当 Client 请求 204.79.197.200:5672 订阅消息时, Windows 服务器需要将 120.80.123.226:xxxxx 请求映射到 Ubuntu 的 192.168.60.128:5672 上, 对于这个需求可以使用 powershell 的 <code>netsh interface portproxy</code> 命令来完成 TCP Proxy.</p><p><a href="http://serverfault.com/questions/17990/easy-tcp-proxy-on-windows" target="_blank" rel="noopener noreferrer">只需设置如下</a> :</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">netsh interface portproxy add v4tov4 listenport=5672 listenaddress=201.79.167.200 connectaddress=192.168.60.128 connectport=5672 protocol=tcp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>具体参数参见<a href="https://technet.microsoft.com/en-us/library/cc776297(v=ws.10).aspx" target="_blank" rel="noopener noreferrer">MSDN</a>, 大意是监听对于 tcp://204.79.197.200:5672 的TCP请求, 然后代理到 tcp://192.168.60.128:5672 上.
RabbitMQ还用到了其他端口号, 需要依次添加.</p><p>我第一次在测试服务器上测试通过了, 后来部署到正式环境怎么测试都不通过. 周五折腾了一天, 把赛门铁克都卸载了, 突然周一上班明白了.</p><p>测试服务器是一个独立的服务器, 只绑定了一个公网IP地址, 没有局域网IP地址, 所以上述设置是生效的. 而正式服务器被部署在一个局域网中了, 不仅配置了公网IP还有一个局域网IP(假设IP是192.168.1.50, 网关时192.168.1.1), 这就导致上述的配置无法生效, 因为192.168.1.50那台Windows服务器压根就监听不到公网IP(204...), 正式环境的TCP请求大概如下:</p><p>Client(120.80.123.226) -&gt; Gateway(Public IP: 204.79.179.200, Private IP: 192.168.1.1) -&gt; Windows(Public IP: 204.79.197.200, Private IP: 192.168.1.50, VMWare NAT IP: 192.168.60.1) -&gt; Ubuntu(VMware NAT IP: 192.168.60.128)</p><p>虽然当时正式服务器的Gateway将 204.79.179.200 的请求都传递给了 192.168.1.50, 可是 192.168.1.50 接收到数据包上的请求IP地址是 192.168.1.1 , 并不是 204.79.179.200, 所以正式的Windows服务器需要使用如下命令来设置:</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">netsh interface portproxy add v4tov4 listenport=5672 listenaddress=192.168.1.50 connectaddress=192.168.60.128 connectport=5672 protocol=tcp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这是我们当时的正式环境的网络设置情况. 你需要搞清楚服务器的网络位置和情况, 然后才能设置正确的 listenaddress(TCP请求的IP地址) 和 listenport(TCP请求的端口号).</p><p>另外 <code>netsh interface protproxy</code> 目前只支持tcp协议, 所以<code>protocol=tcp</code>这个参数可以省略.</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="windows" term="windows"/>
        <category label="tcp" term="tcp"/>
        <category label="powershell" term="powershell"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Ubuntu 系统安装根证书]]></title>
        <id>/2021/04/11/ubuntu-install-root-ca-certificate</id>
        <link href="https://blog.alanwei.com/blog/2021/04/11/ubuntu-install-root-ca-certificate"/>
        <updated>2021-04-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Ubuntu 系统安装根证书]]></summary>
        <content type="html"><![CDATA[<p>原文来自: <a href="https://www.sonicwall.com/support/knowledge-base/how-to-add-dpi-ssl-ca-certificate-on-ubuntu-os/171225202320465/" target="_blank" rel="noopener noreferrer">How To Add DPI-SSL CA Certificate On Ubuntu OS?</a></p><ol><li>下载证书到本地, 如果证书是 <code>.cer</code> 格式, 可以使用以下命令转成 <code>.crt</code> 格式: </li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ openssl x509 –inform DER -in rootCA.cer –out rootCA.crt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>在目录<code>/usr/share/ca-certificates</code>下创建任意名称子目录(比如这里使用<code>extra</code>):</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /usr/share/ca-certificates/extra</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>拷贝文件到 <code>/usr/share/ca-certificates/extra</code> 和 <code>/usr/share/ca-certificate/mozilla</code></li><li>使用命令<code>dpkg-reconfigure ca-certificates</code>, 重新配置证书:<ul><li>选择 <code>Yes</code></li><li>按空格选中刚才新增的证书: <code>extra/rootCA.crt</code> 和 <code>mozilla/rootCA.crt</code></li><li>按 <em>Tab</em> 切到 <code>Ok</code>并确认</li></ul></li><li>执行命令 <code>update-ca-certificates</code> 更新CA证书</li><li>检查文件 <code>/etc/ca-certificates.conf</code>, 确保刚才新增的两条记录前没有<code>!</code>符号</li><li>Firefox / Chrome 在Ubuntu系统上有自己的证书数据库, 需要手动更新两个浏览器里的证书</li><li>打开Chrome浏览器, 访问 <code>chrome://settings/certificates</code>, 切换到 <code>Authorities</code>, 然后选择 <strong>Import</strong> 导入 <code>rootCA.crt</code> 文件, 重启浏览器即可</li><li>打开Firefox浏览器, 搜索 <code>Certificate</code>, 点击 <strong>View Certificate</strong>, 切换到 <code>Authorities</code>, 点击 <strong>Import</strong></li></ol><p>或者使用以下命令更新Chrome证书数据库:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">certutil –d sql:</span><span class="token environment constant" style="color:#36acaa">$HOME</span><span class="token plain">/.pki/nssdb –A –t </span><span class="token string" style="color:#e3116c">"C,,"</span><span class="token plain"> –n </span><span class="token string" style="color:#e3116c">"Description Name"</span><span class="token plain"> -i /usr/share/ca-certificates/extra/rootCA.crt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>验证证书被添加到Chrome证书数据库:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ certutil -L -d sql:</span><span class="token variable" style="color:#36acaa">${</span><span class="token variable environment constant" style="color:#36acaa">HOME</span><span class="token variable" style="color:#36acaa">}</span><span class="token plain">/.pki/nssdb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后重启Chrome浏览器, 访问 <code>chrome://settings/certificates</code> , 切换到 <code>Authorities</code> Tab即可看到新增的证书.</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="linux" term="linux"/>
        <category label="ubuntu" term="ubuntu"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[我的Ubuntu新系统安装脚本]]></title>
        <id>/2021/04/11/ubuntu-starter-scripts</id>
        <link href="https://blog.alanwei.com/blog/2021/04/11/ubuntu-starter-scripts"/>
        <updated>2021-04-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[每次安装Ubuntu系统都要做一些初始化工作(比如安装一些工具软件), 现将我的记录如下, 方便下次使用:]]></summary>
        <content type="html"><![CDATA[<p>每次安装Ubuntu系统都要做一些初始化工作(比如安装一些工具软件), 现将我的记录如下, 方便下次使用:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> update </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># cd /etc/apt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># git init</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># chown -R alan .git/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> build-essential -y </span><span class="token comment" style="color:#999988;font-style:italic"># dev tools</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> gcc -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> net-tools -y </span><span class="token comment" style="color:#999988;font-style:italic"># ifconfig 工具</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> flameshot -y </span><span class="token comment" style="color:#999988;font-style:italic"># 截图工具</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> -y </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> ffmpeg -y </span><span class="token comment" style="color:#999988;font-style:italic"># 视频处理类库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> scrot -y </span><span class="token comment" style="color:#999988;font-style:italic"># 命令行截图工具</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> simplescreenrecorder -y </span><span class="token comment" style="color:#999988;font-style:italic"># 录屏工具</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> network-manager-l2tp-gnome -y </span><span class="token comment" style="color:#999988;font-style:italic"># VPN工具</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> vlc -y </span><span class="token comment" style="color:#999988;font-style:italic"># 媒体播放工具</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># config git</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> config --global core.editor </span><span class="token string" style="color:#e3116c">"vim"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> config --global credential.helper </span><span class="token string" style="color:#e3116c">"cache --timeout 360000"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># install remmina</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apt-add-repository ppa:remmina-ppa-team/remmina-next</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> remmina remmina-plugin-rdp remmina-plugin-secret remmina-plugin-spice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">killall</span><span class="token plain"> remmina</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># install official docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> apt-transport-https ca-certificates </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> gnupg-agent software-properties-common -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -fsSL https://download.docker.com/linux/ubuntu/gpg </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> apt-key </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> - </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add-apt-repository </span><span class="token string" style="color:#e3116c">"deb [arch=amd64] https://download.docker.com/linux/ubuntu </span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable" style="color:#36acaa">lsb_release -cs</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c"> stable"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> docker-ce docker-ce-cli containerd.io -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># install docker by aliyun mirror</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> -y </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> apt-transport-https ca-certificates </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> software-properties-common</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># step 2: 安装GPG证书</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -fsSL https://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> apt-key </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Step 3: 写入软件源信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add-apt-repository </span><span class="token string" style="color:#e3116c">"deb [arch=amd64] https://mirrors.aliyun.com/docker-ce/linux/ubuntu </span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable" style="color:#36acaa">lsb_release -cs</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c"> stable"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Step 4: 更新并安装Docker-CE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> -y update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> -y </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> docker-ce</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 安装 Chrome/Chromium</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">snap </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> chromium</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> dpkg -i ./google-chrome-stable_current_amd64.deb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 开启 SSH </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> openssh-server -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl start </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ufw allow </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 安装 VPNC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> vpnc network-manager-vpnc-gnome</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="dock-图标居中">Dock 图标居中<a class="hash-link" href="#dock-图标居中" title="Direct link to heading">​</a></h2><p>原文 <a href="https://linuxconfig.org/how-to-customize-dock-panel-on-ubuntu-20-04-focal-fossa-linux" target="_blank" rel="noopener noreferrer">How to customize dock panel on Ubuntu 20.04 Focal Fossa Linux</a></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> dconf-editor -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>打开 <strong>dconf-Editor</strong>, 定位到 <code>org &gt; gnome &gt; shell &gt; extensions &gt; dash-to-dock</code>, 修改以下配置:</p><p><a href="https://linuxconfig.org/wp-content/uploads/2020/03/04-how-to-customize-dock-panel-on-Ubuntu-2004-Focal-Fossa-Linux.png" target="_blank" rel="noopener noreferrer">04</a></p><p>或者使用命令行修改配置:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gsettings </span><span class="token builtin class-name">set</span><span class="token plain"> org.gnome.shell.extensions.dash-to-dock extend-height </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 我在 Ubuntu 20.04 上测试, 只修改这一个配置即可, 这个值默认是 true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gsettings </span><span class="token builtin class-name">set</span><span class="token plain"> org.gnome.shell.extensions.dash-to-dock dock-position BOTTOM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gsettings </span><span class="token builtin class-name">set</span><span class="token plain"> org.gnome.shell.extensions.dash-to-dock transparency-mode FIXED</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gsettings </span><span class="token builtin class-name">set</span><span class="token plain"> org.gnome.shell.extensions.dash-to-dock dash-max-icon-size </span><span class="token number" style="color:#36acaa">64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gsettings </span><span class="token builtin class-name">set</span><span class="token plain"> org.gnome.shell.extensions.dash-to-dock unity-backlit-items </span><span class="token boolean" style="color:#36acaa">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="ubuntu" term="ubuntu"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[为什么 Math.Round(2.5) 返回 2]]></title>
        <id>/2021/04/11/why-math-round-return-2-instead-3</id>
        <link href="https://blog.alanwei.com/blog/2021/04/11/why-math-round-return-2-instead-3"/>
        <updated>2021-04-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[为什么 Math.Round(2.5) 返回 2]]></summary>
        <content type="html"><![CDATA[<p><a href="https://stackoverflow.com/questions/977796/why-does-math-round2-5-return-2-instead-of-3" target="_blank" rel="noopener noreferrer">原文 - Why does Math.Round(2.5) return 2 instead of 3?</a></p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">double dbl1 = Math.Round(1.5); // dbl1 == 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">double dbl2 = Math.Round(2.5); // dbl2 == 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">double dbl3 = Math.Round(2.5, 0, MidpointRounding.AwayFromZero); // dbl3 == 3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="csharp" term="csharp"/>
        <category label="c#" term="c#"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[制作Windows启动盘]]></title>
        <id>/2021/04/11/windows-bootable-device</id>
        <link href="https://blog.alanwei.com/blog/2021/04/11/windows-bootable-device"/>
        <updated>2021-04-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[制作Windows启动盘, 来源Dell]]></summary>
        <content type="html"><![CDATA[<p>制作Windows启动盘, 来源<a href="http://zh.community.dell.com/techcenter/b/weblog/archive/2011/09/05/usb-key-windows-7-installation" target="_blank" rel="noopener noreferrer">Dell</a></p><p>使用管理员权限打开DOS窗口, 输入以下命令: </p><div class="language-bat codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bat codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\&gt;diskpart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DISKPART&gt; list disk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM 如果你的机器只有一块硬盘, 那么U盘应该显示为Disk 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM 选择U盘为当前磁盘, 请确定一定要选对U盘所对应的磁盘编号. 如果选错了磁盘来清除, 下面的命令可是HOLD不住的哦.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DISKPART&gt; select disk 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM 清空磁盘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DISKPART&gt; clean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM 创建主分区</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DISKPART&gt; create partition primary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM 选择分区</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DISKPART&gt; select partition 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM 激活分区(一定要做, 不然不能启动)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DISKPART&gt; active</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM 快速格式化为NTFS文件系统, 当然选择成FAT32也是可以的.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DISKPART&gt; format fs=ntfs quick</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM 指定卷,，这个命令是可选的.［］里面包含盘符，不能与现存盘符重复，也可不加参数使用默认。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DISKPART&gt; assign letter=[ ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM 退出Diskpart命令模式。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DISKPART&gt; exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="windows" term="windows"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Node.js require 缓存]]></title>
        <id>/2021/04/10/node-require-cache</id>
        <link href="https://blog.alanwei.com/blog/2021/04/10/node-require-cache"/>
        <updated>2021-04-10T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[在Node环境, 使用require多次加载模块时, 返回的都是同一个对象, 通过require.cache可以迭代查看所有require缓存的对象.]]></summary>
        <content type="html"><![CDATA[<p>在Node环境, 使用<code>require</code>多次加载模块时, 返回的都是同一个对象, 通过<code>require.cache</code>可以迭代查看所有require缓存的对象.</p><p>当你<code>require("module.js")</code>之后, 即便<code>module.js</code>文件发生了变化, 再次执行<code>require("module.js")</code>依然返回第一次<code>require</code>时的对象, 如果想要每次<code>require</code>都是<code>module.js</code>最新的对象, 可以把从<code>require.cache</code>中把<code>module.js</code>引用删除掉, 需要注意的是 <code>require.cache</code> 对象是个类似map的对象, key是<code>module.js</code>对于的绝对路径:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"path"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">requireAgain</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter literal-property property" style="color:#36acaa">absolutePath</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> absolutePath </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"string"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">delete</span><span class="token plain"> require</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cache</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">absolutePath</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">absolutePath</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">requireAgain</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"module.js"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 注意这里要使用 path.resolve 拿到 module.js 的绝对路径</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>相关介绍 <a href="https://stackoverflow.com/questions/23685930/clearing-require-cache" target="_blank" rel="noopener noreferrer">Clearing require cache</a></p></blockquote>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="node.js" term="node.js"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[ASP.Net 应用配置HTTP代理]]></title>
        <id>/2021/04/03/asp.net-proxy-configuration</id>
        <link href="https://blog.alanwei.com/blog/2021/04/03/asp.net-proxy-configuration"/>
        <updated>2021-04-03T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[.Net Framework ASP.Net 应用配置HTTP代理 proxy configuration]]></summary>
        <content type="html"><![CDATA[<p>在 <code>web.config</code> 文件新增以下配置, 即可设置代理(假设代理服务地址为 <code>http://localhost:3210</code>):</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">system.net</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">defaultProxy</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">proxy</span><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">proxyaddress</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://localhost:3210</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">                </span><span class="token tag attr-name" style="color:#00a4db">bypassonlocal</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">True</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">        </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">bypasslist</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">add</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">address</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">[a-z]+\.blueyonderairlines\.com$</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">bypasslist</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">defaultProxy</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">system.net</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>配置节:</p><ul><li><code>proxyaddress</code> 代理服务地址</li><li><code>bypassonlocal</code> 用于配置本地地址请求是否被代理服务忽略, <code>True</code> 表示本地地址的请求不走代理服务</li><li><code>bypasslist</code> 忽略的地址列表, 使用正则表达式描述</li></ul><blockquote><p><a href="https://docs.microsoft.com/en-us/dotnet/framework/network-programming/proxy-configuration" target="_blank" rel="noopener noreferrer">引用 Proxy Configuration</a></p></blockquote>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="asp.net" term="asp.net"/>
        <category label="web.config" term="web.config"/>
        <category label="proxy" term="proxy"/>
        <category label=".net framework" term=".net framework"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[如何使用命令行创建带有多个子模块的Maven项目]]></title>
        <id>/2021/04/03/how-to-create-maven-multi-module-project</id>
        <link href="https://blog.alanwei.com/blog/2021/04/03/how-to-create-maven-multi-module-project"/>
        <updated>2021-04-03T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[In this guide, we learn how to create Maven Multi-Module using Command Line with very easy steps. A multi-module project is defined by a parent POM referencing one or more sub-modules. In this example, we will create a blogger web application with different modules. Let's create a blogger as parent project and it's 3 sub-modules are blogger-core, blogger-common, blogger-web.]]></summary>
        <content type="html"><![CDATA[<p>In this guide, we learn how to create Maven Multi-Module using Command Line with very easy steps. A multi-module project is defined by a parent POM referencing one or more sub-modules. In this example, we will create a blogger web application with different modules. Let's create a blogger as parent project and it's 3 sub-modules are blogger-core, blogger-common, blogger-web.</p><p>Real-world examples of maven multi-module projects are:</p><ol><li><a href="https://github.com/RameshMF/junit-developer-guide" target="_blank" rel="noopener noreferrer">https://github.com/RameshMF/junit-developer-guide</a></li><li><a href="https://github.com/spring-projects/spring-framework" target="_blank" rel="noopener noreferrer">https://github.com/spring-projects/spring-framework</a></li><li><a href="https://github.com/apache/maven" target="_blank" rel="noopener noreferrer">https://github.com/apache/maven</a></li><li><a href="https://github.com/jersey/jersey" target="_blank" rel="noopener noreferrer">https://github.com/jersey/jersey</a></li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="create-a-maven-multi-module-using-command-line">Create a Maven Multi Module using Command Line<a class="hash-link" href="#create-a-maven-multi-module-using-command-line" title="Direct link to heading">​</a></h2><p>Below are the steps to create parent and sub-modules projects.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-1-create-parent-project---blogger">Step 1: Create Parent project - blogger<a class="hash-link" href="#step-1-create-parent-project---blogger" title="Direct link to heading">​</a></h3><p>To create the Parent project:</p><p>mvn archetype:generate -DgroupId=com.companyname.blogger -DartifactId=blogger
Note that whole command should be a single line. After build success, we will see below output in the command line console.</p><div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Parameter: package, Value: com.companyname.blogger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Parameter: groupId, Value: com.companyname.blogger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Parameter: artifactId, Value: blogger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Parameter: packageName, Value: com.companyname.blogger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Parameter: version, Value: 1.0-SNAPSHOT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] project created from Old (1.x) Archetype in dir: C:\Ramesh_Study\maven\guides\blogger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] ------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] BUILD SUCCESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] ------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Total time: 01:09 min</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Finished at: 2018-06-20T13:40:40+05:30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] ------------------------------------------------------------------------</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-2-update-pomxml-to-declare-it-as-parent-project">Step 2: Update pom.xml to Declare It as Parent Project<a class="hash-link" href="#step-2-update-pomxml-to-declare-it-as-parent-project" title="Direct link to heading">​</a></h3><p>Open pom.xml of above-created parent-project and change the packaging to pom.</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The complete <em>pom.xml</em></p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">project</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">xmlns</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://maven.apache.org/POM/4.0.0</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xmlns:</span><span class="token tag attr-name" style="color:#00a4db">xsi</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://www.w3.org/2001/XMLSchema-instance</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xsi:</span><span class="token tag attr-name" style="color:#00a4db">schemaLocation</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">modelVersion</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">4.0.0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">modelVersion</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.companyname.blogger</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">blogger</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.0-SNAPSHOT</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">blogger</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">http://maven.apache.org</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">properties</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">project.build.sourceEncoding</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">UTF-8</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">project.build.sourceEncoding</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">properties</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependencies</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">junit</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">junit</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">3.8.1</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">test</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependencies</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">project</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you don't change this pom.xml then you will get below build fail error:</p><div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Parameter: groupId, Value: com.companyname.blogger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Parameter: artifactId, Value: blogger-core</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Parameter: version, Value: 1.0-SNAPSHOT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Parameter: package, Value: com.companyname.blogger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Parameter: packageInPathFormat, Value: com/companyname/blogger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Parameter: version, Value: 1.0-SNAPSHOT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Parameter: package, Value: com.companyname.blogger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Parameter: groupId, Value: com.companyname.blogger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Parameter: artifactId, Value: blogger-core</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] ------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] BUILD FAILURE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] ------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Total time: 01:49 min</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Finished at: 2018-06-20T13:49:18+05:30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] ------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ERROR] Failed to execute goal org.apache.maven.plugins:maven-archetype-plugin:3.0.1:generate (default-cli) validPackaging: **Unable to add module to the current project as it is not of packaging type 'pom'** -&gt; [Help 1]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-3-create-sub-modules">Step 3: Create Sub-modules<a class="hash-link" href="#step-3-create-sub-modules" title="Direct link to heading">​</a></h3><p>Change directory via below command</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> blogger</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let's create sub-modules in blogger parent project.</p><p>Create blogger-core module.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mvn archetype:generate -DgroupId</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com.companyname.blogger  -DartifactId</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">blogger-core</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create blogger-common module</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mvn archetype:generate -DgroupId</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com.companyname.blogger  -DartifactId</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">blogger-common</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create blogger-web module and it is web application packaged with war file. The archetype for maven web application is <code>-DarchetypeArtifactId=maven-archetype-webapp</code></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mvn archetype:generate -DgroupId</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com.companyname.blogger  -DartifactId</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">blogger-web -DarchetypeArtifactId</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">maven-archetype-webapp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now if you open the blogger parent project <em>pom.xml</em>, you will find all three modules being added in there.</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">modules</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">module</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">blogger-core</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">module</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">module</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">blogger-common</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">module</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">module</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">blogger-web</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">module</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">modules</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Also, in each sub-module’s <em>pom.xml</em>, a parent section being added.</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">blogger</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.companyname.blogger</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.0-SNAPSHOT</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-4-update-sub-modules-pomxml-to-produce-appropriate-output">Step 4: Update Sub-Modules pom.xml to Produce Appropriate Output<a class="hash-link" href="#step-4-update-sub-modules-pomxml-to-produce-appropriate-output" title="Direct link to heading">​</a></h3><p>blogger-core module is package with jar</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">jar</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>blogger-common module is a package with a jar.</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">jar</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>blogger-web module is already packaging with war.</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">war</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let's updated pom.xml files for all the parent and sub-modules.</p><p>blogger parent project <em>pom.xml</em>:</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token prolog" style="color:#999988;font-style:italic">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">project</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">xmlns</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://maven.apache.org/POM/4.0.0</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xmlns:</span><span class="token tag attr-name" style="color:#00a4db">xsi</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://www.w3.org/2001/XMLSchema-instance</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xsi:</span><span class="token tag attr-name" style="color:#00a4db">schemaLocation</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">modelVersion</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">4.0.0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">modelVersion</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.companyname.blogger</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">blogger</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.0-SNAPSHOT</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">blogger</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">http://maven.apache.org</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">properties</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">project.build.sourceEncoding</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">UTF-8</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">project.build.sourceEncoding</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">properties</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependencies</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">junit</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">junit</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">3.8.1</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">test</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependencies</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">modules</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">module</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">blogger-common</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">module</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">module</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">blogger-web</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">module</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">module</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">blogger-core</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">module</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">modules</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">project</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>blogger-core sub-module <em>pom.xml</em>:</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token prolog" style="color:#999988;font-style:italic">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">project</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">xmlns</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://maven.apache.org/POM/4.0.0</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xmlns:</span><span class="token tag attr-name" style="color:#00a4db">xsi</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://www.w3.org/2001/XMLSchema-instance</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xsi:</span><span class="token tag attr-name" style="color:#00a4db">schemaLocation</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">modelVersion</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">4.0.0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">modelVersion</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">blogger</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.companyname.blogger</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.0-SNAPSHOT</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.companyname.blogger</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">blogger-core</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.0-SNAPSHOT</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">jar</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">blogger-core</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- FIXME change it to the project's website --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">http://www.example.com</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">properties</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">project.build.sourceEncoding</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">UTF-8</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">project.build.sourceEncoding</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">maven.compiler.source</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.7</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">maven.compiler.source</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">maven.compiler.target</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.7</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">maven.compiler.target</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">properties</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependencies</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">junit</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">junit</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">4.11</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">test</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependencies</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">project</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>blogger-common sub-module <em>pom.xml</em>:</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token prolog" style="color:#999988;font-style:italic">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">project</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">xmlns</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://maven.apache.org/POM/4.0.0</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xmlns:</span><span class="token tag attr-name" style="color:#00a4db">xsi</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://www.w3.org/2001/XMLSchema-instance</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xsi:</span><span class="token tag attr-name" style="color:#00a4db">schemaLocation</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">modelVersion</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">4.0.0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">modelVersion</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">blogger</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.companyname.blogger</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.0-SNAPSHOT</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.companyname.blogger</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">blogger-common</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.0-SNAPSHOT</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">jar</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">blogger-common</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- FIXME change it to the project's website --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">http://www.example.com</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">properties</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">project.build.sourceEncoding</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">UTF-8</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">project.build.sourceEncoding</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">maven.compiler.source</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.7</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">maven.compiler.source</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">maven.compiler.target</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.7</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">maven.compiler.target</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">properties</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependencies</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">junit</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">junit</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">4.11</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">test</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependencies</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">project</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>blogger-web sub-module <em>pom.xml</em>:</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token prolog" style="color:#999988;font-style:italic">&lt;?xml version="1.0"?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">project</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xsi:</span><span class="token tag attr-name" style="color:#00a4db">schemaLocation</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">xmlns</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://maven.apache.org/POM/4.0.0</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xmlns:</span><span class="token tag attr-name" style="color:#00a4db">xsi</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://www.w3.org/2001/XMLSchema-instance</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">modelVersion</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">4.0.0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">modelVersion</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.companyname.blogger</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">blogger</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.0-SNAPSHOT</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">parent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.companyname.blogger</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">blogger-web</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.0-SNAPSHOT</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">war</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">blogger-web Maven Webapp</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">http://maven.apache.org</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependencies</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">junit</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">junit</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">3.8.1</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">test</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependencies</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">build</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">finalName</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">blogger-web</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">finalName</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">build</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">project</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-build-multi-module">2. Build Multi-Module<a class="hash-link" href="#2-build-multi-module" title="Direct link to heading">​</a></h2><p>To test all the multi-module project setup is correct then run below maven common on blogger parent project:</p><div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mvn clean install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The output of above command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Reactor Summary:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] blogger 1.0-SNAPSHOT ............................... SUCCESS [  0.746 s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] blogger-common ..................................... SUCCESS [  5.727 s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] blogger-core ....................................... SUCCESS [  1.775 s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] blogger-web Maven Webapp 1.0-SNAPSHOT .............. SUCCESS [  0.809 s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] ------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] BUILD SUCCESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] ------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Total time: 9.289 s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Finished at: 2018-06-20T14:20:05+05:30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] ------------------------------------------------------------------------</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>That's it. Now can import this project into Eclipse IDE. In Eclipse , File -&gt; Import -&gt; Maven -&gt; Existing Maven projects</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-conclusion">3. Conclusion<a class="hash-link" href="#3-conclusion" title="Direct link to heading">​</a></h2><p>In this guide, we have learned how to create maven Multi-Module using Command Line by taking the bloggerproject as an example.</p><p>The source code of this multi-module project is available on GitHub.</p><p>Read my favorite Maven Developers Guide.</p><blockquote><p><a href="https://www.javaguides.net/2018/06/how-to-create-maven-multi-module-using-command-line.html" target="_blank" rel="noopener noreferrer">引用</a></p></blockquote>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="maven" term="maven"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[解决 Windows 环境中 git log 命令中文编码问题]]></title>
        <id>/2021/04/03/powershell-git-chinese-encode</id>
        <link href="https://blog.alanwei.com/blog/2021/04/03/powershell-git-chinese-encode"/>
        <updated>2021-04-03T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[解决 Windows 10 系统中 Powershell 终端git log命令输出中文编码问题]]></summary>
        <content type="html"><![CDATA[<p>在Windows系统中使用git命令，如果想正确显示UTF-8字符，需要执行以下命令设置环境变量:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">DOS/cmd</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">set</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:#36acaa">LC_ALL</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">C.UTF-8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">PowerShell</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$env:LC_ALL='C.UTF-8'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上述只对当前会话有效，如果想要永远生效，可以参考以下操作:</p><ol><li>设置系统级别环境变量，变量名为<code>LC_ALL</code>, 变量值为<code>C.UTF-8</code>.</li><li>或者在<code>$Profile</code>文件(PowerShell的初始化文件)中添加一行代码<code>$env:LC_ALL='C.UTF-8'</code></li></ol><blockquote><p><a href="https://stackoverflow.com/questions/41139067/git-log-output-encoding-issues-on-windows-10-command-prompt/41441828#41441828" target="_blank" rel="noopener noreferrer">引用 git log output encoding issues on Windows 10 command prompt</a></p></blockquote>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="git" term="git"/>
        <category label="powershell" term="powershell"/>
        <category label="windows" term="windows"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[添加Windows开启启动程序]]></title>
        <id>/2021/04/03/windows-add-programs-to-startup-folder</id>
        <link href="https://blog.alanwei.com/blog/2021/04/03/windows-add-programs-to-startup-folder"/>
        <updated>2021-04-03T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[设置Windows开机启动程序]]></summary>
        <content type="html"><![CDATA[<p>从Windows 95开始, 只需要将程序的快捷方式拖到Windows的“启动”文件夹即可。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用运行打开启动目录">使用运行打开启动目录<a class="hash-link" href="#使用运行打开启动目录" title="Direct link to heading">​</a></h2><p>使用快捷键 <code>Win + R</code> 或者开始菜单搜索 <code>运行</code>, 然后输入 <code>shell:startup</code> 即可打开启动目录, 然后将要开机启动的程序或者程序的快捷方式放到该目录即可.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="打开当前账号的启动目录">打开当前账号的启动目录<a class="hash-link" href="#打开当前账号的启动目录" title="Direct link to heading">​</a></h2><p>按下Windows开始键，找到 <strong>启动/Startup</strong> 目录，然后右击选择 <strong>打开/Opne</strong> 即可打开启动目录，然后把你的程序的快捷方式加进去即可。</p><p>目录一般位于: <code>C:\Users\&lt;username&gt;\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup</code>, 需要将<code>&lt;username&gt;</code>替换成当前账号的用户名。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="打开系统所有用户的启动目录">打开系统(所有用户)的启动目录<a class="hash-link" href="#打开系统所有用户的启动目录" title="Direct link to heading">​</a></h2><p>还是上述操作，只不过右击 <strong>启动/Startup</strong> 目录的时候要同时按住 <code>Shift</code> 按键，然后选择 <strong>打开所有用户/Open all users</strong>。</p><p>目录一般位于 <code>C:\Program Data\Microsoft\Windows\Start Menu\Programs\Startup</code></p><blockquote><p><a href="https://helpdeskgeek.com/windows-7/add-programs-to-windows-7-startup-folder/" target="_blank" rel="noopener noreferrer">引用 Easily Add Programs to Windows 7 Startup Folders</a></p></blockquote>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="windows" term="windows"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Docker时区设置]]></title>
        <id>/2021/04/02/docker-timezone</id>
        <link href="https://blog.alanwei.com/blog/2021/04/02/docker-timezone"/>
        <updated>2021-04-02T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[设置常用Docker镜像的容器时区]]></summary>
        <content type="html"><![CDATA[<p>下面介绍几个常用基础镜像(Alpine，Ubuntu，Debian 和 CentOS)如何设置时区。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="centos-deian">CentOS, Deian<a class="hash-link" href="#centos-deian" title="Direct link to heading">​</a></h2><p>CentOS 和 Deian 内置了时区数据库 tzdata (时区数据位于 <code>/usr/share/timezone</code>)，支持直接通过环境变量(<code>-e TZ=Asia/Shanghai</code>)设置容器时区:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -e </span><span class="token assign-left variable" style="color:#36acaa">TZ</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Asia/Shanghai --rm -it centos:8 </span><span class="token function" style="color:#d73a49">date</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -e </span><span class="token assign-left variable" style="color:#36acaa">TZ</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Asia/Shanghai --rm -it debian:9.13 </span><span class="token function" style="color:#d73a49">date</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者通过<code>Dockerfile</code>自定环境变量:</p><div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Dockerfile</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM debian:9.13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV TZ=Asia/Shanghai</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 其他指令...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="alpine-ubuntu">Alpine, Ubuntu<a class="hash-link" href="#alpine-ubuntu" title="Direct link to heading">​</a></h2><p>alpine 和 Ubuntu 需要安装时区数据之后指定时区, 以下以 <a href="https://wiki.alpinelinux.org/wiki/Setting_the_timezone" target="_blank" rel="noopener noreferrer">alpine 为例介绍</a>:</p><p>写一个 Dockerfile:</p><div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Dockerfile.alpine</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM alpine:3.13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 添加阿里云镜像, 加快包安装速度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g' /etc/apk/repositories</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 开始安装时区数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN apk add tzdata</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后开始构建: <code>docker build -t alpine:3.13-tz -f Dockerfile.alpine .</code></p><p>现在就可以使用刚才构建的镜像<code>alpine:3.13-tz</code>, 指定容器时区了:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -e </span><span class="token assign-left variable" style="color:#36acaa">TZ</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Asia/Shanghai --rm -it alpine:3.13-tz </span><span class="token function" style="color:#d73a49">date</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 输出容器时间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -e </span><span class="token assign-left variable" style="color:#36acaa">TZ</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Asia/Shanghai --rm -it alpine:3.13-tz </span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> /usr/share/zoneinfo </span><span class="token comment" style="color:#999988;font-style:italic"># 输出时区信息</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><a href="https://mp.weixin.qq.com/s/uO0nqNnWMqeQU8EyQYhllQ" target="_blank" rel="noopener noreferrer">引用 聊一聊Docker与时区</a></p></blockquote>]]></content>
        <author>
            <name>不才老黄</name>
            <uri>https://mp.weixin.qq.com/s/uO0nqNnWMqeQU8EyQYhllQ</uri>
        </author>
        <category label="docker" term="docker"/>
        <category label="timezone" term="timezone"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[解决 NPM 安装应用出现 ERESOLVE 错误]]></title>
        <id>/2021/03/30/npm-install-eresulve-error</id>
        <link href="https://blog.alanwei.com/blog/2021/03/30/npm-install-eresulve-error"/>
        <updated>2021-03-30T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[npm install ERESOLVE issues error npm 安装报错]]></summary>
        <content type="html"><![CDATA[<p>今天在项目里执行 <code>npm i</code> 出现以下错误:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! code ERESOLVE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! ERESOLVE unable to resolve dependency tree</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! While resolving: project-name@0.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! Found: typescript@3.6.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! node_modules/typescript</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR!   dev typescript@"3.6.3" from the root project</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! Could not resolve dependency:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! peer typescript@"^3.6.4" from @nestjs/cli@6.12.9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! node_modules/@nestjs/cli</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR!   dev @nestjs/cli@"6.12.9" from the root project</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! Fix the upstream dependency conflict, or retry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! this command with --force, or --legacy-peer-deps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! to accept an incorrect (and potentially broken) dependency resolution.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! See /root/.npm/eresolve-report.txt for a full report.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! A complete log of this run can be found in:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR!     /root/.npm/_logs/2021-03-30T14_18_07_395Z-debug.log</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>网上搜了一下，是因为NPM从版本7开始在某些方面比之前版本更加严格，改成 <code>npm i --legacy-peer-deps</code> 后解决。</p><p>以下是<a href="https://stackoverflow.com/questions/65567953/npm-i-resulting-in-many-eresolve-issues" target="_blank" rel="noopener noreferrer">原文</a>: </p><p><code>ERESOLVE</code> issues with <code>npm@7</code> are common because npm 7.x is more strict about certain things than npm 6.x. Often, the easiest resolution is to pass the <code>--legacy-peer-deps</code> flag to npm (e.g., <code>npm i --legacy-peer-deps</code>) or else use <code>npm@6</code>.</p><p>If that doesn't work immediately, perhaps try removing <code>node_modules</code> and <code>package-lock.json</code> first. They will be recreated.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Tip</div><div class="admonitionContent_S0QG"><p>You don't need to uninstall <code>npm@7</code> to use <code>npm@6</code>. Use npx to specify the version of npm instead. For example: <code>npx -p npm@6 npm i --legacy-peer-deps</code>.</p></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="npm" term="npm"/>
        <category label="node.js" term="node.js"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Git Tags 使用简介]]></title>
        <id>/2021/03/28/git-tags</id>
        <link href="https://blog.alanwei.com/blog/2021/03/28/git-tags"/>
        <updated>2021-03-28T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Git Tags 常用命令简介]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="添加-tag">添加 tag<a class="hash-link" href="#添加-tag" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> tag your_tag_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> tag -a your_tag_name -m </span><span class="token string" style="color:#e3116c">"tag describe"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="列出所有-tag">列出所有 tag<a class="hash-link" href="#列出所有-tag" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> tag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> describe --tags</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="删除本地-tag">删除本地 tag<a class="hash-link" href="#删除本地-tag" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> tag --delete your_tag_name</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="删除远程-tag">删除远程 tag<a class="hash-link" href="#删除远程-tag" title="Direct link to heading">​</a></h2><p>你可以向远程仓库推送一个空引用的同名tag:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> push origin :your_tag_name</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者更具体一点的方式, 是使用<code>--delete</code>选项(如果你使用的git版本低于1.8.0使用<code>-d</code>代替):</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> push --delete origin your_tag_name</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>需要注意的是, Git有标签(tag)命名空间和分支(branch)命名空间，所以你可能存在标签名和分支名同名的情况，如果你想明确删除的是指定名称的标签，而不想误删分支的话，可以在执行标签删除时指定完全限定的ref:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> push origin :refs/tags/your_tag_name</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>当你推送一个分支(branch)、标签(tag)、或者其他ref到远程仓库时，都涉及到需要指定"哪个仓库(repo)，源是什么(source)，推送到哪儿(destination)"</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> push remote-repo source-ref:destination-ref</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>一个真实环境的例子是推送你本地的master分支到远程的master分支:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> push origin refs/heads/master:refs/heads/maser</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>因为有默认路径，所以上面的可以简写成:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> push origin master:master</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>标签(tags)的工作方式是一样的:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> push origin refs/tags/release-1.0:refs/tags/release-1.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以简写成:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> push origin release-1.0:release-1.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上面删除标签的命令(<code>git push origin :your_tag_name</code>)省略了源引用(source ref)，相当于推送一个空(nothing)到目的地(destination), 也就相当于在远程仓库删除了标签的ref。</p></div></div><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>参考<a href="https://stackoverflow.com/questions/5480258/how-to-delete-a-remote-tag#:~:text=%20If%20you%20use%20SourceTree%20-%20a%20great,window%2C%20select%20%22Remove%20Tag%20From%20Remotes%22%20More%20" target="_blank" rel="noopener noreferrer">How to delete a remote tag?</a></p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="切换标签">切换标签<a class="hash-link" href="#切换标签" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> checkout tags/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">tag_name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> -b </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">branch_name</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="获取所有标签">获取所有标签<a class="hash-link" href="#获取所有标签" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> fetch --all --tags --prune</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="推送标签到远程仓库">推送标签到远程仓库<a class="hash-link" href="#推送标签到远程仓库" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> push --tags</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="git" term="git"/>
        <category label="git tags" term="git tags"/>
        <category label="git tag" term="git tag"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Docker配置镜像加速]]></title>
        <id>/2021/03/26/docker-config-mirror</id>
        <link href="https://blog.alanwei.com/blog/2021/03/26/docker-config-mirror"/>
        <updated>2021-03-26T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[修改Docker文件, 配置镜像加速]]></summary>
        <content type="html"><![CDATA[<p>通过修改Docker的<code>/etc/docker/daemon.json</code>配置文件里的 <code>registry-mirros</code> 配置节，可是设置Docker的镜像服务: </p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">/etc/docker/daemon.json</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"registry-mirrors"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"https://xxxxxx.mirror.aliyuncs.com"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>配置文件(如果不存在可以创建该文件)修改成功后, 重启Docker服务即可:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl daemon-reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl restart </span><span class="token function" style="color:#d73a49">docker</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>查看自己阿里云的Docker镜像加速器地址: <code>https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</code></p></blockquote>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="docker" term="docker"/>
        <category label="mirror" term="mirror"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[国内开源镜像站点]]></title>
        <id>/2021/03/26/open-mirrors</id>
        <link href="https://blog.alanwei.com/blog/2021/03/26/open-mirrors"/>
        <updated>2021-03-26T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[国内开源镜像加速站点]]></summary>
        <content type="html"><![CDATA[<p>国内开源镜像加速站点</p><ul><li><a href="https://developer.aliyun.com/mirror/ubuntu?spm=a2c6h.13651102.0.0.3e221b11id7tZa" target="_blank" rel="noopener noreferrer">Aliyun</a></li><li><a href="https://mirrors.ustc.edu.cn/" target="_blank" rel="noopener noreferrer">中科大</a></li><li><a href="https://mirrors.tuna.tsinghua.edu.cn/" target="_blank" rel="noopener noreferrer">清华大学</a></li><li><a href="http://mirrors.163.com/" target="_blank" rel="noopener noreferrer">网易</a></li><li><a href="https://mirrors.cloud.tencent.com/" target="_blank" rel="noopener noreferrer">腾讯</a></li><li><a href="https://mirrors.huaweicloud.com/" target="_blank" rel="noopener noreferrer">华为</a></li><li><a href="http://mirrors.neusoft.edu.cn/" target="_blank" rel="noopener noreferrer">neusoft</a></li></ul>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="mirror" term="mirror"/>
        <category label="linux" term="linux"/>
        <category label="docker" term="docker"/>
        <category label="android" term="android"/>
        <category label="aosp" term="aosp"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Chromium 所有开关(flag)列表]]></title>
        <id>/2021/03/21/chromium-command-line-switches</id>
        <link href="https://blog.alanwei.com/blog/2021/03/21/chromium-command-line-switches"/>
        <updated>2021-03-21T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Chromium 所有开关列表]]></summary>
        <content type="html"><![CDATA[<p><a href="https://peter.sh/experiments/chromium-command-line-switches/" target="_blank" rel="noopener noreferrer">原文 - List of Chromium Command Line Switches</a></p><ul><li><code>--/prefetch:1[1]</code> ⊗ 	/prefetch:# arguments to use when launching various process types. It has been observed that when file reads are consistent for 3 process launches with the same /prefetch:# argument, the Windows prefetcher starts issuing reads in batch at process launch. Because reads depend on the process type, the prefetcher wouldn't be able to observe consistent reads if no /prefetch:# arguments were used. Note that the browser process has no /prefetch:# argument; as such all other processes must have one in order to avoid polluting its profile. Note: # must always be in <!-- -->[1, 8]<!-- -->; otherwise it is ignored by the Windows prefetcher.  </li><li><code>--/prefetch:2[1]</code> ⊗ 	No description  </li><li><code>--/prefetch:3[1]</code> ⊗ 	No description  </li><li><code>--/prefetch:4[1]</code> ⊗ 	No description  </li><li><code>--/prefetch:5[1]</code> ⊗ 	/prefetch:# arguments for the browser process launched in background mode and for the watcher process. Use profiles 5, 6 and 7 as documented on kPrefetchArgument* in content_switches.cc.  </li><li><code>--/prefetch:6[1]</code> ⊗ 	No description  </li><li><code>--/prefetch:8[1]</code> ⊗ 	Prefetch arguments are used by the Windows prefetcher to disambiguate different execution modes (i.e. process types) of the same executable image so that different types of processes don't trample each others' prefetch behavior. Legal values are integers in the range <!-- -->[1, 8]<!-- -->. We reserve 8 to mean "whatever", and this will ultimately lead to processes with /prefetch:8 having inconsistent behavior thus disabling prefetch in practice. TODO(rockot): Make it possible for embedders to override this argument on a per-service basis.  </li><li><code>--10000</code> ⊗ 	No description  </li><li><code>--100000</code> ⊗ 	No description  </li><li><code>--1000000</code> ⊗ 	No description  </li><li><code>--3d-display-mode[1]</code> ⊗ 	No description  </li><li><code>--50000</code> ⊗ 	No description  </li><li><code>--500000</code> ⊗ 	No description  </li><li><code>--5000000</code> ⊗ 	No description  </li><li><code>--?</code> ⊗ 	No description  </li><li><code>--accept-resource-provider</code> ⊗ 	Flag indicating that a resource provider must be set up to provide cast receiver with resources. Apps cannot start until provided resources. This flag implies --alsa-check-close-timeout=0.  </li><li><code>--adaboost</code> ⊗ 	No description  </li><li><code>--add-gpu-appcontainer-caps[1]</code> ⊗ 	Add additional capabilities to the AppContainer sandbox on the GPU process.  </li><li><code>--add-xr-appcontainer-caps[1]</code> ⊗ 	Add additional capabilities to the AppContainer sandbox used for XR compositing.  </li><li><code>--additional-trust-token-key-commitments</code> ⊗ 	Manually sets additional Trust Tokens key commitments in the network service to the given value, which should be a JSON dictionary satisfying the requirements of TrustTokenKeyCommitmentParser::ParseMultipleIssuers. These keys are available in addition to keys provided by the most recent call to TrustTokenKeyCommitments::Set. For issuers with keys provided through both the command line and TrustTokenKeyCommitments::Set, the keys provided through the command line take precedence. This is because someone testing manually might want to pass additional keys via the command line to a real Chrome release with the component updater enabled, and it would be surprising if the manually-passed keys were overwritten some time after startup when the component updater runs.  </li><li><code>--agc-startup-min-volume</code> ⊗ 	Override the default minimum starting volume of the Automatic Gain Control algorithm in WebRTC used with audio tracks from getUserMedia. The valid range is 12-255. Values outside that range will be clamped to the lowest or highest valid value inside WebRTC. TODO(tommi): Remove this switch when crbug.com/555577 is fixed.  </li><li><code>--aggressive</code> ⊗ 	No description  </li><li><code>--aggressive-cache-discard</code> ⊗ 	No description  </li><li><code>--aggressive-tab-discard</code> ⊗ 	No description  </li><li><code>--all</code> ⊗ 	No description  </li><li><code>--all-renderers</code> ⊗ 	No description  </li><li><code>--allarticles</code> ⊗ 	No description  </li><li><code>--allow-cross-origin-auth-prompt</code> ⊗ 	Allows third-party content included on a page to prompt for a HTTP basic auth username/password pair.  </li><li><code>--allow-external-pages</code> ⊗ 	Allow access to external pages during web tests.  </li><li><code>--allow-failed-policy-fetch-for-test</code> ⊗ 	If this flag is passed, failed policy fetches will not cause profile initialization to fail. This is useful for tests because it means that tests don't have to mock out the policy infrastructure.  </li><li><code>--allow-file-access-from-files</code> ⊗ 	By default, file:// URIs cannot read other file:// URIs. This is an override for developers who need the old behavior for testing.  </li><li><code>--allow-http-background-page</code> ⊗ 	Allows non-https URL for background_page for hosted apps.  </li><li><code>--allow-http-screen-capture</code> ⊗ 	Allow non-secure origins to use the screen capture API and the desktopCapture extension API.  </li><li><code>--allow-insecure-localhost</code> ⊗ 	Enables TLS/SSL errors on localhost to be ignored (no interstitial, no blocking of requests).  </li><li><code>--allow-legacy-extension-manifests</code> ⊗ 	Allows the browser to load extensions that lack a modern manifest when that would otherwise be forbidden.  </li><li><code>--allow-loopback-in-peer-connection</code> ⊗ 	Allows loopback interface to be added in network list for peer connection.  </li><li><code>--allow-nacl-crxfs-api[2]</code> ⊗ 	Specifies comma-separated list of extension ids or hosts to grant access to CRX file system APIs.  </li><li><code>--allow-nacl-file-handle-api[2]</code> ⊗ 	Specifies comma-separated list of extension ids or hosts to grant access to file handle APIs.  </li><li><code>--allow-nacl-socket-api[2]</code> ⊗ 	Specifies comma-separated list of extension ids or hosts to grant access to TCP/UDP socket APIs.  </li><li><code>--allow-no-sandbox-job</code> ⊗ 	Enables the sandboxed processes to run without a job object assigned to them. This flag is required to allow Chrome to run in RemoteApps or Citrix. This flag can reduce the security of the sandboxed processes and allow them to do certain API calls like shut down Windows or access the clipboard. Also we lose the chance to kill some processes until the outer job that owns them finishes.  </li><li><code>--allow-outdated-plugins</code> ⊗ 	Don't block outdated plugins.  </li><li><code>--allow-popups-during-page-unload</code> ⊗ 	Allow a page to show popups during its unloading. <a href="https://crbug.com/937569" target="_blank" rel="noopener noreferrer">TODO</a>: Remove this in Chrome 88.  </li><li><code>--allow-pre-commit-input</code> ⊗ 	Allows processing of input before a frame has been committed. TODO(schenney): crbug.com/987626. Used by headless. Look for a way not involving a command line switch.  </li><li><code>--allow-profiles-outside-user-dir</code> ⊗ 	Allows profiles to be created outside of the user data dir. <a href="https://crbug.com/1060366" target="_blank" rel="noopener noreferrer">TODO</a>: Various places in Chrome assume that all profiles are within the user data dir. Some tests need to violate that assumption. The switch should be removed after this workaround is no longer needed.  </li><li><code>--allow-ra-in-dev-mode</code> ⊗ 	Allows remote attestation (RA) in dev mode for testing purpose. Usually RA is disabled in dev mode because it will always fail. However, there are cases in testing where we do want to go through the permission flow even in dev mode. This can be enabled by this flag.  </li><li><code>--allow-running-insecure-content</code> ⊗ 	No description  </li><li><code>--allow-sandbox-debugging</code> ⊗ 	Allows debugging of sandboxed processes (see zygote_main_linux.cc).  </li><li><code>--allow-silent-push</code> ⊗ 	Allows Web Push notifications that do not show a notification.  </li><li><code>--allow-sync-xhr-in-page-dimissal</code> ⊗ 	Allow a page to send synchronus XHR during its unloading. <a href="https://crbug.com/1003101" target="_blank" rel="noopener noreferrer">TODO</a>: Remove this in Chrome 88.  </li><li><code>--allow-third-party-modules[1]</code> ⊗ 	Allows third party modules to inject by disabling the BINARY_SIGNATURE mitigation policy on Win10+. Also has other effects in ELF.  </li><li><code>--allow-unsecure-dlls[3]</code> ⊗ 	Don't allow EnableSecureDllLoading to run when this is set. This is only to be used in tests.  </li><li><code>--alsa-amp-device-name</code> ⊗ 	Name of the device the amp mixer should be opened on. If this flag is not specified it will default to the same device as kAlsaVolumeDeviceName.  </li><li><code>--alsa-amp-element-name</code> ⊗ 	Name of the simple mixer control element that the ALSA-based media library should use to toggle powersave mode on the system.  </li><li><code>--alsa-check-close-timeout</code> ⊗ 	Time in ms to wait before closing the PCM handle when no more mixer inputs remain. Assumed to be 0 if --accept-resource-provider is present.  </li><li><code>--alsa-enable-upsampling</code> ⊗ 	Flag that enables resampling audio with sample rate below 32kHz up to 48kHz. Should be set to true for internal audio products.  </li><li><code>--alsa-fixed-output-sample-rate</code> ⊗ 	Optional flag to set a fixed sample rate for the alsa device. Deprecated: Use --audio-output-sample-rate instead.  </li><li><code>--alsa-input-device[4]</code> ⊗ 	The Alsa device to use when opening an audio input stream.  </li><li><code>--alsa-mute-device-name</code> ⊗ 	Name of the device the mute mixer should be opened on. If this flag is not specified it will default to the same device as kAlsaVolumeDeviceName.  </li><li><code>--alsa-mute-element-name</code> ⊗ 	Name of the simple mixer control element that the ALSA-based media library should use to mute the system.  </li><li><code>--alsa-output-avail-min</code> ⊗ 	Minimum number of available frames for scheduling a transfer.  </li><li><code>--alsa-output-buffer-size</code> ⊗ 	Size of the ALSA output buffer in frames. This directly sets the latency of the output device. Latency can be calculated by multiplying the sample rate by the output buffer size.  </li><li><code>--alsa-output-device[4]</code> ⊗ 	The Alsa device to use when opening an audio stream.  </li><li><code>--alsa-output-period-size</code> ⊗ 	Size of the ALSA output period in frames. The period of an ALSA output device determines how many frames elapse between hardware interrupts.  </li><li><code>--alsa-output-start-threshold</code> ⊗ 	How many frames need to be in the output buffer before output starts.  </li><li><code>--alsa-volume-device-name</code> ⊗ 	Name of the device the volume control mixer should be opened on. Will use the same device as kAlsaOutputDevice and fall back to "default" if kAlsaOutputDevice is not supplied.  </li><li><code>--alsa-volume-element-name</code> ⊗ 	Name of the simple mixer control element that the ALSA-based media library should use to control the volume.  </li><li><code>--also-emit-success-logs</code> ⊗ 	Also emit full event trace logs for successful tests.  </li><li><code>--alt1</code> ⊗ 	The Chrome-Proxy "exp" directive value used by data reduction proxy to receive an alternative back end implementation.  </li><li><code>--alt10</code> ⊗ 	No description  </li><li><code>--alt2</code> ⊗ 	No description  </li><li><code>--alt3</code> ⊗ 	No description  </li><li><code>--alt4</code> ⊗ 	No description  </li><li><code>--alt5</code> ⊗ 	No description  </li><li><code>--alt6</code> ⊗ 	No description  </li><li><code>--alt7</code> ⊗ 	No description  </li><li><code>--alt8</code> ⊗ 	No description  </li><li><code>--alt9</code> ⊗ 	No description  </li><li><code>--always-use-complex-text</code> ⊗ 	Always use the complex text path for web tests.  </li><li><code>--alwaystrue</code> ⊗ 	No description  </li><li><code>--android-fonts-path</code> ⊗ 	Uses the android SkFontManager on linux. The specified directory should include the configuration xml file with the name "fonts.xml". This is used in blimp to emulate android fonts on linux.  </li><li><code>--angle</code> ⊗ 	No description  </li><li><code>--animation-duration-scale</code> ⊗ 	Scale factor to apply to every animation duration. Must be &gt;= 0.0. This will only apply to LinearAnimation and its subclasses.  </li><li><code>--app</code> ⊗ 	Specifies that the associated value should be launched in "application" mode.  </li><li><code>--app-auto-launched</code> ⊗ 	Specifies whether an app launched in kiosk mode was auto launched with zero delay. Used in order to properly restore auto-launched state during session restore flow.  </li><li><code>--app-cache-force-enabled</code> ⊗ 	Allows app cache to be forced on, even when gated by an origin trial. TODO(enne): remove this once app cache has been removed.  </li><li><code>--app-id</code> ⊗ 	Specifies that the extension-app with the specified id should be launched according to its configuration.  </li><li><code>--app-launch-url-for-shortcuts-menu-item</code> ⊗ 	Overrides the launch url of an app with the specified url. This is used along with kAppId to launch a given app with the url corresponding to an item in the app's shortcuts menu.  </li><li><code>--app-mode-auth-code</code> ⊗ 	Value of GAIA auth code for --force-app-mode.  </li><li><code>--app-mode-oauth-token</code> ⊗ 	Value of OAuth2 refresh token for --force-app-mode.  </li><li><code>--app-mode-oem-manifest</code> ⊗ 	Path for app's OEM manifest file.  </li><li><code>--app-shell-allow-roaming[5]</code> ⊗ 	Allow roaming in the cellular network.  </li><li><code>--app-shell-host-window-size[5]</code> ⊗ 	Size for the host window to create (i.e. "800x600").  </li><li><code>--app-shell-preferred-network[5]</code> ⊗ 	SSID of the preferred WiFi network.  </li><li><code>--apple</code> ⊗ 	No description  </li><li><code>--apps-gallery-download-url</code> ⊗ 	The URL that the webstore APIs download extensions from. Note: the URL must contain one '%s' for the extension ID.  </li><li><code>--apps-gallery-update-url</code> ⊗ 	The update url used by gallery/webstore extensions.  </li><li><code>--apps-gallery-url</code> ⊗ 	The URL to use for the gallery link in the app launcher.  </li><li><code>--apps-keep-chrome-alive-in-tests[6]</code> ⊗ 	Prevents Chrome from quitting when Chrome Apps are open.  </li><li><code>--arc-availability</code> ⊗ 	Signals ARC support status on this device. This can take one of the following three values. - none: ARC is not installed on this device. (default) - installed: ARC is installed on this device, but not officially supported. Users can enable ARC only when Finch experiment is turned on. - officially-supported: ARC is installed and supported on this device. So users can enable ARC via settings etc.  </li><li><code>--arc-available</code> ⊗ 	DEPRECATED: Please use --arc-availability=installed. Signals the availability of the ARC instance on this device.  </li><li><code>--arc-build-properties</code> ⊗ 	A JSON dictionary whose content is the same as cros config's /arc/build-properties.  </li><li><code>--arc-data-cleanup-on-start</code> ⊗ 	Flag that forces ARC data be cleaned on each start.  </li><li><code>--arc-disable-app-sync</code> ⊗ 	Flag that disables ARC app sync flow that installs some apps silently. Used in autotests to resolve racy conditions.  </li><li><code>--arc-disable-gms-core-cache</code> ⊗ 	Used in autotest to disable GMS-core caches which is on by default.  </li><li><code>--arc-disable-locale-sync</code> ⊗ 	Flag that disables ARC locale sync with Android container. Used in autotest to prevent conditions when certain apps, including Play Store may get restarted. Restarting Play Store may cause random test failures. Enabling this flag would also forces ARC container to use 'en-US' as a locale and 'en-US,en' as preferred languages.  </li><li><code>--arc-disable-play-auto-install</code> ⊗ 	Flag that disables ARC Play Auto Install flow that installs set of predefined apps silently. Used in autotests to resolve racy conditions.  </li><li><code>--arc-disable-system-default-apps</code> ⊗ 	Used for development of Android app that are included into ARC++ as system default apps in order to be able to install them via adb.  </li><li><code>--arc-enable-native-bridge-64bit-support-experiment</code> ⊗ 	Flag to enables an experiment to allow users to turn on 64-bit support in native bridge on systems that have such support available but not yet enabled by default.  </li><li><code>--arc-force-cache-app-icons</code> ⊗ 	Flag that forces ARC to cache icons for apps.  </li><li><code>--arc-force-show-optin-ui</code> ⊗ 	Flag that forces the OptIn ui to be shown. Used in tests.  </li><li><code>--arc-packages-cache-mode</code> ⊗ 	Used in autotest to specifies how to handle packages cache. Can be copy - copy resulting packages.xml to the temporary directory. skip-copy - skip initial packages cache setup and copy resulting packages.xml to the temporary directory.  </li><li><code>--arc-play-store-auto-update</code> ⊗ 	Used in autotest to forces Play Store auto-update state. Can be on - auto-update is forced on. off - auto-update is forced off.  </li><li><code>--arc-scale</code> ⊗ 	Set the scale for ARC apps. This is in DPI. e.g. 280 DPI is ~ 1.75 device scale factor. See <a href="https://source.android.com/compatibility/android-cdd#3_7_runtime_compatibility" target="_blank" rel="noopener noreferrer">https://source.android.com/compatibility/android-cdd#3_7_runtime_compatibility</a> for list of supported DPI values.  </li><li><code>--arc-start-mode</code> ⊗ 	Defines how to start ARC. This can take one of the following values: - always-start automatically start with Play Store UI support. - always-start-with-no-play-store automatically start without Play Store UI. If it is not set, then ARC is started in default mode.  </li><li><code>--arc-tos-host-for-tests</code> ⊗ 	Sets ARC Terms Of Service hostname url for testing.  </li><li><code>--arc-transition-migration-required</code> ⊗ 	If this flag is present then the device had ARC M available and gets ARC N when updating. TODO(pmarko): Remove this when we assess that it's not necessary anymore: crbug.com/761348.  </li><li><code>--as-browser</code> ⊗ 	Flag to launch tests in the browser process.  </li><li><code>--ash-color-mode</code> ⊗ 	Indicates the current color mode of ash.  </li><li><code>--ash-constrain-pointer-to-root</code> ⊗ 	Force the pointer (cursor) position to be kept inside root windows.  </li><li><code>--ash-contextual-nudges-interval</code> ⊗ 	Overrides the minimum time that must pass between showing user contextual nudges. Unit of time is in seconds.  </li><li><code>--ash-contextual-nudges-reset-shown-count</code> ⊗ 	Reset contextual nudge shown count on login.  </li><li><code>--ash-debug-shortcuts</code> ⊗ 	Enable keyboard shortcuts useful for debugging.  </li><li><code>--ash-dev-shortcuts</code> ⊗ 	Enable keyboard shortcuts used by developers only.  </li><li><code>--ash-disable-touch-exploration-mode</code> ⊗ 	Disable the Touch Exploration Mode. Touch Exploration Mode will no longer be turned on automatically when spoken feedback is enabled when this flag is set.  </li><li><code>--ash-enable-cursor-motion-blur</code> ⊗ 	Enable cursor motion blur.  </li><li><code>--ash-enable-magnifier-key-scroller</code> ⊗ 	Enables key bindings to scroll magnified screen.  </li><li><code>--ash-enable-palette-on-all-displays</code> ⊗ 	Enables the palette on every display, instead of only the internal one.  </li><li><code>--ash-enable-software-mirroring</code> ⊗ 	Enables software based mirroring.  </li><li><code>--ash-enable-unified-desktop[5]</code> ⊗ 	Enables unified desktop mode.  </li><li><code>--ash-enable-v1-app-back-button</code> ⊗ 	Enables Backbutton on frame for v1 apps. TODO(oshima): Remove this once the feature is launched. crbug.com/749713.  </li><li><code>--ash-hide-notifications-for-factory</code> ⊗ 	Hides notifications that are irrelevant to Chrome OS device factory testing, such as battery level updates.  </li><li><code>--ash-host-window-bounds</code> ⊗ 	Sets a window size, optional position, and optional scale factor. "1024x768" creates a window of size 1024x768. "100+200-1024x768" positions the window at 100,200. "1024x768*2" sets the scale factor to 2 for a high DPI display. "800,0+800-800x800" for two displays at 800x800 resolution. "800,0+800-800x800,0+1600-800x800" for three displays at 800x800 resolution.  </li><li><code>--ash-power-button-position</code> ⊗ 	Power button position includes the power button's physical display side and the percentage for power button center position to the display's width/height in landscape_primary screen orientation. The value is a JSON object containing a "position" property with the value "left", "right", "top", or "bottom". For "left" and "right", a "y" property specifies the button's center position as a fraction of the display's height (in <!-- -->[0.0, 1.0]<!-- -->) relative to the top of the display. For "top" and "bottom", an "x" property gives the position as a fraction of the display's width relative to the left side of the display.  </li><li><code>--ash-side-volume-button-position</code> ⊗ 	The physical position info of the side volume button while in landscape primary screen orientation. The value is a JSON object containing a "region" property with the value "keyboard", "screen" and a "side" property with the value "left", "right", "top", "bottom".  </li><li><code>--ash-touch-hud</code> ⊗ 	Enables the heads-up display for tracking touch points.  </li><li><code>--attestation-server</code> ⊗ 	Used in CryptohomeClient to determine which Google Privacy CA to use for attestation.  </li><li><code>--audio</code> ⊗ 	No description  </li><li><code>--audio-buffer-size</code> ⊗ 	Allow users to specify a custom buffer size for debugging purpose.  </li><li><code>--audio-output-channels</code> ⊗ 	Number of audio output channels. This will be used to send audio buffer with specific number of channels to ALSA and generate loopback audio. Default value is 2.  </li><li><code>--audio-output-sample-rate</code> ⊗ 	Specify fixed sample rate for audio output stream. If this flag is not specified the StreamMixer will choose sample rate based on the sample rate of the media stream.  </li><li><code>--audio-service-quit-timeout-ms</code> ⊗ 	Set a timeout (in milliseconds) for the audio service to quit if there are no client connections to it. If the value is negative the service never quits.  </li><li><code>--aue-reached-for-update-required-test</code> ⊗ 	If this switch is passed, the device policy DeviceMinimumVersion assumes that the device has reached Auto Update Expiration. This is useful for testing the policy behaviour on the DUT.  </li><li><code>--aura-legacy-power-button</code> ⊗ 	(Most) Chrome OS hardware reports ACPI power button releases correctly. Standard hardware reports releases immediately after presses. If set, we lock the screen or shutdown the system immediately in response to a press instead of displaying an interactive animation.  </li><li><code>--auth-server-whitelist</code> ⊗ 	Allowlist for Negotiate Auth servers.  </li><li><code>--auth-spnego-account-type[7]</code> ⊗ 	Android authentication account type for SPNEGO authentication  </li><li><code>--auto</code> ⊗ 	No description  </li><li><code>--auto-open-devtools-for-tabs</code> ⊗ 	This flag makes Chrome auto-open DevTools window for each tab. It is intended to be used by developers and automation to not require user interaction for opening DevTools.  </li><li><code>--auto-select-desktop-capture-source</code> ⊗ 	This flag makes Chrome auto-select the provided choice when an extension asks permission to start desktop capture. Should only be used for tests. For instance, --auto-select-desktop-capture-source="Entire screen" will automatically select sharing the entire screen in English locales. The switch value only needs to be substring of the capture source name, i.e. "display" would match "Built-in display" and "External display", whichever comes first.  </li><li><code>--autofill-api-key</code> ⊗ 	Sets the API key that will be used when calling Autofill API instead of using Chrome's baked key by default. You can use this to test new versions of the API that are not linked to the Chrome baked key yet.  </li><li><code>--autofill-assistant-auth</code> ⊗ 	Disables authentication when set to false. This is only useful during development, as prod instances require authentication.  </li><li><code>--autofill-assistant-key</code> ⊗ 	Sets the API key to be used instead of Chrome's default key when sending requests to the backend.  </li><li><code>--autofill-assistant-url</code> ⊗ 	Overrides the default backend URL.  </li><li><code>--autofill-ios-delay-between-fields</code> ⊗ 	The delay between filling two fields.  </li><li><code>--autofill-metadata-upload-encoding</code> ⊗ 	The randomized encoding type to use when sending metadata uploads. The value of the parameter must be one of the valid integer values of the AutofillRandomizedValue_EncodingType enum.  </li><li><code>--autofill-server-url</code> ⊗ 	Override the default autofill server URL with "scheme://host<!-- -->[:port]<!-- -->/prefix/".  </li><li><code>--autofill-upload-throttling-period-in-days</code> ⊗ 	The number of days after which to reset the registry of autofill events for which an upload has been sent.  </li><li><code>--autoplay-policy</code> ⊗ 	Command line flag name to set the autoplay policy.  </li><li><code>--autopush</code> ⊗ 	The command line alias and URL for the "autopush" environment.  </li><li><code>--back-gesture-horizontal-threshold</code> ⊗ 	The number of pixels from the start of a left swipe gesture to consider as a 'back' gesture.  </li><li><code>--blink-settings</code> ⊗ 	Set blink settings. Format is <code>&lt;name&gt;[=&lt;value],&lt;name&gt;[=&lt;value&gt;]</code>,... The names are declared in Settings.json5. For boolean type, use "true", "false", or omit '<code>=&lt;value&gt;</code>' part to set to true. For enum type, use the int value of the enum value. Applied after other command line flags and prefs.  </li><li><code>--block-new-web-contents</code> ⊗ 	If true, then all pop-ups and calls to window.open will fail.  </li><li><code>--bootstrap</code> ⊗ 	Values for the kExtensionContentVerification flag. See ContentVerifierDelegate::Mode for more explanation.  </li><li><code>--bottom-gesture-start-height</code> ⊗ 	The number of pixels up from the bottom of the screen to consider as a valid origin for a bottom swipe gesture. If set, overrides the value of both the above system-gesture-start-height flag and the default value in cast_system_gesture_handler.cc.  </li><li><code>--browser</code> ⊗ 	No description  </li><li><code>--browser-startup-dialog</code> ⊗ 	Causes the browser process to display a dialog on launch.  </li><li><code>--browser-subprocess-path</code> ⊗ 	Path to the exe to run for the renderer and plugin subprocesses.  </li><li><code>--browser-test</code> ⊗ 	Tells whether the code is running browser tests (this changes the startup URL used by the content shell and also disables features that can make tests flaky <!-- -->[like monitoring of memory pressure]<!-- -->).  </li><li><code>--bwsi</code> ⊗ 	Indicates that the browser is in "browse without sign-in" (Guest session) mode. Should completely disable extensions, sync and bookmarks.  </li><li><code>--bypass-app-banner-engagement-checks</code> ⊗ 	This flag causes the user engagement checks for showing app banners to be bypassed. It is intended to be used by developers who wish to test that their sites otherwise meet the criteria needed to show app banners.  </li><li><code>--cast-app-background-color</code> ⊗ 	Background color used when Chromium hasn't rendered anything yet.  </li><li><code>--cast-initial-screen-height</code> ⊗ 	No description  </li><li><code>--cast-initial-screen-width</code> ⊗ 	Used to pass initial screen resolution to GPU process. This allows us to set screen size correctly (so no need to resize when first window is created).  </li><li><code>--cc-layer-tree-test-long-timeout</code> ⊗ 	Increases timeout for memory checkers.  </li><li><code>--cc-layer-tree-test-no-timeout</code> ⊗ 	Prevents the layer tree unit tests from timing out.  </li><li><code>--cc-scroll-animation-duration-in-seconds</code> ⊗ 	Controls the duration of the scroll animation curve.  </li><li><code>--cdm</code> ⊗ 	No description  </li><li><code>--cellular-first</code> ⊗ 	If this flag is set, it indicates that this device is a "Cellular First" device. Cellular First devices use cellular telephone data networks as their primary means of connecting to the internet. Setting this flag has two consequences: 1. Cellular data roaming will be enabled by default. 2. UpdateEngine will be instructed to allow auto-updating over cellular data connections.  </li><li><code>--check-accessibility-permission[8]</code> ⊗ 	No description  </li><li><code>--check-damage-early</code> ⊗ 	Checks damage early and aborts the frame if no damage, so that clients like Android WebView don't invalidate unnecessarily.  </li><li><code>--check-for-update-interval</code> ⊗ 	How often (in seconds) to check for updates. Should only be used for testing purposes.  </li><li><code>--check-permission[8]</code> ⊗ 	No description  </li><li><code>--check-screen-recording-permission[8]</code> ⊗ 	No description  </li><li><code>--child-wallpaper-large</code> ⊗ 	Default large wallpaper to use for kids accounts (as path to trusted, non-user-writable JPEG file).  </li><li><code>--child-wallpaper-small</code> ⊗ 	Default small wallpaper to use for kids accounts (as path to trusted, non-user-writable JPEG file).  </li><li><code>--chrome-mojo-pipe-token</code> ⊗ 	The Mojo pipe token for IPC communication between the Software Reporter and Chrome. Dropped in M80.  </li><li><code>--ChromeOSMemoryPressureHandling</code> ⊗ 	The memory pressure thresholds selection which is used to decide whether and when a memory pressure event needs to get fired.  </li><li><code>--cipher-suite-blacklist</code> ⊗ 	Comma-separated list of SSL cipher suites to disable.  </li><li><code>--clamshell</code> ⊗ 	Values for the kAshUiMode flag.  </li><li><code>--class[9]</code> ⊗ 	The same as the --class argument in X applications. Overrides the WM_CLASS window property with the given value.  </li><li><code>--cleaning-timeout</code> ⊗ 	Set the timeout for the cleaning phase, in minutes. 0 disables the timeout entirely. WARNING: this switch is used by internal test systems. Be careful when making changes.  </li><li><code>--cleanup-id</code> ⊗ 	Identifier used to group all reports generated during the same run of the cleaner, including runs before and after a reboot. The id is generated by the first cleaner process for a run, and propagated to spawned or scheduled cleaner processes. A new id will be generated in the first process for a subsequent cleanup, so cleanups from the same user cannot be tracked over time.  </li><li><code>--clear-key-cdm-path-for-testing</code> ⊗ 	Specifies the path to the Clear Key CDM for testing, which is necessary to support External Clear Key key system when library CDM is enabled. Note that External Clear Key key system support is also controlled by feature kExternalClearKeyForTesting.  </li><li><code>--clear-token-service</code> ⊗ 	Clears the token service before using it. This allows simulating the expiration of credentials during testing.  </li><li><code>--cloud-print-file</code> ⊗ 	Tells chrome to display the cloud print dialog and upload the specified file for printing.  </li><li><code>--cloud-print-file-type</code> ⊗ 	Specifies the mime type to be used when uploading data from the file referenced by cloud-print-file. Defaults to "application/pdf" if unspecified.  </li><li><code>--cloud-print-job-title</code> ⊗ 	Used with kCloudPrintFile to specify a title for the resulting print job.  </li><li><code>--cloud-print-print-ticket</code> ⊗ 	Used with kCloudPrintFile to specify a JSON print ticket for the resulting print job. Defaults to null if unspecified.  </li><li><code>--cloud-print-setup-proxy</code> ⊗ 	Setup cloud print proxy for provided printers. This does not start service or register proxy for autostart.  </li><li><code>--cloud-print-url</code> ⊗ 	The URL of the cloud print service to use, overrides any value stored in preferences, and the default. Only used if the cloud print service has been enabled. Used for testing.  </li><li><code>--cloud-print-xmpp-endpoint</code> ⊗ 	The XMPP endpoint the cloud print service will use. Only used if the cloud print service has been enabled. Used for testing.  </li><li><code>--compensate-for-unstable-pinch-zoom</code> ⊗ 	Enable compensation for unstable pinch zoom. Some touch screens display significant amount of wobble when moving a finger in a straight line. This makes two finger scroll trigger an oscillating pinch zoom. See crbug.com/394380 for details.  </li><li><code>--compile-shader-always-succeeds</code> ⊗ 	Always return success when compiling a shader. Linking will still fail.  </li><li><code>--component-updater</code> ⊗ 	Comma-separated options to troubleshoot the component updater. Only valid for the browser process.  </li><li><code>--connectivity-check-url</code> ⊗ 	Url for network connectivity checking. Default is "<a href="https://clients3.google.com/generate_204%22" target="_blank" rel="noopener noreferrer">https://clients3.google.com/generate_204"</a>.  </li><li><code>--conservative</code> ⊗ 	No description  </li><li><code>--content-directories</code> ⊗ 	No description  </li><li><code>--content-shell-hide-toolbar</code> ⊗ 	Hides toolbar from content_shell's host window.  </li><li><code>--content-shell-host-window-size</code> ⊗ 	Size for the content_shell's host window (i.e. "800x600").  </li><li><code>--controller</code> ⊗ 	No description  </li><li><code>--conversions-debug-mode</code> ⊗ 	Causes the Conversion Measurement API to run without delays or noise.  </li><li><code>--copy-to-download-dir</code> ⊗ 	Copy user action data to download directory.  </li><li><code>--cors-exempt-headers</code> ⊗ 	No description  </li><li><code>--crash</code> ⊗ 	Crash flag to force a crash right away. Mainly intended for ensuring crashes are properly recorded by crashpad.  </li><li><code>--crash-dumps-dir</code> ⊗ 	The directory breakpad should store minidumps in.  </li><li><code>--crash-handler</code> ⊗ 	Runs as the Crashpad handler.  </li><li><code>--crash-loop-before[5]</code> ⊗ 	A time_t. Passed by session_manager into the Chrome user session, indicating that if Chrome crashes before the indicated time, session_manager will consider this to be a crash-loop situation and log the user out. Chrome mostly just passes this to crash_reporter if it crashes.  </li><li><code>--crash-on-failure</code> ⊗ 	When specified to "enable-leak-detection" command-line option, causes the leak detector to cause immediate crash when found leak.  </li><li><code>--crash-on-hang-threads</code> ⊗ 	Comma-separated list of BrowserThreads that cause browser process to crash if the given browser thread is not responsive. UI/IO are the BrowserThreads that are supported. For example: --crash-on-hang-threads=UI:18,IO:18 --&gt; Crash the browser if UI or IO is not responsive for 18 seconds while the other browser thread is responsive.  </li><li><code>--crash-server-url</code> ⊗ 	Server url to upload crash data to. Default is "<a href="https://clients2.google.com/cr/report%22" target="_blank" rel="noopener noreferrer">https://clients2.google.com/cr/report"</a> for prod devices. Default is "<a href="https://clients2.google.com/cr/staging_report%22" target="_blank" rel="noopener noreferrer">https://clients2.google.com/cr/staging_report"</a> for non prod.  </li><li><code>--crash-test</code> ⊗ 	Causes the browser process to crash on startup.  </li><li><code>--crashpad-handler</code> ⊗ 	A process type (switches::kProcessType) that indicates chrome.exe or setup.exe is being launched as crashpad_handler. This is only used on Windows. We bundle the handler into chrome.exe on Windows because there is high probability of a "new" .exe being blocked or interfered with by application firewalls, AV software, etc. On other platforms, crashpad_handler is a standalone executable.  </li><li><code>--crashpad-handler-pid[10]</code> ⊗ 	The process ID of the Crashpad handler.  </li><li><code>--create-browser-on-startup-for-tests</code> ⊗ 	Some platforms like ChromeOS default to empty desktop. Browser tests may need to add this switch so that at least one browser instance is created on startup. TODO(nkostylev): Investigate if this switch could be removed. (<a href="http://crbug.com/148675" target="_blank" rel="noopener noreferrer">http://crbug.com/148675</a>)  </li><li><code>--cros-region</code> ⊗ 	Forces CrOS region value.  </li><li><code>--cros-regions-mode</code> ⊗ 	Control regions data load ("" is default).  </li><li><code>--crosh-command[5]</code> ⊗ 	Custom crosh command.  </li><li><code>--cryptauth-http-host</code> ⊗ 	Overrides the default URL for Google APIs (<a href="https://www.googleapis.com" target="_blank" rel="noopener noreferrer">https://www.googleapis.com</a>) used by CryptAuth.  </li><li><code>--cryptauth-v2-devicesync-http-host</code> ⊗ 	Overrides the default URL for CryptAuth v2 DeviceSync: <a href="https://cryptauthdevicesync.googleapis.com." target="_blank" rel="noopener noreferrer">https://cryptauthdevicesync.googleapis.com.</a>  </li><li><code>--cryptauth-v2-enrollment-http-host</code> ⊗ 	Overrides the default URL for CryptAuth v2 Enrollment: <a href="https://cryptauthenrollment.googleapis.com." target="_blank" rel="noopener noreferrer">https://cryptauthenrollment.googleapis.com.</a>  </li><li><code>--custom-android-messages-domain</code> ⊗ 	No description  </li><li><code>--custom-devtools-frontend</code> ⊗ 	Specifies the <code>http://</code> endpoint which will be used to serve <code>devtools://devtools/custom/&lt;path&gt;</code> Or a <code>file://</code> URL to specify a custom file path to load from for <code>devtools://devtools/bundled/&lt;path&gt;</code> </li><li><code>--custom-launcher-page</code> ⊗ 	Specifies the chrome-extension:// URL for the contents of an additional page added to the app launcher.  </li><li><code>--custom_summary[7]</code> ⊗ 	Forces a custom summary to be displayed below the update menu item.  </li><li><code>--d3d-support[1]</code> ⊗ 	No description  </li><li><code>--d3d11</code> ⊗ 	No description  </li><li><code>--d3d11-null</code> ⊗ 	Special switches for "NULL"/stub driver implementations.  </li><li><code>--d3d11on12</code> ⊗ 	No description  </li><li><code>--d3d9</code> ⊗ 	No description  </li><li><code>--daemon</code> ⊗ 	No description  </li><li><code>--dark</code> ⊗ 	No description  </li><li><code>--data-path</code> ⊗ 	Makes Content Shell use the given path for its data directory.  </li><li><code>--data-reduction-proxy-client-config</code> ⊗ 	Uses the encoded ClientConfig instead of fetching one from the config server. This value is always used, regardless of error or expiration. The value should be a base64 encoded binary protobuf.  </li><li><code>--data-reduction-proxy-config-url</code> ⊗ 	The URL from which to retrieve the Data Reduction Proxy configuration.  </li><li><code>--data-reduction-proxy-experiment</code> ⊗ 	The name of a Data Reduction Proxy experiment to run. These experiments are defined by the proxy server. Use --force-fieldtrials for Data Reduction Proxy field trials.  </li><li><code>--data-reduction-proxy-http-proxies</code> ⊗ 	The semicolon-separated list of proxy server URIs to override the list of HTTP proxies returned by the Data Saver API. It is illegal to use |kDataReductionProxy| or |kDataReductionProxyFallback| switch in conjunction with |kDataReductionProxyHttpProxies|. If the URI omits a scheme, then the proxy server scheme defaults to HTTP, and if the port is omitted then the default port for that scheme is used. E.g. "<a href="http://foo.net:80%22" target="_blank" rel="noopener noreferrer">http://foo.net:80"</a>, "<a href="http://foo.net%22" target="_blank" rel="noopener noreferrer">http://foo.net"</a>, "foo.net:80", and "foo.net" are all equivalent.  </li><li><code>--data-reduction-proxy-pingback-url</code> ⊗ 	No description  </li><li><code>--data-reduction-proxy-secure-proxy-check-url</code> ⊗ 	Sets a secure proxy check URL to test before committing to using the Data Reduction Proxy. Note this check does not go through the Data Reduction Proxy.  </li><li><code>--data-reduction-proxy-server-experiments-disabled</code> ⊗ 	Disables server experiments that may be enabled through field trial.  </li><li><code>--dbus-stub</code> ⊗ 	Forces the stub implementation of D-Bus clients.  </li><li><code>--de-jelly-screen-width</code> ⊗ 	Screen width is useful for debugging. Shipping implementations should detect this.  </li><li><code>--deadline-to-synchronize-surfaces</code> ⊗ 	The default number of the BeginFrames to wait to activate a surface with dependencies.  </li><li><code>--debug-devtools</code> ⊗ 	Run devtools tests in debug mode (not bundled and minified)  </li><li><code>--debug-enable-frame-toggle</code> ⊗ 	Enables a frame context menu item that toggles the frame in and out of glass mode (Windows Vista and up only).  </li><li><code>--debug-packed-apps</code> ⊗ 	Adds debugging entries such as Inspect Element to context menus of packed apps.  </li><li><code>--debug-print[11]</code> ⊗ 	Enables support to debug printing subsystem.  </li><li><code>--default</code> ⊗ 	No description  </li><li><code>--default-background-color</code> ⊗ 	The background color to be used if the page doesn't specify one. Provided as RGBA integer value in hex, e.g. 'ff0000ff' for red or '00000000' for transparent.  </li><li><code>--default-country-code[7]</code> ⊗ 	Default country code to be used for search engine localization.  </li><li><code>--default-tile-height</code> ⊗ 	No description  </li><li><code>--default-tile-width</code> ⊗ 	Sets the tile size used by composited layers.  </li><li><code>--default-wallpaper-is-oem</code> ⊗ 	Indicates that the wallpaper images specified by kAshDefaultWallpaper{Large,Small} are OEM-specific (i.e. they are not downloadable from Google).  </li><li><code>--default-wallpaper-large</code> ⊗ 	Default large wallpaper to use (as path to trusted, non-user-writable JPEG file).  </li><li><code>--default-wallpaper-small</code> ⊗ 	Default small wallpaper to use (as path to trusted, non-user-writable JPEG file).  </li><li><code>--deny-permission-prompts</code> ⊗ 	Prevents permission prompts from appearing by denying instead of showing prompts.  </li><li><code>--derelict-detection-timeout</code> ⊗ 	Time in seconds before a machine at OOBE is considered derelict.  </li><li><code>--derelict-idle-timeout</code> ⊗ 	Time in seconds before a derelict machines starts demo mode.  </li><li><code>--desktop</code> ⊗ 	No description  </li><li><code>--desktop-window-1080p</code> ⊗ 	When present, desktop cast_shell will create 1080p window (provided display resolution is high enough). Otherwise, cast_shell defaults to 720p.  </li><li><code>--deterministic-mode</code> ⊗ 	A meta flag. This sets a number of flags which put the browser into deterministic mode where begin frames should be issued over DevToolsProtocol (experimental).  </li><li><code>--device-management-url</code> ⊗ 	Specifies the URL at which to communicate with the device management backend to fetch configuration policies and perform other device tasks.  </li><li><code>--device-scale-factor[1]</code> ⊗ 	Device scale factor passed to certain processes like renderers, etc.  </li><li><code>--devtools-flags</code> ⊗ 	Passes command line parameters to the DevTools front-end.  </li><li><code>--diagnostics</code> ⊗ 	Triggers a plethora of diagnostic modes.  </li><li><code>--diagnostics-format</code> ⊗ 	Sets the output format for diagnostic modes enabled by diagnostics flag.  </li><li><code>--diagnostics-recovery</code> ⊗ 	Tells the diagnostics mode to do the requested recovery step(s).  </li><li><code>--disable-2d-canvas-clip-aa</code> ⊗ 	Disable antialiasing on 2d canvas clips  </li><li><code>--disable-2d-canvas-image-chromium</code> ⊗ 	Disables Canvas2D rendering into a scanout buffer for overlay support.  </li><li><code>--disable-3d-apis</code> ⊗ 	Disables client-visible 3D APIs, in particular WebGL and Pepper 3D. This is controlled by policy and is kept separate from the other enable/disable switches to avoid accidentally regressing the policy support for controlling access to these APIs.  </li><li><code>--disable-accelerated-2d-canvas</code> ⊗ 	Disable gpu-accelerated 2d canvas.  </li><li><code>--disable-accelerated-mjpeg-decode</code> ⊗ 	Disable hardware acceleration of mjpeg decode for captured frame, where available.  </li><li><code>--disable-accelerated-video-decode</code> ⊗ 	Disables hardware acceleration of video decode, where available.  </li><li><code>--disable-accelerated-video-encode</code> ⊗ 	Disables hardware acceleration of video encode, where available.  </li><li><code>--disable-and-delete-previous-log</code> ⊗ 	Disable cros action logging.  </li><li><code>--disable-angle-features</code> ⊗ 	Disables specified comma separated ANGLE features if found.  </li><li><code>--disable-app-list-dismiss-on-blur</code> ⊗ 	If set, the app list will not be dismissed when it loses focus. This is useful when testing the app list or a custom launcher page. It can still be dismissed via the other methods (like the Esc key).  </li><li><code>--disable-arc-cpu-restriction</code> ⊗ 	Prevents any CPU restrictions being set on the ARC container. Only meant to be used by tests as some tests may time out if the ARC container is throttled.  </li><li><code>--disable-arc-data-wipe</code> ⊗ 	Disables android user data wipe on opt out.  </li><li><code>--disable-arc-opt-in-verification</code> ⊗ 	Disables ARC Opt-in verification process and ARC is enabled by default.  </li><li><code>--disable-audio-output</code> ⊗ 	No description  </li><li><code>--disable-audio-support-for-desktop-share</code> ⊗ 	No description  </li><li><code>--disable-auto-reload</code> ⊗ 	Disable auto-reload of error pages.  </li><li><code>--disable-auto-wpt-origin-isolation</code> ⊗ 	Disables the automatic origin isolation of web platform test domains. We normally origin-isolate them for better test coverage, but tests of opt-in origin isolation need to disable this.  </li><li><code>--disable-avfoundation-overlays[6]</code> ⊗ 	Disable use of AVFoundation to draw video content.  </li><li><code>--disable-ax-menu-list</code> ⊗ 	Optionally disable AXMenuList, which makes the internal pop-up menu UI for a select element directly accessible.  </li><li><code>--disable-back-forward-cache</code> ⊗ 	Disables the BackForwardCache feature.  </li><li><code>--disable-background-media-suspend</code> ⊗ 	Do not immediately suspend media in background tabs.  </li><li><code>--disable-background-networking</code> ⊗ 	Disable several subsystems which run network requests in the background. This is for use when doing network performance testing to avoid noise in the measurements.  </li><li><code>--disable-background-timer-throttling</code> ⊗ 	Disable task throttling of timer tasks from background pages.  </li><li><code>--disable-backgrounding-occluded-windows</code> ⊗ 	Disable backgrounding renders for occluded windows. Done for tests to avoid nondeterministic behavior.  </li><li><code>--disable-backing-store-limit</code> ⊗ 	Disable limits on the number of backing stores. Can prevent blinking for users with many windows/tabs and lots of memory.  </li><li><code>--disable-best-effort-tasks</code> ⊗ 	Delays execution of TaskPriority::BEST_EFFORT tasks until shutdown.  </li><li><code>--disable-blink-features</code> ⊗ 	Disable one or more Blink runtime-enabled features. Use names from runtime_enabled_features.json5, separated by commas. Applied after kEnableBlinkFeatures, and after other flags that change these features.  </li><li><code>--disable-breakpad</code> ⊗ 	Disables the crash reporting.  </li><li><code>--disable-bundled-ppapi-flash</code> ⊗ 	Disables the bundled PPAPI version of Flash.  </li><li><code>--disable-cancel-all-touches[12]</code> ⊗ 	Disable CancelAllTouches() function for the implementation on cancel single touches.  </li><li><code>--disable-canvas-aa</code> ⊗ 	Disable antialiasing on 2d canvas.  </li><li><code>--disable-checker-imaging</code> ⊗ 	Disabled defering all image decodes to the image decode service, ignoring DecodingMode preferences specified on PaintImage.  </li><li><code>--disable-checking-optimization-guide-user-permissions</code> ⊗ 	No description  </li><li><code>--disable-client-side-phishing-detection</code> ⊗ 	Disables the client-side phishing detection feature. Note that even if client-side phishing detection is enabled, it will only be active if the user has opted in to UMA stats and SafeBrowsing is enabled in the preferences.  </li><li><code>--disable-component-cloud-policy</code> ⊗ 	Disables fetching and storing cloud policy for components.  </li><li><code>--disable-component-extensions-with-background-pages</code> ⊗ 	Disable default component extensions with background pages - useful for performance tests where these pages may interfere with perf results.  </li><li><code>--disable-component-update</code> ⊗ 	No description  </li><li><code>--disable-composited-antialiasing</code> ⊗ 	Disables layer-edge anti-aliasing in the compositor.  </li><li><code>--disable-cookie-encryption</code> ⊗ 	Whether cookies stored as part of user profile are encrypted.  </li><li><code>--disable-crash-reporter</code> ⊗ 	Disable crash reporter for headless. It is enabled by default in official builds.  </li><li><code>--disable-d3d11</code> ⊗ 	Disables use of D3D11.  </li><li><code>--disable-databases</code> ⊗ 	Disables HTML5 DB support.  </li><li><code>--disable-default-apps</code> ⊗ 	Disables installation of default apps on first run. This is used during automated testing.  </li><li><code>--disable-demo-mode</code> ⊗ 	Disables the Chrome OS demo.  </li><li><code>--disable-dev-shm-usage[13]</code> ⊗ 	The /dev/shm partition is too small in certain VM environments, causing Chrome to fail or crash (see <a href="http://crbug.com/715363" target="_blank" rel="noopener noreferrer">http://crbug.com/715363</a>). Use this flag to work-around this issue (a temporary directory will always be used to create anonymous shared memory files).  </li><li><code>--disable-device-disabling</code> ⊗ 	If this switch is set, the device cannot be remotely disabled by its owner.  </li><li><code>--disable-device-discovery-notifications</code> ⊗ 	Disables device discovery notifications.  </li><li><code>--disable-dinosaur-easter-egg</code> ⊗ 	Disables the dinosaur easter egg on the offline interstitial.  </li><li><code>--disable-direct-composition</code> ⊗ 	Disables DirectComposition surface.  </li><li><code>--disable-direct-composition-video-overlays</code> ⊗ 	Disables using DirectComposition video overlays, even if hardware overlays are supported.  </li><li><code>--disable-domain-blocking-for-3d-apis</code> ⊗ 	Disable the per-domain blocking for 3D APIs after GPU reset. This switch is intended only for tests.  </li><li><code>--disable-domain-reliability</code> ⊗ 	Disables Domain Reliability Monitoring.  </li><li><code>--disable-dwm-composition</code> ⊗ 	Disables use of DWM composition for top level windows.  </li><li><code>--disable-encryption-migration</code> ⊗ 	Disable encryption migration for user's cryptohome to run latest Arc.  </li><li><code>--disable-enterprise-policy</code> ⊗ 	Disables enterprise policy support.  </li><li><code>--disable-es3-gl-context</code> ⊗ 	Disables use of ES3 backend (use ES2 backend instead).  </li><li><code>--disable-es3-gl-context-for-testing</code> ⊗ 	Disables use of ES3 backend at a lower level, for testing purposes. This isn't guaranteed to work everywhere, so it's test-only.  </li><li><code>--disable-experimental-accessibility-chromevox-language-switching</code> ⊗ 	Disables ChromeVox language switching feature.  </li><li><code>--disable-experimental-accessibility-chromevox-search-menus</code> ⊗ 	Disables ChromeVox search menus feature.  </li><li><code>--disable-explicit-dma-fences</code> ⊗ 	Disable explicit DMA-fences  </li><li><code>--disable-extensions</code> ⊗ 	Disable extensions.  </li><li><code>--disable-extensions-except</code> ⊗ 	Disable extensions except those specified in a comma-separated list.  </li><li><code>--disable-extensions-file-access-check</code> ⊗ 	Disable checking for user opt-in for extensions that want to inject script into file URLs (ie, always allow it). This is used during automated testing.  </li><li><code>--disable-extensions-http-throttling</code> ⊗ 	Disable the net::URLRequestThrottlerManager functionality for requests originating from extensions.  </li><li><code>--disable-features</code> ⊗ 	Comma-separated list of feature names to disable. See also kEnableFeatures.  </li><li><code>--disable-fetching-hints-at-navigation-start</code> ⊗ 	No description  </li><li><code>--disable-field-trial-config</code> ⊗ 	Disable field trial tests configured in fieldtrial_testing_config.json.  </li><li><code>--disable-file-system</code> ⊗ 	Disable FileSystem API.  </li><li><code>--disable-fine-grained-time-zone-detection</code> ⊗ 	Disables fine grained time zone detection.  </li><li><code>--disable-flash-3d</code> ⊗ 	Disable 3D inside of flapper.  </li><li><code>--disable-flash-stage3d</code> ⊗ 	Disable Stage3D inside of flapper.  </li><li><code>--disable-font-subpixel-positioning</code> ⊗ 	Force disables font subpixel positioning. This affects the character glyph sharpness, kerning, hinting and layout.  </li><li><code>--disable-frame-rate-limit</code> ⊗ 	Disables begin frame limiting in both cc scheduler and display scheduler. Also implies --disable-gpu-vsync (see //ui/gl/gl_switches.h).  </li><li><code>--disable-gaia-services</code> ⊗ 	Disables GAIA services such as enrollment and OAuth session restore. Used by 'fake' telemetry login.  </li><li><code>--disable-gesture-requirement-for-presentation</code> ⊗ 	Disable user gesture requirement for presentation.  </li><li><code>--disable-gl-drawing-for-tests</code> ⊗ 	Disables GL drawing operations which produce pixel output. With this the GL output will not be correct but tests will run faster.  </li><li><code>--disable-gl-error-limit</code> ⊗ 	Disable the GL error log limit.  </li><li><code>--disable-gl-extensions</code> ⊗ 	Disables specified comma separated GL Extensions if found.  </li><li><code>--disable-glsl-translator</code> ⊗ 	Disable the GLSL translator.  </li><li><code>--disable-gpu</code> ⊗ 	Disables GPU hardware acceleration. If software renderer is not in place, then the GPU process won't launch.  </li><li><code>--disable-gpu-compositing</code> ⊗ 	Prevent the compositor from using its GPU implementation.  </li><li><code>--disable-gpu-driver-bug-workarounds</code> ⊗ 	Disable workarounds for various GPU driver bugs.  </li><li><code>--disable-gpu-early-init</code> ⊗ 	Disable proactive early init of GPU process.  </li><li><code>--disable-gpu-memory-buffer-compositor-resources</code> ⊗ 	Do not force that all compositor resources be backed by GPU memory buffers.  </li><li><code>--disable-gpu-memory-buffer-video-frames</code> ⊗ 	Disable GpuMemoryBuffer backed VideoFrames.  </li><li><code>--disable-gpu-process-crash-limit</code> ⊗ 	For tests, to disable the limit on the number of times the GPU process may be restarted.  </li><li><code>--disable-gpu-process-for-dx12-info-collection</code> ⊗ 	Disables the non-sandboxed GPU process for DX12 info collection  </li><li><code>--disable-gpu-program-cache</code> ⊗ 	Turn off gpu program caching  </li><li><code>--disable-gpu-rasterization</code> ⊗ 	Disable GPU rasterization, i.e. rasterize on the CPU only. Overrides the kEnableGpuRasterization flag.  </li><li><code>--disable-gpu-sandbox</code> ⊗ 	Disables the GPU process sandbox.  </li><li><code>--disable-gpu-shader-disk-cache</code> ⊗ 	Disables the GPU shader on disk cache.  </li><li><code>--disable-gpu-vsync</code> ⊗ 	Stop the GPU from synchronizing presentation with vblank.  </li><li><code>--disable-gpu-watchdog</code> ⊗ 	Disable the thread that crashes the GPU process if it stops responding to messages.  </li><li><code>--disable-hang-monitor</code> ⊗ 	Suppresses hang monitor dialogs in renderer processes. This may allow slow unload handlers on a page to prevent the tab from closing, but the Task Manager can be used to terminate the offending process in this case.  </li><li><code>--disable-headless-mode</code> ⊗ 	Disables the shell from beginning in headless mode. Tests will then attempt to use the hardware GPU for rendering. This is only followed when kRunWebTests is set.  </li><li><code>--disable-hid-detection-on-oobe</code> ⊗ 	Disables HID-detection OOBE screen.  </li><li><code>--disable-highres-timer[1]</code> ⊗ 	Disable high-resolution timer on Windows.  </li><li><code>--disable-histogram-customizer</code> ⊗ 	Disable the RenderThread's HistogramCustomizer.  </li><li><code>--disable-hosted-app-shim-creation[6]</code> ⊗ 	Disables app shim creation for hosted apps on Mac.  </li><li><code>--disable-image-animation-resync</code> ⊗ 	Disallow image animations to be reset to the beginning to avoid skipping many frames. Only effective if compositor image animations are enabled.  </li><li><code>--disable-in-process-stack-traces</code> ⊗ 	Disables the in-process stack traces.  </li><li><code>--disable-ios-password-suggestions</code> ⊗ 	Disable showing available password credentials in the keyboard accessory view when focused on form fields.  </li><li><code>--disable-ipc-flooding-protection</code> ⊗ 	Disables the IPC flooding protection. It is activated by default. Some javascript functions can be used to flood the browser process with IPC. This protection limits the rate at which they can be used.  </li><li><code>--disable-javascript-harmony-shipping</code> ⊗ 	Disable latest shipping ECMAScript 6 features.  </li><li><code>--disable-kill-after-bad-ipc</code> ⊗ 	Don't kill a child process when it sends a bad IPC message. Apart from testing, it is a bad idea from a security perspective to enable this switch.  </li><li><code>--disable-layer-tree-host-memory-pressure</code> ⊗ 	Disables LayerTreeHost::OnMemoryPressure  </li><li><code>--disable-lcd-text</code> ⊗ 	Disables LCD text.  </li><li><code>--disable-legacy-window[1]</code> ⊗ 	Disable the Legacy Window which corresponds to the size of the WebContents.  </li><li><code>--disable-local-storage</code> ⊗ 	Disable LocalStorage.  </li><li><code>--disable-logging</code> ⊗ 	Force logging to be disabled. Logging is enabled by default in debug builds.  </li><li><code>--disable-logging-redirect[5]</code> ⊗ 	Disables logging redirect for testing.  </li><li><code>--disable-login-animations</code> ⊗ 	Avoid doing expensive animations upon login.  </li><li><code>--disable-login-screen-apps[5]</code> ⊗ 	Disables apps on the login screen. By default, they are allowed and can be installed through policy.  </li><li><code>--disable-low-end-device-mode</code> ⊗ 	Force disabling of low-end device mode when set.  </li><li><code>--disable-low-latency-dxva</code> ⊗ 	Disables using CODECAPI_AVLowLatencyMode when creating DXVA decoders.  </li><li><code>--disable-low-res-tiling</code> ⊗ 	When using CPU rasterizing disable low resolution tiling. This uses less power, particularly during animations, but more white may be seen during fast scrolling especially on slower devices.  </li><li><code>--disable-mac-overlays[6]</code> ⊗ 	Fall back to using CAOpenGLLayers display content, instead of the IOSurface based overlay display path.  </li><li><code>--disable-machine-cert-request</code> ⊗ 	Disables requests for an enterprise machine certificate during attestation.  </li><li><code>--disable-main-frame-before-activation</code> ⊗ 	Disables sending the next BeginMainFrame before the previous commit activates. Overrides the kEnableMainFrameBeforeActivation flag.  </li><li><code>--disable-media-session-api[7]</code> ⊗ 	Disable Media Session API  </li><li><code>--disable-metal-test-shaders</code> ⊗ 	No description  </li><li><code>--disable-modal-animations[6]</code> ⊗ 	Disable animations for showing and hiding modal dialogs.  </li><li><code>--disable-mojo-renderer</code> ⊗ 	Rather than use the renderer hosted remotely in the media service, fall back to the default renderer within content_renderer. Does not change the behavior of the media service.  </li><li><code>--disable-multi-display-layout</code> ⊗ 	Disables the multiple display layout UI.  </li><li><code>--disable-namespace-sandbox</code> ⊗ 	Disables usage of the namespace sandbox.  </li><li><code>--disable-new-content-rendering-timeout</code> ⊗ 	Disables clearing the rendering output of a renderer when it didn't commit new output for a while after a top-frame navigation.  </li><li><code>--disable-notifications</code> ⊗ 	Disables the Web Notification and the Push APIs.  </li><li><code>--disable-nv12-dxgi-video</code> ⊗ 	Disables the video decoder from drawing to an NV12 textures instead of ARGB.  </li><li><code>--disable-offer-store-unmasked-wallet-cards</code> ⊗ 	Force hiding the local save checkbox in the autofill dialog box for getting the full credit card number for a wallet card. The card will never be stored locally.  </li><li><code>--disable-oop-rasterization</code> ⊗ 	Disables OOP rasterization. Takes precedence over the enable flag.  </li><li><code>--disable-oopr-debug-crash-dump[7]</code> ⊗ 	Disables debug crash dumps for OOPR.  </li><li><code>--disable-oor-cors</code> ⊗ 	Disable OOR-CORS in child processes regardless of the base::Feature flag.  </li><li><code>--disable-origin-trial-controlled-blink-features</code> ⊗ 	Disables all RuntimeEnabledFeatures that can be enabled via OriginTrials.  </li><li><code>--disable-overscroll-edge-effect[7]</code> ⊗ 	Disable overscroll edge effects like those found in Android views.  </li><li><code>--disable-partial-raster</code> ⊗ 	Disable partial raster in the renderer. Disabling this switch also disables the use of persistent gpu memory buffers.  </li><li><code>--disable-pepper-3d</code> ⊗ 	Disable Pepper3D.  </li><li><code>--disable-pepper-3d-image-chromium</code> ⊗ 	Disable Image Chromium for Pepper 3d.  </li><li><code>--disable-per-user-timezone</code> ⊗ 	Disables per-user timezone.  </li><li><code>--disable-permissions-api</code> ⊗ 	Disables the Permissions API.  </li><li><code>--disable-pinch</code> ⊗ 	Disables compositor-accelerated touch-screen pinch gestures.  </li><li><code>--disable-pnacl-crash-throttling</code> ⊗ 	Disables crash throttling for Portable Native Client.  </li><li><code>--disable-popup-blocking</code> ⊗ 	Disables pop-up blocking.  </li><li><code>--disable-prefer-compositing-to-lcd-text</code> ⊗ 	Disable the creation of compositing layers when it would prevent LCD text.  </li><li><code>--disable-presentation-api</code> ⊗ 	Disables the Presentation API.  </li><li><code>--disable-print-preview</code> ⊗ 	Disables print preview (For testing, and for users who don't like us. :[ )  </li><li><code>--disable-prompt-on-repost</code> ⊗ 	Normally when the user attempts to navigate to a page that was the result of a post we prompt to make sure they want to. This switch may be used to disable that check. This switch is used during automated testing.  </li><li><code>--disable-pull-to-refresh-effect[7]</code> ⊗ 	Disable the pull-to-refresh effect when vertically overscrolling content.  </li><li><code>--disable-pushstate-throttle</code> ⊗ 	Disables throttling of history.pushState/replaceState calls.  </li><li><code>--disable-reading-from-canvas</code> ⊗ 	Taints all <code>&lt;canvas&gt;</code> elements, regardless of origin.  </li><li><code>--disable-remote-core-animation[6]</code> ⊗ 	Disable use of cross-process CALayers to display content directly from the GPU process on Mac.  </li><li><code>--disable-remote-fonts</code> ⊗ 	Disables remote web font support. SVG font should always work whether this option is specified or not.  </li><li><code>--disable-remote-playback-api</code> ⊗ 	Disables the RemotePlayback API.  </li><li><code>--disable-renderer-accessibility</code> ⊗ 	Turns off the accessibility in the renderer.  </li><li><code>--disable-renderer-backgrounding</code> ⊗ 	Prevent renderer process backgrounding when set.  </li><li><code>--disable-resource-scheduler</code> ⊗ 	Whether the ResourceScheduler is disabled. Note this is only useful for C++ Headless embedders who need to implement their own resource scheduling.  </li><li><code>--disable-rgba-4444-textures</code> ⊗ 	Disables RGBA_4444 textures.  </li><li><code>--disable-rollback-option</code> ⊗ 	Disables rollback option on reset screen.  </li><li><code>--disable-rtc-smoothness-algorithm</code> ⊗ 	Disables the new rendering algorithm for webrtc, which is designed to improve the rendering smoothness.  </li><li><code>--disable-running-as-system-compositor</code> ⊗ 	Disable running as system compositor.  </li><li><code>--disable-screen-orientation-lock[7]</code> ⊗ 	Disable the locking feature of the screen orientation API.  </li><li><code>--disable-scroll-to-text-fragment</code> ⊗ 	This switch disables the ScrollToTextFragment feature.  </li><li><code>--disable-search-geolocation-disclosure</code> ⊗ 	Disables showing the search geolocation disclosure UI. Used for perf testing.  </li><li><code>--disable-seccomp-filter-sandbox</code> ⊗ 	Disable the seccomp filter sandbox (seccomp-bpf) (Linux only).  </li><li><code>--disable-setuid-sandbox</code> ⊗ 	Disable the setuid sandbox (Linux only).  </li><li><code>--disable-shader-name-hashing</code> ⊗ 	Turn off user-defined name hashing in shaders.  </li><li><code>--disable-shared-workers</code> ⊗ 	Disable shared workers.  </li><li><code>--disable-signin-frame-client-certs</code> ⊗ 	Disables client certificate authentication on the sign-in frame on the Chrome OS sign-in profile. <a href="https://crbug.com/844022" target="_blank" rel="noopener noreferrer">TODO</a>: Remove this flag when reaching endpoints that request client certs does not hang anymore when there is no system token yet.  </li><li><code>--disable-signin-scoped-device-id</code> ⊗ 	Disables sending signin scoped device id to LSO with refresh token request.  </li><li><code>--disable-site-isolation-for-policy[7]</code> ⊗ 	Just like kDisableSiteIsolation, but doesn't show the "stability and security will suffer" butter bar warning.  </li><li><code>--disable-site-isolation-trials</code> ⊗ 	Disables site isolation. Note that the opt-in (to site-per-process, isolate-origins, etc.) via enterprise policy and/or cmdline takes precedence over the kDisableSiteIsolation switch (i.e. the opt-in takes effect despite potential presence of kDisableSiteIsolation switch). Note that for historic reasons the name of the switch misleadingly mentions "trials", but the switch also disables the default site isolation that ships on desktop since M67. The name of the switch is preserved for backcompatibility of chrome://flags.  </li><li><code>--disable-skia-runtime-opts</code> ⊗ 	Do not use runtime-detected high-end CPU optimizations in Skia. This is useful for forcing a baseline code path for e.g. web tests.  </li><li><code>--disable-smooth-scrolling</code> ⊗ 	Disable smooth scrolling for testing.  </li><li><code>--disable-software-compositing-fallback</code> ⊗ 	For tests, to disable falling back to software compositing if the GPU Process has crashed, and reached the GPU Process crash limit.  </li><li><code>--disable-software-rasterizer</code> ⊗ 	Disables the use of a 3D software rasterizer.  </li><li><code>--disable-software-video-decoders</code> ⊗ 	No description  </li><li><code>--disable-speech-api</code> ⊗ 	Disables the Web Speech API (both speech recognition and synthesis).  </li><li><code>--disable-speech-synthesis-api</code> ⊗ 	Disables the speech synthesis part of Web Speech API.  </li><li><code>--disable-sync</code> ⊗ 	Disables syncing browser data to a Google Account.  </li><li><code>--disable-sync-types</code> ⊗ 	Disables syncing one or more sync data types that are on by default. See sync/base/model_type.h for possible types. Types should be comma separated, and follow the naming convention for string representation of model types, e.g.: --disable-synctypes='Typed URLs, Bookmarks, Autofill Profiles'  </li><li><code>--disable-system-font-check</code> ⊗ 	Disables the check for the system font when specified.  </li><li><code>--disable-test-root-certs</code> ⊗ 	Disables adding the test certs in the network process.  </li><li><code>--disable-third-party-keyboard-workaround</code> ⊗ 	Disables the 3rd party keyboard omnibox workaround.  </li><li><code>--disable-threaded-animation</code> ⊗ 	No description  </li><li><code>--disable-threaded-compositing</code> ⊗ 	Disable multithreaded GPU compositing of web content.  </li><li><code>--disable-threaded-scrolling</code> ⊗ 	Disable multithreaded, compositor scrolling of web content.  </li><li><code>--disable-timeouts-for-profiling[7]</code> ⊗ 	Disable timeouts that may cause the browser to die when running slowly. This is useful if running with profiling (such as debug malloc).  </li><li><code>--disable-touch-adjustment</code> ⊗ 	Disables touch adjustment.  </li><li><code>--disable-touch-drag-drop</code> ⊗ 	Disables touch event based drag and drop.  </li><li><code>--disable-usb-keyboard-detect[1]</code> ⊗ 	Disables the USB keyboard detection for blocking the OSK on Win8+.  </li><li><code>--disable-v8-idle-tasks</code> ⊗ 	Disable V8 idle tasks.  </li><li><code>--disable-video-capture-use-gpu-memory-buffer</code> ⊗ 	This is for the same feature controlled by kVideoCaptureUseGpuMemoryBuffer. kVideoCaptureUseGpuMemoryBuffer is settled by chromeos overlays. This flag is necessary to overwrite the settings via chrome:// flag. The behavior of chrome://flag#zero-copy-video-capture is as follows; Default : Respect chromeos overlays settings. Enabled : Force to enable kVideoCaptureUseGpuMemoryBuffer. Disabled : Force to disable kVideoCaptureUseGpuMemoryBuffer.  </li><li><code>--disable-volume-adjust-sound</code> ⊗ 	Disables volume adjust sound.  </li><li><code>--disable-vsync-for-tests</code> ⊗ 	No description  </li><li><code>--disable-vulkan-fallback-to-gl-for-testing</code> ⊗ 	Disables falling back to GL based hardware rendering if initializing Vulkan fails. This is to allow tests to catch regressions in Vulkan.  </li><li><code>--disable-vulkan-surface</code> ⊗ 	Disables VK_KHR_surface extension. Instead of using swapchain, bitblt will be used for present render result on screen.  </li><li><code>--disable-wake-on-wifi</code> ⊗ 	Disables wake on wifi features.  </li><li><code>--disable-web-security</code> ⊗ 	Don't enforce the same-origin policy. (Used by people testing their sites.)  </li><li><code>--disable-webgl</code> ⊗ 	Disable all versions of WebGL.  </li><li><code>--disable-webgl-image-chromium</code> ⊗ 	Disables WebGL rendering into a scanout buffer for overlay support.  </li><li><code>--disable-webgl2</code> ⊗ 	Disable WebGL2.  </li><li><code>--disable-webrtc-encryption</code> ⊗ 	Disables encryption of RTP Media for WebRTC. When Chrome embeds Content, it ignores this switch on its stable and beta channels.  </li><li><code>--disable-webrtc-hw-decoding</code> ⊗ 	Disables HW decode acceleration for WebRTC.  </li><li><code>--disable-webrtc-hw-encoding</code> ⊗ 	Disables HW encode acceleration for WebRTC.  </li><li><code>--disable-windows10-custom-titlebar[1]</code> ⊗ 	Disables custom-drawing the window titlebar on Windows 10.  </li><li><code>--disable-yuv-image-decoding</code> ⊗ 	Disable YUV image decoding for those formats and cases where it's supported. Has no effect unless GPU rasterization is enabled.  </li><li><code>--disable-yuv420-biplanar</code> ⊗ 	Disable a NV12 format buffer allocation with gfx::BufferUsage::SCANOUT_CPU_READ_WRITE usage.  </li><li><code>--disable-zero-browsers-open-for-tests</code> ⊗ 	Some tests seem to require the application to close when the last browser window is closed. Thus, we need a switch to force this behavior for ChromeOS Aura, disable "zero window mode". TODO(pkotwicz): Investigate if this bug can be removed. (<a href="http://crbug.com/119175" target="_blank" rel="noopener noreferrer">http://crbug.com/119175</a>)  </li><li><code>--disable-zero-copy</code> ⊗ 	Disable rasterizer that writes directly to GPU memory associated with tiles.  </li><li><code>--disable-zero-copy-dxgi-video</code> ⊗ 	Disable the video decoder from drawing directly to a texture.  </li><li><code>--disabled</code> ⊗ 	No description  </li><li><code>--disallow-non-exact-resource-reuse</code> ⊗ 	Disable re-use of non-exact resources to fulfill ResourcePool requests. Intended only for use in layout or pixel tests to reduce noise.  </li><li><code>--discoverability</code> ⊗ 	No description  </li><li><code>--disk-cache-dir</code> ⊗ 	Use a specific disk cache location, rather than one derived from the UserDatadir.  </li><li><code>--disk-cache-size</code> ⊗ 	Forces the maximum disk space to be used by the disk cache, in bytes.  </li><li><code>--display</code> ⊗ 	Which X11 display to connect to. Emulates the GTK+ "--display=" command line argument.  </li><li><code>--dmg-device[6]</code> ⊗ 	When switches::kProcessType is switches::kRelauncherProcess, if this switch is also present, the relauncher process will unmount and eject a mounted disk image and move its disk image file to the trash. The argument's value must be a BSD device name of the form "diskN" or "diskNsM".  </li><li><code>--dns-log-details</code> ⊗ 	No description  </li><li><code>--document-user-activation-required</code> ⊗ 	Autoplay policy that requires a document user activation.  </li><li><code>--dom-automation</code> ⊗ 	Specifies if the |DOMAutomationController| needs to be bound in the renderer. This binding happens on per-frame basis and hence can potentially be a performance bottleneck. One should only enable it when automating dom based tests.  </li><li><code>--dont-require-litepage-redirect-infobar</code> ⊗ 	Do not require the user notification InfoBar to be shown before triggering a Lite Page Redirect preview.  </li><li><code>--double-buffer-compositing</code> ⊗ 	Sets the number of max pending frames in the GL buffer queue to 1.  </li><li><code>--draw-view-bounds-rects</code> ⊗ 	Draws a semitransparent rect to indicate the bounds of each view.  </li><li><code>--dump-blink-runtime-call-stats</code> ⊗ 	Logs Runtime Call Stats for Blink. --single-process also needs to be used along with this for the stats to be logged.  </li><li><code>--dump-browser-histograms</code> ⊗ 	Requests that a running browser process dump its collected histograms to a given file. The file is overwritten if it exists.  </li><li><code>--dump-dom</code> ⊗ 	Instructs headless_shell to print document.body.innerHTML to stdout.  </li><li><code>--dump-raw-logs</code> ⊗ 	Dump the raw logs to a file with the same base name as the executable. The dumped file is a raw protobuf and has a "pb" extension. WARNING: this switch is used by internal test systems. Be careful when making changes.  </li><li><code>--easy-unlock-app-path</code> ⊗ 	Overrides the path of Easy Unlock component app.  </li><li><code>--edge-touch-filtering[12]</code> ⊗ 	Tells Chrome to do edge touch filtering. Useful for convertible tablet.  </li><li><code>--egl</code> ⊗ 	No description  </li><li><code>--elevate</code> ⊗ 	No description  </li><li><code>--elevated</code> ⊗ 	Identify that the process is already supposed to be elevated, so that we don't try again.  </li><li><code>--embedded-extension-options</code> ⊗ 	Enables extension options to be embedded in chrome://extensions rather than a new tab.  </li><li><code>--emulate-shader-precision</code> ⊗ 	Emulate ESSL lowp and mediump float precisions by mutating the shaders to round intermediate values in ANGLE.  </li><li><code>--enable-accelerated-2d-canvas</code> ⊗ 	Enable accelerated 2D canvas.  </li><li><code>--enable-accessibility-object-model</code> ⊗ 	Enable the experimental Accessibility Object Model APIs in development.  </li><li><code>--enable-accessibility-tab-switcher[7]</code> ⊗ 	Enable the accessibility tab switcher.  </li><li><code>--enable-adaptive-selection-handle-orientation[7]</code> ⊗ 	Enable inverting of selection handles so that they are not clipped by the viewport boundaries.  </li><li><code>--enable-aggressive-domstorage-flushing</code> ⊗ 	Enable the aggressive flushing of DOM Storage to minimize data loss.  </li><li><code>--enable-angle-features</code> ⊗ 	ANGLE features are defined per-backend in third_party/angle/include/platform Enables specified comma separated ANGLE features if found.  </li><li><code>--enable-app-list</code> ⊗ 	If set, the app list will be enabled as if enabled from CWS.  </li><li><code>--enable-arc</code> ⊗ 	DEPRECATED. Please use --arc-availability=officially-supported. Enables starting the ARC instance upon session start.  </li><li><code>--enable-arcvm</code> ⊗ 	Enables ARC VM.  </li><li><code>--enable-audio-debug-recordings-from-extension</code> ⊗ 	If the WebRTC logging private API is active, enables audio debug recordings.  </li><li><code>--enable-auto-reload</code> ⊗ 	Enable auto-reload of error pages.  </li><li><code>--enable-automation</code> ⊗ 	Enable indication that browser is controlled by automation.  </li><li><code>--enable-background-tracing</code> ⊗ 	Enables background and upload trace to trace-upload-url. Trigger rules are pass as an argument.  </li><li><code>--enable-begin-frame-control</code> ⊗ 	Whether or not begin frames should be issued over DevToolsProtocol (experimental).  </li><li><code>--enable-benchmarking</code> ⊗ 	TODO(asvitkine): Consider removing or renaming this functionality. Enables the benchmarking extensions.  </li><li><code>--enable-ble-advertising-in-apps</code> ⊗ 	Enable BLE Advertisiing in apps.  </li><li><code>--enable-blink-features</code> ⊗ 	Enable one or more Blink runtime-enabled features. Use names from runtime_enabled_features.json5, separated by commas. Applied before kDisableBlinkFeatures, and after other flags that change these features.  </li><li><code>--enable-blink-test-features</code> ⊗ 	Enables blink runtime enabled features with status:"test" or status:"experimental", which are enabled when running web tests.  </li><li><code>--enable-bluetooth-spp-in-serial-api</code> ⊗ 	Enable serial communication for SPP devices.  </li><li><code>--enable-bookmark-undo</code> ⊗ 	Enables the multi-level undo system for bookmarks.  </li><li><code>--enable-caret-browsing</code> ⊗ 	Enable native caret browsing, in which a moveable cursor is placed on a web page, allowing a user to select and navigate through non-editable text using just a keyboard. See <a href="https://crbug.com/977390" target="_blank" rel="noopener noreferrer">https://crbug.com/977390</a> for links to i2i.  </li><li><code>--enable-cast-receiver</code> ⊗ 	Enables the Cast Receiver.  </li><li><code>--enable-cast-streaming-receiver</code> ⊗ 	No description  </li><li><code>--enable-chrome-browser-cloud-management</code> ⊗ 	Enables Chrome Browser Cloud Management flow.  </li><li><code>--enable-chrome-tracing-computation</code> ⊗ 	Enable the tracing service.  </li><li><code>--enable-cloud-print-proxy</code> ⊗ 	This applies only when the process type is "service". Enables the Cloud Print Proxy component within the service process.  </li><li><code>--enable-consumer-kiosk</code> ⊗ 	Enables consumer kiosk mode for Chrome OS.  </li><li><code>--enable-crash-reporter</code> ⊗ 	Enable crash reporter for headless.  </li><li><code>--enable-crash-reporter-for-testing[14]</code> ⊗ 	Used for turning on Breakpad crash reporting in a debug environment where crash reporting is typically compiled but disabled.  </li><li><code>--enable-cros-action-recorder</code> ⊗ 	If set, the CrOSActionRecorder will be enabled which will record some user actions on device.  </li><li><code>--enable-crx-hash-check</code> ⊗ 	Enable package hash check: the .crx file sha256 hash sum should be equal to the one received from update manifest.  </li><li><code>--enable-data-reduction-proxy-bypass-warning</code> ⊗ 	Enable the data reduction proxy bypass warning.  </li><li><code>--enable-data-reduction-proxy-force-pingback</code> ⊗ 	Enables sending a pageload metrics pingback after every page load.  </li><li><code>--enable-data-reduction-proxy-savings-promo</code> ⊗ 	Enables a 1 MB savings promo for the data reduction proxy.  </li><li><code>--enable-dawn-backend-validation</code> ⊗ 	Enable validation layers in Dawn backends.  </li><li><code>--enable-de-jelly</code> ⊗ 	Experimental de-jelly support.  </li><li><code>--enable-defer-all-script-without-optimization-hints</code> ⊗ 	Allows defer script preview on all https pages even if optimization hints are missing for that webpage.  </li><li><code>--enable-device-discovery-notifications</code> ⊗ 	Enable device discovery notifications.  </li><li><code>--enable-dim-shelf</code> ⊗ 	Enables Shelf Dimming for ChromeOS.  </li><li><code>--enable-direct-composition-video-overlays</code> ⊗ 	Enables using DirectComposition video overlays, even if hardware overlays aren't supported.  </li><li><code>--enable-distillability-service</code> ⊗ 	No description  </li><li><code>--enable-dom-distiller</code> ⊗ 	No description  </li><li><code>--enable-domain-reliability</code> ⊗ 	Enables Domain Reliability Monitoring.  </li><li><code>--enable-encryption-migration</code> ⊗ 	Enables encryption migration for user's cryptohome to run latest Arc.  </li><li><code>--enable-encryption-selection[9]</code> ⊗ 	Enables the feature of allowing the user to disable the backend via a setting.  </li><li><code>--enable-enterprise-policy</code> ⊗ 	Enables enterprise policy support.  </li><li><code>--enable-exclusive-audio[1]</code> ⊗ 	Use exclusive mode audio streaming for Windows Vista and higher. Leads to lower latencies for audio streams which uses the AudioParameters::AUDIO_PCM_LOW_LATENCY audio path. See <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/dd370844.aspx" target="_blank" rel="noopener noreferrer">http://msdn.microsoft.com/en-us/library/windows/desktop/dd370844.aspx</a> for details.  </li><li><code>--enable-experimental-accessibility-autoclick</code> ⊗ 	Shows additional automatic click features that haven't launched yet.  </li><li><code>--enable-experimental-accessibility-chromevox-annotations</code> ⊗ 	Enables annotations feature that hasn't launched yet.  </li><li><code>--enable-experimental-accessibility-chromevox-tutorial</code> ⊗ 	Enables interactive tutorial for ChromeVox.  </li><li><code>--enable-experimental-accessibility-labels-debugging</code> ⊗ 	Enables support for visually debugging the accessibility labels feature, which provides images descriptions for screen reader users.  </li><li><code>--enable-experimental-accessibility-language-detection</code> ⊗ 	Enables language detection on in-page text content which is then exposed to assistive technology such as screen readers.  </li><li><code>--enable-experimental-accessibility-language-detection-dynamic</code> ⊗ 	Enables language detection for dynamic content which is then exposed to assistive technology such as screen readers.  </li><li><code>--enable-experimental-accessibility-switch-access</code> ⊗ 	Shows setting to enable Switch Access before it has launched.  </li><li><code>--enable-experimental-accessibility-switch-access-text</code> ⊗ 	Enables in progress Switch Access features for text input.  </li><li><code>--enable-experimental-cookie-features</code> ⊗ 	Flag that turns on a group of experimental/newly added cookie-related features together, as a convenience for e.g. testing, to avoid having to set multiple switches individually which may be error-prone (not to mention tedious). There is not a corresponding switch to disable all these features, because that is discouraged, and for testing purposes you'd need to switch them off individually to identify the problematic feature anyway. At present this turns on: net::features::kCookiesWithoutSameSiteMustBeSecure net::features::kSameSiteByDefaultCookies net::features::kSameSiteDefaultChecksMethodRigorously It will soon also turn on: content_settings::kImprovedCookieControls content_settings::kImprovedCookieControlsForThirdPartyCookieBlocking net::features::kSchemefulSameSite  </li><li><code>--enable-experimental-extension-apis</code> ⊗ 	Enables extension APIs that are in development.  </li><li><code>--enable-experimental-ui-automation[1]</code> ⊗ 	Enables UI Automation platform API in addition to the IAccessible API.  </li><li><code>--enable-experimental-web-platform-features</code> ⊗ 	Enables Web Platform features that are in development.  </li><li><code>--enable-experimental-webassembly-features</code> ⊗ 	Enables experimental WebAssembly features.  </li><li><code>--enable-extension-activity-log-testing</code> ⊗ 	No description  </li><li><code>--enable-extension-activity-logging</code> ⊗ 	Enables logging for extension activity.  </li><li><code>--enable-extension-assets-sharing</code> ⊗ 	Enables sharing assets for installed default apps.  </li><li><code>--enable-features</code> ⊗ 	Comma-separated list of feature names to enable. See also kDisableFeatures.  </li><li><code>--enable-font-antialiasing</code> ⊗ 	Enable font antialiasing for pixel tests.  </li><li><code>--enable-ftp</code> ⊗ 	Enables support for FTP URLs. See <a href="https://crbug.com/333943" target="_blank" rel="noopener noreferrer">https://crbug.com/333943</a>.  </li><li><code>--enable-gamepad-button-axis-events</code> ⊗ 	Enables gamepadbuttondown, gamepadbuttonup, gamepadbuttonchange, gamepadaxismove non-standard gamepad events.  </li><li><code>--enable-gpu-benchmarking</code> ⊗ 	Enables the GPU benchmarking extension  </li><li><code>--enable-gpu-blocked-time</code> ⊗ 	Enables measures of how long GPU Main Thread was blocked between SwapBuffers  </li><li><code>--enable-gpu-client-logging</code> ⊗ 	Enable GPU client logging.  </li><li><code>--enable-gpu-client-tracing</code> ⊗ 	Enables TRACE for GL calls in the renderer.  </li><li><code>--enable-gpu-command-logging</code> ⊗ 	Turn on Logging GPU commands.  </li><li><code>--enable-gpu-debugging</code> ⊗ 	Turn on Calling GL Error after every command.  </li><li><code>--enable-gpu-driver-debug-logging</code> ⊗ 	Enable logging of GPU driver debug messages.  </li><li><code>--enable-gpu-memory-buffer-compositor-resources</code> ⊗ 	Specify that all compositor resources should be backed by GPU memory buffers.  </li><li><code>--enable-gpu-memory-buffer-video-frames</code> ⊗ 	Enable GpuMemoryBuffer backed VideoFrames.  </li><li><code>--enable-gpu-rasterization</code> ⊗ 	Allow heuristics to determine when a layer tile should be drawn with the Skia GPU backend. Only valid with GPU accelerated compositing.  </li><li><code>--enable-gpu-service-logging</code> ⊗ 	Turns on GPU logging (debug build only).  </li><li><code>--enable-gpu-service-tracing</code> ⊗ 	Turns on calling TRACE for every GL call.  </li><li><code>--enable-hardware-overlays</code> ⊗ 	Enable compositing individual elements via hardware overlays when permitted by device. Setting the flag to "single-fullscreen" will try to promote a single fullscreen overlay and use it as main framebuffer where possible.  </li><li><code>--enable-hosted-app-quit-notification[6]</code> ⊗ 	Shows a notification when quitting Chrome with hosted apps running. Default behavior is to also quit all hosted apps.  </li><li><code>--enable-houdini</code> ⊗ 	Enables the use of 32-bit Houdini library for ARM binary translation.  </li><li><code>--enable-houdini64</code> ⊗ 	Enables the use of 64-bit Houdini library for ARM binary translation.  </li><li><code>--enable-hung-renderer-infobar[7]</code> ⊗ 	Enables a hung renderer InfoBar allowing the user to close or wait on unresponsive web content.  </li><li><code>--enable-idle-tracing[7]</code> ⊗ 	Adds additional thread idle time information into the trace event output.  </li><li><code>--enable-input</code> ⊗ 	Enables input event handling by the window manager.  </li><li><code>--enable-ios-handoff-to-other-devices</code> ⊗ 	Enables support for Handoff from Chrome on iOS to the default browser of other Apple devices.  </li><li><code>--enable-lcd-text</code> ⊗ 	Enables LCD text.  </li><li><code>--enable-leak-detection</code> ⊗ 	Enables the leak detection of loading webpages. This allows us to check whether or not reloading a webpage releases web-related objects correctly.  </li><li><code>--enable-local-file-accesses</code> ⊗ 	Enable file accesses. It should not be enabled for most Cast devices.  </li><li><code>--enable-local-sync-backend</code> ⊗ 	Enabled the local sync backend implemented by the LoopbackServer.  </li><li><code>--enable-logging</code> ⊗ 	Controls whether console logging is enabled and optionally configures where it's routed.  </li><li><code>--enable-longpress-drag-selection[7]</code> ⊗ 	Enable drag manipulation of longpress-triggered text selections.  </li><li><code>--enable-low-end-device-mode</code> ⊗ 	Force low-end device mode when set.  </li><li><code>--enable-low-res-tiling</code> ⊗ 	When using CPU rasterizing generate low resolution tiling. Low res tiles may be displayed during fast scrolls especially on slower devices.  </li><li><code>--enable-main-frame-before-activation</code> ⊗ 	Enables sending the next BeginMainFrame before the previous commit activates.  </li><li><code>--enable-nacl</code> ⊗ 	Runs the Native Client inside the renderer process and enables GPU plugin (internally adds lEnableGpuPlugin to the command line).  </li><li><code>--enable-nacl-debug</code> ⊗ 	Enables debugging via RSP over a socket.  </li><li><code>--enable-nacl-nonsfi-mode</code> ⊗ 	Enables Non-SFI mode, in which programs can be run without NaCl's SFI sandbox.  </li><li><code>--enable-native-gpu-memory-buffers</code> ⊗ 	Enable native CPU-mappable GPU memory buffer support on Linux.  </li><li><code>--enable-natural-scroll-default</code> ⊗ 	Enables natural scroll by default.  </li><li><code>--enable-ndk-translation</code> ⊗ 	Enables the use of 32-bit NDK translation library for ARM binary translation.  </li><li><code>--enable-ndk-translation64</code> ⊗ 	Enables the use of 64-bit NDK translation library for ARM binary translation.  </li><li><code>--enable-net-benchmarking</code> ⊗ 	Enables the network-related benchmarking extensions.  </li><li><code>--enable-network-information-downlink-max</code> ⊗ 	Enables the type, downlinkMax attributes of the NetInfo API. Also, enables triggering of change attribute of the NetInfo API when there is a change in the connection type.  </li><li><code>--enable-new-app-menu-icon[15]</code> ⊗ 	No description  </li><li><code>--enable-ntp-search-engine-country-detection</code> ⊗ 	Enables using the default search engine country to show country specific popular sites on the NTP.  </li><li><code>--enable-offer-store-unmasked-wallet-cards</code> ⊗ 	Force showing the local save checkbox in the autofill dialog box for getting the full credit card number for a wallet card.  </li><li><code>--enable-oop-rasterization</code> ⊗ 	Turns on out of process raster for the renderer whenever gpu raster would have been used. Enables the chromium_raster_transport extension.  </li><li><code>--enable-pepper-testing</code> ⊗ 	Enables the testing interface for PPAPI.  </li><li><code>--enable-pixel-output-in-tests</code> ⊗ 	Forces tests to produce pixel output when they normally wouldn't.  </li><li><code>--enable-plugin-placeholder-testing</code> ⊗ 	Enables testing features of the Plugin Placeholder. For internal use only.  </li><li><code>--enable-potentially-annoying-security-features</code> ⊗ 	Enables a number of potentially annoying security features (strict mixed content mode, powerful feature restrictions, etc.)  </li><li><code>--enable-precise-memory-info</code> ⊗ 	Make the values returned to window.performance.memory more granular and more up to date in shared worker. Without this flag, the memory information is still available, but it is bucketized and updated less frequently. This flag also applys to workers.  </li><li><code>--enable-prefer-compositing-to-lcd-text</code> ⊗ 	Enable the creation of compositing layers when it would prevent LCD text.  </li><li><code>--enable-profile-shortcut-manager[1]</code> ⊗ 	Force-enables the profile shortcut manager. This is needed for tests since they use a custom-user-data-dir which disables this.  </li><li><code>--enable-protected-video-buffers[16]</code> ⊗ 	Enables protected buffers for encrypted video streams.  </li><li><code>--enable-reached-code-profiler[7]</code> ⊗ 	Enables the reached code profiler that samples all threads in all processes to determine which functions are almost never executed.  </li><li><code>--enable-reporting[17]</code> ⊗ 	Enables metrics and crash reporting.  </li><li><code>--enable-request-tablet-site</code> ⊗ 	Enables request of tablet site (via user agent override).  </li><li><code>--enable-rgba-4444-textures</code> ⊗ 	Enables RGBA_4444 textures.  </li><li><code>--enable-sandbox-logging[6]</code> ⊗ 	Cause the OS X sandbox write to syslog every time an access to a resource is denied by the sandbox.  </li><li><code>--enable-service-binary-launcher</code> ⊗ 	If true the ServiceProcessLauncher is used to launch services. This allows for service binaries to be loaded rather than using the utility process. This is only useful for tests.  </li><li><code>--enable-service-manager-tracing</code> ⊗ 	Enable the tracing service.  </li><li><code>--enable-sgi-video-sync</code> ⊗ 	Enable use of the SGI_video_sync extension, which can have driver/sandbox/window manager compatibility issues.  </li><li><code>--enable-skia-benchmarking</code> ⊗ 	Enables the Skia benchmarking extension.  </li><li><code>--enable-smooth-scrolling</code> ⊗ 	On platforms that support it, enables smooth scroll animation.  </li><li><code>--enable-spatial-navigation</code> ⊗ 	Enable spatial navigation  </li><li><code>--enable-spdy-proxy-auth</code> ⊗ 	Enable the data reduction proxy.  </li><li><code>--enable-speech-dispatcher[17]</code> ⊗ 	Allows sending text-to-speech requests to speech-dispatcher, a common Linux speech service. Because it's buggy, the user must explicitly enable it so that visiting a random webpage can't cause instability.  </li><li><code>--enable-spotlight-actions</code> ⊗ 	Enables the Spotlight actions.  </li><li><code>--enable-stats-collection-bindings</code> ⊗ 	Specifies if the |StatsCollectionController| needs to be bound in the renderer. This binding happens on per-frame basis and hence can potentially be a performance bottleneck. One should only enable it when running a test that needs to access the provided statistics.  </li><li><code>--enable-strict-mixed-content-checking</code> ⊗ 	Blocks all insecure requests from secure contexts, and prevents the user from overriding that decision.  </li><li><code>--enable-strict-powerful-feature-restrictions</code> ⊗ 	Blocks insecure usage of a number of powerful features (device orientation, for example) that we haven't yet deprecated for the web at large.  </li><li><code>--enable-swap-buffers-with-bounds</code> ⊗ 	Enables SwapBuffersWithBounds if it is supported.  </li><li><code>--enable-switch-access-point-scanning</code> ⊗ 	Enables Switch Access point scanning. This feature hasn't launched yet.  </li><li><code>--enable-tablet-form-factor</code> ⊗ 	Enables tablet form factor.  </li><li><code>--enable-third-party-keyboard-workaround</code> ⊗ 	Enables the 3rd party keyboard omnibox workaround.  </li><li><code>--enable-thread-instruction-count[10]</code> ⊗ 	Controls whether or not retired instruction counts are surfaced for threads in trace events on Linux. This flag requires the BPF sandbox to be disabled.  </li><li><code>--enable-threaded-compositing</code> ⊗ 	Enabled threaded compositing for web tests.  </li><li><code>--enable-threaded-texture-mailboxes</code> ⊗ 	Simulates shared textures when share groups are not available. Not available everywhere.  </li><li><code>--enable-top-drag-gesture</code> ⊗ 	Whether to enable detection and dispatch of a 'drag from the top' gesture.  </li><li><code>--enable-touch-calibration-setting</code> ⊗ 	Enables the touch calibration option in MD settings UI for valid touch displays.  </li><li><code>--enable-touch-drag-drop</code> ⊗ 	Enables touch event based drag and drop.  </li><li><code>--enable-touchpad-three-finger-click</code> ⊗ 	Enables touchpad three-finger-click as middle button.  </li><li><code>--enable-touchview</code> ⊗ 	If the flag is present, it indicates 1) the device has accelerometer and 2) the device is a convertible device or a tablet device (thus is capable of entering tablet mode). If this flag is not set, then the device is not capable of entering tablet mode. For example, Samus has accelerometer, but is not a covertible or tablet, thus doesn't have this flag set, thus can't enter tablet mode.  </li><li><code>--enable-trace-app-source</code> ⊗ 	Pass launch source to platform apps.  </li><li><code>--enable-tracing</code> ⊗ 	Enable tracing during the execution of browser tests.  </li><li><code>--enable-tracing-output</code> ⊗ 	The filename to write the output of the test tracing to.  </li><li><code>--enable-ui-devtools</code> ⊗ 	Enables DevTools server for UI (mus, ash, etc). Value should be the port the server is started on. Default port is 9223.  </li><li><code>--enable-unsafe-webgpu</code> ⊗ 	No description  </li><li><code>--enable-use-zoom-for-dsf</code> ⊗ 	Enable the mode that uses zooming to implment device scale factor behavior.  </li><li><code>--enable-user-metrics[6]</code> ⊗ 	Enable user metrics from within the installer.  </li><li><code>--enable-usermedia-screen-capturing</code> ⊗ 	Enable screen capturing support for MediaStream API.  </li><li><code>--enable-viewport</code> ⊗ 	Enables the use of the @viewport CSS rule, which allows pages to control aspects of their own layout. This also turns on touch-screen pinch gestures.  </li><li><code>--enable-virtual-keyboard</code> ⊗ 	No description  </li><li><code>--enable-viz-devtools</code> ⊗ 	Enables inspecting Viz Display Compositor objects. Default port is 9229. For local inspection use chrome://inspect#other  </li><li><code>--enable-viz-hit-test-debug</code> ⊗ 	Enables hit-test debug logging.  </li><li><code>--enable-vtune-support</code> ⊗ 	Enable the Vtune profiler support.  </li><li><code>--enable-wayland-ime</code> ⊗ 	Try to enable wayland input method editor.  </li><li><code>--enable-wayland-server</code> ⊗ 	Enable the wayland server.  </li><li><code>--enable-web-auth-deprecated-mojo-testing-api</code> ⊗ 	Enable the WebAuthn Mojo Testing API. This is a way to interact with the virtual authenticator environment through a mojo interface and is supported only to run web-platform-tests on content shell. Removal of this deprecated API is blocked on crbug.com/937369.  </li><li><code>--enable-webgl-draft-extensions</code> ⊗ 	Enables WebGL extensions not yet approved by the community.  </li><li><code>--enable-webgl-image-chromium</code> ⊗ 	Enables WebGL rendering into a scanout buffer for overlay support.  </li><li><code>--enable-webgl2-compute-context</code> ⊗ 	Enable WebGL2 Compute context.  </li><li><code>--enable-webrtc-srtp-aes-gcm</code> ⊗ 	Enables negotiation of GCM cipher suites from RFC 7714 for SRTP in WebRTC. See <a href="https://tools.ietf.org/html/rfc7714" target="_blank" rel="noopener noreferrer">https://tools.ietf.org/html/rfc7714</a> for further information.  </li><li><code>--enable-webrtc-srtp-encrypted-headers</code> ⊗ 	Enables negotiation of encrypted header extensions from RFC 6904 for SRTP in WebRTC. See <a href="https://tools.ietf.org/html/rfc6904" target="_blank" rel="noopener noreferrer">https://tools.ietf.org/html/rfc6904</a> for further information. TODO(<a href="https://crbug.com/954201" target="_blank" rel="noopener noreferrer">https://crbug.com/954201</a>): Remove this.  </li><li><code>--enable-webrtc-stun-origin</code> ⊗ 	Enables Origin header in Stun messages for WebRTC.  </li><li><code>--enable-widevine</code> ⊗ 	No description  </li><li><code>--enable-win7-webrtc-hw-h264-decoding[1]</code> ⊗ 	Enables H264 HW decode acceleration for WebRtc on Win 7.  </li><li><code>--enable-zero-copy</code> ⊗ 	Enable rasterizer that writes directly to GPU memory associated with tiles.  </li><li><code>--enabled</code> ⊗ 	No description  </li><li><code>--encode-binary</code> ⊗ 	Encode binary web test results (images, audio) using base64.  </li><li><code>--enforce</code> ⊗ 	No description  </li><li><code>--enforce-gl-minimums</code> ⊗ 	Enforce GL minimums.  </li><li><code>--enforce-vulkan-protected-memory</code> ⊗ 	Forces to use protected memory for vulkan compositing.  </li><li><code>--enforce-webrtc-ip-permission-check</code> ⊗ 	Enforce IP Permission check. TODO(guoweis): Remove this once the feature is not under finch and becomes the default.  </li><li><code>--enforce_strict</code> ⊗ 	No description  </li><li><code>--ensure-forced-color-profile</code> ⊗ 	Crash the browser at startup if the display's color profile does not match the forced color profile. This is necessary on Mac because Chrome's pixel output is always subject to the color conversion performed by the operating system. On all other platforms, this is a no-op.  </li><li><code>--enterprise-disable-arc</code> ⊗ 	Disables ARC for managed accounts.  </li><li><code>--enterprise-enable-forced-re-enrollment</code> ⊗ 	Whether to enable forced enterprise re-enrollment.  </li><li><code>--enterprise-enable-initial-enrollment</code> ⊗ 	Whether to enable initial enterprise enrollment.  </li><li><code>--enterprise-enable-psm</code> ⊗ 	Whether to enable private set membership queries.  </li><li><code>--enterprise-enable-zero-touch-enrollment</code> ⊗ 	Enables the zero-touch enterprise enrollment flow.  </li><li><code>--enterprise-enrollment-initial-modulus</code> ⊗ 	Power of the power-of-2 initial modulus that will be used by the auto-enrollment client. E.g. "4" means the modulus will be 2^4 = 16.  </li><li><code>--enterprise-enrollment-modulus-limit</code> ⊗ 	Power of the power-of-2 maximum modulus that will be used by the auto-enrollment client.  </li><li><code>--evaluate-type</code> ⊗ 	No description  </li><li><code>--evaluate_capability</code> ⊗ 	No description  </li><li><code>--explicitly-allowed-ports</code> ⊗ 	Allows overriding the list of restricted ports by passing a comma-separated list of port numbers.  </li><li><code>--export-tagged-pdf</code> ⊗ 	If enabled, generate a tagged (accessible) file when printing to PDF. The plan is for this to go away once tagged PDFs become the default. See <a href="https://crbug.com/607777" target="_blank" rel="noopener noreferrer">https://crbug.com/607777</a>  </li><li><code>--expose-internals-for-testing</code> ⊗ 	Exposes the window.internals object to JavaScript for interactive development and debugging of web tests that rely on it.  </li><li><code>--extension-content-verification</code> ⊗ 	Name of the command line flag to force content verification to be on in one of various modes.  </li><li><code>--extension-process</code> ⊗ 	Marks a renderer as extension process.  </li><li><code>--extension-updater-test-request</code> ⊗ 	No description  </li><li><code>--extensions-install-verification</code> ⊗ 	Turns on extension install verification if it would not otherwise have been turned on.  </li><li><code>--extensions-not-webstore</code> ⊗ 	Specifies a comma-separated list of extension ids that should be forced to be treated as not from the webstore when doing install verification.  </li><li><code>--extensions-on-chrome-urls</code> ⊗ 	Enables extensions running scripts on chrome:// URLs. Extensions still need to explicitly request access to chrome:// URLs in the manifest.  </li><li><code>--external-metrics-collection-interval</code> ⊗ 	Interval in seconds between Chrome reading external metrics from /var/lib/metrics/uma-events.  </li><li><code>--extra-search-query-params</code> ⊗ 	Additional query params to insert in the search and instant URLs. Useful for testing.  </li><li><code>--fail-audio-stream-creation</code> ⊗ 	Causes the AudioManager to fail creating audio streams. Used when testing various failure cases.  </li><li><code>--fake-drivefs-launcher-chroot-path</code> ⊗ 	An absolute path to the chroot hosting the DriveFS to use. This is only used when running on Linux, i.e. when IsRunningOnChromeOS() returns false.  </li><li><code>--fake-drivefs-launcher-socket-path</code> ⊗ 	A relative path to socket to communicat with the fake DriveFS launcher within the chroot specified by kFakeDriveFsLauncherChrootPath. This is only used when running on Linux, i.e. when IsRunningOnChromeOS() returns false.  </li><li><code>--fake-oobe-configuration-file</code> ⊗ 	Path to a OOBE configuration JSON file (used by FakeOobeConfigurationClient).  </li><li><code>--fake-variations-channel</code> ⊗ 	Fakes the channel of the browser for purposes of Variations filtering. This is to be used for testing only. Possible values are "stable", "beta", "dev" and "canary". This works for official builds as well.  </li><li><code>--false</code> ⊗ 	Value indicating whether flag from command line switch is false.  </li><li><code>--feedback-server</code> ⊗ 	Alternative feedback server to use when submitting user feedback  </li><li><code>--field-trial-handle</code> ⊗ 	Handle to the shared memory segment containing field trial state that is to be shared between processes. The argument to this switch is the handle id (pointer on Windows) as a string, followed by a comma, then the size of the shared memory segment as a string.  </li><li><code>--file-url-path-alias</code> ⊗ 	Define an alias root directory which is replaced with the replacement string in file URLs. The format is "/alias=/replacement", which would turn file:///alias/some/path.html into file:///replacement/some/path.html.  </li><li><code>--file_chooser</code> ⊗ 	No description  </li><li><code>--finch-seed-expiration-age</code> ⊗ 	The length of time in seconds that an app's copy of the variations seed should be considered fresh. If an app's seed is older than this, a new seed will be requested from WebView's IVariationsSeedServer.  </li><li><code>--finch-seed-ignore-pending-download</code> ⊗ 	Forces WebView's service to always schedule a new variations seed download job, even if one is already pending.  </li><li><code>--finch-seed-min-download-period</code> ⊗ 	The minimum amount of time in seconds that WebView's service will wait between two variations seed downloads from the variations server.  </li><li><code>--finch-seed-min-update-period</code> ⊗ 	The minimum amount of time in seconds that the embedded WebView implementation will wait between two requests to WebView's service for a new variations seed.  </li><li><code>--fingerprint-sensor-location</code> ⊗ 	Fingerprint sensor location indicates the physical sensor's location. The value is a string with possible values: "power-button-top-left", "keyboard-bottom-left", keyboard-bottom-right", "keyboard-top-right".  </li><li><code>--first-exec-after-boot</code> ⊗ 	Passed to Chrome the first time that it's run after the system boots. Not passed on restart after sign out.  </li><li><code>--flag-switches-begin</code> ⊗ 	These two flags are added around the switches about:flags adds to the command line. This is useful to see which switches were added by about:flags on about:version. They don't have any effect.  </li><li><code>--flag-switches-end</code> ⊗ 	No description  </li><li><code>--font-cache-shared-handle[1]</code> ⊗ 	DirectWrite FontCache is shared by browser to renderers using shared memory. This switch allows us to pass the shared memory handle to the renderer.  </li><li><code>--font-render-hinting</code> ⊗ 	Sets font render hinting when running headless, affects Skia rendering and whether glyph subpixel positioning is enabled. Possible values: none|slight|medium|full|max. Default: full.  </li><li><code>--force-app-mode</code> ⊗ 	Forces application mode. This hides certain system UI elements and forces the app to be installed if it hasn't been already.  </li><li><code>--force-caption-style</code> ⊗ 	Forces the caption style for WebVTT captions.  </li><li><code>--force-cert-verifier-builtin</code> ⊗ 	Forces Chrome to use CertVerifyProcBuiltin for verification of server certificates, ignoring the status of net::features::kCertVerifierBuiltinFeature.  </li><li><code>--force-color-profile</code> ⊗ 	Force all monitors to be treated as though they have the specified color profile. Accepted values are "srgb" and "generic-rgb" (currently used by Mac layout tests) and "color-spin-gamma24" (used by layout tests).  </li><li><code>--force-dark-mode</code> ⊗ 	Forces dark mode in UI for platforms that support it.  </li><li><code>--force-dev-mode-highlighting</code> ⊗ 	Whether to force developer mode extensions highlighting.  </li><li><code>--force-device-scale-factor</code> ⊗ 	Overrides the device scale factor for the browser UI and the contents.  </li><li><code>--force-devtools-available</code> ⊗ 	Forces developer tools availability, no matter what values the enterprise policies DeveloperToolsDisabled and DeveloperToolsAvailability are set to.  </li><li><code>--force-disable-variation-ids</code> ⊗ 	Forces to remove Chrome Variation Ids from being sent in X-Client-Data header, specified as a 64-bit encoded list of numeric experiment ids. Ids prefixed with the character "t" will be treated as Trigger Variation Ids.  </li><li><code>--force-effective-connection-type</code> ⊗ 	Forces Network Quality Estimator (NQE) to return a specific effective connection type.  </li><li><code>--force-empty-corb-allowlist</code> ⊗ 	Whether |extensions_features::kBypassCorbAllowlistParamName| should always be empty (i.e. ignoring hardcoded allowlist and the field trial param). This switch is useful for manually verifying if an extension would continue to work fine after removing it from the allowlist.  </li><li><code>--force-enable-lite-pages</code> ⊗ 	Force enable all available previews on every page load.  </li><li><code>--force-enable-metrics-reporting</code> ⊗ 	Forces metrics reporting to be enabled.  </li><li><code>--force-enable-night-mode[7]</code> ⊗ 	Forces the night mode to be enabled.  </li><li><code>--force-enable-stylus-tools</code> ⊗ 	Enables the stylus tools next to the status area.  </li><li><code>--force-fieldtrial-params</code> ⊗ 	This option can be used to force parameters of field trials when testing changes locally. The argument is a param list of (key, value) pairs prefixed by an associated (trial, group) pair. You specify the param list for multiple (trial, group) pairs with a comma separator. Example: "Trial1.Group1:k1/v1/k2/v2,Trial2.Group2:k3/v3/k4/v4" Trial names, groups names, parameter names, and value should all be URL escaped for all non-alphanumeric characters.  </li><li><code>--force-fieldtrials</code> ⊗ 	This option can be used to force field trials when testing changes locally. The argument is a list of name and value pairs, separated by slashes. If a trial name is prefixed with an asterisk, that trial will start activated. For example, the following argument defines two trials, with the second one activated: "GoogleNow/Enable/*MaterialDesignNTP/Default/" This option can also be used by the browser process to send the list of trials to a non-browser process, using the same format. See FieldTrialList::CreateTrialsFromString() in field_trial.h for details.  </li><li><code>--force-first-run</code> ⊗ 	Displays the First Run experience when the browser is started, regardless of whether or not it's actually the First Run (this overrides kNoFirstRun).  </li><li><code>--force-first-run-ui</code> ⊗ 	Forces first-run UI to be shown for every login.  </li><li><code>--force-gpu-mem-available-mb</code> ⊗ 	Sets the total amount of memory that may be allocated for GPU resources  </li><li><code>--force-gpu-mem-discardable-limit-mb</code> ⊗ 	Sets the maximum GPU memory to use for discardable caches.  </li><li><code>--force-happiness-tracking-system</code> ⊗ 	Force enables the Happiness Tracking System for the device. This ignores user profile check and time limits and shows the notification every time for any type of user. Should be used only for testing.  </li><li><code>--force-high-contrast</code> ⊗ 	Forces high-contrast mode in native UI drawing, regardless of system settings. Note that this has limited effect on Windows: only Aura colors will be switched to high contrast, not other system colors.  </li><li><code>--force-hwid-check-failure-for-test</code> ⊗ 	Forces Hardware ID check (happens during OOBE) to fail. Should be used only for testing.  </li><li><code>--force-legacy-default-referrer-policy</code> ⊗ 	Pins the default referrer policy to the pre-M80 value of no-referrer-when-downgrade. TODO(crbug.com/1016541): After M82, remove when the corresponding enterprise policy has been deleted.  </li><li><code>--force-login-manager-in-tests</code> ⊗ 	Usually in browser tests the usual login manager bringup is skipped so that tests can change how it's brought up. This flag disables that.  </li><li><code>--force-logs-upload-failure</code> ⊗ 	Force a logs upload failure to help test the logs upload retry.  </li><li><code>--force-max-texture-size</code> ⊗ 	Sets the maximum texture size in pixels.  </li><li><code>--force-media-resolution-height</code> ⊗ 	When present overrides the screen resolution used by CanDisplayType API, instead of using the values obtained from avsettings.  </li><li><code>--force-media-resolution-width</code> ⊗ 	No description  </li><li><code>--force-overlay-fullscreen-video</code> ⊗ 	Forces use of hardware overlay for fullscreen video playback. Useful for testing the Android overlay fullscreen functionality on other platforms.  </li><li><code>--force-pnacl-subzero</code> ⊗ 	Force use of the Subzero as the PNaCl translator instead of LLC.  </li><li><code>--force-prefers-reduced-motion</code> ⊗ 	Forces whether the user desires reduced motion, regardless of system settings.  </li><li><code>--force-presentation-receiver-for-testing</code> ⊗ 	This forces pages to be loaded as presentation receivers. Useful for testing behavior specific to presentation receivers. Spec: <a href="https://www.w3.org/TR/presentation-api/#interface-presentationreceiver" target="_blank" rel="noopener noreferrer">https://www.w3.org/TR/presentation-api/#interface-presentationreceiver</a>  </li><li><code>--force-protected-video-output-buffers[16]</code> ⊗ 	Forces protected memory for all output video buffers generated by FuchsiaVideoDecoder, including unencrypted streams. Ignored unless --enable-protected-video-buffers is also specified.  </li><li><code>--force-raster-color-profile</code> ⊗ 	Force rastering to take place in the specified color profile. Accepted values are the same as for the kForceDisplayColorProfile case above.  </li><li><code>--force-recovery-component</code> ⊗ 	Force the recovery component, when running an unofficial build. This only applies to the cleaner, not the reporter.  </li><li><code>--force-renderer-accessibility</code> ⊗ 	Force renderer accessibility to be on instead of enabling it on demand when a screen reader is detected. The disable-renderer-accessibility switch overrides this if present.  </li><li><code>--force-self-delete</code> ⊗ 	Force self-deletion even on non-official builds.  </li><li><code>--force-show-update-menu-badge[7]</code> ⊗ 	Forces the update menu badge to show.  </li><li><code>--force-stacked-tab-strip-layout</code> ⊗ 	Forces Chrome to use a stacked tab strip layout.  </li><li><code>--force-status-area-collapsible</code> ⊗ 	Forces the status area to allow collapse/expand regardless of the current state.  </li><li><code>--force-system-compositor-mode</code> ⊗ 	Force system compositor mode when set.  </li><li><code>--force-tablet-mode</code> ⊗ 	Enables required things for the selected UI mode, regardless of whether the Chromebook is currently in the selected UI mode.  </li><li><code>--force-tablet-power-button</code> ⊗ 	If set, tablet-like power button behavior (i.e. tapping the button turns the screen off) is used even if the device is in laptop mode.  </li><li><code>--force-text-direction</code> ⊗ 	Force the text rendering to a specific direction. Valid values are "ltr" (left-to-right) and "rtl" (right-to-left). Only tested meaningfully with RTL.  </li><li><code>--force-ui-direction</code> ⊗ 	Force the UI to a specific direction. Valid values are "ltr" (left-to-right) and "rtl" (right-to-left).  </li><li><code>--force-update-menu-type[7]</code> ⊗ 	Forces the update menu type to a specific type.  </li><li><code>--force-update-remote-url</code> ⊗ 	Per-product customization of force update UI remote url, also used in testing.  </li><li><code>--force-variation-ids</code> ⊗ 	Forces additional Chrome Variation Ids that will be sent in X-Client-Data header, specified as a 64-bit encoded list of numeric experiment ids. Ids prefixed with the character "t" will be treated as Trigger Variation Ids.  </li><li><code>--force-video-overlays</code> ⊗ 	Force media player using SurfaceView instead of SurfaceTexture on Android.  </li><li><code>--force-wave-audio[1]</code> ⊗ 	Use Windows WaveOut/In audio API even if Core Audio is supported.  </li><li><code>--force-webrtc-ip-handling-policy</code> ⊗ 	Override WebRTC IP handling policy to mimic the behavior when WebRTC IP handling policy is specified in Preferences.  </li><li><code>--force-webxr-runtime</code> ⊗ 	Forcibly enable and select the specified runtime for webxr. Note that this provides an alternative means of enabling a runtime, and will also functionally disable all other runtimes.  </li><li><code>--frame-throttle-fps</code> ⊗ 	Sets the throttle fps for compositor frame submission.  </li><li><code>--full-memory-crash-report</code> ⊗ 	Generates full memory crash dump.  </li><li><code>--gaia-config</code> ⊗ 	No description  </li><li><code>--gaia-url</code> ⊗ 	No description  </li><li><code>--gamepad-polling-interval</code> ⊗ 	Overrides the gamepad polling interval. Decreasing the interval improves input latency of buttons and axes but may negatively affect performance due to more CPU time spent in the input polling thread.  </li><li><code>--gcm-checkin-url</code> ⊗ 	Sets the checkin service endpoint that will be used for performing Google Cloud Messaging checkins.  </li><li><code>--gcm-mcs-endpoint</code> ⊗ 	Sets the Mobile Connection Server endpoint that will be used for Google Cloud Messaging.  </li><li><code>--gcm-registration-url</code> ⊗ 	Sets the registration endpoint that will be used for creating new Google Cloud Messaging registrations.  </li><li><code>--generate-accessibility-test-expectations</code> ⊗ 	For development / testing only. When running content_browsertests, saves output of failing accessibility tests to their expectations files in content/test/data/accessibility/, overwriting existing file content.  </li><li><code>--gl</code> ⊗ 	No description  </li><li><code>--gl-egl</code> ⊗ 	No description  </li><li><code>--gl-null</code> ⊗ 	No description  </li><li><code>--gl-shader-interm-output</code> ⊗ 	Include ANGLE's intermediate representation (AST) output in shader compilation info logs.  </li><li><code>--gles</code> ⊗ 	No description  </li><li><code>--gles-egl</code> ⊗ 	No description  </li><li><code>--gles-null</code> ⊗ 	No description  </li><li><code>--google-apis-url</code> ⊗ 	No description  </li><li><code>--google-base-url</code> ⊗ 	Specifies an alternate URL to use for speaking to Google. Useful for testing.  </li><li><code>--google-doodle-url</code> ⊗ 	Overrides the URL used to fetch the current Google Doodle. Example: <a href="https://www.google.com/async/ddljson" target="_blank" rel="noopener noreferrer">https://www.google.com/async/ddljson</a> Testing? Try: <a href="https://www.gstatic.com/chrome/ntp/doodle_test/ddljson_android0.json" target="_blank" rel="noopener noreferrer">https://www.gstatic.com/chrome/ntp/doodle_test/ddljson_android0.json</a> <a href="https://www.gstatic.com/chrome/ntp/doodle_test/ddljson_android1.json" target="_blank" rel="noopener noreferrer">https://www.gstatic.com/chrome/ntp/doodle_test/ddljson_android1.json</a> <a href="https://www.gstatic.com/chrome/ntp/doodle_test/ddljson_android2.json" target="_blank" rel="noopener noreferrer">https://www.gstatic.com/chrome/ntp/doodle_test/ddljson_android2.json</a> <a href="https://www.gstatic.com/chrome/ntp/doodle_test/ddljson_android3.json" target="_blank" rel="noopener noreferrer">https://www.gstatic.com/chrome/ntp/doodle_test/ddljson_android3.json</a> <a href="https://www.gstatic.com/chrome/ntp/doodle_test/ddljson_android4.json" target="_blank" rel="noopener noreferrer">https://www.gstatic.com/chrome/ntp/doodle_test/ddljson_android4.json</a>  </li><li><code>--google-url</code> ⊗ 	No description  </li><li><code>--gpu</code> ⊗ 	No description  </li><li><code>--gpu-blocklist-test-group</code> ⊗ 	Select a different set of GPU blocklist entries with the specified test_group ID.  </li><li><code>--gpu-device-id</code> ⊗ 	Passes the active graphics device id from browser process to info collection GPU process.  </li><li><code>--gpu-driver-bug-list-test-group</code> ⊗ 	Enable an extra set of GPU driver bug list entries with the specified test_group ID. Note the default test group (group 0) is still active.  </li><li><code>--gpu-driver-version</code> ⊗ 	Passes the active graphics driver version from browser process to info collection GPU process.  </li><li><code>--gpu-launcher</code> ⊗ 	Extra command line options for launching the GPU process (normally used for debugging). Use like renderer-cmd-prefix.  </li><li><code>--gpu-no-context-lost</code> ⊗ 	Inform Chrome that a GPU context will not be lost in power saving mode, screen saving mode, etc. Note that this flag does not ensure that a GPU context will never be lost in any situations, say, a GPU reset.  </li><li><code>--gpu-preferences</code> ⊗ 	Passes encoded GpuPreferences to GPU process.  </li><li><code>--gpu-process</code> ⊗ 	Flags spied upon from other layers.  </li><li><code>--gpu-program-cache-size-kb</code> ⊗ 	Sets the maximum size of the in-memory gpu program cache, in kb  </li><li><code>--gpu-rasterization-msaa-sample-count</code> ⊗ 	The number of multisample antialiasing samples for GPU rasterization. Requires MSAA support on GPU to have an effect. 0 disables MSAA.  </li><li><code>--gpu-revision</code> ⊗ 	Passes the active graphics revision info from browser process to info collection GPU process.  </li><li><code>--gpu-sandbox-allow-sysv-shm</code> ⊗ 	Allows shmat() system call in the GPU sandbox.  </li><li><code>--gpu-sandbox-failures-fatal</code> ⊗ 	Makes GPU sandbox failures fatal.  </li><li><code>--gpu-sandbox-start-early</code> ⊗ 	Starts the GPU sandbox before creating a GL context.  </li><li><code>--gpu-startup-dialog</code> ⊗ 	Causes the GPU process to display a dialog on launch.  </li><li><code>--gpu-sub-system-id</code> ⊗ 	Passes the active graphics sub system id from browser process to info collection GPU process.  </li><li><code>--gpu-vendor-id</code> ⊗ 	Passes the active graphics vendor id from browser process to info collection GPU process.  </li><li><code>--gpu2-startup-dialog[1]</code> ⊗ 	Causes the second GPU process used for gpu info collection to display a dialog on launch.  </li><li><code>--graphics-buffer-count</code> ⊗ 	No description  </li><li><code>--guest[15]</code> ⊗ 	Causes the browser to launch directly in guest mode.  </li><li><code>--guest-wallpaper-large</code> ⊗ 	Large wallpaper to use in guest mode (as path to trusted, non-user-writable JPEG file).  </li><li><code>--guest-wallpaper-small</code> ⊗ 	Small wallpaper to use in guest mode (as path to trusted, non-user-writable JPEG file).  </li><li><code>--h[9]</code> ⊗ 	No description  </li><li><code>--has-chromeos-keyboard</code> ⊗ 	If set, the system is a Chromebook with a "standard Chrome OS keyboard", which generally means one with a Search key in the standard Caps Lock location above the Left Shift key. It should be unset for Chromebooks with both Search and Caps Lock keys (e.g. stout) and for devices like Chromeboxes that only use external keyboards.  </li><li><code>--has-internal-stylus</code> ⊗ 	Whether this device has an internal stylus.  </li><li><code>--headless</code> ⊗ 	Run in headless mode, i.e., without a UI or display server dependencies.  </li><li><code>--help</code> ⊗ 	No description  </li><li><code>--hermes-fake</code> ⊗ 	Enables Hermes fake behavior. By default, no carrier profiles are setup. If a value of "on" is passed for this switch, then hermes fakes are initialized with a single installed carrier profile. Fake cellular service corresponding to carrier profiles are also setup in Shill.  </li><li><code>--hide</code> ⊗ 	"Hide" value for kCrosRegionsMode (VPD values are hidden).  </li><li><code>--hide-android-files-in-files-app</code> ⊗ 	If true, files in Android internal storage will be hidden in Files app.  </li><li><code>--hide-icons[1]</code> ⊗ 	Makes Windows happy by allowing it to show "Enable access to this program" checkbox in Add/Remove Programs-&gt;Set Program Access and Defaults. This only shows an error box because the only way to hide Chrome is by uninstalling it.  </li><li><code>--hide-scrollbars</code> ⊗ 	Hide scrollbars from screenshots.  </li><li><code>--highlight-all-webviews</code> ⊗ 	Highlight the contents (including web contents) of all WebViews with a yellow tint. This is useful for identifying WebViews in an Android application.  </li><li><code>--highlight-non-lcd-text-layers</code> ⊗ 	Highlights layers that can't use lcd text. Layers containing no text won't be highlighted. See DebugColors::NonLCDTextHighlightColor() for the colors.  </li><li><code>--homedir</code> ⊗ 	Defines user homedir. This defaults to primary user homedir.  </li><li><code>--homepage</code> ⊗ 	Specifies which page will be displayed in newly-opened tabs. We need this for testing purposes so that the UI tests don't depend on what comes up for <a href="http://google.com." target="_blank" rel="noopener noreferrer">http://google.com.</a>  </li><li><code>--host</code> ⊗ 	No description  </li><li><code>--host-resolver-rules</code> ⊗ 	These mappings only apply to the host resolver.  </li><li><code>--https://chromemediarecommendations-pa.googleapis.com</code> ⊗ 	No description  </li><li><code>--icon_reader[1]</code> ⊗ 	No description  </li><li><code>--ignore-autocomplete-off-autofill</code> ⊗ 	Ignores autocomplete="off" for Autofill data (profiles + credit cards).  </li><li><code>--ignore-certificate-errors-spki-list</code> ⊗ 	A set of public key hashes for which to ignore certificate-related errors. If the certificate chain presented by the server does not validate, and one or more certificates have public key hashes that match a key from this list, the error is ignored. The switch value must a be a comma-separated list of Base64-encoded SHA-256 SPKI Fingerprints (RFC 7469, Section 2.4). This switch has no effect unless --user-data-dir (as defined by the content embedder) is also present.  </li><li><code>--ignore-google-port-numbers</code> ⊗ 	When set, this will ignore the PortPermission passed in the google_util.h methods and ignore the port numbers. This makes it easier to run tests for features that use these methods (directly or indirectly) with the EmbeddedTestServer, which is more representative of production.  </li><li><code>--ignore-gpu-blacklist</code> ⊗ 	Ignores GPU blocklist. TODO(crbug.com/1101491): remove in 2020Q4 in favor of --ignore-gpu-blocklist.  </li><li><code>--ignore-gpu-blocklist</code> ⊗ 	Ignores GPU blocklist.  </li><li><code>--ignore-previews-blacklist</code> ⊗ 	Ignore decisions made by PreviewsBlockList. TODO(crbug.com/1092105) : Migrate this to ignore-previews-blacklist.  </li><li><code>--ignore-urlfetcher-cert-requests</code> ⊗ 	Causes net::URLFetchers to ignore requests for SSL client certificates, causing them to attempt an unauthenticated SSL/TLS session. This is intended for use when testing various service URLs (eg: kPromoServerURL, kSbURLPrefix, kSyncServiceURL, etc).  </li><li><code>--ignore-user-profile-mapping-for-tests</code> ⊗ 	If true, profile selection in UserManager will always return active user's profile. TODO(nkostlyev): <a href="http://crbug.com/364604" target="_blank" rel="noopener noreferrer">http://crbug.com/364604</a> - Get rid of this switch after we turn on multi-profile feature on ChromeOS.  </li><li><code>--ime[5]</code> ⊗ 	No description  </li><li><code>--in-process-gpu</code> ⊗ 	Run the GPU process as a thread in the browser process.  </li><li><code>--incognito</code> ⊗ 	No description  </li><li><code>--init-done-notifier</code> ⊗ 	The handle of an event to signal when the initialization of the main process is complete (including loading all DLL's). This is used by the integration test to check that forbidden modules aren't loaded outside the sandbox. If this is set, the main process will signal the event and then wait for the integration test to signal it as well before continuing. Ignored in official builds.  </li><li><code>--initial-virtual-time</code> ⊗ 	Start the renderer with an initial virtual time override specified in seconds since the epoch.  </li><li><code>--input</code> ⊗ 	No description  </li><li><code>--install-autogenerated-theme</code> ⊗ 	Installs an autogenerated theme based on the given RGB value. The format is "r,g,b", where r, g, b are a numeric values from 0 to 255.  </li><li><code>--install-chrome-app</code> ⊗ 	Causes Chrome to initiate an installation flow for the given app.  </li><li><code>--install-managed-bookmarks-handler</code> ⊗ 	Installs the managed bookmarks policy handler.  </li><li><code>--install-supervised-user-whitelists</code> ⊗ 	A list of whitelists to install for a supervised user, for testing. The list is of the following form: <code>&lt;id&gt;[:&lt;name&gt;],[&lt;id&gt;[:&lt;name&gt;],...]</code>  </li><li><code>--install-url-blocklist-handlers</code> ⊗ 	Installs the URLBlocklist and URLAllowlist handlers.  </li><li><code>--instant-process</code> ⊗ 	Marks a renderer as an Instant process.  </li><li><code>--integration-test-timeout-minutes</code> ⊗ 	Set the timeout for integration tests in minutes. 0 disables the timeout entirely.  </li><li><code>--ipc-connection-timeout</code> ⊗ 	Overrides the timeout, in seconds, that a child process waits for a connection from the browser before killing itself.  </li><li><code>--ipc-dump-directory[18]</code> ⊗ 	Dumps IPC messages sent from renderer processes to the browser process to the given directory. Used primarily to gather samples for IPC fuzzing.  </li><li><code>--ipc-fuzzer-testcase[18]</code> ⊗ 	Specifies the testcase used by the IPC fuzzer.  </li><li><code>--isolate-origins</code> ⊗ 	Require dedicated processes for a set of origins, specified as a comma-separated list. For example: <code>--isolate-origins=https://www.foo.com,https://www.bar.com</code>  </li><li><code>--javascript-harmony</code> ⊗ 	Enables experimental Harmony (ECMAScript 6) features.  </li><li><code>--js-flags</code> ⊗ 	Specifies the flags passed to JS engine.  </li><li><code>--kaleidoscope-backend-url</code> ⊗ 	A command line switch for overriding the base URL of the API.  </li><li><code>--keep-alive-for-test</code> ⊗ 	Used for testing - keeps browser alive after last browser window closes.  </li><li><code>--kernelnext-restrict-vms</code> ⊗ 	If set, the Chrome settings will not expose the option to enable crostini unless the enable-experimental-kernel-vm-support flag is set in chrome://flags  </li><li><code>--kiosk</code> ⊗ 	Enable kiosk mode. Please note this is not Chrome OS kiosk mode.  </li><li><code>--kiosk-printing</code> ⊗ 	Enable automatically pressing the print button in print preview.  </li><li><code>--lacros-chrome-additional-args</code> ⊗ 	If this switch is set, then ash-chrome will pass additional arguments when launching lacros-chrome. The string '####' is used as a delimiter. Example: <code>--lacros-chrome-additional-args="--foo=5####--bar=/tmp/dir name"</code>. Will result in two arguments passed to lacros-chrome: --foo=5 --bar=/tmp/dir name  </li><li><code>--lacros-chrome-path</code> ⊗ 	If this switch is set, then ash-chrome will exec the lacros-chrome binary from the indicated path rather than from component updater. Note that the path should be to a directory that contains a binary named 'chrome'.  </li><li><code>--lang</code> ⊗ 	The language file that we want to try to open. Of the form <code>language[-country]</code> where language is the 2 letter code from ISO-639.  </li><li><code>--last-launched-app</code> ⊗ 	Pass the app id information to the renderer process, to be used for logging. last-launched-app should be the app that just launched and is spawning the renderer.  </li><li><code>--layer</code> ⊗ 	No description  </li><li><code>--light</code> ⊗ 	No description  </li><li><code>--lite-video-default-downlink-bandwidth-kbps</code> ⊗ 	The default downlink bandwidth estimate used for throttling media requests. Only used when forcing LiteVideos to be allowed.  </li><li><code>--lite-video-force-coinflip-holdback</code> ⊗ 	Forces the coinflip used for a counterfactual experiment to be true.  </li><li><code>--lite-video-force-override-decision</code> ⊗ 	Overrides all the LiteVideo decision logic to allow it on every navigation. This causes LiteVideos to ignore the hints, user blocklist, and network condition.  </li><li><code>--lite-video-ignore-network-conditions</code> ⊗ 	Overrides the network conditions checks for LiteVideos.  </li><li><code>--load-and-launch-app</code> ⊗ 	Loads an app from the specified directory and launches it.  </li><li><code>--load-apps</code> ⊗ 	Comma-separated list of paths to apps to load at startup. The first app in the list will be launched.  </li><li><code>--load-empty-dll</code> ⊗ 	Attempt to load empty-dll.dll whenever this flag is set. For testing DLL loading.  </li><li><code>--load-extension</code> ⊗ 	Comma-separated list of paths to extensions to load at startup.  </li><li><code>--load-media-router-component-extension</code> ⊗ 	Loads the Media Router component extension on startup.  </li><li><code>--load-signin-profile-test-extension[5]</code> ⊗ 	Path to the unpacked test extension to load into the signin profile. The ID extension loaded must match kTestSigninProfileExtensionId.  </li><li><code>--local-sync-backend-dir</code> ⊗ 	Specifies the local sync backend directory. The name is chosen to mimic user-data-dir etc. This flag only matters if the enable-local-sync-backend flag is present.  </li><li><code>--log-best-effort-tasks</code> ⊗ 	Logs information about all tasks posted with TaskPriority::BEST_EFFORT. Use this to diagnose issues that are thought to be caused by TaskPriority::BEST_EFFORT execution fences. Note: Tasks posted to a non-BEST_EFFORT UpdateableSequencedTaskRunner whose priority is later lowered to BEST_EFFORT are not logged.  </li><li><code>--log-file</code> ⊗ 	Overrides the default file name to use for general-purpose logging (does not affect which events are logged).  </li><li><code>--log-gpu-control-list-decisions</code> ⊗ 	Logs GPU control list decisions when enforcing blacklist rules.  </li><li><code>--log-interface-calls-to</code> ⊗ 	Specifies a file to log all the interface calls of EngineRequestsImpl and CleanerEngineRequestsImpl.  </li><li><code>--log-level</code> ⊗ 	Sets the minimum log level. Valid values are from 0 to 3: INFO = 0, WARNING = 1, LOG_ERROR = 2, LOG_FATAL = 3.  </li><li><code>--log-net-log</code> ⊗ 	Enables saving net log events to a file. If a value is given, it used as the path the the file, otherwise the file is named netlog.json and placed in the user data directory.  </li><li><code>--log-on-ui-double-background-blur[19]</code> ⊗ 	Checks and logs double background blur as an error if any.  </li><li><code>--log-with-hash</code> ⊗ 	Log user actions with action name hashed.  </li><li><code>--log-without-hash</code> ⊗ 	Log user actions with action name unhashed.  </li><li><code>--login-manager</code> ⊗ 	Enables Chrome-as-a-login-manager behavior.  </li><li><code>--login-profile</code> ⊗ 	Specifies the profile to use once a chromeos user is logged in. This parameter is ignored if user goes through login screen since user_id hash defines which profile directory to use. In case of browser restart within active session this parameter is used to pass user_id hash for primary user.  </li><li><code>--login-user</code> ⊗ 	Specifies the user which is already logged in.  </li><li><code>--logs-upload-retry-interval</code> ⊗ 	Specify the time to wait between logs upload retries, in minutes.  </li><li><code>--lso-url</code> ⊗ 	No description  </li><li><code>--ltr</code> ⊗ 	No description  </li><li><code>--main-frame-resizes-are-orientation-changes</code> ⊗ 	Resizes of the main frame are caused by changing between landscape and portrait mode (i.e. Android) so the page should be rescaled to fit.  </li><li><code>--make-chrome-default[6]</code> ⊗ 	Indicates whether Chrome should be set as the default browser during installation.  </li><li><code>--make-default-browser</code> ⊗ 	Makes Chrome default browser  </li><li><code>--managed-user-id</code> ⊗ 	Sets the supervised user ID for any loaded or newly created profile to the given value. Pass an empty string to mark the profile as non-supervised. Used for testing.  </li><li><code>--mangle-localized-strings</code> ⊗ 	Transform localized strings to be longer, with beginning and end markers to make truncation visually apparent.  </li><li><code>--manual</code> ⊗ 	No description  </li><li><code>--market-url-for-testing[7]</code> ⊗ 	Sets the market URL for Chrome for use in testing.  </li><li><code>--marketing-opt-in-url</code> ⊗ 	Determines the URL to be used when calling the backend.  </li><li><code>--max-active-webgl-contexts</code> ⊗ 	Allows user to override maximum number of active WebGL contexts per renderer process.  </li><li><code>--max-decoded-image-size-mb</code> ⊗ 	Sets the maximium decoded image size limitation.  </li><li><code>--max-file-size</code> ⊗ 	Limit the size of files the scanning engine is allowed to open.  </li><li><code>--max-gum-fps</code> ⊗ 	Override the maximum framerate as can be specified in calls to getUserMedia. This flag expects a value. Example: --max-gum-fps=17.5  </li><li><code>--max-output-volume-dba1m</code> ⊗ 	Calibrated max output volume dBa for voice content at 1 meter, if known.  </li><li><code>--max-untiled-layer-height</code> ⊗ 	Sets the width and height above which a composited layer will get tiled.  </li><li><code>--max-untiled-layer-width</code> ⊗ 	No description  </li><li><code>--mem-pressure-system-reserved-kb</code> ⊗ 	Some platforms typically have very little 'free' memory, but plenty is available in buffers+cached. For such platforms, configure this amount as the portion of buffers+cached memory that should be treated as unavailable. If this switch is not used, a simple pressure heuristic based purely on free memory will be used.  </li><li><code>--memlog</code> ⊗ 	No description  </li><li><code>--memlog-sampling-rate</code> ⊗ 	No description  </li><li><code>--memlog-stack-mode</code> ⊗ 	No description  </li><li><code>--memory-pressure-off</code> ⊗ 	No description  </li><li><code>--message-loop-type-ui</code> ⊗ 	Indicates the utility process should run with a message loop type of UI.  </li><li><code>--metrics-client-id[6]</code> ⊗ 	This is how the metrics client ID is passed from the browser process to its children. With Crashpad, the metrics client ID is distinct from the crash client ID.  </li><li><code>--metrics-recording-only</code> ⊗ 	Enables the recording of metrics reports but disables reporting. In contrast to kForceEnableMetricsReporting, this executes all the code that a normal client would use for reporting, except the report is dropped rather than sent to the server. This is useful for finding issues in the metrics code during UI and performance tests.  </li><li><code>--metrics-upload-interval</code> ⊗ 	Override the standard time interval between each metrics report upload for UMA and UKM. It is useful to set to a short interval for debugging. Unit in seconds. (The default is 1800 seconds on desktop).  </li><li><code>--min-height-for-gpu-raster-tile</code> ⊗ 	Sets the min tile height for GPU raster.  </li><li><code>--minimal</code> ⊗ 	No description  </li><li><code>--mixed</code> ⊗ 	No description  </li><li><code>--mixer-enable-dynamic-channel-count</code> ⊗ 	Enable dynamically changing the channel count in the mixer depending on the input streams.  </li><li><code>--mixer-service-endpoint</code> ⊗ 	Endpoint that the mixer service listens on. This is a path for a UNIX domain socket (default is /tmp/mixer-service).  </li><li><code>--mixer-service-port</code> ⊗ 	TCP port that the mixer service listens on on non-Linux platforms. (default 12854).  </li><li><code>--mixer-source-audio-ready-threshold-ms</code> ⊗ 	Specify the start threshold frames for audio output when using our mixer. This is mostly used to override the default value to a larger value, for platforms that can't handle the default start threshold without running into audio underruns.  </li><li><code>--mixer-source-input-queue-ms</code> ⊗ 	Specify the buffer size for audio output when using our mixer. This is mostly used to override the default value to a larger value, for platforms that can't handle an audio buffer so small without running into audio underruns.  </li><li><code>--mock</code> ⊗ 	No description  </li><li><code>--mock-cert-verifier-default-result-for-testing</code> ⊗ 	Set the default result for MockCertVerifier. This only works in test code.  </li><li><code>--mojo-core-library-path</code> ⊗ 	Initializes Mojo Core from a shared library at the specified path, rather than using the version of Mojo Core embedded within the Content executable.  </li><li><code>--mojo-local-storage</code> ⊗ 	Use a Mojo-based LocalStorage implementation.  </li><li><code>--mojo-pipe-token</code> ⊗ 	No description  </li><li><code>--monitoring-destination-id</code> ⊗ 	Allows setting a different destination ID for connection-monitoring GCM messages. Useful when running against a non-prod management server.  </li><li><code>--mse-audio-buffer-size-limit-mb</code> ⊗ 	Allows explicitly specifying MSE audio/video buffer sizes as megabytes. Default values are 150M for video and 12M for audio.  </li><li><code>--mse-video-buffer-size-limit-mb</code> ⊗ 	No description  </li><li><code>--mute-audio</code> ⊗ 	Mutes audio sent to the audio device so it is not audible during automated testing.  </li><li><code>--nacl-broker</code> ⊗ 	No description  </li><li><code>--nacl-dangerous-no-sandbox-nonsfi</code> ⊗ 	Disable sandbox even for non SFI mode. This is particularly unsafe as non SFI NaCl heavily relies on the seccomp sandbox.  </li><li><code>--nacl-debug-mask</code> ⊗ 	Uses NaCl manifest URL to choose whether NaCl program will be debugged by debug stub. Switch value format: <!-- -->[!]<!-- -->pattern1,pattern2,...,patternN. Each pattern uses the same syntax as patterns in Chrome extension manifest. The only difference is that * scheme matches all schemes instead of matching only http and https. If the value doesn't start with !, a program will be debugged if manifest URL matches any pattern. If the value starts with !, a program will be debugged if manifest URL does not match any pattern.  </li><li><code>--nacl-gdb</code> ⊗ 	Native Client GDB debugger that will be launched automatically when needed.  </li><li><code>--nacl-gdb-script</code> ⊗ 	GDB script to pass to the nacl-gdb debugger at startup.  </li><li><code>--nacl-loader</code> ⊗ 	No description  </li><li><code>--nacl-loader-nonsfi</code> ⊗ 	Value for --type that causes the process to run as a NativeClient loader for non SFI mode.  </li><li><code>--native</code> ⊗ 	No description  </li><li><code>--native-messaging-connect-extension</code> ⊗ 	Requests a native messaging connection be established between the extension with ID specified by this switch and the native messaging host named by the kNativeMessagingConnectHost switch.  </li><li><code>--native-messaging-connect-host</code> ⊗ 	Requests a native messaging connection be established between the native messaging host named by this switch and the extension with ID specified by kNativeMessagingConnectExtension.  </li><li><code>--native-messaging-connect-id</code> ⊗ 	If set when kNativeMessagingConnectHost and kNativeMessagingConnectExtension are specified, is reflected to the native messaging host as a command line parameter.  </li><li><code>--native-with-thread-names</code> ⊗ 	No description  </li><li><code>--nearbysharing-http-host</code> ⊗ 	Overrides the default URL for Google APIs (<a href="https://www.googleapis.com" target="_blank" rel="noopener noreferrer">https://www.googleapis.com</a>) used by Nearby Share  </li><li><code>--need-arc-migration-policy-check</code> ⊗ 	If present, the device needs to check the policy to see if the migration to ext4 for ARC is allowed. It should be present only on devices that have been initially issued with ecrypfs encryption and have ARC (N+) available. For the devices in other categories this flag must be missing.  </li><li><code>--net-log-capture-mode</code> ⊗ 	Sets the granularity of events to capture in the network log. The mode can be set to one of the following values: "Default" "IncludeSensitive" "Everything" See the enums of the corresponding name in net_log_capture_mode.h for a description of their meanings.  </li><li><code>--netifs-to-ignore</code> ⊗ 	List of network interfaces to ignore. Ignored interfaces will not be used for network connectivity.  </li><li><code>--network</code> ⊗ 	No description  </li><li><code>--network-country-iso[7]</code> ⊗ 	The telephony region (ISO country code) to use in phone number detection.  </li><li><code>--network-quiet-timeout</code> ⊗ 	Sets the timeout seconds of the network-quiet timers in IdlenessDetector. Used by embedders who want to change the timeout time in order to run web contents on various embedded devices and changeable network bandwidths in different regions. For example, it's useful when using FirstMeaningfulPaint signal to dismiss a splash screen.  </li><li><code>--new-canvas-2d-api</code> ⊗ 	Enable in-progress canvas 2d API features.  </li><li><code>--new-window</code> ⊗ 	Launches URL in new browser window.  </li><li><code>--no-crash-upload</code> ⊗ 	Prevent the crash client from uploading crash reports.  </li><li><code>--no-default-browser-check</code> ⊗ 	Disables the default browser check. Useful for UI/browser tests where we want to avoid having the default browser info-bar displayed.  </li><li><code>--no-delay-for-dx12-vulkan-info-collection</code> ⊗ 	Start the non-sandboxed GPU process for DX12 and Vulkan info collection immediately after the browser starts. The default is to delay for 120 seconds.  </li><li><code>--no-experiments</code> ⊗ 	Disables all experiments set on about:flags. Does not disable about:flags itself. Useful if an experiment makes chrome crash at startup: One can start chrome with --no-experiments, disable the problematic lab at about:flags and then restart chrome without this switch again.  </li><li><code>--no-first-run</code> ⊗ 	Skip First Run tasks, whether or not it's actually the First Run. Overridden by kForceFirstRun. This does not drop the First Run sentinel and thus doesn't prevent first run from occuring the next time chrome is launched without this flag.  </li><li><code>--no-initial-navigation</code> ⊗ 	Stops new Shell objects from navigating to a default url.  </li><li><code>--no-managed-user-acknowledgment-check</code> ⊗ 	Disables checking whether we received an acknowledgment when registering a supervised user. Also disables the timeout during registration that waits for the ack. Useful when debugging against a server that does not support notifications.  </li><li><code>--no-network-profile-warning[1]</code> ⊗ 	Whether or not the browser should warn if the profile is on a network share. This flag is only relevant for Windows currently.  </li><li><code>--no-pings</code> ⊗ 	Don't send hyperlink auditing pings  </li><li><code>--no-proxy-server</code> ⊗ 	Don't use a proxy server, always make direct connections. Overrides any other proxy server flags that are passed.  </li><li><code>--no-recovery-component</code> ⊗ 	Prevent downloading and running the recovery component.  </li><li><code>--no-report-upload</code> ⊗ 	Prevent the logging service from uploading logs and reports. WARNING: this switch is used by internal test systems. Be careful when making changes.  </li><li><code>--no-sandbox</code> ⊗ 	Disables the sandbox for all process types that are normally sandboxed. Meant to be used as a browser-level switch for testing purposes only.  </li><li><code>--no-sandbox-and-elevated[1]</code> ⊗ 	Disables the sandbox and gives the process elevated privileges.  </li><li><code>--no-self-delete</code> ⊗ 	Prevent the executable from deleting itself after running.  </li><li><code>--no-service-autorun</code> ⊗ 	Disables the service process from adding itself as an autorun process. This does not delete existing autorun registrations, it just prevents the service from registering a new one.  </li><li><code>--no-startup-window</code> ⊗ 	Does not automatically open a browser window on startup (used when launching Chrome for the purpose of hosting background apps).  </li><li><code>--no-user-gesture-required</code> ⊗ 	Autoplay policy that does not require any user gesture.  </li><li><code>--no-v8-untrusted-code-mitigations</code> ⊗ 	Disables V8 mitigations for executing untrusted code.  </li><li><code>--no-vr-runtime</code> ⊗ 	Tell WebXr to assume that it does not support any runtimes.  </li><li><code>--no-wifi</code> ⊗ 	Disable features that require WiFi management.  </li><li><code>--no-xshm</code> ⊗ 	Disables MIT-SHM extension.  </li><li><code>--no-zygote</code> ⊗ 	Disables the use of a zygote process for forking child processes. Instead, child processes will be forked and exec'd directly. Note that --no-sandbox should also be used together with this flag because the sandbox needs the zygote to work.  </li><li><code>--no-zygote-sandbox[10]</code> ⊗ 	Instructs the zygote to launch without a sandbox. Processes forked from this type of zygote will apply their own custom sandboxes later.  </li><li><code>--noerrdialogs</code> ⊗ 	Suppresses all error dialogs when present.  </li><li><code>--none</code> ⊗ 	Must be in sync with "sandbox_type" values as used in service manager's manifest.json catalog files.  </li><li><code>--none_and_elevated</code> ⊗ 	No description  </li><li><code>--note-taking-app-ids</code> ⊗ 	An optional comma-separated list of IDs of apps that can be used to take notes. If unset, a hardcoded list is used instead.  </li><li><code>--notification-inline-reply[1]</code> ⊗ 	Used in combination with kNotificationLaunchId to specify the inline reply entered in the toast in the Windows Action Center.  </li><li><code>--notification-launch-id[1]</code> ⊗ 	Used for launching Chrome when a toast displayed in the Windows Action Center has been activated. Should contain the launch ID encoded by Chrome.  </li><li><code>--ntp-snippets-add-incomplete</code> ⊗ 	If this flag is set, we will add downloaded snippets that are missing some critical data to the list.  </li><li><code>--null</code> ⊗ 	No description  </li><li><code>--num-raster-threads</code> ⊗ 	Number of worker threads used to rasterize content.  </li><li><code>--oauth-account-manager-url</code> ⊗ 	No description  </li><li><code>--oauth2-client-id</code> ⊗ 	No description  </li><li><code>--oauth2-client-secret</code> ⊗ 	No description  </li><li><code>--oculus</code> ⊗ 	The following are the runtimes that WebXr supports.  </li><li><code>--offer-in-settings</code> ⊗ 	No description  </li><li><code>--on-the-fly-mhtml-hash-computation</code> ⊗ 	Calculate the hash of an MHTML file as it is being saved. The browser process will write the serialized MHTML contents to a file and calculate its hash as it is streamed back from the renderer via a Mojo data pipe.  </li><li><code>--oobe-eula-url-for-tests</code> ⊗ 	Allows the eula url to be overridden for tests.  </li><li><code>--oobe-force-show-screen</code> ⊗ 	Forces OOBE/login to force show a comma-separated list of screens from chromeos::kScreenNames in oobe_screen.cc. Supported screens are: user-image  </li><li><code>--oobe-force-tablet-first-run</code> ⊗ 	Indicates that the first user run flow (sequence of OOBE screens after the first user login) should show tablet mode centric screens, even if the device is not in tablet mode.  </li><li><code>--oobe-guest-session</code> ⊗ 	Indicates that a guest session has been started before OOBE completion.  </li><li><code>--oobe-screenshot-dir</code> ⊗ 	Specifies directory for screenshots taken with OOBE UI Debugger.  </li><li><code>--oobe-skip-postlogin</code> ⊗ 	Skips all other OOBE pages after user login.  </li><li><code>--oobe-skip-to-login</code> ⊗ 	Skip to login screen.  </li><li><code>--oobe-timer-interval</code> ⊗ 	Interval at which we check for total time on OOBE.  </li><li><code>--oobe-timezone-override-for-tests</code> ⊗ 	Allows the timezone to be overridden on the marketing opt-in screen.  </li><li><code>--opengraph</code> ⊗ 	No description  </li><li><code>--openvr</code> ⊗ 	No description  </li><li><code>--openxr</code> ⊗ 	No description  </li><li><code>--optimization-guide-fetch-hints-override</code> ⊗ 	Overrides scheduling and time delays for fetching hints and causes a hints fetch immediately on start up using the provided comma separate lists of hosts.  </li><li><code>--optimization-guide-fetch-hints-override-timer</code> ⊗ 	Overrides the hints fetch scheduling and delay, causing a hints fetch immediately on start up using the TopHostProvider. This is meant for testing.  </li><li><code>--optimization-guide-fetch-models-and-features-override</code> ⊗ 	Overrides scheduling and time delays for fetching prediction models and host model features. This causes a prediction model and host model features fetch immediately on start up.  </li><li><code>--optimization-guide-service-api-key</code> ⊗ 	Overrides the Optimization Guide Service API Key for remote requests to be made.  </li><li><code>--optimization-guide-service-get-hints-url</code> ⊗ 	Overrides the Optimization Guide Service URL that the HintsFetcher will request remote hints from.  </li><li><code>--optimization-guide-service-get-models-url</code> ⊗ 	Overrides the Optimization Guide Service URL that the PredictionModelFetcher will request remote models and host features from.  </li><li><code>--optimization_guide_hints_override</code> ⊗ 	Overrides the Hints Protobuf that would come from the component updater. If the value of this switch is invalid, regular hint processing is used. The value of this switch should be a base64 encoding of a binary Configuration message, found in optimization_guide's hints.proto. Providing a valid value to this switch causes Chrome startup to block on hints parsing.  </li><li><code>--orientation-sensors</code> ⊗ 	No description  </li><li><code>--origin-trial-disabled-features</code> ⊗ 	Contains a list of feature names for which origin trial experiments should be disabled. Names should be separated by "|" characters.  </li><li><code>--origin-trial-disabled-tokens</code> ⊗ 	Contains a list of token signatures for which origin trial experiments should be disabled. Tokens should be separated by "|" characters.  </li><li><code>--origin-trial-public-key</code> ⊗ 	Comma-separated list of keys which will override the default public keys for checking origin trial tokens.  </li><li><code>--output</code> ⊗ 	No description  </li><li><code>--override</code> ⊗ 	"Override" value for kCrosRegionsMode (region's data is read first).  </li><li><code>--override-enabled-cdm-interface-version</code> ⊗ 	Overrides the default enabled library CDM interface version(s) with the one specified with this switch, which will be the only version enabled. For example, on a build where CDM 8, CDM 9 and CDM 10 are all supported (implemented), but only CDM 8 and CDM 9 are enabled by default: --override-enabled-cdm-interface-version=8 : Only CDM 8 is enabled --override-enabled-cdm-interface-version=9 : Only CDM 9 is enabled --override-enabled-cdm-interface-version=10 : Only CDM 10 is enabled --override-enabled-cdm-interface-version=11 : No CDM interface is enabled This can be used for local testing and debugging. It can also be used to enable an experimental CDM interface (which is always disabled by default) for testing while it's still in development.  </li><li><code>--override-hardware-secure-codecs-for-testing</code> ⊗ 	Overrides hardware secure codecs support for testing. If specified, real platform hardware secure codecs check will be skipped. Codecs are separated by comma. Valid codecs are "vp8", "vp9" and "avc1". For example: --override-hardware-secure-codecs-for-testing=vp8,vp9 --override-hardware-secure-codecs-for-testing=avc1 CENC encryption scheme is assumed to be supported for the specified codecs. If no valid codecs specified, no hardware secure codecs are supported. This can be used to disable hardware secure codecs support: --override-hardware-secure-codecs-for-testing  </li><li><code>--override-https-image-compression-infobar</code> ⊗ 	Override the one-time InfoBar to not needed to be shown before triggering https image compression for the page load.  </li><li><code>--override-metrics-upload-url</code> ⊗ 	Override the URL to which metrics logs are sent for debugging.  </li><li><code>--override-plugin-power-saver-for-testing</code> ⊗ 	Override the behavior of plugin throttling for testing. By default the throttler is only enabled for a hard-coded list of plugins. Set the value to 'always' to always throttle every plugin instance. Set the value to 'never' to disable throttling.  </li><li><code>--override-use-software-gl-for-tests</code> ⊗ 	Forces the use of software GL instead of hardware gpu.  </li><li><code>--ozone-dump-file</code> ⊗ 	Specify location for image dumps.  </li><li><code>--ozone-platform</code> ⊗ 	Specify ozone platform implementation to use.  </li><li><code>--pack-extension</code> ⊗ 	Packages an extension to a .crx installable file from a given directory.  </li><li><code>--pack-extension-key</code> ⊗ 	Optional PEM private key to use in signing packaged .crx.  </li><li><code>--parent-window</code> ⊗ 	No description  </li><li><code>--passive-listeners-default</code> ⊗ 	Override the default value for the 'passive' field in javascript addEventListener calls. Values are defined as: 'documentonlytrue' to set the default be true only for document level nodes. 'true' to set the default to be true on all nodes (when not specified). 'forcealltrue' to force the value on all nodes.  </li><li><code>--passthrough</code> ⊗ 	No description  </li><li><code>--password-store</code> ⊗ 	Specifies which encryption storage backend to use. Possible values are kwallet, kwallet5, gnome, gnome-keyring, gnome-libsecret, basic. Any other value will lead to Chrome detecting the best backend automatically. TODO(crbug.com/571003): Once PasswordStore no longer uses the Keyring or KWallet for storing passwords, rename this flag to stop referencing passwords. Do not rename it sooner, though; developers and testers might rely on it keeping large amounts of testing passwords out of their Keyrings or KWallets.  </li><li><code>--pdf_conversion[1]</code> ⊗ 	No description  </li><li><code>--pen-devices[10]</code> ⊗ 	Tells chrome to interpret events from these devices as pen events. Only available with XInput 2 (i.e. X server 1.8 or above). The id's of the devices can be retrieved from 'xinput list'.  </li><li><code>--perf-test-print-uma-means</code> ⊗ 	Show the mean value of histograms that native performance tests are monitoring. Note that this is only applicable for PerformanceTest subclasses.  </li><li><code>--perfetto-disable-interning</code> ⊗ 	Repeat internable data for each TraceEvent in the perfetto proto format.  </li><li><code>--perfetto-output-file</code> ⊗ 	If supplied, will enable Perfetto startup tracing and stream the output to the given file. On Android, if no file is provided, automatically generate a file to write the output to. TODO(oysteine): Remove once Perfetto starts early enough after process startup to be able to replace the legacy startup tracing.  </li><li><code>--performance[5]</code> ⊗ 	No description  </li><li><code>--permission-request-api-scope</code> ⊗ 	Development flag for permission request API. This flag is needed until the API is finalized. TODO(bauerb): Remove when this flag is not needed anymore.  </li><li><code>--permission-request-api-url</code> ⊗ 	Development flag for permission request API. This flag is needed until the API is finalized. TODO(bauerb): Remove when this flag is not needed anymore.  </li><li><code>--playready-key-system</code> ⊗ 	No description  </li><li><code>--post-reboot</code> ⊗ 	Indicates this run is post-reboot.  </li><li><code>--post-reboot-override-cmd</code> ⊗ 	Indicates that this is a post-reboot run that should fetch its switches from an external registry key. Important note: When this switch is present in the command line, all other switches are ignored except for kCleanupIdSwitch, which is used to read post-reboot switches from the correct registry location.  </li><li><code>--post-reboot-trigger</code> ⊗ 	A freeform text string that records what triggered a post-reboot run.  </li><li><code>--ppapi</code> ⊗ 	No description  </li><li><code>--ppapi-antialiased-text-enabled[1]</code> ⊗ 	The boolean value (0/1) of FontRenderParams::antialiasing to be passed to Ppapi processes.  </li><li><code>--ppapi-broker</code> ⊗ 	No description  </li><li><code>--ppapi-flash-args</code> ⊗ 	"Command-line" arguments for the PPAPI Flash; used for debugging options.  </li><li><code>--ppapi-flash-path</code> ⊗ 	Use the PPAPI (Pepper) Flash found at the given path.  </li><li><code>--ppapi-flash-version</code> ⊗ 	Report the given version for the PPAPI (Pepper) Flash. The version should be numbers separated by '.'s (e.g., "12.3.456.78"). If not specified, it defaults to "10.2.999.999".  </li><li><code>--ppapi-in-process</code> ⊗ 	Runs PPAPI (Pepper) plugins in-process.  </li><li><code>--ppapi-plugin-launcher</code> ⊗ 	Specifies a command that should be used to launch the ppapi plugin process. Useful for running the plugin process through purify or quantify. Ex: --ppapi-plugin-launcher="path\to\purify /Run=yes"  </li><li><code>--ppapi-startup-dialog</code> ⊗ 	Causes the PPAPI sub process to display a dialog on launch. Be sure to use --no-sandbox as well or the sandbox won't allow the dialog to display.  </li><li><code>--ppapi-subpixel-rendering-setting[1]</code> ⊗ 	The enum value of FontRenderParams::subpixel_rendering to be passed to Ppapi processes.  </li><li><code>--previous-app</code> ⊗ 	previous-app should be the app that was running when last-launched-app started.  </li><li><code>--print-to-pdf</code> ⊗ 	Save a pdf file of the loaded page.  </li><li><code>--print-to-pdf-no-header</code> ⊗ 	Do not display header and footer in the pdf file.  </li><li><code>--print_compositor</code> ⊗ 	No description  </li><li><code>--privet-ipv6-only</code> ⊗ 	Use IPv6 only for privet HTTP.  </li><li><code>--process-per-site</code> ⊗ 	Enable the "Process Per Site" process model for all domains. This mode consolidates same-site pages so that they share a single process. More details here: - <a href="https://www.chromium.org/developers/design-documents/process-models" target="_blank" rel="noopener noreferrer">https://www.chromium.org/developers/design-documents/process-models</a> - The class comment in site_instance.h, listing the supported process models. IMPORTANT: This isn't to be confused with --site-per-process (which is about isolation, not consolidation). You probably want the other one.  </li><li><code>--process-per-tab</code> ⊗ 	Runs each set of script-connected tabs (i.e., a BrowsingInstance) in its own renderer process. We default to using a renderer process for each site instance (i.e., group of pages from the same registered domain with script connections to each other). TODO(creis): This flag is currently a no-op. We should refactor it to avoid "unnecessary" process swaps for cross-site navigations but still swap when needed for security (e.g., isolated origins).  </li><li><code>--prod</code> ⊗ 	The command line alias and URL for the "prod" environment.  </li><li><code>--product-version</code> ⊗ 	Outputs the product version information and quit. Used as an internal api to detect the installed version of Chrome on Linux.  </li><li><code>--profile-directory</code> ⊗ 	Selects directory of profile to associate with the first browser launched.  </li><li><code>--profile-requires-policy</code> ⊗ 	If set to "true", the profile requires policy during restart (policy load must succeed, otherwise session restart should fail).  </li><li><code>--profiling-at-start</code> ⊗ 	Starts the sampling based profiler for the browser process at startup. This will only work if chrome has been built with the gn arg enable_profiling = true. The output will go to the value of kProfilingFile.  </li><li><code>--profiling-file</code> ⊗ 	Specifies a location for profiling output. This will only work if chrome has been built with the gyp variable profiling=1 or gn arg enable_profiling=true. {pid} if present will be replaced by the pid of the process. {count} if present will be incremented each time a profile is generated for this process. The default is chrome-profile-{pid} for the browser and test-profile-{pid} for tests.  </li><li><code>--profiling-flush</code> ⊗ 	Controls whether profile data is periodically flushed to a file. Normally the data gets written on exit but cases exist where chromium doesn't exit cleanly (especially when using single-process). A time in seconds can be specified.  </li><li><code>--progress-bar-animation[7]</code> ⊗ 	Specifies Android phone page loading progress bar animation.  </li><li><code>--proxy-auto-detect</code> ⊗ 	Forces proxy auto-detection.  </li><li><code>--proxy-bypass-list</code> ⊗ 	Specifies a list of hosts for whom we bypass proxy settings and use direct connections. Ignored unless --proxy-server is also specified. This is a comma-separated list of bypass rules. See: "net/proxy_resolution/proxy_bypass_rules.h" for the format of these rules.  </li><li><code>--proxy-pac-url</code> ⊗ 	Uses the pac script at the given URL  </li><li><code>--proxy-server</code> ⊗ 	Uses a specified proxy server, overrides system settings. This switch only affects HTTP and HTTPS requests.  </li><li><code>--proxy_resolver[1]</code> ⊗ 	No description  </li><li><code>--pseudo</code> ⊗ 	No description  </li><li><code>--public-accounts-saml-acl-url</code> ⊗ 	SAML assertion consumer URL, used to detect when Gaia-less SAML flows end (e.g. for SAML managed guest sessions) TODO(984021): Remove when URL is sent by DMServer.  </li><li><code>--pull-to-refresh</code> ⊗ 	Enables or disables pull-to-refresh gesture in response to vertical overscroll. Set the value to '0' to disable the feature, set to '1' to enable it for both touchpad and touchscreen, and set to '2' to enable it only for touchscreen. Defaults to disabled.  </li><li><code>--purge-model-and-features-store</code> ⊗ 	Purges the store containing prediction medels and host model features on startup, so that it's guaranteed to be using fresh data.  </li><li><code>--purge-optimization-guide-store</code> ⊗ 	Purges the store containing fetched and component hints on startup, so that it's guaranteed to be using fresh data.  </li><li><code>--pwa-launcher-version[1]</code> ⊗ 	Specifies the version of the Progressive-Web-App launcher that launched Chrome, used to determine whether to update all launchers. NOTE: changing this switch requires adding legacy handling for the previous method, as older PWA launchers still using this switch will rely on Chrome to update them to use the new method.  </li><li><code>--quarantine-dir</code> ⊗ 	Specifies the quarantine folder instead of the default one.  </li><li><code>--query-tiles-country-code</code> ⊗ 	No description  </li><li><code>--query-tiles-instant-background-task</code> ⊗ 	No description  </li><li><code>--query-tiles-single-tier</code> ⊗ 	No description  </li><li><code>--rdp_desktop_session</code> ⊗ 	No description  </li><li><code>--reached-code-sampling-interval-us[7]</code> ⊗ 	Specifies the profiling interval in microseconds for reached code profiler.  </li><li><code>--reader-mode-feedback</code> ⊗ 	No description  </li><li><code>--reader-mode-heuristics</code> ⊗ 	No description  </li><li><code>--realtime-reporting-url</code> ⊗ 	Specifies the URL at which to upload real-time reports.  </li><li><code>--redirect-libassistant-logging</code> ⊗ 	Redirects libassistant logging to /var/log/chrome/.  </li><li><code>--register-font-files[1]</code> ⊗ 	Registers additional font files on Windows (for fonts outside the usual %WINDIR%\Fonts location). Multiple files can be used by separating them with a semicolon (;).  </li><li><code>--register-max-dark-suspend-delay</code> ⊗ 	Makes Chrome register the maximum dark suspend delay possible on Chrome OS i.e. give the device the maximum amount of time to do its work in dark resume as is allowed by the power manager.  </li><li><code>--register-pepper-plugins</code> ⊗ 	Register Pepper plugins (see pepper_plugin_list.cc for its format).  </li><li><code>--regulatory-label-dir</code> ⊗ 	The name of the per-model directory which contains per-region subdirectories with regulatory label files for this model. The per-model directories (if there are any) are located under "/usr/share/chromeos-assets/regulatory_labels/".  </li><li><code>--relauncher[6]</code> ⊗ 	A process type (switches::kProcessType) that relaunches the browser. See chrome/browser/mac/relauncher.h.  </li><li><code>--remote-debugger-handles</code> ⊗ 	No description  </li><li><code>--remote-debugging-address</code> ⊗ 	Use the given address instead of the default loopback for accepting remote debugging connections. Should be used together with --remote-debugging-port. Note that the remote debugging protocol does not perform any authentication, so exposing it too widely can be a security risk.  </li><li><code>--remote-debugging-pipe</code> ⊗ 	Enables remote debug over stdio pipes <!-- -->[in=3, out=4]<!-- -->. Optionally, specifies the format for the protocol messages, can be either "JSON" (the default) or "CBOR".  </li><li><code>--remote-debugging-port</code> ⊗ 	Enables remote debug over HTTP on the specified port.  </li><li><code>--remote-debugging-socket-name[7]</code> ⊗ 	Enables remote debug over HTTP on the specified socket name.  </li><li><code>--remote-debugging-targets</code> ⊗ 	Porvides a list of addresses to discover DevTools remote debugging targets. The format is <code>&lt;host&gt;:&lt;port&gt;,...,&lt;host&gt;:port</code>.  </li><li><code>--remove-scan-only-uws</code> ⊗ 	Allow the engine to remove UwS that isn't marked cleanable. For testing only.  </li><li><code>--renderer</code> ⊗ 	No description  </li><li><code>--renderer-client-id</code> ⊗ 	No description  </li><li><code>--renderer-cmd-prefix</code> ⊗ 	The contents of this flag are prepended to the renderer command line. Useful values might be "valgrind" or "xterm -e gdb --args".  </li><li><code>--renderer-process-limit</code> ⊗ 	Overrides the default/calculated limit to the number of renderer processes. Very high values for this setting can lead to high memory/resource usage or instability.  </li><li><code>--renderer-sampling</code> ⊗ 	No description  </li><li><code>--renderer-startup-dialog</code> ⊗ 	Causes the renderer process to display a dialog on launch. Passing this flag also adds sandbox::policy::kNoSandbox on Windows non-official builds, since that's needed to show a dialog.  </li><li><code>--renderer-wait-for-java-debugger[7]</code> ⊗ 	Block ChildProcessMain thread of the renderer's ChildProcessService until a Java debugger is attached.  </li><li><code>--renderpass</code> ⊗ 	Parameters for kUIShowCompositedLayerBorders.  </li><li><code>--repl</code> ⊗ 	Runs a read-eval-print loop that allows the user to evaluate Javascript expressions.  </li><li><code>--report-vp9-as-an-unsupported-mime-type</code> ⊗ 	Force to report VP9 as an unsupported MIME type.  </li><li><code>--require-audio-hardware-for-testing</code> ⊗ 	When running tests on a system without the required hardware or libraries, this flag will cause the tests to fail. Otherwise, they silently succeed.  </li><li><code>--require-wlan</code> ⊗ 	Only connect to WLAN interfaces.  </li><li><code>--reset-variation-state</code> ⊗ 	Forces a reset of the one-time-randomized FieldTrials on this client, also known as the Chrome Variations state.  </li><li><code>--restore-last-session</code> ⊗ 	Indicates the last session should be restored on startup. This overrides the preferences value. Note that this does not force automatic session restore following a crash, so as to prevent a crash loop. This switch is used to implement support for OS-specific "continue where you left off" functionality on OS X and Windows.  </li><li><code>--restrict-gamepad-access</code> ⊗ 	Enables Feature Policy and Secure Context requirements on getGamepads.  </li><li><code>--rlz-ping-delay</code> ⊗ 	The rlz ping delay (in seconds) that overwrites the default value.  </li><li><code>--rtl</code> ⊗ 	No description  </li><li><code>--run-all-compositor-stages-before-draw</code> ⊗ 	Effectively disables pipelining of compositor frame production stages by waiting for each stage to finish before completing a frame.  </li><li><code>--run-manual</code> ⊗ 	Manual tests only run when --run-manual is specified. This allows writing tests that don't run automatically but are still in the same test binary. This is useful so that a team that wants to run a few tests doesn't have to add a new binary that must be compiled on all builds.  </li><li><code>--run-web-tests</code> ⊗ 	Runs Content Shell in web test mode, injecting test-only behaviour for blink web tests.  </li><li><code>--run-without-sandbox-for-testing[3]</code> ⊗ 	Load the engine outside the sandbox. This is only to be used for manual testing.  </li><li><code>--safe-mode</code> ⊗ 	The switch added by session_manager daemon when chrome crashes 3 times or more within the first 60 seconds on start. See BrowserJob::ExportArgv in platform2/login_manager/browser_job.cc.  </li><li><code>--safebrowsing-enable-enhanced-protection</code> ⊗ 	Enable Safe Browsing Enhanced Protection.  </li><li><code>--safebrowsing-manual-download-blacklist</code> ⊗ 	List of comma-separated sha256 hashes of executable files which the download-protection service should treat as "dangerous." For a file to show a warning, it also must be considered a dangerous filetype and not be whitelisted otherwise (by signature or URL) and must be on a supported OS. Hashes are in hex. This is used for manual testing when looking for ways to by-pass download protection.  </li><li><code>--SafeSites</code> ⊗ 	No description  </li><li><code>--saml-password-change-url</code> ⊗ 	Password change url for SAML users. TODO(941489): Remove when the bug is fixed.  </li><li><code>--sandbox-ipc</code> ⊗ 	Causes the process to run as a sandbox IPC subprocess.  </li><li><code>--sandbox-mojo-pipe-token</code> ⊗ 	Mojo pipe token generated in the broker process and passed to the sandbox process to bind with the EngineCommands IPC interface.  </li><li><code>--sandboxed-process-id</code> ⊗ 	Used to identify the id of the sandbox process that is intended to be spawned.  </li><li><code>--save-page-as-mhtml</code> ⊗ 	Disable saving pages as HTML-only, disable saving pages as HTML Complete (with a directory of sub-resources). Enable only saving pages as MHTML. See <a href="http://crbug.com/120416" target="_blank" rel="noopener noreferrer">http://crbug.com/120416</a> for how to remove this switch.  </li><li><code>--scan-locations</code> ⊗ 	Used to limit trace locations that will be scanned. Trace locations should be specified as integers, separated by commas. For example: --scan-locations=1,2,3,5  </li><li><code>--scanning-timeout</code> ⊗ 	Set the timeout for the scanning phase, in minutes. 0 disables the timeout entirely. WARNING: this switch is used by internal test systems. Be careful when making changes.  </li><li><code>--scheduler-configuration[5]</code> ⊗ 	Selects the scheduler configuration specified in the parameter.  </li><li><code>--scheduler-configuration-default[5]</code> ⊗ 	Specifies what the default scheduler configuration value is if the user does not set one.  </li><li><code>--screen-config</code> ⊗ 	Specifies the initial screen configuration, or state of all displays, for FakeDisplayDelegate, see class for format details.  </li><li><code>--screenshot</code> ⊗ 	Save a screenshot of the loaded page.  </li><li><code>--search-provider-logo-url</code> ⊗ 	Use a static URL for the logo of the default search engine. Example: <a href="https://www.google.com/branding/logo.png" target="_blank" rel="noopener noreferrer">https://www.google.com/branding/logo.png</a>  </li><li><code>--secondary-display-layout</code> ⊗ 	Specifies the layout mode and offsets for the secondary display for testing. The format is "<code>&lt;t|r|b|l&gt;,&lt;offset&gt;</code>" where t=TOP, r=RIGHT, b=BOTTOM and L=LEFT. For example, 'r,-100' means the secondary display is positioned on the right with -100 offset. (above than primary)  </li><li><code>--service</code> ⊗ 	No description  </li><li><code>--service-manager</code> ⊗ 	The value of the |kProcessType| switch which tells the executable to assume the role of a standalone Service Manager instance.  </li><li><code>--service-name</code> ⊗ 	Indicates the name of the service to run. Useful for debugging, or if a service executable is built to support being run as a number of potential different services.  </li><li><code>--service-request-attachment-name</code> ⊗ 	The name of the <code>|mojo::PendingReceiver&lt;service_manager::mojom::Service&gt;|</code> message pipe handle that is attached to the incoming Mojo invitation received by the service.  </li><li><code>--service-request-channel-token</code> ⊗ 	The token to use to construct the message pipe for a service in a child process.  </li><li><code>--service-runner</code> ⊗ 	The value of the |kProcessType| switch which tells the executable to assume the role of a service instance.  </li><li><code>--service-sandbox-type</code> ⊗ 	Type of sandbox to apply to the process running the service, one of the values in the next block.  </li><li><code>--set-extension-throttle-test-params</code> ⊗ 	Set the parameters for ExtensionURLLoaderThrottleBrowserTest.  </li><li><code>--shader-disk-cache-size-kb</code> ⊗ 	Allows explicitly specifying the shader disk cache size for embedded devices. Default value is 6MB. On Android, 2MB is default and 128KB for low-end devices.  </li><li><code>--shared-files</code> ⊗ 	Describes the file descriptors passed to a child process in the following list format: <code>&lt;file_id&gt;:&lt;descriptor_id&gt;,&lt;file_id&gt;:&lt;descriptor_id&gt;,...</code> where <code>&lt;file_id&gt;</code> is an ID string from the manifest of the service being launched and <code>&lt;descriptor_id&gt;</code> is the numeric identifier of the descriptor for the child process can use to retrieve the file descriptor from the global descriptor table.  </li><li><code>--sharing_service</code> ⊗ 	No description  </li><li><code>--shelf-hotseat</code> ⊗ 	New modular design for the shelf with apps separated into a hotseat UI and smaller shelf in clamshell mode.  </li><li><code>--shelf-hover-previews</code> ⊗ 	App window previews when hovering over the shelf.  </li><li><code>--shill-stub</code> ⊗ 	Overrides Shill stub behavior. By default, ethernet, wifi and vpn are enabled, and transitions occur instantaneously. Multiple options can be comma separated (no spaces). Note: all options are in the format 'foo=x'. Values are case sensitive and based on Shill names in service_constants.h. See FakeShillManagerClient::SetInitialNetworkState for implementation. Examples: 'clear=1' - Clears all default configurations 'wifi=on' - A wifi network is initially connected ('1' also works) 'wifi=off' - Wifi networks are all initially disconnected ('0' also works) 'wifi=disabled' - Wifi is initially disabled 'wifi=none' - Wifi is unavailable 'wifi=portal' - Wifi connection will be in Portal state 'cellular=1' - Cellular is initially connected 'cellular=LTE' - Cellular is initially connected, technology is LTE 'interactive=3' - Interactive mode, connect/scan/etc requests take 3 secs  </li><li><code>--short-merge-session-timeout-for-test[5]</code> ⊗ 	Use a short (1 second) timeout for merge session loader throttle testing.  </li><li><code>--short-reporting-delay</code> ⊗ 	Sets the Reporting API delay to under a second to allow much quicker reports.  </li><li><code>--show-aggregated-damage</code> ⊗ 	Adds a DebugBorderDrawQuad to the top of the root RenderPass showing the damage rect after surface aggregation. Note that when enabled this feature sets the entire output rect as damaged after adding the quad to highlight the real damage rect, which could hide damage rect problems.  </li><li><code>--show-android-files-in-files-app</code> ⊗ 	If true, files in Android internal storage will be shown in Files app.  </li><li><code>--show-auth-dialog-dev-overlay</code> ⊗ 	If true, the debug view overlay will be shown for the in-session authentication dialog. This enables development of the dialog. TODO(yichenli): Remove this after the feature is released.  </li><li><code>--show-autofill-signatures</code> ⊗ 	Annotates forms and fields with Autofill signatures.  </li><li><code>--show-autofill-type-predictions</code> ⊗ 	Annotates forms with Autofill field type predictions.  </li><li><code>--show-component-extension-options</code> ⊗ 	Makes component extensions appear in chrome://settings/extensions.  </li><li><code>--show-composited-layer-borders</code> ⊗ 	Renders a border around compositor layers to help debug and study layer compositing.  </li><li><code>--show-dc-layer-debug-borders</code> ⊗ 	Show debug borders for DC layers - red for overlays and blue for underlays. The debug borders are offset from the layer rect by a few pixels for clarity.  </li><li><code>--show-fps-counter</code> ⊗ 	Draws a heads-up-display showing Frames Per Second as well as GPU memory usage. If you also use --enable-logging=stderr --vmodule="head*=1" then FPS will also be output to the console log.  </li><li><code>--show-icons[1]</code> ⊗ 	See kHideIcons.  </li><li><code>--show-layer-animation-bounds</code> ⊗ 	Renders a border that represents the bounding box for the layer's animation.  </li><li><code>--show-layout-shift-regions</code> ⊗ 	Visibly render a border around layout shift rects in the web page to help debug and study layout shifts.  </li><li><code>--show-login-dev-overlay</code> ⊗ 	If true, the developer tool overlay will be shown for the login/lock screen. This makes it easier to test layout logic.  </li><li><code>--show-mac-overlay-borders[6]</code> ⊗ 	Show borders around CALayers corresponding to overlays and partial damage.  </li><li><code>--show-oobe-dev-overlay</code> ⊗ 	Enables OOBE UI Debugger for ease of navigation between screens during manual testing. Limited to ChromeOS-on-linux and test images only.  </li><li><code>--show-overdraw-feedback</code> ⊗ 	Visualize overdraw by color-coding elements based on if they have other elements drawn underneath. This is good for showing where the UI might be doing more rendering work than necessary. The colors are hinting at the amount of overdraw on your screen for each pixel, as follows: True color: No overdraw. Blue: Overdrawn once. Green: Overdrawn twice. Pink: Overdrawn three times. Red: Overdrawn four or more times.  </li><li><code>--show-paint-rects</code> ⊗ 	Visibly render a border around paint rects in the web page to help debug and study painting behavior.  </li><li><code>--show-property-changed-rects</code> ⊗ 	Show rects in the HUD around layers whose properties have changed.  </li><li><code>--show-screenspace-rects</code> ⊗ 	Show rects in the HUD around the screen-space transformed bounds of every layer.  </li><li><code>--show-surface-damage-rects</code> ⊗ 	Show rects in the HUD around damage as it is recorded into each render surface.  </li><li><code>--show-taps</code> ⊗ 	Draws a circle at each touch point, similar to the Android OS developer option "Show taps".  </li><li><code>--silent-debugger-extension-api</code> ⊗ 	Does not show an infobar when an extension attaches to a page using chrome.debugger page. Required to attach to extension background pages.  </li><li><code>--silent-launch</code> ⊗ 	Causes Chrome to launch without opening any windows by default. Useful if one wishes to use Chrome as an ash server.  </li><li><code>--simulate-critical-update</code> ⊗ 	Simulates a critical update being available.  </li><li><code>--simulate-elevated-recovery</code> ⊗ 	Simulates that elevation is needed to recover upgrade channel.  </li><li><code>--simulate-outdated</code> ⊗ 	Simulates that current version is outdated.  </li><li><code>--simulate-outdated-no-au</code> ⊗ 	Simulates that current version is outdated and auto-update is off.  </li><li><code>--simulate-update-error-code</code> ⊗ 	Simulates a GoogleUpdateErrorCode error by the update check. Must be supplied with |kSimulateUpdateHresult| switch.  </li><li><code>--simulate-update-hresult</code> ⊗ 	Simulates a specific HRESULT error code returned by the update check. If the switch value is not specified (as hex) then it defaults to E_FAIL.  </li><li><code>--simulate-upgrade</code> ⊗ 	Simulates an update being available.  </li><li><code>--single-process</code> ⊗ 	Runs the renderer and plugins in the same process as the browser  </li><li><code>--site-per-process</code> ⊗ 	Enforces a one-site-per-process security policy: <em> Each renderer process, for its whole lifetime, is dedicated to rendering pages for just one site. </em> Thus, pages from different sites are never in the same process. <em> A renderer process's access rights are restricted based on its site. </em> All cross-site navigations force process swaps. * <code>&lt;iframe&gt;</code>s are rendered out-of-process whenever the src= is cross-site. More details here: - <a href="https://www.chromium.org/developers/design-documents/site-isolation" target="_blank" rel="noopener noreferrer">https://www.chromium.org/developers/design-documents/site-isolation</a> - <a href="https://www.chromium.org/developers/design-documents/process-models" target="_blank" rel="noopener noreferrer">https://www.chromium.org/developers/design-documents/process-models</a> - The class comment in site_instance.h, listing the supported process models. IMPORTANT: this isn't to be confused with --process-per-site (which is about process consolidation, not isolation). You probably want this one.  </li><li><code>--skia-font-cache-limit-mb</code> ⊗ 	Specifies the max number of bytes that should be used by the skia font cache. If the cache needs to allocate more, skia will purge previous entries.  </li><li><code>--skia-resource-cache-limit-mb</code> ⊗ 	Specifies the max number of bytes that should be used by the skia resource cache. The previous entries are purged from the cache when the memory useage exceeds this limit.  </li><li><code>--slow-down-compositing-scale-factor</code> ⊗ 	Re-draw everything multiple times to simulate a much slower machine. Give a slow down factor to cause renderer to take that many times longer to complete, such as --slow-down-compositing-scale-factor=2.  </li><li><code>--slow-down-raster-scale-factor</code> ⊗ 	Re-rasters everything multiple times to simulate a much slower machine. Give a scale factor to cause raster to take that many times longer to complete, such as --slow-down-raster-scale-factor=25.  </li><li><code>--sms-test-messages</code> ⊗ 	Sends test messages on first call to RequestUpdate (stub only).  </li><li><code>--spdy-proxy-auth-fallback</code> ⊗ 	The origin of the data reduction proxy fallback.  </li><li><code>--spdy-proxy-auth-origin</code> ⊗ 	The origin of the data reduction proxy.  </li><li><code>--spdy-proxy-auth-value</code> ⊗ 	A test key for data reduction proxy authentication.  </li><li><code>--speech_recognition</code> ⊗ 	No description  </li><li><code>--ssl-key-log-file</code> ⊗ 	Causes SSL key material to be logged to the specified file for debugging purposes. See <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/NSS/Key_Log_Format" target="_blank" rel="noopener noreferrer">https://developer.mozilla.org/en-US/docs/Mozilla/Projects/NSS/Key_Log_Format</a> for the format.  </li><li><code>--ssl-version-max</code> ⊗ 	Specifies the maximum SSL/TLS version ("tls1.2" or "tls1.3").  </li><li><code>--ssl-version-min</code> ⊗ 	Specifies the minimum SSL/TLS version ("tls1", "tls1.1", "tls1.2", or "tls1.3").  </li><li><code>--stable-release-mode</code> ⊗ 	This makes us disable some web-platform runtime features so that we test content_shell as if it was a stable release. It is only followed when kRunWebTest is set. For the features' level, see <a href="http://dev.chromium.org/blink/runtime-enabled-features" target="_blank" rel="noopener noreferrer">http://dev.chromium.org/blink/runtime-enabled-features</a>.  </li><li><code>--staging</code> ⊗ 	The command line alias and URL for the "staging" environment.  </li><li><code>--start-fullscreen</code> ⊗ 	Specifies if the browser should start in fullscreen mode, like if the user had pressed F11 right after startup.  </li><li><code>--start-in-incognito</code> ⊗ 	Starts the shell with the profile in incognito mode.  </li><li><code>--start-maximized</code> ⊗ 	Starts the browser maximized, regardless of any previous settings.  </li><li><code>--start-stack-profiler</code> ⊗ 	Starts the stack sampling profiler in the child process.  </li><li><code>--started</code> ⊗ 	Value for kTestCrosGaiaIdMigration indicating that migration is started (i.e. all stored user keys will be converted to GaiaId)  </li><li><code>--storage-pressure-notification-interval</code> ⊗ 	Interval, in minutes, used for storage pressure notification throttling. Useful for developers testing applications that might use non-trivial amounts of disk space.  </li><li><code>--structured-metrics-disabled</code> ⊗ 	Disable structured metrics logging of cros actions.  </li><li><code>--stub</code> ⊗ 	No description  </li><li><code>--suppress-message-center-popups</code> ⊗ 	Hides all Message Center notification popups (toasts). Used for testing.  </li><li><code>--surface</code> ⊗ 	No description  </li><li><code>--swiftshader</code> ⊗ 	No description  </li><li><code>--swiftshader-webgl</code> ⊗ 	No description  </li><li><code>--sync-deferred-startup-timeout-seconds</code> ⊗ 	Allows overriding the deferred init fallback timeout.  </li><li><code>--sync-disable-deferred-startup</code> ⊗ 	Enables deferring sync backend initialization until user initiated changes occur.  </li><li><code>--sync-include-specifics</code> ⊗ 	Controls whether the initial state of the "Capture Specifics" flag on chrome://sync-internals is enabled.  </li><li><code>--sync-short-initial-retry-override</code> ⊗ 	This flag causes sync to retry very quickly (see polling_constants.h) the when it encounters an error, as the first step towards exponential backoff.  </li><li><code>--sync-short-nudge-delay-for-test</code> ⊗ 	This flag significantly shortens the delay between nudge cycles. Its primary purpose is to speed up integration tests. The normal delay allows coalescing and prevention of server overload, so don't use this unless you're really sure that it's what you want.  </li><li><code>--sync-url</code> ⊗ 	Overrides the default server used for profile sync.  </li><li><code>--sys-info-file-path</code> ⊗ 	System info file path. Default is an empty string, which means that dummy info will be used.  </li><li><code>--system-developer-mode</code> ⊗ 	Used by FakeDebugDaemonClient to specify that the system is running in dev mode when running in a Linux environment. The dev mode probing is done by session manager.  </li><li><code>--system-gesture-start-height</code> ⊗ 	The number of pixels from the very top or bottom of the screen to consider as a valid origin for the top or bottom swipe gesture. Overrides the default value in cast_system_gesture_handler.cc.  </li><li><code>--system-gesture-start-width</code> ⊗ 	The number of pixels from the very left or right of the screen to consider as a valid origin for the left or right swipe gesture. Overrides the default value in cast_system_gesture_handler.cc.  </li><li><code>--system-log-upload-frequency</code> ⊗ 	Frequency in Milliseconds for system log uploads. Should only be used for testing purposes.  </li><li><code>--telemetry-extension-dir</code> ⊗ 	Specifies directory for the Telemetry System Web Extension.  </li><li><code>--test-child-process</code> ⊗ 	When running certain tests that spawn child processes, this switch indicates to the test framework that the current process is a child process.  </li><li><code>--test-cros-gaia-id-migration</code> ⊗ 	Controls CrOS GaiaId migration for tests ("" is default).  </li><li><code>--test-do-not-initialize-icu</code> ⊗ 	When running certain tests that spawn child processes, this switch indicates to the test framework that the current process should not initialize ICU to avoid creating any scoped handles too early in startup.  </li><li><code>--test-encryption-migration-ui</code> ⊗ 	Enables testing for encryption migration UI.  </li><li><code>--test-gl-lib</code> ⊗ 	Flag used for Linux tests: for desktop GL bindings, try to load this GL library first, but fall back to regular library if loading fails.  </li><li><code>--test-logging-path</code> ⊗ 	Set a path to save logs in while testing.  </li><li><code>--test-logging-url</code> ⊗ 	Set a test logging URL, where logs will be uploaded.  </li><li><code>--test-name</code> ⊗ 	Passes the name of the current running automated test to Chrome.  </li><li><code>--test-type</code> ⊗ 	Type of the current test harness ("browser" or "ui").  </li><li><code>--test-wallpaper-server</code> ⊗ 	Enables the wallpaper picker to fetch images from the test server.  </li><li><code>--testing</code> ⊗ 	Flag set during testing and stored as a crash key, to differentiate from crashes received from actual users. WARNING: this switch is used by internal test systems. Be careful when making changes.  </li><li><code>--tether-host-scans-ignore-wired-connections</code> ⊗ 	Tells the Chromebook to scan for a tethering host even if there is already a wired connection. This allows end-to-end tests to be deployed over ethernet without that connection preventing scans and thereby blocking the testing of cases with no preexisting connection. Should be used only for testing.  </li><li><code>--tether-stub</code> ⊗ 	Overrides Tether with stub service. Provide integer arguments for the number of fake networks desired, e.g. 'tether-stub=2'.  </li><li><code>--third-party-doodle-url</code> ⊗ 	Overrides the Doodle URL to use for third-party search engines. Testing? Try: <a href="https://www.gstatic.com/chrome/ntp/doodle_test/third_party_simple.json" target="_blank" rel="noopener noreferrer">https://www.gstatic.com/chrome/ntp/doodle_test/third_party_simple.json</a> <a href="https://www.gstatic.com/chrome/ntp/doodle_test/third_party_animated.json" target="_blank" rel="noopener noreferrer">https://www.gstatic.com/chrome/ntp/doodle_test/third_party_animated.json</a>  </li><li><code>--timeout</code> ⊗ 	Issues a stop after the specified number of milliseconds. This cancels all navigation and causes the DOMContentLoaded event to fire.  </li><li><code>--tint-composited-content</code> ⊗ 	Tint composited color.  </li><li><code>--tls1</code> ⊗ 	TLS 1.0 mode for the |kSSLVersionMin| switch.  </li><li><code>--tls1.1</code> ⊗ 	TLS 1.1 mode for the |kSSLVersionMin| switch.  </li><li><code>--tls1.2</code> ⊗ 	TLS 1.2 mode for |kSSLVersionMax| and |kSSLVersionMin| switches.  </li><li><code>--tls1.3</code> ⊗ 	TLS 1.3 mode for |kSSLVersionMax| and |kSSLVersionMin| switches.  </li><li><code>--top-chrome-touch-ui</code> ⊗ 	Controls touch-optimized UI layout for top chrome.  </li><li><code>--top-controls-hide-threshold</code> ⊗ 	Percentage of the browser controls need to be hidden before they will auto hide.  </li><li><code>--top-controls-show-threshold</code> ⊗ 	Percentage of the browser controls need to be shown before they will auto show.  </li><li><code>--touch-devices[10]</code> ⊗ 	Tells chrome to interpret events from these devices as touch events. Only available with XInput 2 (i.e. X server 1.8 or above). The id's of the devices can be retrieved from 'xinput list'.  </li><li><code>--touch-events</code> ⊗ 	Enable support for touch event feature detection.  </li><li><code>--touch-selection-strategy</code> ⊗ 	Controls how text selection granularity changes when touch text selection handles are dragged. Should be "character" or "direction". If not specified, the platform default is used.  </li><li><code>--touchscreen-usable-while-screen-off</code> ⊗ 	Chromebases' touchscreens can be used to wake from suspend, unlike the touchscreens on other Chrome OS devices. If set, the touchscreen is kept enabled while the screen is off so that it can be used to turn the screen back on after it has been turned off for inactivity but before the system has suspended.  </li><li><code>--touch_view</code> ⊗ 	No description  </li><li><code>--trace-config-file</code> ⊗ 	Causes TRACE_EVENT flags to be recorded from startup. This flag will be ignored if --trace-startup or --trace-shutdown is provided.  </li><li><code>--trace-startup</code> ⊗ 	Causes TRACE_EVENT flags to be recorded from startup. Optionally, can specify the specific trace categories to include (e.g. --trace-startup=base,net) otherwise, all events are recorded. Setting this flag results in the first call to BeginTracing() to receive all trace events since startup. In Chrome, you may find --trace-startup-file and --trace-startup-duration to control the auto-saving of the trace (not supported in the base-only TraceLog component).  </li><li><code>--trace-startup-duration</code> ⊗ 	Sets the time in seconds until startup tracing ends. If omitted a default of 5 seconds is used. Has no effect without --trace-startup, or if --startup-trace-file=none was supplied.  </li><li><code>--trace-startup-enable-privacy-filtering</code> ⊗ 	If the perfetto tracing backend is used, this enables privacy filtering in the TraceEvent data sources for the startup tracing session.  </li><li><code>--trace-startup-file</code> ⊗ 	If supplied, sets the file which startup tracing will be stored into, if omitted the default will be used "chrometrace.log" in the current directory. Has no effect unless --trace-startup is also supplied. Example: --trace-startup --trace-startup-file=/tmp/trace_event.log As a special case, can be set to 'none' - this disables automatically saving the result to a file and the first manually recorded trace will then receive all events since startup.  </li><li><code>--trace-startup-owner</code> ⊗ 	Specifies the coordinator of the startup tracing session. If the legacy tracing backend is used instead of perfetto, providing this flag is not necessary. Valid values: 'controller', 'devtools', or 'system'. Defaults to 'controller'. If 'controller' is specified, the session is controlled and stopped via the TracingController (e.g. to implement the timeout). If 'devtools' is specified, the startup tracing session will be owned by DevTools and thus can be controlled (i.e. stopped) via the DevTools Tracing domain on the first session connected to the browser endpoint. If 'system' is specified, the system Perfetto service should already be tracing on a supported platform (currently only Android). Session is stopped through the normal methods for stopping system traces.  </li><li><code>--trace-startup-record-mode</code> ⊗ 	If supplied, sets the tracing record mode and options; otherwise, the default "record-until-full" mode will be used.  </li><li><code>--trace-to-console</code> ⊗ 	Sends a pretty-printed version of tracing info to the console.  </li><li><code>--trace-to-file</code> ⊗ 	Sends trace events from these categories to a file. --trace-to-file on its own sends to default categories.  </li><li><code>--trace-to-file-name</code> ⊗ 	Specifies the file name for --trace-to-file. If unspecified, it will go to a default file name.  </li><li><code>--trace-upload-url</code> ⊗ 	Sets the target URL for uploading tracing data.  </li><li><code>--translate-ranker-model-url</code> ⊗ 	Overrides the URL from which the translate ranker model is downloaded.  </li><li><code>--translate-script-url</code> ⊗ 	Overrides the default server used for Google Translate.  </li><li><code>--translate-security-origin</code> ⊗ 	Overrides security-origin with which Translate runs in an isolated world.  </li><li><code>--true</code> ⊗ 	Value indicating whether flag from command line switch is true.  </li><li><code>--trustable-web-bundles-file-url</code> ⊗ 	Accepts specified file URL of a trustable WebBundle file. This flag should be used only for testing purpose.  </li><li><code>--trusted-cdn-base-url-for-tests[7]</code> ⊗ 	Specifies a base URL for the trusted CDN for tests.  </li><li><code>--trusted-download-sources</code> ⊗ 	Identifies a list of download sources as trusted, but only if proper group policy is set.  </li><li><code>--try-chrome-again</code> ⊗ 	Experimental. Shows a dialog asking the user to try chrome. This flag is to be used only by the upgrade process.  </li><li><code>--try-supported-channel-layouts[1]</code> ⊗ 	Instead of always using the hardware channel layout, check if a driver supports the source channel layout. Avoids outputting empty channels and permits drivers to enable stereo to multichannel expansion. Kept behind a flag since some drivers lie about supported layouts and hang when used. See <a href="http://crbug.com/259165" target="_blank" rel="noopener noreferrer">http://crbug.com/259165</a> for more details.  </li><li><code>--tts[5]</code> ⊗ 	No description  </li><li><code>--type</code> ⊗ 	Indicates the type of process to run. This may be "service-manager", "service-runner", or any other arbitrary value supported by the embedder.  </li><li><code>--ui-compositor-memory-limit-when-visible-mb</code> ⊗ 	No description  </li><li><code>--ui-disable-partial-swap</code> ⊗ 	Disable partial swap which is needed for some OpenGL drivers / emulators.  </li><li><code>--ui-disable-zero-copy</code> ⊗ 	No description  </li><li><code>--ui-enable-layer-lists</code> ⊗ 	Switches the ui compositor to use layer lists instead of layer trees.  </li><li><code>--ui-enable-rgba-4444-textures</code> ⊗ 	No description  </li><li><code>--ui-enable-zero-copy</code> ⊗ 	No description  </li><li><code>--ui-show-composited-layer-borders</code> ⊗ 	No description  </li><li><code>--ui-show-fps-counter</code> ⊗ 	No description  </li><li><code>--ui-show-layer-animation-bounds</code> ⊗ 	No description  </li><li><code>--ui-show-paint-rects</code> ⊗ 	No description  </li><li><code>--ui-show-property-changed-rects</code> ⊗ 	No description  </li><li><code>--ui-show-screenspace-rects</code> ⊗ 	No description  </li><li><code>--ui-show-surface-damage-rects</code> ⊗ 	No description  </li><li><code>--ui-slow-animations</code> ⊗ 	No description  </li><li><code>--unfiltered-bluetooth-devices</code> ⊗ 	Shows all Bluetooth devices in UI (System Tray/Settings Page.)  </li><li><code>--uninstall[1]</code> ⊗ 	Runs un-installation steps that were done by chrome first-run.  </li><li><code>--unlimited-storage</code> ⊗ 	Overrides per-origin quota settings to unlimited storage for any apps/origins. This should be used only for testing purpose.  </li><li><code>--unsafely-allow-protected-media-identifier-for-domain</code> ⊗ 	For automated testing of protected content, this switch allows specific domains (e.g. example.com) to skip asking the user for permission to share the protected media identifier. In this context, domain does not include the port number. User's content settings will not be affected by enabling this switch. Reference: <a href="http://crbug.com/718608" target="_blank" rel="noopener noreferrer">http://crbug.com/718608</a> Example: --unsafely-allow-protected-media-identifier-for-domain=a.com,b.ca  </li><li><code>--unsafely-treat-insecure-origin-as-secure</code> ⊗ 	Treat given (insecure) origins as secure origins. Multiple origins can be supplied as a comma-separated list. For the definition of secure contexts, see <a href="https://w3c.github.io/webappsec-secure-contexts/" target="_blank" rel="noopener noreferrer">https://w3c.github.io/webappsec-secure-contexts/</a> and <a href="https://www.w3.org/TR/powerful-features/#is-origin-trustworthy" target="_blank" rel="noopener noreferrer">https://www.w3.org/TR/powerful-features/#is-origin-trustworthy</a> Example: --unsafely-treat-insecure-origin-as-secure=<a href="http://a.test,http://b.test" target="_blank" rel="noopener noreferrer">http://a.test,http://b.test</a>  </li><li><code>--upload-log-file</code> ⊗ 	Specifies the full path to a protocol buffer log file to be uploaded.  </li><li><code>--use-adapter-luid</code> ⊗ 	Initialize the GPU process using the adapter with the specified LUID. This is only used on Windows, as LUID is a Windows specific structure.  </li><li><code>--use-angle</code> ⊗ 	Select which ANGLE backend to use. Options are: default: Attempts several ANGLE renderers until one successfully initializes, varying ES support by platform. d3d9: Legacy D3D9 renderer, ES2 only. d3d11: D3D11 renderer, ES2 and ES3. warp: D3D11 renderer using software rasterization, ES2 and ES3. gl: Desktop GL renderer, ES2 and ES3. gles: GLES renderer, ES2 and ES3.  </li><li><code>--use-cmd-decoder</code> ⊗ 	Use the Pass-through command decoder, skipping all validation and state tracking. Switch lives in ui/gl because it affects the GL binding initialization on platforms that would otherwise not default to using EGL bindings.  </li><li><code>--use-cras[20]</code> ⊗ 	Use CRAS, the ChromeOS audio server.  </li><li><code>--use-crash-handler-in-tests</code> ⊗ 	If present, the test harness will use the crash reporter.  </li><li><code>--use-crash-handler-with-id</code> ⊗ 	Specifies the IPC pipe name of the crash handler to use (instead of starting a new crash handler process).  </li><li><code>--use-fake-codec-for-peer-connection</code> ⊗ 	Replaces the existing codecs supported in peer connection with a single fake codec entry that create a fake video encoder and decoder.  </li><li><code>--use-fake-device-for-media-stream</code> ⊗ 	Use fake device for Media Stream to replace actual camera and microphone. For the list of allowed parameters, see FakeVideoCaptureDeviceFactory::ParseFakeDevicesConfigFromOptionsString().  </li><li><code>--use-fake-mjpeg-decode-accelerator</code> ⊗ 	Use a fake device for accelerated decoding of MJPEG. This allows, for example, testing of the communication to the GPU service without requiring actual accelerator hardware to be present.  </li><li><code>--use-fake-ui-for-media-stream</code> ⊗ 	Bypass the media stream infobar by selecting the default device for media streams (e.g. WebRTC). Works with --use-fake-device-for-media-stream.  </li><li><code>--use-file-for-fake-audio-capture</code> ⊗ 	Play a .wav file as the microphone. Note that for WebRTC calls we'll treat the bits as if they came from the microphone, which means you should disable audio processing (lest your audio file will play back distorted). The input file is converted to suit Chrome's audio buses if necessary, so most sane .wav files should work. You can pass either <code>&lt;path&gt;</code> to play the file looping or <code>&lt;path&gt;</code>%noloop to stop after playing the file to completion.  </li><li><code>--use-file-for-fake-video-capture</code> ⊗ 	Use an .y4m file to play as the webcam. See the comments in media/capture/video/file_video_capture_device.h for more details.  </li><li><code>--use-first-display-as-internal</code> ⊗ 	Uses the 1st display in --ash-host-window-bounds as internal display. This is for debugging on linux desktop.  </li><li><code>--use-gl</code> ⊗ 	Select which implementation of GL the GPU process should use. Options are: desktop: whatever desktop OpenGL the user has installed (Linux and Mac default). egl: whatever EGL / GLES2 the user has installed (Windows default - actually ANGLE). swiftshader: The SwiftShader software renderer.  </li><li><code>--use-gpu-high-thread-priority-for-perf-tests</code> ⊗ 	Increases the priority (to REALTIME_AUDIO) of gpu process and compositor thread. This is only to be used for perf tests on macOS for more reliable values.  </li><li><code>--use-gpu-in-tests</code> ⊗ 	Use hardware gpu, if available, for tests.  </li><li><code>--use-legacy-metrics-service</code> ⊗ 	No description  </li><li><code>--use-mobile-user-agent</code> ⊗ 	Set when Chromium should use a mobile user agent.  </li><li><code>--use-mock-cert-verifier-for-testing</code> ⊗ 	Use the MockCertVerifier. This only works in test code.  </li><li><code>--use-mock-keychain[8]</code> ⊗ 	No description  </li><li><code>--use-system-clipboard</code> ⊗ 	Enables the ozone x11 clipboard for linux-chromeos.  </li><li><code>--use-system-default-printer[21]</code> ⊗ 	Uses the system default printer as the initially selected destination in print preview, instead of the most recently used destination.  </li><li><code>--use-temp-registry-path</code> ⊗ 	Override the registry with the specified temporary registry. Used for tests.  </li><li><code>--use-vulkan</code> ⊗ 	Enable Vulkan support and select Vulkan implementation, must also have ENABLE_VULKAN defined. This only initializes Vulkan, the flag --enable-features=Vulkan must also be used to select Vulkan for compositing and rasterization.  </li><li><code>--user-agent</code> ⊗ 	A string used to override the default user agent with a custom one.  </li><li><code>--user-agent-product</code> ⊗ 	No description  </li><li><code>--user-always-affiliated</code> ⊗ 	Always treat user as affiliated. TODO(antrim): Remove once test servers correctly produce affiliation ids.  </li><li><code>--user-data-dir</code> ⊗ 	Directory where the browser stores the user profile.  </li><li><code>--user-data-migrated[22]</code> ⊗ 	Indicates that this process is the product of a relaunch following migration of User Data.  </li><li><code>--user-gesture-required</code> ⊗ 	Autoplay policy to require a user gesture in order to play.  </li><li><code>--user-response-timeout</code> ⊗ 	Set the timeout for how long to wait for user response from Chrome, in minutes. 0 disables the timeout entirely.  </li><li><code>--utility</code> ⊗ 	No description  </li><li><code>--utility-and-browser</code> ⊗ 	No description  </li><li><code>--utility-cmd-prefix</code> ⊗ 	The contents of this flag are prepended to the utility process command line. Useful values might be "valgrind" or "xterm -e gdb --args".  </li><li><code>--utility-sampling</code> ⊗ 	No description  </li><li><code>--utility-startup-dialog</code> ⊗ 	Causes the utility process to display a dialog on launch.  </li><li><code>--utility-sub-type</code> ⊗ 	This switch indicates the type of a utility process. It is not used by Chrome but is added to the command line for debugging and profiling purposes.  </li><li><code>--v</code> ⊗ 	Gives the default maximal active V-logging level; 0 is the default. Normally positive values are used for V-logging levels.  </li><li><code>--v8-cache-options</code> ⊗ 	Set options to cache V8 data. (off, preparse data, or code)  </li><li><code>--validate-crx</code> ⊗ 	Examines a .crx for validity and prints the result.  </li><li><code>--validate-input-event-stream</code> ⊗ 	In debug builds, asserts that the stream of input events is valid.  </li><li><code>--validating</code> ⊗ 	The command decoder names that can be passed to --use-cmd-decoder.  </li><li><code>--variations-insecure-server-url</code> ⊗ 	Specifies a custom URL for the server to use as an insecure fallback when requests to |kVariationsServerURL| fail. Requests to this URL will be encrypted.  </li><li><code>--variations-override-country</code> ⊗ 	Allows overriding the country used for evaluating variations. This is similar to the "Override Variations Country" entry on chrome://translate-internals, but is exposed as a command-line flag to allow testing First Run scenarios. Additionally, unlike chrome://translate-internals, the value isn't persisted across sessions.  </li><li><code>--variations-server-url</code> ⊗ 	Specifies a custom URL for the server which reports variation data to the client. Specifying this switch enables the Variations service on unofficial builds. See variations_service.cc.  </li><li><code>--version</code> ⊗ 	No description  </li><li><code>--video-capture-use-gpu-memory-buffer</code> ⊗ 	Enables GpuMemoryBuffer-based buffer pool.  </li><li><code>--video-image-texture-target</code> ⊗ 	Texture target for CHROMIUM_image backed video frame textures.  </li><li><code>--video-threads</code> ⊗ 	Set number of threads to use for video decoding.  </li><li><code>--video-underflow-threshold-ms</code> ⊗ 	Allows clients to override the threshold for when the media renderer will declare the underflow state for the video stream when audio is present. TODO(dalecurtis): Remove once experiments for <a href="http://crbug.com/470940" target="_blank" rel="noopener noreferrer">http://crbug.com/470940</a> finish.  </li><li><code>--video_capture</code> ⊗ 	No description  </li><li><code>--virtual-time-budget</code> ⊗ 	If set the system waits the specified number of virtual milliseconds before deeming the page to be ready. For determinism virtual time does not advance while there are pending network fetches (i.e no timers will fire). Once all network fetches have completed, timers fire and if the system runs out of virtual time is fastforwarded so the next timer fires immediatley, until the specified virtual time budget is exhausted.  </li><li><code>--vmodule</code> ⊗ 	Gives the per-module maximal V-logging levels to override the value given by --v. E.g. "my_module=2,foo<em>=3" would change the logging level for all code in source files "my_module.</em>" and "foo<em>.</em>" ("-inl" suffixes are also disregarded for this matching). Any pattern containing a forward or backward slash will be tested against the whole pathname and not just the module. E.g., "<em>/foo/bar/</em>=2" would change the logging level for all code in source files under a "foo/bar" directory.  </li><li><code>--vsync-interval</code> ⊗ 	Overrides the vsync interval used by the GPU process to refresh the display.  </li><li><code>--vulkan</code> ⊗ 	No description  </li><li><code>--vulkan-null</code> ⊗ 	No description  </li><li><code>--wait-for-debugger</code> ⊗ 	Will wait for 60 seconds for a debugger to come to attach to the process.  </li><li><code>--wait-for-debugger-children</code> ⊗ 	Will add kWaitForDebugger to every child processes. If a value is passed, it will be used as a filter to determine if the child process should have the kWaitForDebugger flag passed on or not.  </li><li><code>--wait-for-debugger-webui</code> ⊗ 	Flag used by WebUI test runners to wait for debugger to be attached.  </li><li><code>--wait-for-initial-policy-fetch-for-test</code> ⊗ 	Used to tell the policy infrastructure to not let profile initialization complete until policy is manually set by a test. This is used to provide backward compatibility with a few tests that incorrectly use the synchronously-initialized login profile to run their tests - do not add new uses of this flag.  </li><li><code>--wallet-service-use-sandbox</code> ⊗ 	Use the sandbox Online Wallet service URL (for developer testing).  </li><li><code>--waveout-buffers[1]</code> ⊗ 	Number of buffers to use for WaveOut.  </li><li><code>--web-otp-backend</code> ⊗ 	Enables specified backend for the Web OTP API.  </li><li><code>--web-otp-backend-sms-verification</code> ⊗ 	Enables Sms Verification backend for Web OTP API which requires app hash in SMS body.  </li><li><code>--web-otp-backend-user-consent</code> ⊗ 	Enables User Consent backend for Web OTP API.  </li><li><code>--webapk-server-url[7]</code> ⊗ 	Custom WebAPK server URL for the sake of testing.  </li><li><code>--webgl-antialiasing-mode</code> ⊗ 	Set the antialiasing method used for webgl. (none, explicit, implicit)  </li><li><code>--webgl-msaa-sample-count</code> ⊗ 	Set a default sample count for webgl if msaa is enabled.  </li><li><code>--weblayer-user-data-dir</code> ⊗ 	Makes WebLayer Shell use the given path for its data directory.  </li><li><code>--webrtc-event-log-proactive-pruning-delta</code> ⊗ 	Sets the delay (in seconds) between proactive prunings of remote-bound WebRTC event logs which are pending upload. All positive values are legal. All negative values are illegal, and ignored. If set to 0, the meaning is "no proactive pruning".  </li><li><code>--webrtc-event-log-upload-delay-ms</code> ⊗ 	WebRTC event logs will only be uploaded if the conditions hold for this many milliseconds.  </li><li><code>--webrtc-event-log-upload-no-suppression</code> ⊗ 	Normally, remote-bound WebRTC event logs are uploaded only when no peer connections are active. With this flag, the upload is never suppressed.  </li><li><code>--webrtc-event-logging</code> ⊗ 	Enable capture and local storage of WebRTC event logs without visiting chrome://webrtc-internals. This is useful for automated testing. It accepts the path to which the local logs would be stored. Disabling is not possible without restarting the browser and relaunching without this flag.  </li><li><code>--webrtc-max-cpu-consumption-percentage</code> ⊗ 	Configure the maximum CPU time percentage of a single core that can be consumed for desktop capturing. Default is 50. Set 100 to disable the throttling of the capture.  </li><li><code>--webrtc-stun-probe-trial</code> ⊗ 	Renderer process parameter for WebRTC Stun probe trial to determine the interval. Please see SetupStunProbeTrial in chrome_browser_field_trials_desktop.cc for more detail.  </li><li><code>--webview-disable-safebrowsing-support</code> ⊗ 	used to disable safebrowsing functionality in webview  </li><li><code>--webview-enable-vulkan</code> ⊗ 	Used to enable vulkan draw mode instead of interop draw mode for webview.  </li><li><code>--webview-log-js-console-messages</code> ⊗ 	No description  </li><li><code>--webview-safebrowsing-block-all-resources</code> ⊗ 	Enables SafeBrowsing and causes WebView to treat all resources as malicious. Use care: this will block all resources from loading.  </li><li><code>--webview-sandboxed-renderer</code> ⊗ 	No description  </li><li><code>--webview-verbose-logging</code> ⊗ 	WebView will log additional debugging information to logcat, such as variations and commandline state.  </li><li><code>--whitelisted-extension-id</code> ⊗ 	Adds the given extension ID to all the permission allowlists.  </li><li><code>--win-jumplist-action</code> ⊗ 	Specifies which category option was clicked in the Windows Jumplist that resulted in a browser startup.  </li><li><code>--window-position</code> ⊗ 	Specify the initial window position: --window-position=x,y  </li><li><code>--window-size</code> ⊗ 	Sets the initial window size. Provided as string in the format "800,600".  </li><li><code>--window-workspace</code> ⊗ 	Specify the initial window workspace: --window-workspace=id  </li><li><code>--windows-mixed-reality</code> ⊗ 	No description  </li><li><code>--winhttp-proxy-resolver</code> ⊗ 	Uses WinHTTP to fetch and evaluate PAC scripts. Otherwise the default is to use Chromium's network stack to fetch, and V8 to evaluate.  </li><li><code>--with-cleanup-mode-logs</code> ⊗ 	Identify that the elevated cleaner process is allowed to collect logs. This shouldn't be set if |kExecutionModeSwitch| is not ExecutionMode::kCleaner.  </li><li><code>--wm-window-animations-disabled</code> ⊗ 	If present animations are disabled.  </li><li><code>--xr_compositing[1]</code> ⊗ 	No description  </li><li><code>--xsession_chooser[10]</code> ⊗ 	No description<br>--zygote ⊗ 	Causes the process to run as a zygote.  </li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-to-use-a-command-line-switch">How to use a command line switch?<a class="hash-link" href="#how-to-use-a-command-line-switch" title="Direct link to heading">​</a></h2><p>The Chromium Team has made a page on which <a href="http://www.chromium.org/developers/how-tos/run-chromium-with-flags" target="_blank" rel="noopener noreferrer">they briefly explain</a> how to use these switches.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="conditionsflag">Conditions(flag)<a class="hash-link" href="#conditionsflag" title="Direct link to heading">​</a></h2><p>These are rather technical. While most are pretty self-explanatory, keep in mind that any condition means that a switch isn't always available.</p><ol><li>The constant OS_WIN must be defined.</li><li>The constant BUILDFLAG(ENABLE_PLUGINS) must be defined.</li><li>The constant !BUILDFLAG(IS_OFFICIAL_CHROME_CLEANER_BUILD) must not be defined.</li><li>The constants OS_FREEBSD, OS_LINUX and OS_SOLARIS must be defined.</li><li>The constant OS_CHROMEOS must be defined.</li><li>The constant OS_MAC must be defined.</li><li>The constant OS_ANDROID must be defined.</li><li>The constant OS_APPLE must be defined.</li><li>The constants OS_CHROMEOS and OS_MAC must not be defined, and the constant OS_POSIX must be defined.</li><li>The constant OS_LINUX must be defined.</li><li>The constant OFFICIAL_BUILD must not be defined, and the constant BUILDFLAG(ENABLE_PRINT_PREVIEW) must be defined.</li><li>The constants USE_OZONE and USE_X11 must be defined.</li><li>The constants !BUILDFLAG(IS_LACROS) and OS_CHROMEOS must not be defined, and the constant OS_LINUX must be defined.</li><li>The constant OS_POSIX must be defined.</li><li>The constants OS_LINUX, OS_MAC and OS_WIN must be defined.</li><li>The constant OS_FUCHSIA must be defined.</li><li>The constant OS_CHROMEOS must not be defined, and the constant OS_LINUX must be defined.</li><li>The constant ENABLE_IPC_FUZZER must be defined.</li><li>The constant DCHECK_IS_ON() must be defined.</li><li>The constant USE_CRAS must be defined.</li><li>The constants OS_ANDROID and OS_CHROMEOS must not be defined.</li><li>The constant BUILDFLAG(ENABLE_DOWNGRADE_PROCESSING) must be defined.</li></ol>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="chrome" term="chrome"/>
        <category label="chromium" term="chromium"/>
        <category label="chrome flags" term="chrome flags"/>
        <category label="chrome switches" term="chrome switches"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Docusaurus 配置 GitHub Action 自动发布]]></title>
        <id>/2021/03/21/docusaurus-github-deploy</id>
        <link href="https://blog.alanwei.com/blog/2021/03/21/docusaurus-github-deploy"/>
        <updated>2021-03-21T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Docusaurus 配置 GitHub Action 自动发布]]></summary>
        <content type="html"><![CDATA[<p><a href="https://v2.docusaurus.io/docs/deployment/#deploying-to-github-pages" target="_blank" rel="noopener noreferrer">原文 - Deploying to GitHub Pages</a></p><p>记录一下我是如何利用 GitHub Action，自动发布我的 Docusaurus(以下简称Doc) 博客的。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="git-仓库结构">Git 仓库结构<a class="hash-link" href="#git-仓库结构" title="Direct link to heading">​</a></h2><p>我的 Doc 源码是在仓库<code>alanwei43/blog</code>的 <code>master</code> 分支，源码发布后的静态站点，也就是GitHub Page所在仓库是 <code>alanwei43/alanwei43.github.io</code>，GitHub Page使用 <em>master</em> 分支。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置仓库">配置仓库<a class="hash-link" href="#配置仓库" title="Direct link to heading">​</a></h2><p>首先需要配置 <code>alanwei43/blog</code> 仓库的认证。</p><ol><li>生成一对 SSH Key(如果你的系统安装了SSH，可以执行<code>ssh-keygen</code>生成。因为我是Mac，之前生成过，所以直接使用 <em>~/.ssh</em> 目录下的SSH Key。)</li><li>访问仓库 <code>alanwei43/alanwei43.github.io</code>，依次进入到仓库的 <strong>Settings &gt; Deploy keys</strong>，然后将第一步生成的公钥 <em>id_rsa.pub</em> 添加进去。(添加key的时候需要勾选 <strong>Allow write access</strong>。)</li><li>访问仓库 <code>alanwei43/blog</code>，依次进入到仓库的 <strong>Settings &gt; Secrets</strong>，然后将第一步生成的私钥 <em>id_rsa</em> 添加进去，名称填写 <code>GH_PAGES_DEPLOY</code>。</li></ol><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>我实际操作中并没有执行第2步，因为我之前已经把Mac上的 <em>id_rsa.pub</em> 添加到我GitHub账号(<em>Account settings &gt; SSH and GPG keys</em>)里了, 然后使用我Mac上的私有SSH可以(<em>id_rsa</em>)操作我GitHub账号下的所有仓库.</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建-workflow-文件">创建 Workflow 文件<a class="hash-link" href="#创建-workflow-文件" title="Direct link to heading">​</a></h2><p>在 <code>alanwei43/blog</code> 项目根目录创建文件 <code>.github/workflows/documentation.yml</code></p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">.github/workflows/documentation.yml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> documentation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">pull_request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">branches</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">master</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">push</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">branches</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">master</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 这里表示当 alanwei43/blog 的分支 master 有push代码是执行以下job</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">checks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> github.event_name </span><span class="token tag" style="color:#00009f">!=</span><span class="token plain"> 'push'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/setup</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">node@v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">node-version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'12.x'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Test Build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          if [ -e yarn.lock ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          yarn install --frozen-lockfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          elif [ -e package-lock.json ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          npm ci</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          else</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          npm i</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          npm run build</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">gh-release</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> github.event_name </span><span class="token tag" style="color:#00009f">!=</span><span class="token plain"> 'pull_request'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/setup</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">node@v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">node-version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'12.x'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> webfactory/ssh</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">agent@v0.5.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ssh-private-key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.GH_PAGES_DEPLOY </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Release to GitHub Pages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">USE_SSH</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 这里配置成使用SSH认证，会用到上面配置的 deploy key 和 secret</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">GIT_USER</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">DEPLOYMENT_BRANCH</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> master </span><span class="token comment" style="color:#999988;font-style:italic"># 这里指的是 alanwei43/alanwei43.github.io 仓库的 GitHub Page 使用的分支名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          git config --global user.email "actions@github.com"</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          git config --global user.name "gh-actions"</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          if [ -e yarn.lock ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          yarn install --frozen-lockfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          elif [ -e package-lock.json ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          npm ci</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          else</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          npm i</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          npm run deploy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>参考资料</div><div class="admonitionContent_S0QG"><ul><li><a href="https://developer.github.com/v3/guides/managing-deploy-keys/" target="_blank" rel="noopener noreferrer">GitHub deploy keys</a></li><li><a href="https://help.github.com/en/actions/configuring-and-managing-workflows/creating-and-storing-encrypted-secrets" target="_blank" rel="noopener noreferrer">GitHub secret</a></li></ul></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="github" term="github"/>
        <category label="Docusaurus" term="Docusaurus"/>
        <category label="github action" term="github action"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[frp连接 EOF 失败问题]]></title>
        <id>/2021/03/21/frp-eof</id>
        <link href="https://blog.alanwei.com/blog/2021/03/21/frp-eof"/>
        <updated>2021-03-21T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[为了在家调试方便，老高使用frp将自己放在公司的开发机器的ssh端口开放出来了，但是配置frp客户端的过程中总是出现下面的一句话:]]></summary>
        <content type="html"><![CDATA[<p>为了在家调试方便，老高使用frp将自己放在公司的开发机器的ssh端口开放出来了，但是配置frp客户端的过程中总是出现下面的一句话:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2019/08/30 23:42:47 [W] [service.go:82] login to server failed: EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>开始怀疑是frp的版本问题，于是客户端和服务端都换上了最新的版本，结果还是无法解决问题，继续尝试更换端口，问题依旧。</p><p>网上搜索一圈，发现遇到<code>login to server failed: EOF</code>问题的人还真不少，下面看看老高是如何解决的吧!</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="本地抓包">本地抓包<a class="hash-link" href="#本地抓包" title="Direct link to heading">​</a></h3><p>开启Wireshark，选择网卡，输入过滤规则:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">tcp and ip.addr==xxx.xxx.220.109</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>wireshark 抓包</p><p>后面的那三个RST包很可疑，其中还有三个IRC协议的包，打开看一下，发现原来是认证数据。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{"version":"0.28.2","hostname":"","os":"darwin","arch":"amd64","user":"","privilege_key":"144fa23b09635f403ccd18","timestamp":1567119104,"run_id":"","pool_count":1}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="服务端抓包">服务端抓包<a class="hash-link" href="#服务端抓包" title="Direct link to heading">​</a></h3><p>打开终端，输入命令</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># xxxx 为frp监听端口</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcpdump -i eth0  port xxxx -n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">23</span><span class="token plain">:57:54.041136 IP </span><span class="token number" style="color:#36acaa">180.167</span><span class="token plain">.229.162.64674 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> xx.xx.xx.xx.PPPP: Flags </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">S</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token function" style="color:#d73a49">seq</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2454088299</span><span class="token plain">, win </span><span class="token number" style="color:#36acaa">65535</span><span class="token plain">, options </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">mss </span><span class="token number" style="color:#36acaa">1460</span><span class="token plain">,nop,wscale </span><span class="token number" style="color:#36acaa">6</span><span class="token plain">,nop,nop,TS val </span><span class="token number" style="color:#36acaa">1598952560</span><span class="token plain"> ecr </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">,sackOK,eol</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, length </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">23</span><span class="token plain">:57:54.041203 IP xx.xx.xx.xx.PPPP </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">180.167</span><span class="token plain">.229.162.64674: Flags </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">S.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token function" style="color:#d73a49">seq</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2502814427</span><span class="token plain">, ack </span><span class="token number" style="color:#36acaa">2454088300</span><span class="token plain">, win </span><span class="token number" style="color:#36acaa">65160</span><span class="token plain">, options </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">mss </span><span class="token number" style="color:#36acaa">1460</span><span class="token plain">,sackOK,TS val </span><span class="token number" style="color:#36acaa">3508779989</span><span class="token plain"> ecr </span><span class="token number" style="color:#36acaa">1598952560</span><span class="token plain">,nop,wscale </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, length </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">23</span><span class="token plain">:57:54.171283 IP </span><span class="token number" style="color:#36acaa">180.167</span><span class="token plain">.229.162.64674 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> xx.xx.xx.xx.PPPP: Flags </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, ack </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">, win </span><span class="token number" style="color:#36acaa">2058</span><span class="token plain">, options </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">nop,nop,TS val </span><span class="token number" style="color:#36acaa">1598952691</span><span class="token plain"> ecr </span><span class="token number" style="color:#36acaa">3508779989</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, length </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">23</span><span class="token plain">:57:54.171670 IP </span><span class="token number" style="color:#36acaa">180.167</span><span class="token plain">.229.162.64674 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> xx.xx.xx.xx.PPPP: Flags </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">P.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token function" style="color:#d73a49">seq</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">:13, ack </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">, win </span><span class="token number" style="color:#36acaa">2058</span><span class="token plain">, options </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">nop,nop,TS val </span><span class="token number" style="color:#36acaa">1598952692</span><span class="token plain"> ecr </span><span class="token number" style="color:#36acaa">3508779989</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, length </span><span class="token number" style="color:#36acaa">12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">23</span><span class="token plain">:57:54.171694 IP xx.xx.xx.xx.PPPP </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">180.167</span><span class="token plain">.229.162.64674: Flags </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, ack </span><span class="token number" style="color:#36acaa">13</span><span class="token plain">, win </span><span class="token number" style="color:#36acaa">1018</span><span class="token plain">, options </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">nop,nop,TS val </span><span class="token number" style="color:#36acaa">3508780120</span><span class="token plain"> ecr </span><span class="token number" style="color:#36acaa">1598952692</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, length </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">23</span><span class="token plain">:57:54.171896 IP xx.xx.xx.xx.PPPP </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">180.167</span><span class="token plain">.229.162.64674: Flags </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">P.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token function" style="color:#d73a49">seq</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">:13, ack </span><span class="token number" style="color:#36acaa">13</span><span class="token plain">, win </span><span class="token number" style="color:#36acaa">1018</span><span class="token plain">, options </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">nop,nop,TS val </span><span class="token number" style="color:#36acaa">3508780120</span><span class="token plain"> ecr </span><span class="token number" style="color:#36acaa">1598952692</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, length </span><span class="token number" style="color:#36acaa">12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">23</span><span class="token plain">:57:54.172366 IP </span><span class="token number" style="color:#36acaa">180.167</span><span class="token plain">.229.162.64674 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> xx.xx.xx.xx.PPPP: Flags </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">P.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token function" style="color:#d73a49">seq</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">13</span><span class="token plain">:25, ack </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">, win </span><span class="token number" style="color:#36acaa">2058</span><span class="token plain">, options </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">nop,nop,TS val </span><span class="token number" style="color:#36acaa">1598952692</span><span class="token plain"> ecr </span><span class="token number" style="color:#36acaa">3508779989</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, length </span><span class="token number" style="color:#36acaa">12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">23</span><span class="token plain">:57:54.172391 IP </span><span class="token number" style="color:#36acaa">180.167</span><span class="token plain">.229.162.64674 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> xx.xx.xx.xx.PPPP: Flags </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">R.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token function" style="color:#d73a49">seq</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">25</span><span class="token plain">, ack </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">, win </span><span class="token number" style="color:#36acaa">8224</span><span class="token plain">, length </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">23</span><span class="token plain">:57:54.301735 IP </span><span class="token number" style="color:#36acaa">180.167</span><span class="token plain">.229.162.64674 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> xx.xx.xx.xx.PPPP: Flags </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">R.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token function" style="color:#d73a49">seq</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">13</span><span class="token plain">, ack </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">, win </span><span class="token number" style="color:#36acaa">8224</span><span class="token plain">, length </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">23</span><span class="token plain">:57:54.302089 IP </span><span class="token number" style="color:#36acaa">180.167</span><span class="token plain">.229.162.64674 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> xx.xx.xx.xx.PPPP: Flags </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">R.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token function" style="color:#d73a49">seq</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">13</span><span class="token plain">, ack </span><span class="token number" style="color:#36acaa">13</span><span class="token plain">, win </span><span class="token number" style="color:#36acaa">8224</span><span class="token plain">, length </span><span class="token number" style="color:#36acaa">0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>好嘛，注意最后三个包，也是RST，而且方向刚好和我在本地抓包相反，很明显，这是受到了替身攻击!😄</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="解决">解决<a class="hash-link" href="#解决" title="Direct link to heading">​</a></h3><p>看来公司的防火墙应该是探测到了某些特征流量而触发了规则，导致frp认证的包被重置，于是服务端frp关闭了链接，而翻开源码，我们能看到再发送完认证信息后执行了 <code>ReadMsgInto</code> 方法，因为连接已经关闭，所以我们就得到了EOF错误!</p><p>回头再看wireshark的RST包之前的三个IRC包，等等，IRC是什么鬼？在FRP源代码中根本搜不到这个关键字啊!从源代码的登录逻辑来看，基本都是TCP的操作。于是再试着抓一次包，IRC又变回了TCP，看来wireshark也有误报的情况发生。</p><p>究其原因，很有可能是这一段明文数据暴露了frp，然后导致被防火墙封杀。</p><p>那么如何解决<code>login to server failed: EOF</code>的问题呢？</p><p>其实看了源代码就知道了，原来frp在v0.25.0版本后增加了一个客户端选项，支持了tls传输，也就是传说中的非对称加密，原来在frps初始化服务时，在内存中已经为我们生成了一个简易的TLS服务，简直完美!</p><p>开启的办法很简单，在客户端原来的<code>[common]</code>配置中加入<code>tls_enable = true</code>即可!</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="另一种解决办法">另一种解决办法<a class="hash-link" href="#另一种解决办法" title="Direct link to heading">​</a></h3><p>其实嘛，还有一种解决办法，但是不一定能行，而且可能会带来一些问题!</p><p>什么方法呢？既然防火墙检测了我的tcp，那我换成udp行不行？</p><p>frp支持使用kcp作为底层的通讯协议，而kcp默认就是基于udp协议，废话不多说，赶紧试一试!</p><p>步骤(假设kcp的端口为7000):</p><ol><li>在服务端原来的<code>[common]</code>配置中加入<code>kcp_bind_port = 7000</code>，使其支持udp</li><li>在客户端原来的<code>[common]</code>处加入<code>protocol = kcp</code>即可，注意端口一定要对上!</li></ol><section style="margin-top:1em"><hr><ul style="margin-left:-1em"><li>作者: <a href="https://blog.phpgao.com/frp_tcp_reset.html" target="_blank">老高</a></li><li>来源: <a href="https://blog.phpgao.com/frp_tcp_reset.html" target="_blank">https://blog.phpgao.com/frp_tcp_reset.html</a></li><li>本文仅用于本人学习和存档, 文章所有权归作者 <a href="https://blog.phpgao.com/frp_tcp_reset.html" target="_blank">老高</a> 所有, 如有侵权请发送邮件至 <a href="mailto:me@alanwei.com?subject=删除侵权文章" target="_top">me#alanwei.com(<i>#换成@</i>)</a> 删除此文.</li></ul><hr></section>]]></content>
        <author>
            <name>老高</name>
            <uri>https://blog.phpgao.com/author/1/</uri>
        </author>
        <category label="frp" term="frp"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[linux下查看指定进程的所有连接信息]]></title>
        <id>/2021/03/21/linux-all-ps-connection</id>
        <link href="https://blog.alanwei.com/blog/2021/03/21/linux-all-ps-connection"/>
        <updated>2021-03-21T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[linux下查看指定进程的所有连接信息]]></summary>
        <content type="html"><![CDATA[<p>Ref: <a href="https://blog.fatedier.com/2016/07/18/stat-all-connection-info-of-special-process-in-linux/" target="_blank" rel="noopener noreferrer">linux下查看指定进程的所有连接信息</a></p><p>定位某个进程的网络故障时经常需要用到的一个功能就是查找所有连接的信息。通常查找某个端口的连接信息使用 <code>ss</code> 或者 <code>netstat</code> 可以轻松拿到，如果是主动与别的机器建立的连接信息则可以通过 <code>lsof</code> 命令来获得。</p><p>例如我想要查看进程 frps 当前的所有连接信息，先获得进程的 pid：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> -ef</span><span class="token operator" style="color:#393A34">|</span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> frps</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>结果为：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wcl       </span><span class="token number" style="color:#36acaa">4721</span><span class="token plain">     </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">:27 ?        00:00:01 ./frps</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以看到进程 pid 为 4721，之后通过 lsof 命令查看所有 TCP 连接信息：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">lsof</span><span class="token plain"> -p </span><span class="token number" style="color:#36acaa">4721</span><span class="token plain"> -nP </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> TCP</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>显示结果为：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">frps    </span><span class="token number" style="color:#36acaa">4721</span><span class="token plain">  wcl    4u     IPv6 </span><span class="token number" style="color:#36acaa">117051764</span><span class="token plain">      0t0     TCP *:7000 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">LISTEN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">frps    </span><span class="token number" style="color:#36acaa">4721</span><span class="token plain">  wcl    6u     IPv6 </span><span class="token number" style="color:#36acaa">117051765</span><span class="token plain">      0t0     TCP *:7003 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">LISTEN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">frps    </span><span class="token number" style="color:#36acaa">4721</span><span class="token plain">  wcl    7u     IPv6 </span><span class="token number" style="color:#36acaa">117092563</span><span class="token plain">      0t0     TCP </span><span class="token number" style="color:#36acaa">139.129</span><span class="token plain">.11.120:7000-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">116.231</span><span class="token plain">.70.223:61545 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ESTABLISHED</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">frps    </span><span class="token number" style="color:#36acaa">4721</span><span class="token plain">  wcl    8u     IPv6 </span><span class="token number" style="color:#36acaa">117092565</span><span class="token plain">      0t0     TCP *:6000 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">LISTEN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">frps    </span><span class="token number" style="color:#36acaa">4721</span><span class="token plain">  wcl    9u     IPv6 </span><span class="token number" style="color:#36acaa">117334426</span><span class="token plain">      0t0     TCP </span><span class="token number" style="color:#36acaa">139.129</span><span class="token plain">.11.120:7000-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">116.237</span><span class="token plain">.93.230:64898 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ESTABLISHED</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">frps    </span><span class="token number" style="color:#36acaa">4721</span><span class="token plain">  wcl   10u     IPv6 </span><span class="token number" style="color:#36acaa">117053538</span><span class="token plain">      0t0     TCP </span><span class="token number" style="color:#36acaa">139.129</span><span class="token plain">.11.120:7000-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">115.231</span><span class="token plain">.20.123:41297 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ESTABLISHED</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">frps    </span><span class="token number" style="color:#36acaa">4721</span><span class="token plain">  wcl   11u     IPv6 </span><span class="token number" style="color:#36acaa">117053540</span><span class="token plain">      0t0     TCP *:6005 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">LISTEN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">frps    </span><span class="token number" style="color:#36acaa">4721</span><span class="token plain">  wcl   12u     IPv6 </span><span class="token number" style="color:#36acaa">117334428</span><span class="token plain">      0t0     TCP *:6004 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">LISTEN</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>从 <code>lsof</code> 的输出结果中可以清楚的看到 frps 进程监听了 5 个端口，并且在 7000 端口上建立了 3 个连接，连接两端的 ip 信息也都可以查到。</p><p><code>lsof</code> 的 <code>-nP</code> 参数用于将 ip 地址和端口号显示为正常的数值类型，否则可能会用别名表示。</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="linux" term="linux"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[显示Linux端口占用]]></title>
        <id>/2021/03/21/linux-view-port-using</id>
        <link href="https://blog.alanwei.com/blog/2021/03/21/linux-view-port-using"/>
        <updated>2021-03-21T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[显示Linux端口占用]]></summary>
        <content type="html"><![CDATA[<p>On Linux, you must be root or the owner of the process to get the information you desire. As such, for processes running as another user, prepending sudo is most of what you need. In addition to that, on modern Linux systems, ss is tool to use to do this:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> ss -lptn </span><span class="token string" style="color:#e3116c">'sport = :80'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">State   Local Address:Port  Peer Address:Port              </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LISTEN  </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:80        *:*                users:</span><span class="token variable punctuation" style="color:#393A34">((</span><span class="token variable" style="color:#36acaa">"nginx"</span><span class="token variable punctuation" style="color:#393A34">,</span><span class="token variable" style="color:#36acaa">pid</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable number" style="color:#36acaa">125004</span><span class="token variable punctuation" style="color:#393A34">,</span><span class="token variable" style="color:#36acaa">fd</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable number" style="color:#36acaa">12</span><span class="token variable punctuation" style="color:#393A34">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LISTEN  ::1:80              :::*               users:</span><span class="token variable punctuation" style="color:#393A34">((</span><span class="token variable" style="color:#36acaa">"nginx"</span><span class="token variable punctuation" style="color:#393A34">,</span><span class="token variable" style="color:#36acaa">pid</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable number" style="color:#36acaa">125004</span><span class="token variable punctuation" style="color:#393A34">,</span><span class="token variable" style="color:#36acaa">fd</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable number" style="color:#36acaa">11</span><span class="token variable punctuation" style="color:#393A34">))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can also use the same invocation you're currently using, but remember to sudo:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">netstat</span><span class="token plain"> -nlp </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> :80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcp  </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:80  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:*  LISTEN  </span><span class="token number" style="color:#36acaa">125004</span><span class="token plain">/nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can also use lsof:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">lsof</span><span class="token plain"> -n -i :80 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> LISTEN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nginx   </span><span class="token number" style="color:#36acaa">125004</span><span class="token plain"> nginx    3u  IPv4   </span><span class="token number" style="color:#36acaa">6645</span><span class="token plain">      0t0  TCP </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:80 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">LISTEN</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="linux" term="linux"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[阿里云Maven镜像]]></title>
        <id>/2021/03/21/maven-aliyun</id>
        <link href="https://blog.alanwei.com/blog/2021/03/21/maven-aliyun"/>
        <updated>2021-03-21T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[阿里云Maven镜像]]></summary>
        <content type="html"><![CDATA[<p>配置Maven使用阿里云镜像:</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">~/.m2/settings.xml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">settings</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">xmlns</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://maven.apache.org/SETTINGS/1.0.0</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xmlns:</span><span class="token tag attr-name" style="color:#00a4db">xsi</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://www.w3.org/2001/XMLSchema-instance</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xsi:</span><span class="token tag attr-name" style="color:#00a4db">schemaLocation</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://maven.apache.org/SETTINGS/1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token tag attr-value" style="color:#e3116c">                        https://maven.apache.org/xsd/settings-1.0.0.xsd</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">localRepository</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 配置Maven Repository本地缓存目录 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ${user.home}/.m2/repository </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">localRepository</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">interactiveMode</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">interactiveMode</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">usePluginRegistry</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">false</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">usePluginRegistry</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">offline</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">pluginGroups</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">servers</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">mirrors</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">mirror</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">maven-aliyun</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">Maven Aliyun Mirror</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">http://maven.aliyun.com/nexus/content/groups/public/</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">mirrorOf</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">central</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">mirrorOf</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">mirror</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">mirror</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">maven-net-cn</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">Maven China Mirror</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">http://maven.NET.cn/content/groups/public/</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">mirrorOf</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">central</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">mirrorOf</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">mirror</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">mirrors</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">proxies</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">profiles</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">activeProfiles</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">settings</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="maven" term="maven"/>
        <category label="java" term="java"/>
        <category label="mirror" term="mirror"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[解决 Node.js HTTP 请求出现的自签名证书校验失败问题]]></title>
        <id>/2021/03/21/node-tls</id>
        <link href="https://blog.alanwei.com/blog/2021/03/21/node-tls"/>
        <updated>2021-03-21T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[程序执行之前先执行以下代码, 设置环境变量:]]></summary>
        <content type="html"><![CDATA[<p>程序执行之前先执行以下代码, 设置环境变量:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">NODE_TLS_REJECT_UNAUTHORIZED</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"0"</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="node.js" term="node.js"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[NPM的淘宝镜像]]></title>
        <id>/2021/03/21/npm-taobao</id>
        <link href="https://blog.alanwei.com/blog/2021/03/21/npm-taobao"/>
        <updated>2021-03-21T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[NPM的淘宝镜像]]></summary>
        <content type="html"><![CDATA[<p>下面简单介绍一下NPM淘宝镜像使用:</p><p>淘宝镜像地址为: <code>https://registry.npm.taobao.org</code></p><p>一般使用以下命令全局安装 <code>cnpm</code>:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -g cnpm --registry</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">https://registry.npm.taobao.org</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>也可以在安装项目依赖时直接使用淘宝镜像:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> --registry</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">https://registry.npm.taobao.org </span><span class="token comment" style="color:#999988;font-style:italic"># 安装当前项目依赖</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者在项目根目录新增 <code>.npmrc</code> 配置文件，修改项目使用淘宝镜像，这样比较适合团队协作：</p><div class="language-rc codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">.npmrc</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rc codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">registry=https://registry.npm.taobao.org</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="npm" term="npm"/>
        <category label="node.js" term="node.js"/>
        <category label="镜像" term="镜像"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Visual Studio Code 侧边栏定位到当前文件]]></title>
        <id>/2021/03/20/visual-studio-code-reveal</id>
        <link href="https://blog.alanwei.com/blog/2021/03/20/visual-studio-code-reveal"/>
        <updated>2021-03-20T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Visual Studio Code 侧边栏定位到当前文件]]></summary>
        <content type="html"><![CDATA[<p>项目文件比较多时, 如何在侧边栏快速定位到当前文件是一个常用的功能，下面介绍我的配置。</p><p>默认VSC定位当前文件的默认行为修改: </p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">settings.json</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * 此配置用于设置切换到当前文件时, 侧边栏是否展示当前文件的所在位置, 可选值如下:</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * true: 侧边栏自动滚动到当前文件所在位置</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * false: 禁用自动显示当前文件所在位置</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * focusNoScroll: 侧边栏自动定位到当前文件所在位置(侧边栏的文件名处于选中状态), 但是侧边栏滚动条不会滚动到文件位置显示.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"explorer.autoReveal"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"focusNoScroll"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果需要在侧边栏滚动到当前文件并显示, 可以按下快捷键 <code>Command + Shift + P</code>(Windows 环境是 <code>Ctrl + Shift + P</code>), 然后输入 <code>Files: Reveal Active File in Side Bar</code> 即可.</p><p>可以配置快捷键:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">keybindings.json</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"shift+cmd+r"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"revealInExplorer"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更多快捷键参考: <a href="/blog/2020/03/20/visual-studio-code-keyboard">我的 VSC 快捷键</a></p><blockquote><p>相关介绍 <a href="https://stackoverflow.com/questions/44844005/reveal-current-file-in-explorer-in-visual-studio-code" target="_blank" rel="noopener noreferrer">Reveal current file in Explorer in Visual Studio Code</a></p></blockquote>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="vsc" term="vsc"/>
        <category label="visual studio code" term="visual studio code"/>
        <category label="editor" term="editor"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Chrome flags]]></title>
        <id>/2021/03/15/chrome-flags</id>
        <link href="https://blog.alanwei.com/blog/2021/03/15/chrome-flags"/>
        <updated>2021-03-15T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Chrome支持的flags列表]]></summary>
        <content type="html"><![CDATA[<p>Chrome 工具 flags 列表, 摘自 <a href="https://github.com/GoogleChrome/chrome-launcher/blob/master/docs/chrome-flags-for-tools.md" target="_blank" rel="noopener noreferrer">Chrome Flags for Tooling</a>: </p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="常用">常用<a class="hash-link" href="#常用" title="Direct link to heading">​</a></h2><ul><li><code>--proxy-server=http://192.168.1.199:3210</code> 设置HTTP代理</li><li><code>--proxy-bypass-list</code> 忽略的 server host</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ssl-证书">SSL 证书<a class="hash-link" href="#ssl-证书" title="Direct link to heading">​</a></h2><p>解决 Chrome设置使用代理，代理工具证书未被信任导致的签名问题。</p><ul><li>如果你的代理工具是本地运行，可以在Chrome启动时增加 <code>--allow-insecure-localhost</code> flag。</li><li>或者忽略所有证书错误 <code>--ignore-certificate-errors</code></li></ul><p>本文尝试记录和自动化工具以及基准测试相关的Chrome flags列表. </p><p>没有相同的场景, 所以你需要选择最适合自己的flag. </p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="通常无用的浏览器特性">通常无用的浏览器特性<a class="hash-link" href="#通常无用的浏览器特性" title="Direct link to heading">​</a></h2><ul><li><code>--disable-client-side-phishing-detection</code>: 禁用客户端钓鱼检测</li><li><code>--disable-component-extensions-with-background-pages</code>: 禁用一些 <code>--disable-extensions</code> 无法禁用的内置扩展</li><li><code>--disable-default-apps</code>: 禁止安装默认App</li><li><code>--disable-extensions</code>: 禁用所有Chrome扩展</li><li><code>--mute-audio</code>: 静音</li><li><code>--no-default-browser-check</code>: 禁用默认浏览器检测</li><li><code>--no-first-run</code>: 跳过首次运行向导</li><li><code>--use-fake-device-for-media-stream</code>: Use fake device for Media Stream to replace camera and microphone</li><li><code>--use-file-for-fake-video-capture=&lt;path-to-file&gt;</code>: Use file for fake video capture (.y4m or .mjpeg) Needs <code>--use-fake-device-for-media-stream</code></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="性能和web平台行为">性能和Web平台行为<a class="hash-link" href="#性能和web平台行为" title="Direct link to heading">​</a></h2><ul><li><code>--allow-running-insecure-content</code> 允许运行不安全的内容</li><li><code>--autoplay-policy=user-gesture-required</code>: 不要渲染视频</li><li><code>--disable-background-timer-throttling</code>: 禁用后台页面或tab抖动计时器</li><li><code>--disable-backgrounding-occluded-windows</code> </li><li><code>--disable-features=ScriptStreaming</code>: V8 script streaming</li><li><code>--disable-hang-monitor</code></li><li><code>--disable-ipc-flooding-protection</code>: Some javascript functions can be used to flood the browser process with IPC. By default, protection is on to limit the number of IPC sent to 10 per second per frame. This flag disables it. <a href="https://crrev.com/604305" target="_blank" rel="noopener noreferrer">https://crrev.com/604305</a></li><li><code>--disable-notifications</code>: Disables the Web Notification and the Push APIs.</li><li><code>--disable-popup-blocking</code>: Disable popup blocking.  <code>--block-new-web-contents</code> is the strict version of this.</li><li><code>--disable-prompt-on-repost</code>: Reloading a page that came from a POST normally prompts the user.</li><li><code>--disable-renderer-backgrounding</code>: This disables non-foreground tabs from getting a lower process priority This doesn't (on its own) affect timers or painting behavior. <a href="https://github.com/karma-runner/karma-chrome-launcher/issues/123" target="_blank" rel="noopener noreferrer">karma-chrome-launcher#123</a></li><li><code>--js-flags=--random-seed=1157259157</code>: Initialize V8's RNG with a fixed seed.</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="test--debugging-flags">Test &amp; debugging flags<a class="hash-link" href="#test--debugging-flags" title="Direct link to heading">​</a></h2><ul><li><code>--disable-device-discovery-notifications</code>: Avoid messages like "New printer on your network"</li><li><code>--enable-automation</code>: Disable a few things considered not appropriate for automation. (<a href="https://docs.google.com/a/google.com/document/d/1JYj9K61UyxIYavR8_HATYIglR9T_rDwAtLLsD3fbDQg/preview" target="_blank" rel="noopener noreferrer">Original design doc</a>, though renamed <a href="https://codereview.chromium.org/2564973002#msg24" target="_blank" rel="noopener noreferrer">here</a>) <a href="https://cs.chromium.org/search/?q=kEnableAutomation&amp;type=cs" target="_blank" rel="noopener noreferrer">codesearch</a>. Note that some projects have chosen to <strong>avoid</strong> using this flag: <a href="https://github.com/web-platform-tests/wpt/pull/6348" target="_blank" rel="noopener noreferrer">web-platform-tests/wpt/#6348</a><ul><li>disables bubble notification about running development/unpacked extensions</li><li>disables the password saving UI (which <a href="https://source.chromium.org/chromium/chromium/src/+/master:chrome/browser/password_manager/chrome_password_manager_client.cc;l=295-298;drc=00053fb4d880a925c890193b74a8ff35e1cef2a0" target="_blank" rel="noopener noreferrer">covers</a> the usecase of the <a href="https://bugs.chromium.org/p/chromedriver/issues/detail?id=1015" target="_blank" rel="noopener noreferrer">removed</a> <code>--disable-save-password-bubble</code> flag)</li><li>disables infobar animations</li><li>disables auto-reloading on network errors (<a href="https://cs.chromium.org/chromium/src/chrome/renderer/net/net_error_helper_core.cc?l=917&amp;rcl=6eaf0af71262eb876764c6237ee2fe021a3e7a18" target="_blank" rel="noopener noreferrer">source</a>)</li><li>means the default browser check prompt isn't shown</li><li>avoids showing these 3 infobars: ShowBadFlagsPrompt, GoogleApiKeysInfoBarDelegate, ObsoleteSystemInfoBarDelegate</li><li>adds this infobar: <img loading="lazy" src="https://user-images.githubusercontent.com/39191/30349667-92a7a086-97c8-11e7-86b2-1365e3d407e3.png" alt="image" class="img_ev3q"></li></ul></li><li><code>--enable-logging=stderr</code>: Logging behavior slightly more appropriate for a server-type process.</li><li><code>--log-level=0</code>: 0 means INFO and higher.</li><li><code>--password-store=basic</code>: Avoid potential instability of using Gnome Keyring or KDE wallet. <a href="https://chromium.googlesource.com/chromium/src/+/master/docs/linux/password_storage.md" target="_blank" rel="noopener noreferrer">chromium/linux/password_storage.md</a> <a href="https://crbug.com/571003" target="_blank" rel="noopener noreferrer">https://crbug.com/571003</a></li><li><code>--remote-debugging-pipe</code>: more secure than using protocol over a websocket</li><li><code>--silent-debugger-extension-api</code>: Does not show an infobar when a Chrome extension attaches to a page using <code>chrome.debugger</code> page. Required to attach to extension background pages.</li><li><code>--test-type</code>: Basically the 2014 version of <code>--enable-automation</code>. <a href="https://cs.chromium.org/search/?q=kTestType%5Cb&amp;type=cs" target="_blank" rel="noopener noreferrer">codesearch</a><ul><li>It avoids creating application stubs in ~/Applications on mac.</li><li>It makes exit codes slightly more correct</li><li>windows navigation jumplists arent updated <a href="https://crbug.com/389375" target="_blank" rel="noopener noreferrer">https://crbug.com/389375</a></li><li>doesn't start some chrome StartPageService</li><li>disables initializing chromecast service</li><li>"Component extensions with background pages are not enabled during tests because they generate a lot of background behavior that can interfere."</li><li>when quitting the browser, it disables additional checks that may stop that quitting process. (like unsaved form modifications or unhandled profile notifications..)</li></ul></li><li><code>--use-mock-keychain</code>: Use mock keychain on Mac to prevent blocking permissions dialogs. <a href="https://crbug.com/865247" target="_blank" rel="noopener noreferrer">https://crbug.com/865247</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="background-updates-networking-reporting">Background updates, networking, reporting<a class="hash-link" href="#background-updates-networking-reporting" title="Direct link to heading">​</a></h2><ul><li><code>--disable-background-networking</code>: Disable various background network services, including extension updating,safe browsing service, upgrade detector, translate, UMA</li><li><code>--disable-breakpad</code>: Disable crashdump collection (reporting is already disabled in Chromium)</li><li><code>--disable-component-update</code>: Don't update the browser 'components' listed at chrome://components/</li><li><code>--disable-domain-reliability</code>: Disables Domain Reliability Monitoring, which tracks whether the browser has difficulty contacting Google-owned sites and uploads reports to Google.</li><li><code>--disable-sync</code>: Disable syncing to a Google account</li><li><code>--enable-crash-reporter-for-testing</code>: Used for turning on Breakpad crash reporting in a debug environment where crash reporting is typically compiled but disabled.</li><li><code>--metrics-recording-only</code>: Disable reporting to UMA, but allows for collection</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="rendering--gpu">Rendering &amp; GPU<a class="hash-link" href="#rendering--gpu" title="Direct link to heading">​</a></h2><ul><li><code>--deterministic-mode</code>: An experimental meta flag. This sets the below indented flags which put the browser into a mode where rendering (border radius, etc) is deterministic and begin frames should be issued over DevTools Protocol. <a href="https://source.chromium.org/chromium/chromium/src/+/master:headless/app/headless_shell.cc;drc=df45d1abbc20abc7670643adda6d9625eea55b4d" target="_blank" rel="noopener noreferrer">codesearch</a><ul><li><code>--run-all-compositor-stages-before-draw</code></li><li><code>--disable-new-content-rendering-timeout</code></li><li><code>--enable-begin-frame-control</code></li><li><code>--disable-threaded-animation</code></li><li><code>--disable-threaded-scrolling</code></li><li><code>--disable-checker-imaging</code></li><li><code>--disable-image-animation-resync</code></li></ul></li><li><code>--disable-features=PaintHolding</code>: Don't defer paint commits (normally used to avoid flash of unstyled content)</li><li><code>--disable-partial-raster</code>: <a href="https://crbug.com/919955" target="_blank" rel="noopener noreferrer">https://crbug.com/919955</a></li><li><code>--disable-skia-runtime-opts</code>: Do not use runtime-detected high-end CPU optimizations in Skia.</li><li><code>--in-process-gpu</code>: Saves some memory by moving GPU process into a browser process thread</li><li><code>--use-gl="swiftshader"</code>: Select which implementation of GL the GPU process should use. Options are: <code>desktop</code>: whatever desktop OpenGL the user has installed (Linux and Mac default). <code>egl</code>: whatever EGL / GLES2 the user has installed (Windows default - actually ANGLE). <code>swiftshader</code>: The SwiftShader software renderer.</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="window--screen-management">Window &amp; screen management<a class="hash-link" href="#window--screen-management" title="Direct link to heading">​</a></h2><ul><li><code>--block-new-web-contents</code>: All pop-ups and calls to window.open will fail.</li><li><code>--force-color-profile=srgb</code>: Force all monitors to be treated as though they have the specified color profile.</li><li><code>--force-device-scale-factor=1</code></li><li><code>--new-window</code>: Launches URL in new browser window.</li><li><code>--window-position=0,0</code></li><li><code>--window-size=1600,1024</code></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="process-management">Process management<a class="hash-link" href="#process-management" title="Direct link to heading">​</a></h2><ul><li><code>--disable-features=site-per-process</code>: Disables OOPIF. <a href="https://www.chromium.org/Home/chromium-security/site-isolation" target="_blank" rel="noopener noreferrer">https://www.chromium.org/Home/chromium-security/site-isolation</a></li><li><code>--process-per-tab</code>: <a href="https://source.chromium.org/chromium/chromium/src/+/master:content/public/common/content_switches.cc;l=602-605;drc=2149a93144ce2030ab20863c2983b6c9d7bfd177" target="_blank" rel="noopener noreferrer">Doesn't do anything</a>. Use --single-process instead.</li><li><code>--single-process</code>: Runs the renderer and plugins in the same process as the browser.</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="headless">Headless<a class="hash-link" href="#headless" title="Direct link to heading">​</a></h2><ul><li><code>--disable-dev-shm-usage</code>: Often used in Lambda, Cloud Functions scenarios. (<a href="https://github.com/GoogleChrome/puppeteer/issues/1834" target="_blank" rel="noopener noreferrer">pptr issue</a>, <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=736452" target="_blank" rel="noopener noreferrer">crbug</a>)</li><li><code>--no-sandbox</code>: <a href="https://github.com/puppeteer/puppeteer/blob/main/docs/troubleshooting.md#setting-up-chrome-linux-sandbox" target="_blank" rel="noopener noreferrer">Sometimes used</a> with headless, though not recommended.</li><li><code>--disable-gpu</code>: Sometimes <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=737678" target="_blank" rel="noopener noreferrer">used</a> with headless.</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="removed-flags">~Removed~ flags<a class="hash-link" href="#removed-flags" title="Direct link to heading">​</a></h2><ul><li><code>--disable-add-to-shelf</code>: <a href="https://codereview.chromium.org/2944283002" target="_blank" rel="noopener noreferrer">Removed June 2017</a></li><li><code>--disable-background-downloads</code>: <a href="https://codereview.chromium.org/607843002" target="_blank" rel="noopener noreferrer">Removed Oct 2014</a>.</li><li><code>--disable-browser-side-navigation</code> Disabled PlzNavigate.</li><li><code>--disable-datasaver-prompt</code></li><li><code>--disable-desktop-notifications</code></li><li><code>--disable-features=TranslateUI</code>: renamed <code>TranslateUI</code> to <code>Translate</code> in <a href="https://chromium-review.googlesource.com/c/chromium/src/+/2404484" target="_blank" rel="noopener noreferrer">Sept 2020</a>.</li><li><code>--disable-infobars</code>: <a href="https://codereview.chromium.org/240193003" target="_blank" rel="noopener noreferrer">Removed April 2014</a></li><li><code>--disable-save-password-bubble</code>: <a href="https://codereview.chromium.org/1978563002" target="_blank" rel="noopener noreferrer">Removed May 2016</a></li><li><code>--disable-translate</code>: <a href="https://codereview.chromium.org/2819813002/" target="_blank" rel="noopener noreferrer">Removed April 2017</a> Used to disable built-in Google Translate service.</li><li><code>--ignore-autoplay-restrictions</code>: <a href="https://chromium-review.googlesource.com/#/c/816855/" target="_blank" rel="noopener noreferrer">Removed December 2017</a> Can use <code>--autoplay-policy=no-user-gesture-required</code> instead.</li><li><code>--safebrowsing-disable-auto-update</code>: <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=74848#c26" target="_blank" rel="noopener noreferrer">Removed Nov 2017</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="sources">Sources<a class="hash-link" href="#sources" title="Direct link to heading">​</a></h2><ul><li><a href="https://github.com/GoogleChrome/chrome-launcher/blob/master/src/flags.ts" target="_blank" rel="noopener noreferrer">chrome-launcher's flags</a></li><li><a href="https://cs.chromium.org/chromium/src/chrome/test/chromedriver/chrome_launcher.cc?type=cs&amp;q=f:chrome_launcher++kDesktopSwitches&amp;sq=package:chromium" target="_blank" rel="noopener noreferrer">Chromedriver's flags</a></li><li><a href="https://github.com/puppeteer/puppeteer/blob/main/src/node/Launcher.ts" target="_blank" rel="noopener noreferrer">Puppeteer's flags</a></li><li><a href="https://github.com/WPO-Foundation/wptagent/blob/master/internal/chrome_desktop.py" target="_blank" rel="noopener noreferrer">WebpageTest's flags</a></li><li><a href="https://source.chromium.org/search?q=f:catapult%20f:desktop%20symbol:GetBrowserStartupArgs&amp;ss=chromium%2Fchromium%2Fsrc" target="_blank" rel="noopener noreferrer">Catapult's flags</a></li><li><a href="https://github.com/karma-runner/karma-chrome-launcher/blob/master/index.js" target="_blank" rel="noopener noreferrer">Karma's flags</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="浏览器所有-flags">浏览器所有 flags<a class="hash-link" href="#浏览器所有-flags" title="Direct link to heading">​</a></h2><ul><li><a href="/blog/2021/03/21/chromium-command-line-switches">The canonical list of Chrome command-line switches on peter.sh</a> (maintained by the Chromium team)</li></ul><p>FYI: (Probably) all flags are defined in files matching the pattern of <a href="f:_switches.cc" target="_blank" rel="noopener noreferrer"><code>*_switches.cc</code></a>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="feature-flags-fyi">Feature Flags FYI<a class="hash-link" href="#feature-flags-fyi" title="Direct link to heading">​</a></h2><p>Chromium and Blink use feature flags to disable/enable many features at runtime. Chromium has <a href="https://source.chromium.org/search?q=%22const%20base::Feature%22%20f:%5C.cc&amp;sq=&amp;ss=chromium%2Fchromium%2Fsrc" target="_blank" rel="noopener noreferrer">~400 features</a> that can be toggled with <code>--enable-features</code> / <code>--disable-features</code>. Indepdently, Blink has <a href="https://source.chromium.org/chromium/chromium/src/+/master:out/Debug/gen/third_party/blink/renderer/platform/runtime_enabled_features.cc;l=1559;drc=170473ad887b7990079f1f996b126548569c5902" target="_blank" rel="noopener noreferrer">many features</a> that can be toggled <a href="https://chromium.googlesource.com/chromium/src/+/master/third_party/blink/renderer/platform/RuntimeEnabledFeatures.md#command_line-switches" target="_blank" rel="noopener noreferrer">with commandline switches</a>: <code>--enable-blink-features</code> / <code>--disable-blink-features</code>.</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="chrome flags" term="chrome flags"/>
        <category label="chrome" term="chrome"/>
        <category label="puppeteer" term="puppeteer"/>
        <category label="chrome-launcher" term="chrome-launcher"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Let's Encrypt证书申请及配置]]></title>
        <id>/2021/03/14/lets-encrypt-ssl-certificate</id>
        <link href="https://blog.alanwei.com/blog/2021/03/14/lets-encrypt-ssl-certificate"/>
        <updated>2021-03-14T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[本文主要介绍使用 Let's Encrypt(一个由非营利性组织 互联网安全研究小组（ISRG）提供的免费、自动化和开放的证书颁发机构（CA）) 签发证书及Nginx配置。]]></summary>
        <content type="html"><![CDATA[<p>本文主要介绍使用 <a href="https://letsencrypt.org/" target="_blank" rel="noopener noreferrer">Let's Encrypt</a>(一个由非营利性组织 互联网安全研究小组（ISRG）提供的免费、自动化和开放的证书颁发机构（CA）) 签发证书及Nginx配置。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="签发工具">签发工具<a class="hash-link" href="#签发工具" title="Direct link to heading">​</a></h2><p><strong>在线版</strong></p><ul><li><a href="https://freessl.cn/" target="_blank" rel="noopener noreferrer">FreeSSL</a>（不支持自动续签）</li><li><a href="https://www.qiniu.com/products/ssl" target="_blank" rel="noopener noreferrer">七牛</a>（不支持 DV 泛域名）</li><li><a href="https://www.upyun.com/products/ssl" target="_blank" rel="noopener noreferrer">又拍云</a>（不支持 DV 泛域名）</li></ul><p><strong>acme.sh</strong></p><p>这里介绍 <a href="https://github.com/acmesh-official/acme.sh" target="_blank" rel="noopener noreferrer">acme.sh</a>的使用，<a href="https://github.com/acmesh-official/acme.sh/wiki/%E8%AF%B4%E6%98%8E" target="_blank" rel="noopener noreferrer">中文文档</a>，<a href="https://github.com/acmesh-official/acme.sh/wiki/Run-acme.sh-in-docker" target="_blank" rel="noopener noreferrer">Docker使用</a>。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装">安装<a class="hash-link" href="#安装" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> https://get.acme.sh </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>安装完成后, 会有一个 <code>~/.acme.sh</code> 目录，之后所有生成的证书也会放在这个目录下，里面有一个 <code>acme.sh</code> 脚本, 添加以下alia方便使用:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">alias</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">acme</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"/root/.acme.sh/acme.sh"</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 假设当前是root用户，如果是其他用需要把 /root 改成当前用户目录</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其他简单命令:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">acme --version </span><span class="token comment" style="color:#999988;font-style:italic"># 查看版本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">acme --list </span><span class="token comment" style="color:#999988;font-style:italic"># 查看证书列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">acme remove </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">SAN_Domains</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 删除证书</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">acme --upgrade --auto-upgrade </span><span class="token comment" style="color:#999988;font-style:italic"># 自动更新脚本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">acme --upgrade </span><span class="token comment" style="color:#999988;font-style:italic"># 手动更新脚本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">acme --upgrade --auto-upgrade </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 关闭更新脚本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">acme.sh --renew -d example.com --force </span><span class="token comment" style="color:#999988;font-style:italic"># 默认90天过期，可以强制续签证书</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="证书申请">证书申请<a class="hash-link" href="#证书申请" title="Direct link to heading">​</a></h2><p>申请证书前需要验证域名所有权，有两种方式验证： HTTP 和 DNS</p><ul><li>HTTP：在网站的根目录下添加一个文件</li><li>DNS：在域名上添加一条 txt 解析记录</li></ul><p>下面介绍DNS方式验证</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="dns验证域名所有权">DNS验证域名所有权<a class="hash-link" href="#dns验证域名所有权" title="Direct link to heading">​</a></h2><p><a href="https://github.com/Neilpang/acme.sh/wiki/dns-manual-mode" target="_blank" rel="noopener noreferrer">DNS</a>不支持自动续签, 执行以下脚本生成解析记录值，</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">acme --issue --dns -d mydomain.com --yes-I-know-dns-manual-mode-enough-go-ahead-please</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上述命令执行完成后，终端会有关于 <em>acme-challenge.mydomain.com</em> 的txt值输出，然后需要去DNS提供商添加一条TXT记录，记录类型为 <em>TXT</em>，主机记录为 <em>acme-challenge.mydomain.com</em>，记录值从终端里复制。</p><p>然后查询记录是否生效：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 查询域名 txt 记录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">nslookup</span><span class="token plain"> -type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">txt _acme-challenge.mydomain.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>生效后执行以下脚本:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">acme --renew -d mydomain.com --yes-I-know-dns-manual-mode-enough-go-ahead-please</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="证书配置">证书配置<a class="hash-link" href="#证书配置" title="Direct link to heading">​</a></h2><p>上一小节，生成的证书放在了<code>/root/.acme.sh/mydomain.com</code>目录，因为这是 acme.sh 脚本的内部使用目录，而且目录结构可能会变化，所以我们不能让 Nginx 的配置文件直接读取该目录下的证书文件。</p><p>正确的做法就是使用<code>--installcert</code>命令，指定目标位置，然后证书文件会被 copy 到相应的位置。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">acme.sh  --installcert -d mydomain.cn </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         --key-file /wwwroot/certs/alanwei.net.key</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         --fullchain-file /wwwroot/certs/alanwei.net.cer </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         --reloadcmd </span><span class="token string" style="color:#e3116c">"service nginx force-reload"</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 这行命令根据具体情况可以省略</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="nginx配置">Nginx配置<a class="hash-link" href="#nginx配置" title="Direct link to heading">​</a></h2><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen       443 ssl;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name  blog.alanwei.net;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_certificate /wwwroot/certs/alanwei.net.cer; # 证书文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_certificate_key /wwwroot/certs/alanwei.net.key; # 私钥文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_session_timeout 5m; # 会话缓存过期时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # 开启 SSL 支持</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_prefer_server_ciphers on; # 设置协商加密算法时，优先使用服务端的加密套件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #charset koi8-r;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    access_log  /var/log/nginx/blog.alanwei.net.access.log  main;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_pass http://blog.alanwei.com;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error_page   500 502 503 504  /50x.html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location = /50x.html {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        root   /usr/share/nginx/html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>参考文章
<a href="https://www.jianshu.com/p/1a792f87b6fe" target="_blank" rel="noopener noreferrer">Let's Encrypt 证书申请及配置</a>
<a href="https://www.cnblogs.com/esofar/p/9291685.html" target="_blank" rel="noopener noreferrer">快速签发 Let's Encrypt 证书指南</a></p></blockquote>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="ssl" term="ssl"/>
        <category label="nginx" term="nginx"/>
        <category label="let's encrypt" term="let's encrypt"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[浏览器的前进后退缓存机制 Back/forward cache]]></title>
        <id>/2021/03/13/back-forward-cache</id>
        <link href="https://blog.alanwei.com/blog/2021/03/13/back-forward-cache"/>
        <updated>2021-03-13T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Optimize your pages for instant loads when using the browser's back and forward buttons.]]></summary>
        <content type="html"><![CDATA[<p>Optimize your pages for instant loads when using the browser's back and forward buttons. </p><p>Back/forward cache (or bfcache) is a browser optimization that enables instant back and forward navigation. It significantly improves the browsing experience for users—especially those with slower networks or devices.</p><p>As web developers, it's critical to understand how to <a href="https://web.dev/bfcache/#optimize-your-pages-for-bfcache" target="_blank" rel="noopener noreferrer">optimize your pages for bfcache</a> across all browsers, so your users can reap the benefits.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="browser-compatibility">Browser compatibility<a class="hash-link" href="#browser-compatibility" title="Direct link to heading">​</a></h2><p>bfcache has been supported in both <a href="https://developer.mozilla.org/docs/Mozilla/Firefox/Releases/1.5/Using_Firefox_1.5_caching" target="_blank" rel="noopener noreferrer">Firefox</a> and <a href="https://webkit.org/blog/427/webkit-page-cache-i-the-basics/" target="_blank" rel="noopener noreferrer">Safari</a> for many years, across desktop and mobile.</p><p>Starting in version 86, Chrome has enabled bfcache for <a href="https://web.dev/same-site-same-origin/" target="_blank" rel="noopener noreferrer">cross-site</a> navigations on Android for a small percentage of users. In Chrome 87, bfcache support will be rolled out to all Android users for cross-site navigation, with the intent to support <a href="https://web.dev/same-site-same-origin/" target="_blank" rel="noopener noreferrer">same-site</a> navigation as well in the near future.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="bfcache-basics">bfcache basics<a class="hash-link" href="#bfcache-basics" title="Direct link to heading">​</a></h3><p>bfcache is an in-memory cache that stores a complete snapshot of a page (including the JavaScript heap) as the user is navigating away. With the entire page in memory, the browser can quickly and easily restore it if the user decides to return.</p><p>How many times have you visited a website and clicked a link to go to another page, only to realize it's not what you wanted and click the back button? In that moment, bfcache can make a big difference in how fast the previous page loads:</p><ul><li><strong>Without bfcache enabled</strong>  A new request is initiated to load the previous page, and, depending on how well that page has been <a href="https://web.dev/reliable/#the-options-in-your-caching-toolbox" target="_blank" rel="noopener noreferrer">optimized</a> for repeat visits, the browser might have to re-download, re-parse, and re-execute some (or all) of resources it just downloaded. </li><li><strong>With bfcache enabled</strong>  Loading the previous page is <em>essentially instant</em>, because the entire page can be restored from memory, without having to go to the network at all </li></ul><p>Check out <a href="https://youtu.be/cuPsdRckkF0" target="_blank" rel="noopener noreferrer">this video of bfcache in action</a> to understand the speed up it can bring to navigations.</p><p>In the video above, the example with bfcache is quite a bit faster than the example without it.</p><p>bfcache not only speeds up navigation, it also reduces data usage, since resources do not have to be downloaded again.</p><p>Chrome usage data shows that 1 in 10 navigations on desktop and 1 in 5 on mobile are either back or forward. With bfcache enabled, browsers could eliminate the data transfer and time spent loading for billions of web pages every single day!</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-the-cache-works">How the "cache" works<a class="hash-link" href="#how-the-cache-works" title="Direct link to heading">​</a></h3><p>The "cache" used by bfcache is different from the <a href="https://web.dev/http-cache/" target="_blank" rel="noopener noreferrer">HTTP cache</a> (which is also useful in speeding up repeat navigations). The bfcache is a snapshot of the entire page in memory (including the JavaScript heap), whereas the HTTP cache contains only the responses for previously made requests. Since it's quite rare that all requests required to load a page can be fulfilled from the HTTP cache, repeat visits using bfcache restores are always faster than even the most well-optimized non-bfcache navigations.</p><p>Creating a snapshot of a page in memory, however, involves some complexity in terms of how best to preserve in-progress code. For example, how do you handle <code>setTimeout()</code> calls where the timeout is reached while the page is in the bfcache?</p><p>The answer is that browsers pause running any pending timers or unresolved promises—essentially all pending tasks in the <a href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" target="_blank" rel="noopener noreferrer">JavaScript task queues</a>—and resume processing tasks when (or if) the page is restored from the bfcache.</p><p>In some cases this is fairly low-risk (for example, timeouts or promises), but in other cases it might lead to very confusing or unexpected behavior. For example, if the browser pauses a task that's required as part of an <a href="https://developer.mozilla.org/docs/Web/API/IDBTransaction" target="_blank" rel="noopener noreferrer">IndexedDB transaction</a>, it can affect other open tabs in the same origin (since the same IndexedDB databases can be accessed by multiple tabs simultaneously). As a result, browsers will generally not attempt to cache pages in the middle of an IndexedDB transaction or using APIs that might affect other pages.</p><p>For more details on how various API usage affects a page's bfcache eligibility, see <a href="https://web.dev/bfcache/#optimize-your-pages-for-bfcache" target="_blank" rel="noopener noreferrer">Optimize your pages for bfcache</a> below.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="apis-to-observe-bfcache">APIs to observe bfcache<a class="hash-link" href="#apis-to-observe-bfcache" title="Direct link to heading">​</a></h3><p>While bfcache is an optimization that browsers do automatically, it's still important for developers to know when it's happening so they can <a href="https://web.dev/bfcache/#optimize-your-pages-for-bfcache" target="_blank" rel="noopener noreferrer">optimize their pages for it</a> and <a href="https://web.dev/bfcache/#implications-for-analytics-and-performance-measurement" target="_blank" rel="noopener noreferrer">adjust any metrics or performance measurement</a> accordingly.</p><p>The primary events used to observe bfcache are the <a href="https://developer.mozilla.org/docs/Web/API/PageTransitionEvent" target="_blank" rel="noopener noreferrer">page transition events</a>—<code>pageshow</code> and pagehide—which have been around as long as bfcache has and are supported in pretty much <a href="https://caniuse.com/page-transition-events" target="_blank" rel="noopener noreferrer">all browsers in use today</a>.</p><p>The newer <a href="https://developers.google.com/web/updates/2018/07/page-lifecycle-api" target="_blank" rel="noopener noreferrer">Page Lifecycle</a> events—<code>freeze</code> and <code>resume</code>—are also dispatched when pages go in or out of the bfcache, as well as in some other situations. For example when a background tab gets frozen to minimize CPU usage. Note, the Page Lifecycle events are currently only supported in Chromium-based browsers.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="observe-when-a-page-is-restored-from-bfcache">Observe when a page is restored from bfcache<a class="hash-link" href="#observe-when-a-page-is-restored-from-bfcache" title="Direct link to heading">​</a></h3><p>The <code>pageshow</code> event fires right after the <code>load</code> event when the page is initially loading and any time the page is restored from bfcache. The <code>pageshow</code> event has a <a href="https://developer.mozilla.org/docs/Web/API/PageTransitionEvent/persisted" target="_blank" rel="noopener noreferrer">persisted</a> property which will be <code>true</code> if the page was restored from bfcache (and <code>false</code> if not). You can use the <code>persisted</code> property to distinguish regular page loads from bfcache restores. For example:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'pageshow'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">persisted</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'This page was restored from the bfcache.'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'This page was loaded normally.'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In browsers that support the Page Lifecycle API, the <code>resume</code> event will also fire when pages are restored from bfcache (immediately before the <code>pageshow</code> event), though it will also fire when a user revisits a frozen background tab. If you want to restore a page's state after it's frozen (which includes pages in the bfcache), you can use the <code>resume</code> event, but if you want to measure your site's bfcache hit rate, you'd need to use the <code>pageshow</code> event. In some cases, you might need to use both.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>See <a href="https://web.dev/bfcache/#how-bfcache-affects-analytics-and-performance-measurement" target="_blank" rel="noopener noreferrer">Implications for performance and analytics</a> for more details on bfcache measurement best practices.</p></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="observe-when-a-page-is-entering-bfcache">Observe when a page is entering bfcache<a class="hash-link" href="#observe-when-a-page-is-entering-bfcache" title="Direct link to heading">​</a></h3><p>The <code>pagehide</code> event is the counterpart to the <code>pageshow</code> event. The <code>pageshow</code> event fires when a page is either loaded normally or restored from the bfcache. The <code>pagehide</code> event fires when the page is either unloaded normally or when the browser attempts to put it into the bfcache.</p><p>The <code>pagehide</code> event also has a <code>persisted</code> property, and if it's <code>false</code> then you can be confident a page is not about to enter the bfcache. However, if the <code>persisted</code> property is <code>true</code>, it doesn't guarantee that a page will be cached. It means that the browser intends to cache the page, but there may be factors that make it impossible to cache.</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'pagehide'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">persisted</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'This page *might* be entering the bfcache.'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'This page will unload normally and be discarded.'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Similarly, the <code>freeze</code> event will fire immediately after the <code>pagehide</code> event (if the event's <code>persisted</code> property is <code>true</code>), but again that only means the browser intends to cache the page. It may still have to discard it for a number of reasons explained below.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="optimize-your-pages-for-bfcache">Optimize your pages for bfcache<a class="hash-link" href="#optimize-your-pages-for-bfcache" title="Direct link to heading">​</a></h2><p>Not all pages get stored in bfcache, and even when a page does get stored there, it won't stay there indefinitely. It's critical that developers understand what makes pages eligible (and ineligible) for bfcache to maximize their cache-hit rates.</p><p>The following sections outline the best practices to make it as likely as possible that the browser can cache your pages.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="never-use-the-unload-event">Never use the unload event<a class="hash-link" href="#never-use-the-unload-event" title="Direct link to heading">​</a></h3><p>The most important way to optimize for bfcache in all browsers is to never use the <code>unload</code> event. Ever!</p><p>The <code>unload</code> event is problematic for browsers because it predates bfcache and many pages on the internet operate under the (reasonable) assumption that a page will not continue to exist after the <code>unload</code> event has fired. This presents a challenge because many of those pages were also built with the assumption that the <code>unload</code> event would fire any time a user is navigating away, which is no longer true (and <a href="https://developers.google.com/web/updates/2018/07/page-lifecycle-api#the-unload-event" target="_blank" rel="noopener noreferrer">hasn't been true for a long time</a>).</p><p>So browsers are faced with a dilemma, they have to choose between something that can improve the user experience—but might also risk breaking the page.</p><p>Firefox has chosen to make pages ineligible for bfcache if they add an <code>unload</code> listener, which is less risky but also disqualifies a lot of pages. Safari will attempt to cache some pages with an <code>unload</code> event listener, but to reduce potential breakage it will not run the <code>unload</code> event when a user is navigating away.</p><p>Since 65% of pages in Chrome register an <code>unload</code> event listener, to be able to cache as many pages as possible, Chrome chose to align implementation with Safari.</p><p>Instead of using the <code>unload</code> event, use the <code>pagehide</code> event. The <code>pagehide</code> event fires in all cases where the <code>unload</code> event currently fires, and it also fires when a page is put in the bfcache.</p><p>In fact, Lighthouse v6.2.0 has added a <a href="https://github.com/GoogleChrome/lighthouse/pull/11085" target="_blank" rel="noopener noreferrer">no-unload-listeners</a> audit, which will warn developers if any JavaScript on their pages (including that from third-party libraries) adds an <code>unload</code> event listener.</p><div class="theme-admonition theme-admonition-warning alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_S0QG"><p>Warning: Never add an <code>unload</code> event listener! Use the <code>pagehide</code> event instead. Adding an <code>unload</code> event listener will make your site slower in Firefox, and the code won't even run most of the time in Chrome and Safari.</p></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="only-add-beforeunload-listeners-conditionally">Only add beforeunload listeners conditionally<a class="hash-link" href="#only-add-beforeunload-listeners-conditionally" title="Direct link to heading">​</a></h3><p>The <code>beforeunload</code> event will not make your pages ineligible for bfcache in Chrome or Safari, but it will make them ineligible in Firefox, so avoid using it unless absolutely necessary.</p><p>Unlike the <code>unload</code> event, however, there are legitimate uses for <code>beforeunload</code>. For example, when you want to warn the user that they have unsaved changes they'll lose if they leave the page. In this case, it's recommended that you only add <code>beforeunload</code> listeners when a user has unsaved changes and then remove them immediately after the unsaved changes are saved.</p><div class="theme-admonition theme-admonition-warning alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_S0QG"><p><strong>Don't</strong></p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'beforeunload'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">pageHasUnsavedChanges</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">preventDefault</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">returnValue</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Are you sure you want to exit?'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The code above adds a <code>beforeunload</code> listener unconditionally.</p></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p><strong>Do</strong></p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">beforeUnloadListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">preventDefault</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">returnValue</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Are you sure you want to exit?'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// A function that invokes a callback when the page has unsaved changes.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">onPageHasUnsavedChanges</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'beforeunload'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> beforeUnloadListener</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// A function that invokes a callback when the page's unsaved changes are resolved.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">onAllChangesSaved</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">removeEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'beforeunload'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> beforeUnloadListener</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The code above only adds the <code>beforeunload</code> listener when it's needed (and removes it when it's not).</p></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="avoid-windowopener-references">Avoid window.opener references<a class="hash-link" href="#avoid-windowopener-references" title="Direct link to heading">​</a></h3><p>In some browsers (including Chromium-based browsers) if a page was opened using <a href="https://developer.mozilla.org/docs/Web/API/Window/open" target="_blank" rel="noopener noreferrer">window.open()</a> or (in <a href="https://crbug.com/898942" target="_blank" rel="noopener noreferrer">Chromium-based browsers prior to version 88</a>) from a link with <a href="https://developer.mozilla.org/docs/Web/HTML/Element/a#target" target="_blank" rel="noopener noreferrer">target=_blank</a>—without specifying <a href="https://developer.mozilla.org/docs/Web/HTML/Link_types/noopener" target="_blank" rel="noopener noreferrer">rel="noopener"</a>—then the opening page will have a reference to the window object of the opened page.</p><p>In addition to <a href="https://mathiasbynens.github.io/rel-noopener/" target="_blank" rel="noopener noreferrer">being a security risk</a>, a page with a non-null window.opener reference cannot safely be put into the bfcache because that could break any pages attempting to access it.</p><p>As a result, it's best to avoid creating window.opener references by using rel="noopener" whenever possible. If your site requires opening a window and controlling it through <a href="https://developer.mozilla.org/docs/Web/API/Window/postMessage" target="_blank" rel="noopener noreferrer">window.postMessage()</a> or directly referencing the window object, neither the opened window nor the opener will be eligible for bfcache.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="always-close-open-connections-before-the-user-navigates-away">Always close open connections before the user navigates away<a class="hash-link" href="#always-close-open-connections-before-the-user-navigates-away" title="Direct link to heading">​</a></h3><p>As mentioned above, when a page is put into the bfcache all scheduled JavaScript tasks are paused and then resumed when the page is taken out of the cache.</p><p>If these scheduled JavaScript tasks are only accessing DOM APIs—or other APIs isolated to just the current page—then pausing these tasks while the page is not visible to the user is not going to cause any problems.</p><p>However, if these tasks are connected to APIs that are also accessible from other pages in the same origin (for example: IndexedDB, Web Locks, WebSockets, etc.) this can be problematic because pausing these tasks may prevent code in other tabs from running.</p><p>As a result, most browsers will not attempt to put a page in bfcache in the following scenarios:</p><ul><li>Pages with an unfinished <a href="https://developer.mozilla.org/docs/Web/API/IDBTransaction" target="_blank" rel="noopener noreferrer">IndexedDB transaction</a></li><li>Pages with in-progress <a href="https://developer.mozilla.org/docs/Web/API/Fetch_API" target="_blank" rel="noopener noreferrer">fetch()</a> or <a href="https://developer.mozilla.org/docs/Web/API/XMLHttpRequest" target="_blank" rel="noopener noreferrer">XMLHttpRequest</a></li><li>Pages with an open <a href="https://developer.mozilla.org/docs/Web/API/WebSocket" target="_blank" rel="noopener noreferrer">WebSocket</a> or <a href="https://developer.mozilla.org/docs/Web/API/WebRTC_API" target="_blank" rel="noopener noreferrer">WebRTC</a> connection</li></ul><p>If your page is using any of these APIs, it's best to always close connections and remove or disconnect observers during the <code>pagehide</code> or <code>freeze</code> event. That will allow the browser to safely cache the page without the risk of it affecting other open tabs.</p><p>Then, if the page is restored from the bfcache, you can re-open or re-connect to those APIs (in the <code>pageshow</code> or <code>resume</code> event).</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Using the APIs listed above does not disqualify a page from being stored in bfcache, as long as they are not actively in use before the user navigates away. However, there are APIs (Embedded Plugins, Workers, Broadcast Channel, and <a href="https://source.chromium.org/chromium/chromium/src/+/master:content/browser/frame_host/back_forward_cache_impl.cc;l=124;drc=e790fb2272990696f1d16a465832692f25506925?originalUrl=https:%2F%2Fcs.chromium.org%2F" target="_blank" rel="noopener noreferrer">several others</a>) where usage currently does disqualify a page from being cached. While Chrome is intentionally being conservative in its initial release of bfcache, the long-term goal is to make bfcache work with as many APIs as possible.</p></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="test-to-ensure-your-pages-are-cacheable">Test to ensure your pages are cacheable<a class="hash-link" href="#test-to-ensure-your-pages-are-cacheable" title="Direct link to heading">​</a></h3><p>While there's no way to determine whether a page was put into the cache as it's unloading, it is possible to assert that a back or forward navigation did restore a page from the cache.</p><p>Currently, in Chrome, a page can remain in the bfcache for up to three minutes, which should be enough time to run a test (using a tool like <a href="https://github.com/puppeteer/puppeteer" target="_blank" rel="noopener noreferrer">Puppeteer</a> or <a href="https://www.w3.org/TR/webdriver/" target="_blank" rel="noopener noreferrer">WebDriver</a>) to ensure that the <code>persisted</code> property of a <code>pageshow</code> event is true after navigating away from a page and then clicking the back button.</p><p>Note that, while under normal conditions a page should remain in the cache for long enough to run a test, it can be evicted silently at any time (for example, if the system is under memory pressure). A failing test doesn't necessarily mean your pages are not cacheable, so you need to configure your test or build failure criteria accordingly.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>In Chrome, bfcache is currently only enabled on mobile. To test bfcache on desktop you need to <a href="https://www.chromium.org/developers/how-tos/run-chromium-with-flags" target="_blank" rel="noopener noreferrer">enable the #back-forward-cache flag</a>.</p></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ways-to-opt-out-of-bfcache">Ways to opt out of bfcache<a class="hash-link" href="#ways-to-opt-out-of-bfcache" title="Direct link to heading">​</a></h3><p>If you do not want a page to be stored in the bfcache you can ensure it's not cached by setting the <code>Cache-Control</code> header on the top-level page response to <code>no-store</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Cache-Control: no-store</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>All other caching directives (including <code>no-cache</code> or even <code>no-store</code> on a subframe) will not affect a page's eligibility for bfcache.</p><p>While this method is effective and works across browsers, it has other caching and performance implications that may be undesirable. To address that, there's a proposal to <a href="https://github.com/whatwg/html/issues/5744" target="_blank" rel="noopener noreferrer">add a more explicit opt-out mechanism</a>, including a mechanism to clear the bfcache if needed (for example, when a user logs out of a website on a shared device).</p><p>Also, in Chrome, user-level opt-out is currently possible via <a href="https://www.chromium.org/developers/how-tos/run-chromium-with-flags" target="_blank" rel="noopener noreferrer">the #back-forward-cache flag</a>, as well an <a href="https://cloud.google.com/docs/chrome-enterprise/policies" target="_blank" rel="noopener noreferrer">enterprise policy-based opt-out</a>.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Caution: Given the significantly better user experience that bfcache delivers, it is not recommended to opt-out unless absolutely necessary for privacy reasons, for example if a user logs out of a website on a shared device.</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-bfcache-affects-analytics-and-performance-measurement">How bfcache affects analytics and performance measurement<a class="hash-link" href="#how-bfcache-affects-analytics-and-performance-measurement" title="Direct link to heading">​</a></h2><p>If you track visits to your site with an analytics tool, you will likely notice a decrease in the total number of pageviews reported as Chrome continues to enable bfcache for more users.</p><p>In fact, you're likely already underreporting pageviews from other browsers that implement bfcache since most of the popular analytics libraries do not track bfcache restores as new pageviews.</p><p>If you don't want your pageview counts to go down due to Chrome enabling bfcache, you can report bfcache restores as pageviews (recommended) by listening to the <code>pageshow</code> event and checking the <code>persisted</code> property.</p><p>The following example shows how to do this with Google Analytics; the logic should be similar for other analytics tools:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Send a pageview when the page is first loaded.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">gtag</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'event'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'page_view'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'pageshow'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">persisted</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Send another pageview if the page is restored from bfcache.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">gtag</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'event'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'page_view'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="performance-measurement">Performance measurement<a class="hash-link" href="#performance-measurement" title="Direct link to heading">​</a></h3><p>bfcache can also negatively affect performance metrics collected <a href="https://web.dev/user-centric-performance-metrics/#in-the-field" target="_blank" rel="noopener noreferrer">in the field</a>, specifically metrics that measure page load times.</p><p>Since bfcache navigations restore an existing page rather than initiate a new page load, the total number of page loads collected will decrease when bfcache is enabled. What's critical, though, is that the page loads being replaced by bfcache restores would likely have been some of the fastest page loads in your dataset. This is because back and forward navigations, by definition, are repeat visits, and repeat page loads are generally faster than page loads from first time visitors (due to <a href="https://web.dev/http-cache/" target="_blank" rel="noopener noreferrer">HTTP caching</a>, as mentioned earlier).</p><p>The result is fewer fast page loads in your dataset, which will likely skew the distribution slower—despite the fact that the performance experienced by the user has probably improved!</p><p>There are a few ways to deal with this issue. One is to annotate all page load metrics with their respective <a href="https://www.w3.org/TR/navigation-timing-2/#sec-performance-navigation-types" target="_blank" rel="noopener noreferrer">navigation type</a>: <code>navigate</code>, <code>reload</code>, <code>back_forward</code>, or <code>prerender</code>. This will allow you to continue to monitor your performance within these navigation types—even if the overall distribution skews negative. This approach is recommended for non-user-centric page load metrics like <a href="https://web.dev/time-to-first-byte/" target="_blank" rel="noopener noreferrer">Time to First Byte (TTFB)</a>.</p><p>For user-centric metrics like the <a href="https://web.dev/vitals/" target="_blank" rel="noopener noreferrer">Core Web Vitals</a>, a better option is to report a value that more accurately represents what the user experiences.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Caution: The <code>back_forward</code> navigation type in the <a href="https://www.w3.org/TR/navigation-timing-2/#sec-performance-navigation-types" target="_blank" rel="noopener noreferrer">Navigation Timing API</a> is not to be confused with bfcache restores. The Navigation Timing API only annotates page loads, whereas bfcache restores are re-using a page loaded from a previous navigation.</p></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="impact-on-core-web-vitals">Impact on Core Web Vitals<a class="hash-link" href="#impact-on-core-web-vitals" title="Direct link to heading">​</a></h3><p>Core Web Vitals measure the user's experience of a web page across a variety of dimensions (loading speed, interactivity, visual stability), and since users experience bfcache restores as faster navigations than traditional page loads, it's important that the Core Web Vitals metrics reflect this. After all, a user doesn't care whether or not bfcache was enabled, they just care that the navigation was fast!</p><p>Tools like the Chrome User Experience Report, that collect and report on the Core Web Vitals metrics treat bfcache restores as separate page visits in their dataset.</p><p>And while there aren't (yet) dedicated web performance APIs for measuring these metrics after bfcache restores, their values can be approximated using existing web APIs.</p><ul><li>For Largest Contentful Paint (LCP), you can use the delta between the pageshow event's timestamp and the timestamp of the next painted frame (since all elements in the frame will be painted at the same time). Note that in the case of a bfcache restore, LCP and FCP will be the same.</li><li>For First Input Delay (FID), you can re-add the event listeners (the same ones used by the FID polyfill) in the pageshow event, and report FID as the delay of the first input after the bfcache restore.</li><li>For Cumulative Layout Shift (CLS), you can continue to keep using your existing Performance Observer; all you have to do is reset the current CLS value to 0.</li></ul><p>For more details on how bfcache affects each metric, refer to the individual Core Web Vitals metric guides pages. And for a specific example of how to implement bfcache versions of these metrics in code, refer to the PR adding them to the web-vitals JS library.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>As of v1, the <a href="https://github.com/GoogleChrome/web-vitals" target="_blank" rel="noopener noreferrer">web-vitals</a> JavaScript library <a href="https://github.com/GoogleChrome/web-vitals/pull/87" target="_blank" rel="noopener noreferrer">supports bfcache restores</a> in the metrics it reports. Developers using v1 or greater should not need to update their code.</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="additional-resources">Additional Resources<a class="hash-link" href="#additional-resources" title="Direct link to heading">​</a></h2><ul><li><a href="https://developer.mozilla.org/Firefox/Releases/1.5/Using_Firefox_1.5_caching" target="_blank" rel="noopener noreferrer">Firefox Caching</a> <em>(bfcache in Firefox)</em></li><li><a href="https://webkit.org/blog/427/webkit-page-cache-i-the-basics/" target="_blank" rel="noopener noreferrer">Page Cache</a> <em>(bfcache in Safari)</em></li><li><a href="https://docs.google.com/document/d/1JtDCN9A_1UBlDuwkjn1HWxdhQ1H2un9K4kyPLgBqJUc/edit?usp=sharing" target="_blank" rel="noopener noreferrer">Back/forward cache: web exposed behavior</a> <em>(bfcache differences across browsers)</em></li><li><a href="https://back-forward-cache-tester.glitch.me/?persistent_logs=1" target="_blank" rel="noopener noreferrer">bfcache tester</a> <em>(test how different APIs and events affect bfcache in browsers)</em></li></ul><blockquote><p><a href="https://web.dev/bfcache/" target="_blank" rel="noopener noreferrer">原文 - Back/forward cache</a></p></blockquote>]]></content>
        <author>
            <name>Philip Walton</name>
            <uri>https://github.com/philipwalton</uri>
        </author>
        <category label="javascript" term="javascript"/>
        <category label="browser" term="browser"/>
        <category label="译文" term="译文"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[macOS - 更改功能键的默认行为]]></title>
        <id>/2021/03/13/macos-change-default-behavior-function-keys</id>
        <link href="https://blog.alanwei.com/blog/2021/03/13/macos-change-default-behavior-function-keys"/>
        <updated>2021-03-13T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[更改 macOS 系统功能键的默认行为]]></summary>
        <content type="html"><![CDATA[<p>如果您要更改顶行按键(F1~F12)以使它们在无需按住 Fn 键的情况下用作标准功能键，请按照以下步骤操作：</p><ol><li>选取苹果菜单 <strong> &gt; 系统偏好设置(System Perferences)</strong></li><li>点按 <strong>键盘(Keyboard)</strong></li><li>选择 <strong>将F1、F12等键用作标准按键(Use F1, F2, ect. keys as standard function keys)</strong></li></ol><p><a href="https://support.apple.com/zh-cn/HT204436" target="_blank" rel="noopener noreferrer">原文 - 如何使用 Mac 上的功能键</a></p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="mac" term="mac"/>
        <category label="keyboard" term="keyboard"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[删除HTTP请求头中的 referrer]]></title>
        <id>/2021/03/09/remove-http-request-referrer</id>
        <link href="https://blog.alanwei.com/blog/2021/03/09/remove-http-request-referrer"/>
        <updated>2021-03-09T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[删除HTTP请求头中的 Referer，能解决部分防盗链问题。]]></summary>
        <content type="html"><![CDATA[<p>删除HTTP请求头中的 <code>Referer</code>，能解决部分防盗链问题。</p><p>在页面的 <code>head</code> 里添加以下代码即可删除<code>Referer</code>请求头： </p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">referrer</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">content</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">no-referrer</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这对页面上的链接请求以及使用JavaScript代码发起的Ajax请求都有效。</p><p>或者针对图片去掉referrer:</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">img</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">referrer</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">no-referrer|origin|unsafe-url</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">image link</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 比如 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">img</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">https://gitee.com/alanway/resources/raw/master/files/iis-reverse-proxy/site-access-with-proxy.png</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">referrerpolicy</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">no-referrer</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其他有效 <code>meta</code> 选项如下:</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">referrer</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">content</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">unsafe-url</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">referrer</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">content</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">origin</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">referrer</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">content</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">no-referrer-when-downgrade</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">referrer</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">content</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">origin-when-cross-origin</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>See if it works for your browser here: <a href="http://caniuse.com/#feat=referrer-policy" target="_blank" rel="noopener noreferrer">http://caniuse.com/#feat=referrer-policy</a></li><li>See specs here: <a href="http://w3c.github.io/webappsec/specs/referrer-policy/" target="_blank" rel="noopener noreferrer">http://w3c.github.io/webappsec/specs/referrer-policy/</a></li></ul><p>Also note that browsers now send the Origin header (with CORS requests and POST requests, see here: <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin" target="_blank" rel="noopener noreferrer">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin</a> ) which includes domain and port, and, as far as I know, cannot be removed. If you use <code>&lt;meta name="referrer" content="origin" /&gt;</code> the referrer will contain similar information to the Origin header, which is already good from a privacy point of view, since it will hide the exact page the user is in.</p><p><strong>Update:</strong></p><p>If you want to remove the referrer by using JavaScript only, you may add the appropriate meta tag dynamically just before making the Ajax request. This JavaScript will add <code>&lt;meta name="referrer" content="no-referrer" /&gt; </code>to head section of the web page:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> meta </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'meta'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meta</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"referrer"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meta</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">content</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"no-referrer"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementsByTagName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'head'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">appendChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><a href="https://stackoverflow.com/questions/6817595/remove-http-referer" target="_blank" rel="noopener noreferrer">原文 - Remove http referer</a></p></blockquote>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="http" term="http"/>
        <category label="web" term="web"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[悲催的程序员，以及程序员的悲催]]></title>
        <id>/2021/03/07/bei-cui-cheng-xu-yuan-yi-ji-cheng-xu-yuan-be-cui</id>
        <link href="https://blog.alanwei.com/blog/2021/03/07/bei-cui-cheng-xu-yuan-yi-ji-cheng-xu-yuan-be-cui"/>
        <updated>2021-03-07T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[原文 - 悲催的程序员，以及程序员的悲催[转(http://blog.sina.cn/dpool/blog/s/blog_621a71a00100qs5r.html)]]></summary>
        <content type="html"><![CDATA[<section style="margin-top:1em"><hr><ul style="margin-left:-1em"><li>作者: <a href="http://blog.sina.cn/dpool/blog/s/blog_621a71a00100qs5r.html" target="_blank">佚名</a></li><li>来源: <a href="http://blog.sina.cn/dpool/blog/s/blog_621a71a00100qs5r.html" target="_blank">http://blog.sina.cn/dpool/blog/s/blog_621a71a00100qs5r.html</a></li><li>本文仅用于本人学习和存档, 文章所有权归作者 <a href="http://blog.sina.cn/dpool/blog/s/blog_621a71a00100qs5r.html" target="_blank">佚名</a> 所有, 如有侵权请发送邮件至 <a href="mailto:me@alanwei.com?subject=删除侵权文章" target="_top">me#alanwei.com(<i>#换成@</i>)</a> 删除此文.</li></ul><hr></section><p><a href="http://blog.sina.cn/dpool/blog/s/blog_621a71a00100qs5r.html" target="_blank" rel="noopener noreferrer">原文 - 悲催的程序员，以及程序员的悲催[转](转载自http://www.douban.com/note/122664737/水之印象豆瓣）</a></p><p>我尽量用平和一点的口吻跟你说说关于程序员的那点事儿。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="第1节">第1节<a class="hash-link" href="#第1节" title="Direct link to heading">​</a></h2><p>我在一个叫摩托罗拉的公司干过，那地方有50%的人整天干的事情就是催另外25%的人没完没了的解剩下那25%的人造成的bug。我是个程序员，每天敲敲打打，哪天电脑崩溃了你会发现我这辈子啥都没留下。大多数人甚至都没有想过我们是怎么把手机捣鼓出来的，包括是是否人手一套乐高的家庭套装工具。</p><p>我那可爱的岳父岳母在向自己的亲戚朋友们介绍我的时候，总是用一种充满自豪的口吻轻描淡写的说，他在摩托罗拉上班（我离开摩托罗拉以后他们会说，他以前在摩托罗拉上班）。然后那帮倒霉催的亲戚朋友们就会一种既内行又套近乎的口气说，你能埋导偏伊熟几啵？...我内诺几亚屏幕不咸你能修啵？</p><p>类似的事情在我刚毕业的时候也会经常发生，人们一听到邮电大学就会忧国忧民的叹一口气：现在这邮局不景气啊，快递也都是体力活儿...</p><p>今天下午我的我同事同客户见面，我们花了一个多小时也没法很好的解释为什么我们的客户端在收到一个完整的图片（虽然它超时了）后又再次发生相同的请求，并且在3秒钟又收到应答之后还是没法让它显示出来。“有关部门”可以“不解释”，但程序员一点儿都不能含糊。</p><p>然后另外一个同事给我发了一个链接，关于大洋彼岸一个悲催的程序员<a href="http://www.zhuoqun.net/html/y2010/1565.html" target="_blank" rel="noopener noreferrer">阿什顿的故事</a>。“他写过的任何一行代码都没有运行过。过去两年内他做的任何一件事情都没有对世界产生过什么影响。”</p><p>尽管我从内心里明白这个世界上还有很多人活得比我悲惨，但我还是忍不住的悲从中来，几乎逆流。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="第2节">第2节<a class="hash-link" href="#第2节" title="Direct link to heading">​</a></h2><p>我每天努力编写代码的间隙，会上水木清华的笑话版放松一下，或是看看不露点的美女图片解解乏。我也看一些业界的新闻，那些狗日的天天把“创新/用户体验/敏捷开发”等等挂在嘴边，却从来没为这个世界贡献过哪怕一行代码。我还用免费的在线翻译软件，为的是给代码中的每一个变量都起一个地道的英文名字，至少让印度同事们看上去可读性强一些。</p><p>我有个师弟，因为工作的关系他居然不得不在晚上编程。在他失恋的那天晚上我们一起喝酒，他泪流满面的对我说，其实他觉得最悲痛的事情是自己连坐台的小姐都不如，她们还可以赚外快，而这却是我的生活。</p><p>上个月我和几个校友聚餐，其中一个26岁的小伙子一直没怎么吃，末了他十分沉重的说，怕自己这辈子就只能当个程序员了...编程年龄最长为12年的我们充满羞愧地以遍历的形式相互对视了一圈；包间的空气里充满了悲怆和绝望。</p><p>我努力回忆看过的每一部有程序员出现的片子，发现这些人不是前景就是背景，总是处于焦外。有时候他们在黑掉一些系统之后会有有幸运的正脸出现，但很快就会以一种飞来横祸（例如被鼠标线勒住或滑落的电脑砸到）的方式死掉，连像主角那样中枪或被爆炸都不配。他们没有名表名车，没有女人和性，最多养一只看上去和本人一样非主流的宠物蜥蜴。</p><p>那晚上我做了个梦，梦见这个世界有一个总的电源开关，邪恶的章鱼博士用手（他有八只手）恶狠狠的掐掉了开关，然后我干了一辈子什么都没留下。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="第3节">第3节<a class="hash-link" href="#第3节" title="Direct link to heading">​</a></h2><p>我老婆每天下班都会跟我讲她们办公室好玩的事情，例如A和B闹矛盾打了起来然后B就把A全年的工资单群发给所有同事...我也跟她说我们好玩的事情：A写的代码把互斥和信号量弄混淆了，导致执行的结果总是时对时错，B给他做code review之后把互斥和信号量都去掉了，发现根本不需要这些东西也能得到正确的结果，因为所有的一切都运行在同一个线程里...</p><p>如你所知，这个世界上有两种人永远没法理解程序员的幽默和笑点，一种是不会编程的人，一种是没有幽默感的人。就如同狗日的KJ说过的，这个世界有两种人，一种是程序员，一种不是程序员。</p><p>非程序员可以要求程序员提高点文化素质和举止修养，但程序员却不能要求非程序员们在讨论大事小事的时候多一点理性的态度和客观科学的精神。这也是我和我老婆的家庭生活原则。</p><p>我认识的朋友中有做编剧，也有画画的，这两个倒霉的家伙的作品从来没有在这个世界上以一种公开的方式被人看过。但是所有的人都充满耐心和爱心的安慰他们，没关系，总有那么一天你会进军好莱坞，或是在佳士得拍卖场的。可是这帮势利眼们每次见到我都会用一种不出所料的心态，以一种关切惋惜的口吻说，你怎么还在编程啊？他们从来不会安慰我说，总有一天你会成为比尔盖茨的；哪怕是王江民也行，尽管他已经英年早逝。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="第4节">第4节<a class="hash-link" href="#第4节" title="Direct link to heading">​</a></h2><p>哲人们说过，是你去迎合这个世界，而不是这个世界来迎合你。我为了迎合这个狗日的世界，不得不在编程之余去做一些事情，目的只是让自己成为一个不是那么普通的程序员而已。世界可能是你的，也可能是他的，但不是程序员的，尽管这个世界凡是插电的东西里基本都跑着匿名程序员们一行一行写出来的代码。</p><p>我得看一些大部头，不是《鬼吹灯》，至少得是《明朝那些事儿》，这样他们在谈论《万历十五年的时候》我至少能插得上话，偶尔也能谈笑风生。我最近看的一本书是《高级迷信》，我敢打赌不管你是不是程序员你都不一定看得懂。</p><p>我买了单反还有镜头，虽然都是二手的，但我和所有烧不起器材的人们一样，坚信重要的不是镜头而是镜头后边的这颗脑袋。</p><p>我还听摇滚，虽然他们的iPod里大多数时候放的都是些小资小清新。至少我也有自己的品味。</p><p>我的那些程序员同事和朋友们，有的去登山远足，有的学调酒（因为没法学会调姑娘），还有的自己和自己玩SM。因为程序员们对于这个复杂的世界来说都属于足够简单的那一类人，性格简单，爱好简单，甚至行为也简单。他们有时只是想引起身边的人对自己的程序员朋友或程序员家人一点足够的重视，就像你养的小狗那样。</p><p>有时我也把一些编程的心得写出来，插入一些故弄玄虚的废话，然后发到博客里。我从来不知道自己写的代码什么时候在哪些地方运行着，但我却可以清楚的看到多少人访问过我的博客（尽管有些人只是误点），还有多少人留言（尽管大部分都是“顶”或“狗屁”一类的狗屁）。但得感谢他们，深夜里我抚摸屏幕上这些莫名的访客记录，感觉自己那灰色的二进制程序员生活因此而照进了一丝圣光，看上去变成了8进制：赤橙红黄绿蓝紫，还有白。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="第5节">第5节<a class="hash-link" href="#第5节" title="Direct link to heading">​</a></h2><p>对于程序员来说，一个最好的世界，就是我们可以心无旁骛编程的世界，是我们可以骄傲的高呼“我要编一辈子程”的世界，是非程序员的那些人像追捧iPad一样奉程序员为明星和教主的世界</p>]]></content>
        <author>
            <name>苏鹏</name>
            <uri>http://blog.sina.cn/dpool/blog/u/1645900192#type=-1</uri>
        </author>
        <category label="日志" term="日志"/>
        <category label="文章" term="文章"/>
        <category label="摘抄" term="摘抄"/>
        <category label="转摘" term="转摘"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[从前慢]]></title>
        <id>/2021/03/07/cong-qian-man</id>
        <link href="https://blog.alanwei.com/blog/2021/03/07/cong-qian-man"/>
        <updated>2021-03-07T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[记得早先少年时]]></summary>
        <content type="html"><![CDATA[<p>记得早先少年时 <br>
大家诚诚恳恳 <br>
说一句 是一句 <br></p><p>清早上火车站  <br>
长街黑暗无行人 <br>
卖豆浆的小店冒着热气 <br></p><p>从前的日色变得慢 <br>
车，马，邮件都慢 <br>
一生只够爱一个人 <br></p><p>从前的锁也好看 <br>
钥匙精美有样子 <br>
你锁了 人家就懂了 <br></p>]]></content>
        <author>
            <name>木心</name>
        </author>
        <category label="日志" term="日志"/>
        <category label="文章" term="文章"/>
        <category label="转摘" term="转摘"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[使用Maven创建一个Java项目]]></title>
        <id>/2021/03/06/create-java-project-use-maven</id>
        <link href="https://blog.alanwei.com/blog/2021/03/06/create-java-project-use-maven"/>
        <updated>2021-03-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[原文]]></summary>
        <content type="html"><![CDATA[<p><a href="https://mkyong.com/maven/how-to-create-a-java-project-with-maven/" target="_blank" rel="noopener noreferrer">原文</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-create-a-project-from-maven-template">1. Create a Project from Maven Template<a class="hash-link" href="#1-create-a-project-from-maven-template" title="Direct link to heading">​</a></h2><p>In a terminal (*uix or Mac) or command prompt (Windows), navigate to the folder you want to create the Java project. Type this command :</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mvn archetype:generate </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -DgroupId={project-packaging}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -DartifactId={project-name}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -DarchetypeArtifactId={maven-template} </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -DinteractiveMode=false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This tells Maven to generate a Java project from a Maven template. For example,</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">D:\&gt;mvn archetype:generate -DgroupId=com.mkyong.hashing -DartifactId=java-project -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] ------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] BUILD SUCCESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] ------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Total time: 3.992 s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Finished at: 2018-09-27T17:15:57+08:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] ------------------------------------------------------------------------</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Above command will generate a Java project from maven-archetype-quickstart template.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-maven-directory-layout">2. Maven Directory Layout<a class="hash-link" href="#2-maven-directory-layout" title="Direct link to heading">​</a></h2><p>The following project directory structure will be created. In short, source code puts in folder /src/main/java/, unit test code puts in <code>/src/test/java/</code>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-pom-file">3. POM file<a class="hash-link" href="#3-pom-file" title="Direct link to heading">​</a></h2><p>Review the generated <code>pom.xml</code>. It’s quite empty, just a single <code>jUnit</code> dependency.</p><p><em>pom.xml</em></p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">project</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">xmlns</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://maven.apache.org/POM/4.0.0</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xmlns:</span><span class="token tag attr-name" style="color:#00a4db">xsi</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://www.w3.org/2001/XMLSchema-instance</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">         </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xsi:</span><span class="token tag attr-name" style="color:#00a4db">schemaLocation</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://maven.apache.org/POM/4.0.0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token tag attr-value" style="color:#e3116c">         http://maven.apache.org/maven-v4_0_0.xsd</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">modelVersion</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">4.0.0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">modelVersion</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.mkyong.hashing</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">java-project3</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">jar</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.0-SNAPSHOT</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">java-project</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">http://maven.apache.org</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependencies</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">junit</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">junit</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">3.8.1</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">test</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependencies</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">project</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This POM file is like the Ant <code>build.xml</code> file, it describes the entire project information, everything from directory structure, project plugins, project dependencies, how to build this project and etc, read this <a href="http://maven.apache.org/guides/introduction/introduction-to-the-pom.html" target="_blank" rel="noopener noreferrer">official POM guide</a>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4-update-pom">4. Update POM<a class="hash-link" href="#4-update-pom" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="41-add-compiler-properties-to-tell-maven-use-a-specified-jdk-version-to-compile-the-source-code">4.1 Add compiler properties to tell Maven use a specified JDK version to compile the source code.<a class="hash-link" href="#41-add-compiler-properties-to-tell-maven-use-a-specified-jdk-version-to-compile-the-source-code" title="Direct link to heading">​</a></h3><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">properties</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- https://maven.apache.org/general.html#encoding-warning --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">project.build.sourceEncoding</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">UTF-8</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">project.build.sourceEncoding</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">maven.compiler.source</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.8</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">maven.compiler.source</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">maven.compiler.target</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.8</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">maven.compiler.target</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">properties</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="42-update-junit-to-412">4.2 Update jUnit to 4.12<a class="hash-link" href="#42-update-junit-to-412" title="Direct link to heading">​</a></h3><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">junit</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">junit</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">4.12</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">test</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="43-add-commons-codec-for-sha-hashing">4.3 Add commons-codec for SHA hashing.<a class="hash-link" href="#43-add-commons-codec-for-sha-hashing" title="Direct link to heading">​</a></h3><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Dependency for hashing --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- https://search.maven.org/artifact/commons-codec/commons-codec/1.11/jar --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">commons-codec</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">commons-codec</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.11</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="44-complete-updated-version">4.4 Complete updated version.<a class="hash-link" href="#44-complete-updated-version" title="Direct link to heading">​</a></h3><p><em>pom.xml</em></p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">project</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">xmlns</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://maven.apache.org/POM/4.0.0</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xmlns:</span><span class="token tag attr-name" style="color:#00a4db">xsi</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://www.w3.org/2001/XMLSchema-instance</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">         </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xsi:</span><span class="token tag attr-name" style="color:#00a4db">schemaLocation</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://maven.apache.org/POM/4.0.0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token tag attr-value" style="color:#e3116c">         http://maven.apache.org/maven-v4_0_0.xsd</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">modelVersion</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">4.0.0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">modelVersion</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.mkyong.hashing</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">java-project</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">jar</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.0-SNAPSHOT</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">java-project</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">http://maven.apache.org</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">properties</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- https://maven.apache.org/general.html#encoding-warning --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">project.build.sourceEncoding</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">UTF-8</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">project.build.sourceEncoding</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">maven.compiler.source</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.8</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">maven.compiler.source</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">maven.compiler.target</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.8</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">maven.compiler.target</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">properties</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependencies</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">junit</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">junit</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">4.12</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">test</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">commons-codec</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">commons-codec</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.11</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependencies</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">project</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5-write-code">5. Write Code<a class="hash-link" href="#5-write-code" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="51-update-the-appjava-to-accept-an-input-and-hash-it-with-a-sha-256-algorithm">5.1 Update the App.java to accept an input and hash it with a SHA-256 algorithm.<a class="hash-link" href="#51-update-the-appjava-to-accept-an-input-and-hash-it-with-a-sha-256-algorithm" title="Direct link to heading">​</a></h3><p><em>App.java</em></p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.mkyong.hashing;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.commons.codec.digest.DigestUtils;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class App {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (args.length &lt; 1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.err.println("Please provide an input!");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.exit(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(sha256hex(args[0]));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static String sha256hex(String input) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return DigestUtils.sha256Hex(input);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="52-unit-test">5.2 Unit Test.<a class="hash-link" href="#52-unit-test" title="Direct link to heading">​</a></h3><p><em>AppTest.java</em></p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.mkyong.hashing;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.junit.Assert;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.junit.Test;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AppTest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String INPUT = "123456";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void testLength() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Assert.assertEquals(64, App.sha256hex(INPUT).length());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void testHex() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String expected = "8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Assert.assertEquals(expected, App.sha256hex(INPUT));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Done.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="6-maven-build">6. Maven Build<a class="hash-link" href="#6-maven-build" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="61-let-build-it-with-mvn-package">6.1 Let build it with <code>mvn package</code><a class="hash-link" href="#61-let-build-it-with-mvn-package" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">D:\java-project&gt;mvn package</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Scanning for projects...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] ------------------&lt; com.mkyong.hashing:java-project &gt;-------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Building java-project 1.0-SNAPSHOT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] --------------------------------[ jar ]---------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> T E S T S</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Running com.mkyong.hashing.AppTest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.067 sec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Results :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tests run: 2, Failures: 0, Errors: 0, Skipped: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ java-project ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Building jar: D:\java-project\target\java-project-1.0-SNAPSHOT.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] ------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] BUILD SUCCESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] ------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Total time: 1.956 s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Finished at: 2018-09-28T12:40:18+08:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] ------------------------------------------------------------------------</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It compiles, run unit test and package the project into a <code>jar</code> file and puts it into the <code>project/target</code> folder.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="7-run1">7. Run#1<a class="hash-link" href="#7-run1" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="71-run-it-oops-by-default-maven-didnt-add-the-project-dependencies-commons-codec-into-the-jar-file">7.1 Run it. Oops… By default, Maven didn’t add the project dependencies <code>commons-codec</code> into the jar file.<a class="hash-link" href="#71-run-it-oops-by-default-maven-didnt-add-the-project-dependencies-commons-codec-into-the-jar-file" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">D:\java-project&gt;java -cp target/java-project-1.0-SNAPSHOT.jar com.mkyong.hashing.App 123456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Exception in thread "main" java.lang.NoClassDefFoundError: org/apache/commons/codec/digest/DigestUtils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at com.mkyong.hashing.App.sha256hex(App.java:18)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at com.mkyong.hashing.App.main(App.java:13)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Caused by: java.lang.ClassNotFoundException: org.apache.commons.codec.digest.DigestUtils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(Unknown Source)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(Unknown Source)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at java.base/java.lang.ClassLoader.loadClass(Unknown Source)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ... 2 more</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="72-to-solve-it-we-can-use-this-maven-shade-plugin-to-create-an-uberfat-jar--group-everything-into-a-single-jar-file">7.2 To solve it, we can use this <code>maven-shade-plugin</code> to create an uber/fat-jar – group everything into a single jar file.<a class="hash-link" href="#72-to-solve-it-we-can-use-this-maven-shade-plugin-to-create-an-uberfat-jar--group-everything-into-a-single-jar-file" title="Direct link to heading">​</a></h3><p><em>pom.xml</em></p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">build</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugins</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.apache.maven.plugins</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">maven-shade-plugin</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">3.2.0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">executions</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Attach the shade goal into the package phase --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">execution</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">phase</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">package</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">phase</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">goals</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">goal</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">shade</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">goal</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">goals</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">execution</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">executions</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugins</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">build</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="73-package-it-again">7.3 Package it again!<a class="hash-link" href="#73-package-it-again" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">D:\java-project&gt;mvn clean package</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Scanning for projects...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] --- maven-shade-plugin:3.2.0:shade (default) @ java-project ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Including commons-codec:commons-codec:jar:1.11 in the shaded jar.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Replacing original artifact with shaded artifact.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] Replacing D:\java-project\target\java-project-1.0-SNAPSHOT.jar </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    with D:\java-project\target\java-project-1.0-SNAPSHOT-shaded.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Two jars will be generated, review the file size :</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">D:\java-project&gt;dir target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Volume in drive D is Samsung970</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Volume Serial Number is 10DF-E63D</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Directory of D:\java-project\target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">28/09/2018  12:57 PM           335,643 java-project-1.0-SNAPSHOT.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">28/09/2018  12:57 PM             3,053 original-java-project-1.0-SNAPSHOT.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8-run2">8. Run#2<a class="hash-link" href="#8-run2" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="81-run-it-again-good-the-result-is-expected">8.1 Run it again. Good, the result is expected.<a class="hash-link" href="#81-run-it-again-good-the-result-is-expected" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">D:\java-project&gt;java -cp target/java-project-1.0-SNAPSHOT.jar com.mkyong.hashing.App 123456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="82-can-we-run-it-as-jar-no-there-is-no-main-class">8.2 Can we run it as Jar? No, there is no main class.<a class="hash-link" href="#82-can-we-run-it-as-jar-no-there-is-no-main-class" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">D:\java-project&gt;java -jar target/java-project-1.0-SNAPSHOT.jar 123456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">no main manifest attribute, in target/java-project-1.0-SNAPSHOT.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="83-to-solve-it-add-the-main-class-in-maven-shade-plugin-like-this">8.3 To solve it, add the main class in maven-shade-plugin like this.<a class="hash-link" href="#83-to-solve-it-add-the-main-class-in-maven-shade-plugin-like-this" title="Direct link to heading">​</a></h3><p><em>pom.xml</em></p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.apache.maven.plugins</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">maven-shade-plugin</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">3.2.0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">executions</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Attach the shade into the package phase --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">execution</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">phase</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">package</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">phase</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">goals</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">goal</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">shade</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">goal</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">goals</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">transformers</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">transformer</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">implementation</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">org.apache.maven.plugins.shade.resource.ManifestResourceTransformer</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">mainClass</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.mkyong.hashing.App</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">mainClass</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">transformer</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">transformers</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">execution</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">executions</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="9-run3">9. Run#3<a class="hash-link" href="#9-run3" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="91-package-it-again">9.1 Package it again!<a class="hash-link" href="#91-package-it-again" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">D:\java-project&gt;mvn clean package</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="92-run-it-as-jar">9.2 Run it as Jar.<a class="hash-link" href="#92-run-it-as-jar" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">D:\java-project&gt;java -jar target/java-project-1.0-SNAPSHOT.jar 123456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Done.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="10-pom">10. POM<a class="hash-link" href="#10-pom" title="Direct link to heading">​</a></h2><p>Final POM file.</p><p><em>pom.xml</em></p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">project</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">xmlns</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://maven.apache.org/POM/4.0.0</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xmlns:</span><span class="token tag attr-name" style="color:#00a4db">xsi</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://www.w3.org/2001/XMLSchema-instance</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">         </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">xsi:</span><span class="token tag attr-name" style="color:#00a4db">schemaLocation</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://maven.apache.org/POM/4.0.0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token tag attr-value" style="color:#e3116c">         http://maven.apache.org/maven-v4_0_0.xsd</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">modelVersion</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">4.0.0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">modelVersion</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.mkyong.hashing</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">java-project</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">jar</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">packaging</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.0-SNAPSHOT</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">java-project</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">http://maven.apache.org</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">properties</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- https://maven.apache.org/general.html#encoding-warning --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">project.build.sourceEncoding</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">UTF-8</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">project.build.sourceEncoding</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">maven.compiler.source</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.8</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">maven.compiler.source</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">maven.compiler.target</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.8</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">maven.compiler.target</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">properties</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependencies</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">junit</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">junit</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">4.12</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">test</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">scope</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">commons-codec</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">commons-codec</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.11</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependencies</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">build</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugins</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.apache.maven.plugins</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">maven-shade-plugin</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">3.2.0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">executions</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Attach the shade into the package phase --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">execution</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">phase</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">package</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">phase</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">goals</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">goal</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">shade</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">goal</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">goals</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">transformers</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">transformer</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">                                        </span><span class="token tag attr-name" style="color:#00a4db">implementation</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">org.apache.maven.plugins.shade.resource.ManifestResourceTransformer</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">mainClass</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.mkyong.hashing.App</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">mainClass</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">transformer</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">transformers</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">execution</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">executions</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugins</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">build</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">project</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="java" term="java"/>
        <category label="maven" term="maven"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[如何使用Maven创建可执行的JAR文件]]></title>
        <id>/2021/03/06/how-can-i-create-an-executable-jar-with-dependencies-using-maven</id>
        <link href="https://blog.alanwei.com/blog/2021/03/06/how-can-i-create-an-executable-jar-with-dependencies-using-maven"/>
        <updated>2021-03-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[原文 - 使用Maven打包可执行JAR程序]]></summary>
        <content type="html"><![CDATA[<p><a href="https://stackoverflow.com/questions/574594/how-can-i-create-an-executable-jar-with-dependencies-using-maven" target="_blank" rel="noopener noreferrer">原文 - 使用Maven打包可执行JAR程序</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="方案-1">方案 1<a class="hash-link" href="#方案-1" title="Direct link to heading">​</a></h2><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">build</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugins</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">maven-assembly-plugin</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">archive</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">manifest</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">mainClass</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">fully.qualified.MainClass</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">mainClass</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">manifest</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">archive</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">descriptorRefs</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">descriptorRef</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">jar-with-dependencies</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">descriptorRef</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">descriptorRefs</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugins</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">build</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and you run it with</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mvn clean compile assembly:single</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="方案-2">方案 2<a class="hash-link" href="#方案-2" title="Direct link to heading">​</a></h2><p>You can use the dependency-plugin to generate all dependencies in a separate directory before the package phase and then include that in the classpath of the manifest:</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.apache.maven.plugins</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">maven-dependency-plugin</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">executions</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">execution</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">copy-dependencies</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">phase</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">prepare-package</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">phase</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">goals</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">goal</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">copy-dependencies</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">goal</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">goals</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">outputDirectory</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">${project.build.directory}/lib</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">outputDirectory</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">overWriteReleases</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">false</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">overWriteReleases</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">overWriteSnapshots</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">false</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">overWriteSnapshots</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">overWriteIfNewer</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">overWriteIfNewer</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">execution</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">executions</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.apache.maven.plugins</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">maven-jar-plugin</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">archive</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">manifest</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">addClasspath</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">addClasspath</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">classpathPrefix</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">lib/</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">classpathPrefix</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">mainClass</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">theMainClass</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">mainClass</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">manifest</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">archive</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Alternatively use <code>${project.build.directory}/classes/lib</code> as OutputDirectory to integrate all jar-files into the main jar, but then you will need to add custom classloading code to load the jars.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="方案-3">方案 3<a class="hash-link" href="#方案-3" title="Direct link to heading">​</a></h2><p><a href="https://robert-reiz.com/2011/10/19/uber-jar-with-maven/" target="_blank" rel="noopener noreferrer">Uber JAR with Maven</a></p><p>By default maven is generating a small JAR file, which just contains your compiled classes and other project files. If you want to have a single JAR file which also includes all dependent JAR files, you have to create a uber JAR. You can do that with the maven shade plugin. Just put this lines of xml into your pom.xml.</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">build</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugins</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.apache.maven.plugins</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">maven-shade-plugin</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.4</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">executions</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">execution</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">phase</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">package</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">phase</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">goals</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">goal</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">shade</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">goal</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">goals</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">shadedArtifactAttached</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">shadedArtifactAttached</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">shadedClassifierName</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">all</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">shadedClassifierName</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">execution</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">executions</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugins</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">build</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In Maven you can solve every problem. You just need enough XML code for that. If you still have problems, than probably your pom.xml is to short.</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="java" term="java"/>
        <category label="maven" term="maven"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[IKEv2 配置和使用指南]]></title>
        <id>/2021/03/06/ipsec-clients-ikev2</id>
        <link href="https://blog.alanwei.com/blog/2021/03/06/ipsec-clients-ikev2"/>
        <updated>2021-03-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[你也可以使用 IPsec/L2TP 或者 IPsec/XAuth 模式连接。]]></summary>
        <content type="html"><![CDATA[<div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>你也可以使用 <a href="/blog/2021/03/06/ipsec-clients-l2tp">IPsec/L2TP</a> 或者 <a href="/blog/2021/03/06/ipsec-clients-xauth">IPsec/XAuth</a> 模式连接。</p></div></div><ul><li><a href="#%E5%AF%BC%E8%A8%80">导言</a></li><li><a href="#%E4%BD%BF%E7%94%A8%E8%BE%85%E5%8A%A9%E8%84%9A%E6%9C%AC">使用辅助脚本</a></li><li><a href="#%E9%85%8D%E7%BD%AE-ikev2-vpn-%E5%AE%A2%E6%88%B7%E7%AB%AF">配置 IKEv2 VPN 客户端</a></li><li><a href="#%E7%AE%A1%E7%90%86%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AF%81%E4%B9%A6">管理客户端证书</a></li><li><a href="#%E6%89%8B%E5%8A%A8%E5%9C%A8-vpn-%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E9%85%8D%E7%BD%AE-ikev2">手动在 VPN 服务器上配置 IKEv2</a></li><li><a href="#%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4">故障排除</a></li><li><a href="#%E7%A7%BB%E9%99%A4-ikev2">移除 IKEv2</a></li><li><a href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5">参考链接</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="导言">导言<a class="hash-link" href="#导言" title="Direct link to heading">​</a></h2><p>现代操作系统（比如 Windows 7 和更新版本）支持 IKEv2 协议标准。因特网密钥交换（英语：Internet Key Exchange，简称 IKE 或 IKEv2）是一种网络协议，归属于 IPsec 协议族之下，用以创建安全关联 (Security Association, SA)。与 IKE 版本 1 相比较，IKEv2 的 <a href="https://en.wikipedia.org/wiki/Internet_Key_Exchange#Improvements_with_IKEv2" target="_blank" rel="noopener noreferrer">功能改进</a> 包括比如通过 MOBIKE 实现 Standard Mobility 支持，以及更高的可靠性。</p><p>Libreswan 支持通过使用 RSA 签名算法的 X.509 Machine Certificates 来对 IKEv2 客户端进行身份验证。该方法无需 IPsec PSK, 用户名或密码。它可以用于以下系统：</p><ul><li>Windows 7, 8.x 和 10</li><li>OS X (macOS)</li><li>iOS (iPhone/iPad)</li><li>Android 4.x 和更新版本（使用 strongSwan VPN 客户端）</li></ul><p>在按照本指南操作之后，你将可以选择三种模式中的任意一种连接到 VPN：IKEv2，以及已有的 <a href="/blog/2021/03/06/ipsec-clients-l2tp">IPsec/L2TP</a> 和 <a href="/blog/2021/03/06/ipsec-clients-xauth">IPsec/XAuth ("Cisco IPsec")</a> 模式。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用辅助脚本">使用辅助脚本<a class="hash-link" href="#使用辅助脚本" title="Direct link to heading">​</a></h2><p><strong>新：</strong> 辅助脚本现在可以为 macOS 和 iOS 客户端创建 .mobileconfig 文件，以简化客户端设置并提高 VPN 性能。</p><p><strong>重要：</strong> 在继续之前，你应该已经成功地 <a href="/blog/2021/03/06/ipsec-server">搭建自己的 VPN 服务器</a>，并且（可选但推荐）<a href="/blog/2021/03/06/ipsec-clients-l2tp">升级 Libreswan</a>。<strong>Docker 用户请看 <a href="https://github.com/hwdsl2/docker-ipsec-vpn-server/blob/master/README-zh.md#配置并使用-ikev2-vpn" target="_blank" rel="noopener noreferrer">这里</a></strong>。</p><p>使用这个辅助脚本来自动地在 VPN 服务器上配置 IKEv2：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wget https://git.io/ikev2setup -O ikev2.sh &amp;&amp; sudo bash ikev2.sh --auto</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>该 <a href="https://github.com/hwdsl2/setup-ipsec-vpn/blob/master/extras/ikev2setup.sh" target="_blank" rel="noopener noreferrer">脚本</a> 必须使用 <code>bash</code> 而不是 <code>sh</code> 运行。以上命令使用自动模式和默认选项运行辅助脚本。如果你想要自定义 IKEv2 安装选项，请在运行脚本时去掉 <code>--auto</code> 参数。在完成之后，请转到 <a href="/blog/2021/03/06/ipsec-clients-ikev2">配置 IKEv2 VPN 客户端#配置-ikev2-vpn-客户端</a>。</p><p>你可以指定一个域名和/或另外的 DNS 服务器。这是可选的。点这里查看详情。</p><p>在使用自动模式安装 IKEv2 时，高级用户可以指定一个域名作为 VPN 服务器的地址。这是可选的。该域名必须是一个全称域名(FQDN)。示例如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo VPN_DNS_NAME='vpn.example.com' bash ikev2.sh --auto</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在 VPN 已连接时，IKEv2 客户端默认配置为使用 <a href="https://developers.google.com/speed/public-dns/" target="_blank" rel="noopener noreferrer">Google Public DNS</a>。在使用自动模式安装 IKEv2 时，你可以指定另外的 DNS 服务器。这是可选的。示例如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo VPN_DNS_SRV1=1.1.1.1 VPN_DNS_SRV2=1.0.0.1 bash ikev2.sh --auto</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>单击此处以查看 IKEv2 辅助脚本的详细使用信息。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Usage: bash ikev2.sh [options]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Options:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --auto                        run IKEv2 setup in auto mode using default options (for initial IKEv2 setup only)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --addclient [client name]     add a new IKEv2 client using default options (after IKEv2 setup)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --exportclient [client name]  export an existing IKEv2 client using default options (after IKEv2 setup)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --listclients                 list the names of existing IKEv2 clients (after IKEv2 setup)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --removeikev2                 remove IKEv2 and delete all certificates and keys from the IPsec database</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -h, --help                    show this help message and exit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">To customize IKEv2 or client options, run this script without arguments.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置-ikev2-vpn-客户端">配置 IKEv2 VPN 客户端<a class="hash-link" href="#配置-ikev2-vpn-客户端" title="Direct link to heading">​</a></h2><p><strong>注：</strong> 如果要为更多的客户端生成证书，或者为一个已有的客户端导出配置，只需重新运行<a href="#%E4%BD%BF%E7%94%A8%E8%BE%85%E5%8A%A9%E8%84%9A%E6%9C%AC">辅助脚本</a>。使用参数 <code>-h</code> 显示详细的使用信息。</p><ul><li><a href="#windows-7-8x-%E5%92%8C-10">Windows 7, 8.x 和 10</a></li><li><a href="#os-x-macos">OS X (macOS)</a></li><li><a href="#ios">iOS (iPhone/iPad)</a></li><li><a href="#android">Android</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="windows-7-8x-和-10">Windows 7, 8.x 和 10<a class="hash-link" href="#windows-7-8x-和-10" title="Direct link to heading">​</a></h3><ol><li><p>将生成的 <code>.p12</code> 文件安全地传送到你的计算机，然后导入到 "计算机账户" 证书存储。要导入 <code>.p12</code> 文件，打开 <a href="http://www.cnblogs.com/xxcanghai/p/4610054.html" target="_blank" rel="noopener noreferrer">提升权限命令提示符</a> 并运行以下命令：</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 导入 .p12 文件（换成你自己的值）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">certutil -f -importpfx ".p12文件的位置和名称" NoExport</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>另外，你也可以手动导入 <code>.p12</code> 文件。详细步骤请看 <a href="https://wiki.strongswan.org/projects/strongswan/wiki/Win7Certs" target="_blank" rel="noopener noreferrer">这里</a>。在导入证书后，你必须确保将客户端证书放在 "个人 -&gt; 证书" 目录中，并且将 CA 证书放在 "受信任的根证书颁发机构 -&gt; 证书" 目录中。</p><p><strong>注：</strong> Ubuntu 18.04 用户在尝试导入 <code>.p12</code> 文件时可能会遇到错误 "输入的密码不正确"。参见 <a href="#%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4">故障排除</a>。</p></li><li><p>在 Windows 计算机上添加一个新的 IKEv2 VPN 连接。对于 Windows 8.x 和 10，推荐从命令提示符运行以下命令创建 VPN 连接，以达到更佳的安全性和性能。Windows 7 不支持这些命令，你可以手动创建 VPN 连接（见下面）。</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 将服务器地址存入变量（换成你自己的值）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set server_addr="你的 VPN 服务器 IP（或者域名）"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 创建 VPN 连接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">powershell -command "Add-VpnConnection -Name 'My IKEv2 VPN' -ServerAddress '%server_addr%' -TunnelType IKEv2 -AuthenticationMethod MachineCertificate -EncryptionLevel Required -PassThru"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 设置 IPsec 参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">powershell -command "Set-VpnConnectionIPsecConfiguration -ConnectionName 'My IKEv2 VPN' -AuthenticationTransformConstants GCMAES256 -CipherTransformConstants GCMAES256 -EncryptionMethod AES256 -IntegrityCheckMethod SHA256 -PfsGroup None -DHGroup Group14 -PassThru -Force"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>另外，你也可以手动创建 VPN 连接。详细步骤请看 <a href="https://wiki.strongswan.org/projects/strongswan/wiki/Win7Config" target="_blank" rel="noopener noreferrer">这里</a>。如果你在配置 IKEv2 时指定了服务器的域名（而不是 IP 地址），则必须在 <strong>Internet地址</strong> 字段中输入该域名。</p></li><li><p>为 IKEv2 启用更强的加密算法，通过修改一次注册表来实现。这一步是可选的，但推荐。请下载并导入下面的 <code>.reg</code> 文件，或者打开提升权限命令提示符并运行以下命令。更多信息请看 <a href="https://wiki.strongswan.org/projects/strongswan/wiki/WindowsClients#AES-256-CBC-and-MODP2048" target="_blank" rel="noopener noreferrer">这里</a>。</p><ul><li><p>适用于 Windows 7, 8.x 和 10 (<a href="https://dl.ls20.com/reg-files/v1/Enable_Stronger_Ciphers_for_IKEv2_on_Windows.reg" target="_blank" rel="noopener noreferrer">下载 .reg 文件</a>)</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">REG ADD HKLM\SYSTEM\CurrentControlSet\Services\RasMan\Parameters /v NegotiateDH2048_AES256 /t REG_DWORD /d 0x1 /f</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li></ol><p>要连接到 VPN：单击系统托盘中的无线/网络图标，选择新的 VPN 连接，然后单击 <strong>连接</strong>。连接成功后，你可以到 <a href="https://www.ipchicken.com" target="_blank" rel="noopener noreferrer">这里</a> 检测你的 IP 地址，应该显示为<code>你的 VPN 服务器 IP</code>。</p><p>如果在连接过程中遇到错误，请参见 <a href="#%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4">故障排除</a>。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="os-x-macos">OS X (macOS)<a class="hash-link" href="#os-x-macos" title="Direct link to heading">​</a></h3><p>首先，将生成的 <code>.mobileconfig</code> 文件安全地传送到你的 Mac，然后双击并按提示操作，以导入为 macOS 配置描述文件。在完成之后，检查并确保 "IKEv2 VPN configuration" 显示在系统偏好设置 -&gt; 描述文件中。</p><p>要连接到 VPN：</p><ol><li>打开系统偏好设置并转到网络部分。</li><li>选择与 <code>你的 VPN 服务器 IP</code>（或者域名）对应的 VPN 连接。</li><li>选中 <strong>在菜单栏中显示 VPN 状态</strong> 复选框。</li><li>单击 <strong>连接</strong>。</li></ol><p>（可选功能）你可以选择启用 <a href="https://developer.apple.com/documentation/networkextension/personal_vpn/vpn_on_demand_rules" target="_blank" rel="noopener noreferrer">VPN On Demand（按需连接）</a> ，该功能在使用 Wi-Fi 网络时自动建立 VPN 连接。要启用它，选中 VPN 连接的 <strong>按需连接</strong> 复选框，然后单击 <strong>应用</strong>。</p><p>如果你手动配置 IKEv2 而不是使用辅助脚本，点这里查看步骤。</p><p>首先，将生成的 <code>.p12</code> 文件安全地传送到你的 Mac，然后双击以导入到 <strong>钥匙串访问</strong> 中的 <strong>登录</strong> 钥匙串。下一步，双击导入的 <code>IKEv2 VPN CA</code> 证书，展开 <strong>信任</strong> 并从 <strong>IP 安全 (IPsec)</strong> 下拉菜单中选择 <strong>始终信任</strong>。单击左上角的红色 "X" 关闭窗口。根据提示使用触控 ID，或者输入密码并单击 "更新设置"。</p><p>在完成之后，检查并确保新的客户端证书和 <code>IKEv2 VPN CA</code> 都显示在 <strong>登录</strong> 钥匙串 的 <strong>证书</strong> 类别中。</p><ol><li>打开系统偏好设置并转到网络部分。</li><li>在窗口左下角单击 <strong>+</strong> 按钮。</li><li>从 <strong>接口</strong> 下拉菜单选择 <strong>VPN</strong>。</li><li>从 <strong>VPN 类型</strong> 下拉菜单选择 <strong>IKEv2</strong>。</li><li>在 <strong>服务名称</strong> 字段中输入任意内容。</li><li>单击 <strong>创建</strong>。</li><li>在 <strong>服务器地址</strong> 字段中输入 <code>你的 VPN 服务器 IP</code> （或者域名）。<br><strong>注：</strong> 如果你在配置 IKEv2 时指定了服务器的域名（而不是 IP 地址），则必须在 <strong>服务器地址</strong> 和 <strong>远程 ID</strong> 字段中输入该域名。</li><li>在 <strong>远程 ID</strong> 字段中输入 <code>你的 VPN 服务器 IP</code> （或者域名）。</li><li>在 <strong>本地 ID</strong> 字段中输入 <code>你的 VPN 客户端名称</code>。<br><strong>注：</strong> 该名称必须和你在 IKEv2 配置过程中指定的客户端名称一致。它与你的 <code>.p12</code> 文件名的第一部分相同。</li><li>单击 <strong>认证设置</strong> 按钮。</li><li>从 <strong>认证设置</strong> 下拉菜单中选择 <strong>无</strong>。</li><li>选择 <strong>证书</strong> 单选按钮，然后选择新的客户端证书。</li><li>单击 <strong>好</strong>。</li><li>选中 <strong>在菜单栏中显示 VPN 状态</strong> 复选框。</li><li>单击 <strong>应用</strong> 保存VPN连接信息。</li><li>单击 <strong>连接</strong>。</li></ol><p>连接成功后，你可以到 <a href="https://www.ipchicken.com" target="_blank" rel="noopener noreferrer">这里</a> 检测你的 IP 地址，应该显示为<code>你的 VPN 服务器 IP</code>。</p><p>如果在连接过程中遇到错误，请参见 <a href="#%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4">故障排除</a>。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ios">iOS<a class="hash-link" href="#ios" title="Direct link to heading">​</a></h3><p>首先，将生成的 <code>.mobileconfig</code> 文件安全地传送到你的 iOS 设备，并且导入为 iOS 配置描述文件。要传送文件，你可以使用：</p><ol><li>AirDrop（隔空投送），或者</li><li>使用 iTunes 的 "文件共享" 功能上传到设备，然后打开 iOS 设备上的 "文件" 应用程序，将上传的文件移动到 "On My iPhone" 目录下。然后单击它并到 "设置" 应用程序中导入，或者</li><li>将文件放在一个你的安全的托管网站上，然后在 Mobile Safari 中下载并导入它们。</li></ol><p>在完成之后，检查并确保 "IKEv2 VPN configuration" 显示在设置 -&gt; 通用 -&gt; 描述文件中。</p><p>要连接到 VPN：</p><ol><li>进入设置 -&gt; 通用 -&gt; VPN。</li><li>选择与 <code>你的 VPN 服务器 IP</code>（或者域名）对应的 VPN 连接。</li><li>启用 <strong>VPN</strong> 连接。</li></ol><p>（可选功能）你可以选择启用 <a href="https://developer.apple.com/documentation/networkextension/personal_vpn/vpn_on_demand_rules" target="_blank" rel="noopener noreferrer">VPN On Demand（按需连接）</a> ，该功能在使用 Wi-Fi 网络时自动建立 VPN 连接。要启用它，单击 VPN 连接右边的 "i" 图标，然后启用 <strong>按需连接</strong>。</p><p>如果你手动配置 IKEv2 而不是使用辅助脚本，点这里查看步骤。</p><p>首先，将生成的 <code>ikev2vpnca.cer</code> 和 <code>.p12</code> 文件安全地传送到你的 iOS 设备，并且逐个导入为 iOS 配置描述文件。要传送文件，你可以使用：</p><ol><li>AirDrop（隔空投送），或者</li><li>使用 iTunes 的 "文件共享" 功能上传到设备，然后打开 iOS 设备上的 "文件" 应用程序，将上传的文件移动到 "On My iPhone" 目录下。然后逐个单击它们并到 "设置" 应用程序中导入，或者</li><li>将文件放在一个你的安全的托管网站上，然后在 Mobile Safari 中下载并导入它们。</li></ol><p>在完成之后，检查并确保新的客户端证书和 <code>IKEv2 VPN CA</code> 都显示在设置 -&gt; 通用 -&gt; 描述文件中。</p><ol><li>进入设置 -&gt; 通用 -&gt; VPN。</li><li>单击 <strong>添加VPN配置...</strong>。</li><li>单击 <strong>类型</strong> 。选择 <strong>IKEv2</strong> 并返回。</li><li>在 <strong>描述</strong> 字段中输入任意内容。</li><li>在 <strong>服务器</strong> 字段中输入 <code>你的 VPN 服务器 IP</code> （或者域名）。<br><strong>注：</strong> 如果你在配置 IKEv2 时指定了服务器的域名（而不是 IP 地址），则必须在 <strong>服务器</strong> 和 <strong>远程 ID</strong> 字段中输入该域名。</li><li>在 <strong>远程 ID</strong> 字段中输入 <code>你的 VPN 服务器 IP</code> （或者域名）。</li><li>在 <strong>本地 ID</strong> 字段中输入 <code>你的 VPN 客户端名称</code>。<br><strong>注：</strong> 该名称必须和你在 IKEv2 配置过程中指定的客户端名称一致。它与你的 <code>.p12</code> 文件名的第一部分相同。</li><li>单击 <strong>用户鉴定</strong> 。选择 <strong>无</strong> 并返回。</li><li>启用 <strong>使用证书</strong> 选项。</li><li>单击 <strong>证书</strong> 。选择新的客户端证书并返回。</li><li>单击右上角的 <strong>完成</strong>。</li><li>启用 <strong>VPN</strong> 连接。</li></ol><p>连接成功后，你可以到 <a href="https://www.ipchicken.com" target="_blank" rel="noopener noreferrer">这里</a> 检测你的 IP 地址，应该显示为<code>你的 VPN 服务器 IP</code>。</p><p>如果在连接过程中遇到错误，请参见 <a href="#%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4">故障排除</a>。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="android">Android<a class="hash-link" href="#android" title="Direct link to heading">​</a></h3><ol><li>将生成的 <code>.sswan</code> 文件安全地传送到你的 Android 设备。</li><li>从 <strong>Google Play</strong> 安装 <a href="https://play.google.com/store/apps/details?id=org.strongswan.android" target="_blank" rel="noopener noreferrer">strongSwan VPN 客户端</a>。</li><li>启动 strongSwan VPN 客户端。</li><li>单击右上角的 "更多选项" 菜单，然后单击 <strong>导入VPN配置</strong>。</li><li>选择你从服务器传送过来的 <code>.sswan</code> 文件。<br><strong>注：</strong> 要查找 <code>.sswan</code> 文件，单击左上角的抽拉式菜单，然后浏览到你保存文件的目录。</li><li>在 "导入VPN配置" 屏幕上，单击 <strong>从VPN配置导入证书</strong>，并按提示操作。</li><li>在 "选择证书" 屏幕上，选择新的客户端证书并单击 <strong>选择</strong>。</li><li>单击 <strong>导入</strong>。</li><li>单击新的 VPN 配置文件以开始连接。</li></ol><p>如果你的设备运行 Android 6.0 或更早版本，点这里查看额外的步骤。</p><p>如果你的设备运行 Android 6.0 (Marshmallow) 或更早版本，要使用 strongSwan VPN 客户端连接，你必须更改 VPN 服务器上的以下设置：编辑服务器上的 <code>/etc/ipsec.d/ikev2.conf</code>。在 <code>conn ikev2-cp</code> 小节的末尾添加 <code>authby=rsa-sha1</code>，开头必须空两格。保存文件并运行 <code>service ipsec restart</code>。</p><p>（可选功能）你可以选择启用 Android 上的 "始终开启的 VPN" 功能。启动 <strong>设置</strong> 应用程序，进入 网络和互联网 -&gt; 高级 -&gt; VPN，单击 "strongSwan VPN 客户端" 右边的设置图标，然后启用 <strong>始终开启的 VPN</strong> 以及 <strong>屏蔽未使用 VPN 的所有连接</strong> 选项。</p><p>如果你手动配置 IKEv2 而不是使用辅助脚本，点这里查看步骤。</p><p><strong>Android 10 和更新版本:</strong></p><ol><li>将生成的 <code>.p12</code> 文件安全地传送到你的 Android 设备。</li><li>从 <strong>Google Play</strong> 安装 <a href="https://play.google.com/store/apps/details?id=org.strongswan.android" target="_blank" rel="noopener noreferrer">strongSwan VPN 客户端</a>。</li><li>启动 <strong>设置</strong> 应用程序。</li><li>进入 安全 -&gt; 高级 -&gt; 加密与凭据。</li><li>单击 <strong>从存储设备（或 SD 卡）安装证书</strong>。</li><li>选择你从服务器传送过来的 <code>.p12</code> 文件，并按提示操作。<br><strong>注：</strong> 要查找 <code>.p12</code> 文件，单击左上角的抽拉式菜单，然后浏览到你保存文件的目录。</li><li>启动 strongSwan VPN 客户端，然后单击 <strong>添加VPN配置</strong>。</li><li>在 <strong>服务器地址</strong> 字段中输入 <code>你的 VPN 服务器 IP</code> （或者域名）。<br><strong>注：</strong> 如果你在配置 IKEv2 时指定了服务器的域名（而不是 IP 地址），则必须在 <strong>服务器地址</strong> 字段中输入该域名。</li><li>在 <strong>VPN 类型</strong> 下拉菜单选择 <strong>IKEv2 证书</strong>。</li><li>单击 <strong>选择用户证书</strong>，选择新的客户端证书并单击 <strong>选择</strong>。</li><li><strong>（重要）</strong> 单击 <strong>显示高级设置</strong>。向下滚动，找到并启用 <strong>Use RSA/PSS signatures</strong> 选项。</li><li>保存新的 VPN 连接，然后单击它以开始连接。</li></ol><p><strong>Android 4 to 9:</strong></p><ol><li>将生成的 <code>.p12</code> 文件安全地传送到你的 Android 设备。</li><li>从 <strong>Google Play</strong> 安装 <a href="https://play.google.com/store/apps/details?id=org.strongswan.android" target="_blank" rel="noopener noreferrer">strongSwan VPN 客户端</a>。</li><li>启动 strongSwan VPN 客户端，然后单击 <strong>添加VPN配置</strong>。</li><li>在 <strong>服务器地址</strong> 字段中输入 <code>你的 VPN 服务器 IP</code> （或者域名）。<br><strong>注：</strong> 如果你在配置 IKEv2 时指定了服务器的域名（而不是 IP 地址），则必须在 <strong>服务器地址</strong> 字段中输入该域名。</li><li>在 <strong>VPN 类型</strong> 下拉菜单选择 <strong>IKEv2 证书</strong>。</li><li>单击 <strong>选择用户证书</strong>，然后单击 <strong>安装证书</strong>。</li><li>选择你从服务器传送过来的 <code>.p12</code> 文件，并按提示操作。<br><strong>注：</strong> 要查找 <code>.p12</code> 文件，单击左上角的抽拉式菜单，然后浏览到你保存文件的目录。</li><li><strong>（重要）</strong> 单击 <strong>显示高级设置</strong>。向下滚动，找到并启用 <strong>Use RSA/PSS signatures</strong> 选项。</li><li>保存新的 VPN 连接，然后单击它以开始连接。</li></ol><p>连接成功后，你可以到 <a href="https://www.ipchicken.com" target="_blank" rel="noopener noreferrer">这里</a> 检测你的 IP 地址，应该显示为<code>你的 VPN 服务器 IP</code>。</p><p>如果在连接过程中遇到错误，请参见 <a href="#%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4">故障排除</a>。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="管理客户端证书">管理客户端证书<a class="hash-link" href="#管理客户端证书" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="列出已有的客户端">列出已有的客户端<a class="hash-link" href="#列出已有的客户端" title="Direct link to heading">​</a></h3><p>如果要列出已有的 IKEv2 客户端的名称，运行 <a href="#%E4%BD%BF%E7%94%A8%E8%BE%85%E5%8A%A9%E8%84%9A%E6%9C%AC">辅助脚本</a> 并添加 <code>--listclients</code> 选项。IKEv2 辅助脚本的详细使用信息请看 <a href="#%E4%BD%BF%E7%94%A8%E8%BE%85%E5%8A%A9%E8%84%9A%E6%9C%AC">这里</a>。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="添加一个客户端证书">添加一个客户端证书<a class="hash-link" href="#添加一个客户端证书" title="Direct link to heading">​</a></h3><p>如果要为更多的 IKEv2 客户端生成证书，只需重新运行 <a href="#%E4%BD%BF%E7%94%A8%E8%BE%85%E5%8A%A9%E8%84%9A%E6%9C%AC">辅助脚本</a>。参见上面的使用信息。或者你可以看 <a href="#%E6%89%8B%E5%8A%A8%E5%9C%A8-vpn-%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E9%85%8D%E7%BD%AE-ikev2">这一小节</a> 的第 4 步。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="导出一个已有的客户端的配置">导出一个已有的客户端的配置<a class="hash-link" href="#导出一个已有的客户端的配置" title="Direct link to heading">​</a></h3><p>在默认情况下，<a href="#%E4%BD%BF%E7%94%A8%E8%BE%85%E5%8A%A9%E8%84%9A%E6%9C%AC">IKEv2 辅助脚本</a> 在运行后会导出客户端配置。如果之后你想要为一个已有的客户端导出配置，重新运行辅助脚本并选择适当的选项。参见上面的使用信息。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="吊销一个客户端证书">吊销一个客户端证书<a class="hash-link" href="#吊销一个客户端证书" title="Direct link to heading">​</a></h3><p>在某些情况下，你可能需要吊销一个之前生成的 VPN 客户端证书。这可以通过 <code>crlutil</code> 实现。下面举例说明，这些命令必须用 <code>root</code> 账户运行。</p><ol><li><p>检查证书数据库，并且找到想要吊销的客户端证书的昵称。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">certutil -L -d sql:/etc/ipsec.d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Certificate Nickname                               Trust Attributes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                   SSL,S/MIME,JAR/XPI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IKEv2 VPN CA                                       CTu,u,u</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">($PUBLIC_IP)                                       u,u,u</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vpnclient-to-revoke                                u,u,u</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在这个例子中，我们将要吊销昵称为 <code>vpnclient-to-revoke</code> 的客户端证书。它是由 <code>IKEv2 VPN CA</code> 签发的。</p></li><li><p>找到该客户端证书的序列号。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">certutil -L -d sql:/etc/ipsec.d -n </span><span class="token string" style="color:#e3116c">"vpnclient-to-revoke"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Certificate:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Data:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Version: 3 (0x2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Serial Number:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            00:cd:69:ff:74</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">... ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>根据上面的输出，我们知道该序列号为十六进制的 <code>CD69FF74</code>，也就是十进制的 <code>3446275956</code>。它将在以下步骤中使用。</p></li><li><p>创建一个新的证书吊销列表 (CRL)。该步骤对于每个 CA 只需运行一次。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> crlutil -L -d sql:/etc/ipsec.d -n </span><span class="token string" style="color:#e3116c">"IKEv2 VPN CA"</span><span class="token plain"> </span><span class="token operator file-descriptor important" style="color:#393A34">2</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/dev/null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  crlutil -G -d sql:/etc/ipsec.d -n </span><span class="token string" style="color:#e3116c">"IKEv2 VPN CA"</span><span class="token plain"> -c /dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CRL Info:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Version: 2 (0x1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Signature Algorithm: PKCS #1 SHA-256 With RSA Encryption</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Issuer: "O=IKEv2 VPN,CN=IKEv2 VPN CA"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    This Update: Sat Jun 06 22:00:00 2020</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CRL Extensions:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>将你想要吊销的客户端证书添加到 CRL。在这里我们指定该证书的（十进制）序列号，以及吊销时间（UTC时间，格式：GeneralizedTime (YYYYMMDDhhmmssZ)）。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">crlutil -M -d sql:/etc/ipsec.d -n </span><span class="token string" style="color:#e3116c">"IKEv2 VPN CA"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">addcert 3446275956 20200606220100Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CRL Info:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Version: 2 (0x1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Signature Algorithm: PKCS #1 SHA-256 With RSA Encryption</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Issuer: "O=IKEv2 VPN,CN=IKEv2 VPN CA"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    This Update: Sat Jun 06 22:02:00 2020</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Entry 1 (0x1):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Serial Number:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            00:cd:69:ff:74</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Revocation Date: Sat Jun 06 22:01:00 2020</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CRL Extensions:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>注：</strong> 如果需要从 CRL 删除一个证书，可以将上面的 <code>addcert 3446275956 20200606220100Z</code> 替换为 <code>rmcert 3446275956</code>。关于 <code>crlutil</code> 的其它用法参见 <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/NSS/tools/NSS_Tools_crlutil" target="_blank" rel="noopener noreferrer">这里</a>。</p></li><li><p>最后，让 Libreswan 重新读取已更新的 CRL。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ipsec crls</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="手动在-vpn-服务器上配置-ikev2">手动在 VPN 服务器上配置 IKEv2<a class="hash-link" href="#手动在-vpn-服务器上配置-ikev2" title="Direct link to heading">​</a></h2><p>除了使用 <a href="#%E4%BD%BF%E7%94%A8%E8%BE%85%E5%8A%A9%E8%84%9A%E6%9C%AC">辅助脚本</a> 之外，高级用户也可以手动配置 IKEv2。下面举例说明如何手动在 Libreswan 上配置 IKEv2。以下命令必须用 <code>root</code> 账户运行。</p><ol><li><p>获取 VPN 服务器的公共 IP 地址，将它保存到变量并检查。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">PUBLIC_IP</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">dig</span><span class="token variable" style="color:#36acaa"> @resolver1.opendns.com -t A -4 myip.opendns.com +short</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> -z </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$PUBLIC_IP</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">PUBLIC_IP</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">wget</span><span class="token variable" style="color:#36acaa"> -t </span><span class="token variable number" style="color:#36acaa">3</span><span class="token variable" style="color:#36acaa"> -T </span><span class="token variable number" style="color:#36acaa">15</span><span class="token variable" style="color:#36acaa"> -qO- http://ipv4.icanhazip.com</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">printf</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'%s\n'</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$PUBLIC_IP</span><span class="token string" style="color:#e3116c">"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>检查并确保以上命令的输出与服务器的公共 IP 一致。该变量将在以下步骤中使用。</p><p><strong>注：</strong> 另外，在这里你也可以指定 VPN 服务器的域名。例如： <code>PUBLIC_IP=myvpn.example.com</code>。</p></li><li><p>添加一个新的 IKEv2 连接：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> -qs </span><span class="token string" style="color:#e3116c">'^include /etc/ipsec\.d/\*\.conf$'</span><span class="token plain"> /etc/ipsec.conf</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> /etc/ipsec.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'include /etc/ipsec.d/*.conf'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> /etc/ipsec.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>注：</strong> 如果你在上面的第一步指定了服务器的域名（而不是 IP 地址），则必须将以下命令中的 <code>leftid=$PUBLIC_IP</code> 换成 <code>leftid=@$PUBLIC_IP</code>。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /etc/ipsec.d/ikev2.conf </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">conn ikev2-cp</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  left=%defaultroute</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  leftcert=</span><span class="token string variable" style="color:#36acaa">$PUBLIC_IP</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  leftid=</span><span class="token string variable" style="color:#36acaa">$PUBLIC_IP</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  leftsendcert=always</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  leftsubnet=0.0.0.0/0</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  leftrsasigkey=%cert</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  right=%any</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  rightid=%fromcert</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  rightaddresspool=192.168.43.10-192.168.43.250</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  rightca=%same</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  rightrsasigkey=%cert</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  narrowing=yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  dpddelay=30</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  dpdtimeout=120</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  dpdaction=clear</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  auto=add</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  ikev2=insist</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  rekey=no</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  pfs=no</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  fragmentation=yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  ike=aes256-sha2,aes128-sha2,aes256-sha1,aes128-sha1,aes256-sha2;modp1024,aes128-sha1;modp1024</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  phase2alg=aes_gcm-null,aes128-sha1,aes256-sha1,aes128-sha2,aes256-sha2</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  ikelifetime=24h</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  salifetime=24h</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>还需要在该文件中添加一些行。首先查看你的 Libreswan 版本，然后运行以下命令之一：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ipsec --version</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果是 Libreswan 3.23 或更新版本：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> /etc/ipsec.d/ikev2.conf </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  modecfgdns="8.8.8.8 8.8.4.4"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  encapsulation=yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  mobike=no</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>注：</strong> <a href="https://wiki.strongswan.org/projects/strongswan/wiki/MobIke" target="_blank" rel="noopener noreferrer">MOBIKE</a>  IKEv2 协议扩展允许 VPN 客户端更改网络连接点，例如在移动数据和 Wi-Fi 之间切换，并使 VPN 保持连接。如果你的服务器（或者 Docker 主机）的操作系统 <strong>不是</strong> Ubuntu Linux，并且你想要启用 MOBIKE 支持，可以将上面命令中的 <code>mobike=no</code> 换成 <code>mobike=yes</code>。<strong>不要</strong> 在 Ubuntu 系统或者 Raspberry Pi 上启用该选项。</p><p>如果是 Libreswan 3.19-3.22：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> /etc/ipsec.d/ikev2.conf </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  modecfgdns1=8.8.8.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  modecfgdns2=8.8.4.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  encapsulation=yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果是 Libreswan 3.18 或更早版本：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> /etc/ipsec.d/ikev2.conf </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  modecfgdns1=8.8.8.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  modecfgdns2=8.8.4.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  forceencaps=yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>生成 Certificate Authority (CA) 和 VPN 服务器证书。</p><p><strong>注：</strong> 使用 "-v" 参数指定证书的有效期（单位：月），例如 "-v 120"。</p><p>生成 CA 证书：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">certutil -z </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">head</span><span class="token plain"> -c </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"> /dev/urandom</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -S -x -n </span><span class="token string" style="color:#e3116c">"IKEv2 VPN CA"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -s </span><span class="token string" style="color:#e3116c">"O=IKEv2 VPN,CN=IKEv2 VPN CA"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -k rsa -g </span><span class="token number" style="color:#36acaa">4096</span><span class="token plain"> -v </span><span class="token number" style="color:#36acaa">120</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d sql:/etc/ipsec.d -t </span><span class="token string" style="color:#e3116c">"CT,,"</span><span class="token plain"> -2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Generating key.  This may take a few moments...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Is this a CA certificate [y/N]?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter the path length constraint, enter to skip [&lt;0 for unlimited path]: &gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Is this a critical extension [y/N]?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">N</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>生成 VPN 服务器证书：</p><p><strong>注：</strong> 如果你在上面的第一步指定了服务器的域名（而不是 IP 地址），则必须将以下命令中的 <code>--extSAN "ip:$PUBLIC_IP,dns:$PUBLIC_IP"</code> 换成 <code>--extSAN "dns:$PUBLIC_IP"</code>。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">certutil -z </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">head</span><span class="token plain"> -c </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"> /dev/urandom</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -S -c </span><span class="token string" style="color:#e3116c">"IKEv2 VPN CA"</span><span class="token plain"> -n </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$PUBLIC_IP</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -s </span><span class="token string" style="color:#e3116c">"O=IKEv2 VPN,CN=</span><span class="token string variable" style="color:#36acaa">$PUBLIC_IP</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -k rsa -g </span><span class="token number" style="color:#36acaa">4096</span><span class="token plain"> -v </span><span class="token number" style="color:#36acaa">120</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d sql:/etc/ipsec.d -t </span><span class="token string" style="color:#e3116c">",,"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --keyUsage digitalSignature,keyEncipherment </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --extKeyUsage serverAuth </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --extSAN </span><span class="token string" style="color:#e3116c">"ip:</span><span class="token string variable" style="color:#36acaa">$PUBLIC_IP</span><span class="token string" style="color:#e3116c">,dns:</span><span class="token string variable" style="color:#36acaa">$PUBLIC_IP</span><span class="token string" style="color:#e3116c">"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Generating key.  This may take a few moments...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>生成客户端证书，然后导出 <code>.p12</code> 文件，该文件包含客户端证书，私钥以及 CA 证书。</p><p><strong>注：</strong> 你可以重复本步骤来为更多的客户端生成证书，但必须将所有的 <code>vpnclient</code> 换成比如 <code>vpnclient2</code>，等等。如需同时连接多个客户端，则必须为每个客户端生成唯一的证书。</p><p>生成客户端证书：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">certutil -z </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">head</span><span class="token plain"> -c </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"> /dev/urandom</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -S -c </span><span class="token string" style="color:#e3116c">"IKEv2 VPN CA"</span><span class="token plain"> -n </span><span class="token string" style="color:#e3116c">"vpnclient"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -s </span><span class="token string" style="color:#e3116c">"O=IKEv2 VPN,CN=vpnclient"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -k rsa -g </span><span class="token number" style="color:#36acaa">4096</span><span class="token plain"> -v </span><span class="token number" style="color:#36acaa">120</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d sql:/etc/ipsec.d -t </span><span class="token string" style="color:#e3116c">",,"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --keyUsage digitalSignature,keyEncipherment </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --extKeyUsage serverAuth,clientAuth -8 </span><span class="token string" style="color:#e3116c">"vpnclient"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Generating key.  This may take a few moments...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>导出 <code>.p12</code> 文件：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pk12util -d sql:/etc/ipsec.d -n </span><span class="token string" style="color:#e3116c">"vpnclient"</span><span class="token plain"> -o vpnclient.p12</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Enter password for PKCS12 file:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Re-enter password:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pk12util: PKCS12 EXPORT SUCCESSFUL</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>指定一个安全的密码以保护导出的 <code>.p12</code> 文件（在导入到 iOS 或 macOS 设备时，该密码不能为空）。</p></li><li><p>（适用于 iOS 客户端） 导出 CA 证书到 <code>ikev2vpnca.cer</code>：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">certutil -L -d sql:/etc/ipsec.d -n </span><span class="token string" style="color:#e3116c">"IKEv2 VPN CA"</span><span class="token plain"> -a -o ikev2vpnca.cer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>证书数据库现在应该包含以下内容：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">certutil -L -d sql:/etc/ipsec.d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Certificate Nickname                               Trust Attributes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                   SSL,S/MIME,JAR/XPI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IKEv2 VPN CA                                       CTu,u,u</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">($PUBLIC_IP)                                       u,u,u</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vpnclient                                          u,u,u</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>注：</strong> 如需显示证书内容，可使用 <code>certutil -L -d sql:/etc/ipsec.d -n "Nickname"</code>。要吊销一个客户端证书，请转到<a href="#%E5%90%8A%E9%94%80%E4%B8%80%E4%B8%AA%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AF%81%E4%B9%A6">这一节</a>。关于 <code>certutil</code> 的其它用法参见 <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/NSS/tools/NSS_Tools_certutil" target="_blank" rel="noopener noreferrer">这里</a>。</p></li><li><p><strong>（重要）重启 IPsec 服务</strong>：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">service</span><span class="token plain"> ipsec restart</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><p>在继续之前，你<strong>必须</strong>重启 IPsec 服务。VPN 服务器上的 IKEv2 配置到此已完成。下一步：<a href="#%E9%85%8D%E7%BD%AE-ikev2-vpn-%E5%AE%A2%E6%88%B7%E7%AB%AF">配置 VPN 客户端</a>。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="故障排除">故障排除<a class="hash-link" href="#故障排除" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="在导入客户端配置文件时提示密码不正确">在导入客户端配置文件时提示密码不正确<a class="hash-link" href="#在导入客户端配置文件时提示密码不正确" title="Direct link to heading">​</a></h3><p>如果你忘记了客户端配置文件的密码，可以重新 <a href="#%E5%AF%BC%E5%87%BA%E4%B8%80%E4%B8%AA%E5%B7%B2%E6%9C%89%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E9%85%8D%E7%BD%AE">导出 IKEv2 客户端的配置</a>。</p><p>Ubuntu 18.04 用户在尝试将生成的 <code>.p12</code> 文件导入到 Windows 时可能会遇到错误 "输入的密码不正确"。这是由 <code>NSS</code> 中的一个问题导致的。更多信息请看 <a href="https://github.com/hwdsl2/setup-ipsec-vpn/issues/414#issuecomment-460495258" target="_blank" rel="noopener noreferrer">这里</a>。</p><p>Ubuntu 18.04 上的 NSS 问题的解决方法</p><p><strong>注：</strong> 该解决方法仅适用于运行在 <code>x86_64</code> 架构下的 Ubuntu 18.04 系统。在 2021-01-21 已更新 IKEv2 辅助脚本以自动应用这个解决方法。</p><p>首先安装更新版本的 <code>libnss3</code> 相关的软件包：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wget https://mirrors.kernel.org/ubuntu/pool/main/n/nss/libnss3_3.49.1-1ubuntu1.5_amd64.deb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://mirrors.kernel.org/ubuntu/pool/main/n/nss/libnss3-dev_3.49.1-1ubuntu1.5_amd64.deb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://mirrors.kernel.org/ubuntu/pool/universe/n/nss/libnss3-tools_3.49.1-1ubuntu1.5_amd64.deb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apt-get -y update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apt-get -y install "./libnss3_3.49.1-1ubuntu1.5_amd64.deb" \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> "./libnss3-dev_3.49.1-1ubuntu1.5_amd64.deb" \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> "./libnss3-tools_3.49.1-1ubuntu1.5_amd64.deb"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后重新 <a href="#%E5%AF%BC%E5%87%BA%E4%B8%80%E4%B8%AA%E5%B7%B2%E6%9C%89%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E9%85%8D%E7%BD%AE">导出 IKEv2 客户端的配置</a>。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ikev2-在一小时后断开连接">IKEv2 在一小时后断开连接<a class="hash-link" href="#ikev2-在一小时后断开连接" title="Direct link to heading">​</a></h3><p>如果 IKEv2 连接在一小时（60 分钟）后自动断开，可以这样解决：编辑 VPN 服务器上的 <code>/etc/ipsec.d/ikev2.conf</code>（如果不存在，编辑 <code>/etc/ipsec.conf</code>）。在 <code>conn ikev2-cp</code> 一节的末尾添加以下行，开头必须空两格：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  ikelifetime=24h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  salifetime=24h</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>保存修改并运行 <code>service ipsec restart</code>。该解决方案已在 2021-01-20 添加到辅助脚本。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="无法同时连接多个-ikev2-客户端">无法同时连接多个 IKEv2 客户端<a class="hash-link" href="#无法同时连接多个-ikev2-客户端" title="Direct link to heading">​</a></h3><p>如果要同时连接多个客户端，则必须为每个客户端 <a href="#%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AF%81%E4%B9%A6">生成唯一的证书</a>。</p><p>如果你无法同时连接同一个 NAT （比如家用路由器）后面的多个 IKEv2 客户端，可以这样解决：编辑 VPN 服务器上的 <code>/etc/ipsec.d/ikev2.conf</code>，找到这一行 <code>leftid=@&lt;your_server_ip&gt;</code> 并去掉 <code>@</code>，也就是说将它替换为 <code>leftid=&lt;your_server_ip&gt;</code>。保存修改并运行 <code>service ipsec restart</code>。如果 <code>leftid</code> 是一个域名则不受影响，不要应用这个解决方案。该解决方案已在 2021-02-01 添加到辅助脚本。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="其它已知问题">其它已知问题<a class="hash-link" href="#其它已知问题" title="Direct link to heading">​</a></h3><ol><li>Windows 自带的 VPN 客户端可能不支持 IKEv2 fragmentation（该功能<a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-ikee/74df968a-7125-431d-9c98-4ea929e548dc" target="_blank" rel="noopener noreferrer">需要</a> Windows 10 v1803 或更新版本）。在有些网络上，这可能会导致连接错误或其它连接问题。你可以尝试换用 <a href="/blog/2021/03/06/ipsec-clients-l2tp">IPsec/L2TP</a> 或 <a href="/blog/2021/03/06/ipsec-clients-xauth">IPsec/XAuth</a> 模式。</li><li>如果你使用 strongSwan Android VPN 客户端，则必须将服务器上的 Libreswan <a href="/blog/2021/03/06/ipsec-clients-l2tp">升级libreswan</a>到版本 3.26 或以上。</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="更多故障排除信息">更多故障排除信息<a class="hash-link" href="#更多故障排除信息" title="Direct link to heading">​</a></h3><p>要查看更多故障排除信息，请看 <a href="/blog/2021/03/06/ipsec-clients-l2tp">这里 &gt; 故障排除</a>。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="移除-ikev2">移除 IKEv2<a class="hash-link" href="#移除-ikev2" title="Direct link to heading">​</a></h2><p>如果你想要从 VPN 服务器移除 IKEv2，但是保留 <a href="/blog/2021/03/06/ipsec-clients-l2tp">IPsec/L2TP</a> 和 <a href="/blog/2021/03/06/ipsec-clients-xauth">IPsec/XAuth ("Cisco IPsec")</a> 模式，请重新运行 <a href="#%E4%BD%BF%E7%94%A8%E8%BE%85%E5%8A%A9%E8%84%9A%E6%9C%AC">辅助脚本</a> 并选择 "Remove IKEv2" 选项。请注意，这将删除所有的 IKEv2 配置（包括证书和密钥），并且<strong>不可撤销</strong>！</p><p>另外，你也可以手动移除 IKEv2。点这里查看步骤。</p><p>要手动从 VPN 服务器移除 IKEv2，但是保留 <a href="/blog/2021/03/06/ipsec-clients-l2tp">IPsec/L2TP</a> 和 <a href="/blog/2021/03/06/ipsec-clients-xauth">IPsec/XAuth ("Cisco IPsec")</a> 模式，按照以下步骤操作。这些命令必须用 <code>root</code> 账户运行。请注意，这将删除所有的 IKEv2 配置（包括证书和密钥），并且<strong>不可撤销</strong>！</p><ol><li><p>重命名（或者删除）IKEv2 配置文件：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> /etc/ipsec.d/ikev2.conf /etc/ipsec.d/ikev2.conf.bak</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>注：</strong> 如果你使用了较旧版本（2020-05-31 之前）的 IKEv2 辅助脚本或者配置说明，文件 <code>/etc/ipsec.d/ikev2.conf</code> 可能不存在。在该情况下，请移除文件 <code>/etc/ipsec.conf</code> 中的 <code>conn ikev2-cp</code> 部分。</p></li><li><p><strong>（重要）重启 IPsec 服务</strong>：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">service</span><span class="token plain"> ipsec restart</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>列出 IPsec 证书数据库中的证书：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">certutil -L -d sql:/etc/ipsec.d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>示例输出：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Certificate Nickname                               Trust Attributes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                   SSL,S/MIME,JAR/XPI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IKEv2 VPN CA                                       CTu,u,u</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">($PUBLIC_IP)                                       u,u,u</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vpnclient                                          u,u,u</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>删除证书和密钥。将下面的 "Nickname" 替换为每个证书的昵称。为每个证书重复这些命令。在完成后，再次列出 IPsec 证书数据库中的证书，并确认列表为空。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">certutil -F -d sql:/etc/ipsec.d -n </span><span class="token string" style="color:#e3116c">"Nickname"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">certutil -D -d sql:/etc/ipsec.d -n </span><span class="token string" style="color:#e3116c">"Nickname"</span><span class="token plain"> </span><span class="token operator file-descriptor important" style="color:#393A34">2</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/dev/null</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="参考链接">参考链接<a class="hash-link" href="#参考链接" title="Direct link to heading">​</a></h2><ul><li><a href="https://libreswan.org/wiki/VPN_server_for_remote_clients_using_IKEv2" target="_blank" rel="noopener noreferrer">https://libreswan.org/wiki/VPN_server_for_remote_clients_using_IKEv2</a></li><li><a href="https://libreswan.org/wiki/HOWTO:_Using_NSS_with_libreswan" target="_blank" rel="noopener noreferrer">https://libreswan.org/wiki/HOWTO:_Using_NSS_with_libreswan</a></li><li><a href="https://libreswan.org/man/ipsec.conf.5.html" target="_blank" rel="noopener noreferrer">https://libreswan.org/man/ipsec.conf.5.html</a></li><li><a href="https://wiki.strongswan.org/projects/strongswan/wiki/WindowsClients" target="_blank" rel="noopener noreferrer">https://wiki.strongswan.org/projects/strongswan/wiki/WindowsClients</a></li><li><a href="https://wiki.strongswan.org/projects/strongswan/wiki/AndroidVpnClient" target="_blank" rel="noopener noreferrer">https://wiki.strongswan.org/projects/strongswan/wiki/AndroidVpnClient</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/NSS/tools/NSS_Tools_certutil" target="_blank" rel="noopener noreferrer">https://developer.mozilla.org/en-US/docs/Mozilla/Projects/NSS/tools/NSS_Tools_certutil</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/NSS/tools/NSS_Tools_crlutil" target="_blank" rel="noopener noreferrer">https://developer.mozilla.org/en-US/docs/Mozilla/Projects/NSS/tools/NSS_Tools_crlutil</a></li></ul><blockquote><p><a href="https://github.com/hwdsl2/setup-ipsec-vpn/blob/master/docs/ikev2-howto-zh.md" target="_blank" rel="noopener noreferrer">原文 - IKEv2 配置和使用指南</a></p></blockquote>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="ipsec" term="ipsec"/>
        <category label="ikev2" term="ikev2"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[配置 IPsec/L2TP 客户端]]></title>
        <id>/2021/03/06/ipsec-clients-l2tp</id>
        <link href="https://blog.alanwei.com/blog/2021/03/06/ipsec-clients-l2tp"/>
        <updated>2021-03-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[在成功 搭建自己的 VPN 服务器 之后，按照下面的步骤来配置你的设备。IPsec/L2TP 在 Android, iOS, OS X 和 Windows 上均受支持，无需安装额外的软件。设置过程通常只需要几分钟。如果无法连接,请首先检查是否输入了正确的登录凭证。]]></summary>
        <content type="html"><![CDATA[<p>在成功 <a href="/blog/2021/03/06/ipsec-server">搭建自己的 VPN 服务器</a> 之后，按照下面的步骤来配置你的设备。IPsec/L2TP 在 Android, iOS, OS X 和 Windows 上均受支持，无需安装额外的软件。设置过程通常只需要几分钟。如果无法连接,请首先检查是否输入了正确的登录凭证。</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>你也可以 <a href="/blog/2021/03/06/ipsec-clients-ikev2">配置 IKEv2</a>（推荐），或者使用更高效的 <a href="/blog/2021/03/06/ipsec-clients-xauth">IPsec/XAuth 模式</a> 连接。</p></div></div><hr><ul><li>平台名称<ul><li><a href="#windows">Windows</a></li><li><a href="#os-x">OS X (macOS)</a></li><li><a href="#android">Android</a></li><li><a href="#ios">iOS (iPhone/iPad)</a></li><li><a href="#chromebook">Chromebook</a></li><li><a href="#linux">Linux</a></li></ul></li><li><a href="#%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4">故障排除</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="windows">Windows<a class="hash-link" href="#windows" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="windows-10-and-8x">Windows 10 and 8.x<a class="hash-link" href="#windows-10-and-8x" title="Direct link to heading">​</a></h3><ol><li>右键单击系统托盘中的无线/网络图标。</li><li>选择 <strong>打开网络和共享中心</strong>。或者，如果你使用 Windows 10 版本 1709 或以上，选择 <strong>打开"网络和 Internet"设置</strong>，然后在打开的页面中单击 <strong>网络和共享中心</strong>。</li><li>单击 <strong>设置新的连接或网络</strong>。</li><li>选择 <strong>连接到工作区</strong>，然后单击 <strong>下一步</strong>。</li><li>单击 <strong>使用我的Internet连接 (VPN)</strong>。</li><li>在 <strong>Internet地址</strong> 字段中输入<code>你的 VPN 服务器 IP</code>。</li><li>在 <strong>目标名称</strong> 字段中输入任意内容。单击 <strong>创建</strong>。</li><li>返回 <strong>网络和共享中心</strong>。单击左侧的 <strong>更改适配器设置</strong>。</li><li>右键单击新创建的 VPN 连接，并选择 <strong>属性</strong>。</li><li>单击 <strong>安全</strong> 选项卡，从 <strong>VPN 类型</strong> 下拉菜单中选择 "使用 IPsec 的第 2 层隧道协议 (L2TP/IPSec)"。</li><li>单击 <strong>允许使用这些协议</strong>。选中 "质询握手身份验证协议 (CHAP)" 和 "Microsoft CHAP 版本 2 (MS-CHAP v2)" 复选框。</li><li>单击 <strong>高级设置</strong> 按钮。</li><li>单击 <strong>使用预共享密钥作身份验证</strong> 并在 <strong>密钥</strong> 字段中输入<code>你的 VPN IPsec PSK</code>。</li><li>单击 <strong>确定</strong> 关闭 <strong>高级设置</strong>。</li><li>单击 <strong>确定</strong> 保存 VPN 连接的详细信息。</li></ol><p><strong>注：</strong> 在首次连接之前需要<a href="#windows-错误-809">修改一次注册表</a>，以解决 VPN 服务器 和/或 客户端与 NAT （比如家用路由器）的兼容问题。</p><p>要连接到 VPN：单击系统托盘中的无线/网络图标，选择新的 VPN 连接，然后单击 <strong>连接</strong>。如果出现提示，在登录窗口中输入 <code>你的 VPN 用户名</code> 和 <code>密码</code> ，并单击 <strong>确定</strong>。最后你可以到 <a href="https://www.ipchicken.com" target="_blank" rel="noopener noreferrer">这里</a> 检测你的 IP 地址，应该显示为<code>你的 VPN 服务器 IP</code>。</p><p>如果在连接过程中遇到错误，请参见 <a href="#故障排除">故障排除</a>。</p><p>另外，除了按照以上步骤操作，你也可以运行下面的 Windows PowerShell 命令来创建 VPN 连接。将 <code>你的 VPN 服务器 IP</code> 和 <code>你的 VPN IPsec PSK</code> 换成你自己的值，用单引号括起来：</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 不保存命令行历史记录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Set-PSReadlineOption –HistorySaveStyle SaveNothing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 创建 VPN 连接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Add-VpnConnection -Name 'My IPsec VPN' -ServerAddress '你的 VPN 服务器 IP' -L2tpPsk '你的 VPN IPsec PSK' -TunnelType L2tp -EncryptionLevel Required -AuthenticationMethod Chap,MSChapv2 -Force -RememberCredential -PassThru</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 忽略 data encryption 警告（数据在 IPsec 隧道中已被加密）</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="windows-7-vista-and-xp">Windows 7, Vista and XP<a class="hash-link" href="#windows-7-vista-and-xp" title="Direct link to heading">​</a></h3><ol><li>单击开始菜单，选择控制面板。</li><li>进入 <strong>网络和Internet</strong> 部分。</li><li>单击 <strong>网络和共享中心</strong>。</li><li>单击 <strong>设置新的连接或网络</strong>。</li><li>选择 <strong>连接到工作区</strong>，然后单击 <strong>下一步</strong>。</li><li>单击 <strong>使用我的Internet连接 (VPN)</strong>。</li><li>在 <strong>Internet地址</strong> 字段中输入<code>你的 VPN 服务器 IP</code>。</li><li>在 <strong>目标名称</strong> 字段中输入任意内容。</li><li>选中 <strong>现在不连接；仅进行设置以便稍后连接</strong> 复选框。</li><li>单击 <strong>下一步</strong>。</li><li>在 <strong>用户名</strong> 字段中输入<code>你的 VPN 用户名</code>。</li><li>在 <strong>密码</strong> 字段中输入<code>你的 VPN 密码</code>。</li><li>选中 <strong>记住此密码</strong> 复选框。</li><li>单击 <strong>创建</strong>，然后单击 <strong>关闭</strong> 按钮。</li><li>返回 <strong>网络和共享中心</strong>。单击左侧的 <strong>更改适配器设置</strong>。</li><li>右键单击新创建的 VPN 连接，并选择 <strong>属性</strong>。</li><li>单击 <strong>选项</strong> 选项卡，取消选中 <strong>包括Windows登录域</strong> 复选框。</li><li>单击 <strong>安全</strong> 选项卡，从 <strong>VPN 类型</strong> 下拉菜单中选择 "使用 IPsec 的第 2 层隧道协议 (L2TP/IPSec)"。</li><li>单击 <strong>允许使用这些协议</strong>。选中 "质询握手身份验证协议 (CHAP)" 和 "Microsoft CHAP 版本 2 (MS-CHAP v2)" 复选框。</li><li>单击 <strong>高级设置</strong> 按钮。</li><li>单击 <strong>使用预共享密钥作身份验证</strong> 并在 <strong>密钥</strong> 字段中输入<code>你的 VPN IPsec PSK</code>。</li><li>单击 <strong>确定</strong> 关闭 <strong>高级设置</strong>。</li><li>单击 <strong>确定</strong> 保存 VPN 连接的详细信息。</li></ol><p><strong>注：</strong> 在首次连接之前需要<a href="#windows-错误-809">修改一次注册表</a>，以解决 VPN 服务器 和/或 客户端与 NAT （比如家用路由器）的兼容问题。</p><p>要连接到 VPN：单击系统托盘中的无线/网络图标，选择新的 VPN 连接，然后单击 <strong>连接</strong>。如果出现提示，在登录窗口中输入 <code>你的 VPN 用户名</code> 和 <code>密码</code> ，并单击 <strong>确定</strong>。最后你可以到 <a href="https://www.ipchicken.com" target="_blank" rel="noopener noreferrer">这里</a> 检测你的 IP 地址，应该显示为<code>你的 VPN 服务器 IP</code>。</p><p>如果在连接过程中遇到错误，请参见 <a href="#故障排除">故障排除</a>。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="os-x">OS X<a class="hash-link" href="#os-x" title="Direct link to heading">​</a></h2><ol><li>打开系统偏好设置并转到网络部分。</li><li>在窗口左下角单击 <strong>+</strong> 按钮。</li><li>从 <strong>接口</strong> 下拉菜单选择 <strong>VPN</strong>。</li><li>从 <strong>VPN类型</strong> 下拉菜单选择 <strong>IPSec 上的 L2TP</strong>。</li><li>在 <strong>服务名称</strong> 字段中输入任意内容。</li><li>单击 <strong>创建</strong>。</li><li>在 <strong>服务器地址</strong> 字段中输入<code>你的 VPN 服务器 IP</code>。</li><li>在 <strong>帐户名称</strong> 字段中输入<code>你的 VPN 用户名</code>。</li><li>单击 <strong>认证设置</strong> 按钮。</li><li>在 <strong>用户认证</strong> 部分，选择 <strong>密码</strong> 单选按钮，然后输入<code>你的 VPN 密码</code>。</li><li>在 <strong>机器认证</strong> 部分，选择 <strong>共享的密钥</strong> 单选按钮，然后输入<code>你的 VPN IPsec PSK</code>。</li><li>保持 <strong>群组名称</strong> 字段空白。</li><li>单击 <strong>好</strong>。</li><li>选中 <strong>在菜单栏中显示 VPN 状态</strong> 复选框。</li><li><strong>（重要）</strong> 单击 <strong>高级</strong> 按钮，并选中 <strong>通过VPN连接发送所有通信</strong> 复选框。</li><li><strong>（重要）</strong> 单击 <strong>TCP/IP</strong> 选项卡，并在 <strong>配置IPv6</strong> 部分中选择 <strong>仅本地链接</strong>。</li><li>单击 <strong>好</strong> 关闭高级设置，然后单击 <strong>应用</strong> 保存VPN连接信息。</li></ol><p>要连接到 VPN：使用菜单栏中的图标，或者打开系统偏好设置的网络部分，选择 VPN 并单击 <strong>连接</strong>。最后你可以到 <a href="https://www.ipchicken.com" target="_blank" rel="noopener noreferrer">这里</a> 检测你的 IP 地址，应该显示为<code>你的 VPN 服务器 IP</code>。</p><p>如果在连接过程中遇到错误，请参见 <a href="#故障排除">故障排除</a>。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="android">Android<a class="hash-link" href="#android" title="Direct link to heading">​</a></h2><ol><li>启动 <strong>设置</strong> 应用程序。</li><li>单击 <strong>网络和互联网</strong>。或者，如果你使用 Android 7 或更早版本，在 <strong>无线和网络</strong> 部分单击 <strong>更多...</strong>。</li><li>单击 <strong>VPN</strong>。</li><li>单击 <strong>添加VPN配置文件</strong> 或窗口右上角的 <strong>+</strong>。</li><li>在 <strong>名称</strong> 字段中输入任意内容。</li><li>在 <strong>类型</strong> 下拉菜单选择 <strong>L2TP/IPSec PSK</strong>。</li><li>在 <strong>服务器地址</strong> 字段中输入<code>你的 VPN 服务器 IP</code>。</li><li>保持 <strong>L2TP 密钥</strong> 字段空白。</li><li>保持 <strong>IPSec 标识符</strong> 字段空白。</li><li>在 <strong>IPSec 预共享密钥</strong> 字段中输入<code>你的 VPN IPsec PSK</code>。</li><li>单击 <strong>保存</strong>。</li><li>单击新的VPN连接。</li><li>在 <strong>用户名</strong> 字段中输入<code>你的 VPN 用户名</code>。</li><li>在 <strong>密码</strong> 字段中输入<code>你的 VPN 密码</code>。</li><li>选中 <strong>保存帐户信息</strong> 复选框。</li><li>单击 <strong>连接</strong>。</li></ol><p>VPN 连接成功后，会在通知栏显示图标。最后你可以到 <a href="https://www.ipchicken.com" target="_blank" rel="noopener noreferrer">这里</a> 检测你的 IP 地址，应该显示为<code>你的 VPN 服务器 IP</code>。</p><p>如果在连接过程中遇到错误，请参见 <a href="#故障排除">故障排除</a>。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ios">iOS<a class="hash-link" href="#ios" title="Direct link to heading">​</a></h2><ol><li>进入设置 -&gt; 通用 -&gt; VPN。</li><li>单击 <strong>添加VPN配置...</strong>。</li><li>单击 <strong>类型</strong> 。选择 <strong>L2TP</strong> 并返回。</li><li>在 <strong>描述</strong> 字段中输入任意内容。</li><li>在 <strong>服务器</strong> 字段中输入<code>你的 VPN 服务器 IP</code>。</li><li>在 <strong>帐户</strong> 字段中输入<code>你的 VPN 用户名</code>。</li><li>在 <strong>密码</strong> 字段中输入<code>你的 VPN 密码</code>。</li><li>在 <strong>密钥</strong> 字段中输入<code>你的 VPN IPsec PSK</code>。</li><li>启用 <strong>发送所有流量</strong> 选项。</li><li>单击右上角的 <strong>完成</strong>。</li><li>启用 <strong>VPN</strong> 连接。</li></ol><p>VPN 连接成功后，会在通知栏显示图标。最后你可以到 <a href="https://www.ipchicken.com" target="_blank" rel="noopener noreferrer">这里</a> 检测你的 IP 地址，应该显示为<code>你的 VPN 服务器 IP</code>。</p><p>如果在连接过程中遇到错误，请参见 <a href="#故障排除">故障排除</a>。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="chromebook">Chromebook<a class="hash-link" href="#chromebook" title="Direct link to heading">​</a></h2><ol><li>如果你尚未登录 Chromebook，请先登录。</li><li>单击状态区（其中显示你的帐户头像）。</li><li>单击 <strong>设置</strong>。</li><li>在 <strong>互联网连接</strong> 部分，单击 <strong>添加连接</strong>。</li><li>单击 <strong>添加 OpenVPN / L2TP</strong>。</li><li>在 <strong>服务器主机名</strong> 字段中输入<code>你的 VPN 服务器 IP</code>。</li><li>在 <strong>服务名称</strong> 字段中输入任意内容。</li><li>在 <strong>供应商类型</strong> 下拉菜单选择 <strong>L2TP/IPsec + 预共享密钥</strong>。</li><li>在 <strong>预共享密钥</strong> 字段中输入<code>你的 VPN IPsec PSK</code>。</li><li>在 <strong>用户名</strong> 字段中输入<code>你的 VPN 用户名</code>。</li><li>在 <strong>密码</strong> 字段中输入<code>你的 VPN 密码</code>。</li><li>单击 <strong>连接</strong>。</li></ol><p>VPN 连接成功后，网络状态图标上会出现 VPN 指示。最后你可以到 <a href="https://www.ipchicken.com" target="_blank" rel="noopener noreferrer">这里</a> 检测你的 IP 地址，应该显示为<code>你的 VPN 服务器 IP</code>。</p><p>如果在连接过程中遇到错误，请参见 <a href="#故障排除">故障排除</a>。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="linux">Linux<a class="hash-link" href="#linux" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ubuntu-linux">Ubuntu Linux<a class="hash-link" href="#ubuntu-linux" title="Direct link to heading">​</a></h3><p>Ubuntu 18.04 和更新版本用户可以使用 <code>apt</code> 安装 <a href="https://packages.ubuntu.com/search?keywords=network-manager-l2tp-gnome" target="_blank" rel="noopener noreferrer">network-manager-l2tp-gnome</a> 软件包，然后通过 GUI 配置 IPsec/L2TP VPN 客户端。Ubuntu 16.04 用户可能需要添加 <code>nm-l2tp</code> PPA，参见 <a href="https://medium.com/@hkdb/ubuntu-16-04-connecting-to-l2tp-over-ipsec-via-network-manager-204b5d475721" target="_blank" rel="noopener noreferrer">这里</a>。</p><ol><li>进入 Settings -&gt; Network -&gt; VPN。单击 <strong>+</strong> 按钮。</li><li>选择 <strong>Layer 2 Tunneling Protocol (L2TP)</strong>。</li><li>在 <strong>Name</strong> 字段中输入任意内容。</li><li>在 <strong>Gateway</strong> 字段中输入<code>你的 VPN 服务器 IP</code>。</li><li>在 <strong>User name</strong> 字段中输入<code>你的 VPN 用户名</code>。</li><li>右键单击 <strong>Password</strong> 字段中的 <strong>?</strong>，选择 <strong>Store the password only for this user</strong>。</li><li>在 <strong>Password</strong> 字段中输入<code>你的 VPN 密码</code>。</li><li>保持 <strong>NT Domain</strong> 字段空白。</li><li>单击 <strong>IPsec Settings...</strong> 按钮。</li><li>选中 <strong>Enable IPsec tunnel to L2TP host</strong> 复选框。</li><li>保持 <strong>Gateway ID</strong> 字段空白。</li><li>在 <strong>Pre-shared key</strong> 字段中输入<code>你的 VPN IPsec PSK</code>。</li><li>展开 <strong>Advanced</strong> 部分。</li><li>在 <strong>Phase1 Algorithms</strong> 字段中输入 <code>aes128-sha1-modp2048</code>。</li><li>在 <strong>Phase2 Algorithms</strong> 字段中输入 <code>aes128-sha1</code>。</li><li>单击 <strong>OK</strong>，然后单击 <strong>Add</strong> 保存 VPN 连接信息。</li><li>启用 <strong>VPN</strong> 连接。</li></ol><p>VPN 连接成功后，你可以到 <a href="https://www.ipchicken.com" target="_blank" rel="noopener noreferrer">这里</a> 检测你的 IP 地址，应该显示为<code>你的 VPN 服务器 IP</code>。</p><p>如果在连接过程中遇到错误，请尝试 <a href="https://github.com/nm-l2tp/NetworkManager-l2tp/blob/master/README.md#issue-with-not-stopping-system-xl2tpd-service" target="_blank" rel="noopener noreferrer">这个解决方案</a>。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="fedora-和-centos">Fedora 和 CentOS<a class="hash-link" href="#fedora-和-centos" title="Direct link to heading">​</a></h3><p>Fedora 28 （和更新版本）和 CentOS 8/7 用户可以使用更高效的 <a href="/blog/2021/03/06/ipsec-clients-xauth#linux">IPsec/XAuth</a> 模式连接。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="其它-linux">其它 Linux<a class="hash-link" href="#其它-linux" title="Direct link to heading">​</a></h3><p>首先看 <a href="https://github.com/nm-l2tp/NetworkManager-l2tp/wiki/Prebuilt-Packages" target="_blank" rel="noopener noreferrer">这里</a> 以确认 <code>network-manager-l2tp</code> 和 <code>network-manager-l2tp-gnome</code> 软件包是否在你的 Linux 版本上可用。如果可用，安装它们（选择使用 strongSwan）并参见上面的说明。另外，你也可以 <a href="#%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E9%85%8D%E7%BD%AE-linux-vpn-%E5%AE%A2%E6%88%B7%E7%AB%AF">使用命令行配置 Linux VPN 客户端</a>。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="故障排除">故障排除<a class="hash-link" href="#故障排除" title="Direct link to heading">​</a></h2><ul><li><a href="#windows">Windows</a><ul><li><a href="#windows-10-and-8x">Windows 10 and 8.x</a></li><li><a href="#windows-7-vista-and-xp">Windows 7, Vista and XP</a></li></ul></li><li><a href="#os-x">OS X</a></li><li><a href="#android">Android</a></li><li><a href="#ios">iOS</a></li><li><a href="#chromebook">Chromebook</a></li><li><a href="#linux">Linux</a><ul><li><a href="#ubuntu-linux">Ubuntu Linux</a></li><li><a href="#fedora-%E5%92%8C-centos">Fedora 和 CentOS</a></li><li><a href="#%E5%85%B6%E5%AE%83-linux">其它 Linux</a></li></ul></li><li><a href="#%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4">故障排除</a><ul><li><a href="#windows-%E9%94%99%E8%AF%AF-809">Windows 错误 809</a></li><li><a href="#windows-%E9%94%99%E8%AF%AF-628-%E6%88%96-766">Windows 错误 628 或 766</a></li><li><a href="#windows-10-%E6%AD%A3%E5%9C%A8%E8%BF%9E%E6%8E%A5">Windows 10 正在连接</a></li><li><a href="#windows-10-%E5%8D%87%E7%BA%A7">Windows 10 升级</a></li><li><a href="#windows-810-dns-%E6%B3%84%E6%BC%8F">Windows 8/10 DNS 泄漏</a></li><li><a href="#android-mtumss-%E9%97%AE%E9%A2%98">Android MTU/MSS 问题</a></li><li><a href="#android-6-%E5%92%8C-7">Android 6 和 7</a></li><li><a href="#macos-%E9%80%9A%E8%BF%87-vpn-%E5%8F%91%E9%80%81%E9%80%9A%E4%BF%A1">macOS 通过 VPN 发送通信</a></li><li><a href="#ios-1314-%E5%92%8C-macos-101511">iOS 13/14 和 macOS 10.15/11</a></li><li><a href="#iosandroid-%E7%9D%A1%E7%9C%A0%E6%A8%A1%E5%BC%8F">iOS/Android 睡眠模式</a></li><li><a href="#debian-10-%E5%86%85%E6%A0%B8">Debian 10 内核</a></li><li><a href="#chromebook-%E8%BF%9E%E6%8E%A5%E9%97%AE%E9%A2%98">Chromebook 连接问题</a></li><li><a href="#%E5%85%B6%E5%AE%83%E9%94%99%E8%AF%AF">其它错误</a></li><li><a href="#%E6%A3%80%E6%9F%A5%E6%97%A5%E5%BF%97%E5%8F%8A-vpn-%E7%8A%B6%E6%80%81">检查日志及 VPN 状态</a></li></ul></li><li><a href="#%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E9%85%8D%E7%BD%AE-linux-vpn-%E5%AE%A2%E6%88%B7%E7%AB%AF">使用命令行配置 Linux VPN 客户端</a></li><li><a href="#%E8%87%B4%E8%B0%A2">致谢</a></li><li><a href="#%E6%8E%88%E6%9D%83%E5%8D%8F%E8%AE%AE">授权协议</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="windows-错误-809">Windows 错误 809<a class="hash-link" href="#windows-错误-809" title="Direct link to heading">​</a></h3><blockquote><p>错误 809：无法建立计算机与 VPN 服务器之间的网络连接，因为远程服务器未响应。这可能是因为未将计算机与远程服务器之间的某种网络设备(如防火墙、NAT、路由器等)配置为允许 VPN 连接。请与管理员或服务提供商联系以确定哪种设备可能产生此问题。</p></blockquote><p>要解决此错误，在首次连接之前需要<a href="https://documentation.meraki.com/MX-Z/Client_VPN/Troubleshooting_Client_VPN#Windows_Error_809" target="_blank" rel="noopener noreferrer">修改一次注册表</a>，以解决 VPN 服务器 和/或 客户端与 NAT （比如家用路由器）的兼容问题。请下载并导入下面的 <code>.reg</code> 文件，或者打开 <a href="http://www.cnblogs.com/xxcanghai/p/4610054.html" target="_blank" rel="noopener noreferrer">提升权限命令提示符</a> 并运行以下命令。<strong>完成后必须重启计算机。</strong></p><ul><li><p>适用于 Windows Vista, 7, 8.x 和 10 (<a href="https://dl.ls20.com/reg-files/v1/Fix_VPN_Error_809_Windows_Vista_7_8_10_Reboot_Required.reg" target="_blank" rel="noopener noreferrer">下载 .reg 文件</a>)</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">REG ADD HKLM\SYSTEM\CurrentControlSet\Services\PolicyAgent /v AssumeUDPEncapsulationContextOnSendRule /t REG_DWORD /d 0x2 /f</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>仅适用于 Windows XP (<a href="https://dl.ls20.com/reg-files/v1/Fix_VPN_Error_809_Windows_XP_ONLY_Reboot_Required.reg" target="_blank" rel="noopener noreferrer">下载 .reg 文件</a>)</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">REG ADD HKLM\SYSTEM\CurrentControlSet\Services\IPSec /v AssumeUDPEncapsulationContextOnSendRule /t REG_DWORD /d 0x2 /f</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><p>另外，某些个别的 Windows 系统配置禁用了 IPsec 加密，此时也会导致连接失败。要重新启用它，可以运行以下命令并重启。</p><ul><li><p>适用于 Windows XP, Vista, 7, 8.x 和 10 (<a href="https://dl.ls20.com/reg-files/v1/Fix_VPN_Error_809_Allow_IPsec_Reboot_Required.reg" target="_blank" rel="noopener noreferrer">下载 .reg 文件</a>)</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">REG ADD HKLM\SYSTEM\CurrentControlSet\Services\RasMan\Parameters /v ProhibitIpSec /t REG_DWORD /d 0x0 /f</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="windows-错误-628-或-766">Windows 错误 628 或 766<a class="hash-link" href="#windows-错误-628-或-766" title="Direct link to heading">​</a></h3><blockquote><p>错误 628：在连接完成前，连接被远程计算机终止。</p></blockquote><blockquote><p>错误 766：找不到证书。使用通过 IPSec 的 L2TP 协议的连接要求安装一个机器证书。它也叫做计算机证书。</p></blockquote><p>要解决这些错误，请按以下步骤操作：</p><ol><li>右键单击系统托盘中的无线/网络图标。</li><li>选择 <strong>打开网络和共享中心</strong>。或者，如果你使用 Windows 10 版本 1709 或以上，选择 <strong>打开"网络和 Internet"设置</strong>，然后在打开的页面中单击 <strong>网络和共享中心</strong>。</li><li>单击左侧的 <strong>更改适配器设置</strong>。右键单击新的 VPN 连接，并选择 <strong>属性</strong>。</li><li>单击 <strong>安全</strong> 选项卡，从 <strong>VPN 类型</strong> 下拉菜单中选择 "使用 IPsec 的第 2 层隧道协议 (L2TP/IPSec)"。</li><li>单击 <strong>允许使用这些协议</strong>。选中 "质询握手身份验证协议 (CHAP)" 和 "Microsoft CHAP 版本 2 (MS-CHAP v2)" 复选框。</li><li>单击 <strong>高级设置</strong> 按钮。</li><li>单击 <strong>使用预共享密钥作身份验证</strong> 并在 <strong>密钥</strong> 字段中输入<code>你的 VPN IPsec PSK</code>。</li><li>单击 <strong>确定</strong> 关闭 <strong>高级设置</strong>。</li><li>单击 <strong>确定</strong> 保存 VPN 连接的详细信息。</li></ol><p><img loading="lazy" src="https://raw.githubusercontent.com/hwdsl2/setup-ipsec-vpn/master/docs/images/vpn-properties-zh.png" alt="Select CHAP in VPN connection properties" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="windows-10-正在连接">Windows 10 正在连接<a class="hash-link" href="#windows-10-正在连接" title="Direct link to heading">​</a></h3><p>如果你使用 Windows 10 并且 VPN 卡在 "正在连接" 状态超过几分钟，尝试以下步骤：</p><ol><li>右键单击系统托盘中的无线/网络图标。</li><li>选择 <strong>打开"网络和 Internet"设置</strong>，然后在打开的页面中单击左侧的 <strong>VPN</strong>。</li><li>选择新的 VPN 连接，然后单击 <strong>连接</strong>。如果出现提示，在登录窗口中输入 <code>你的 VPN 用户名</code> 和 <code>密码</code> ，并单击 <strong>确定</strong>。</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="windows-10-升级">Windows 10 升级<a class="hash-link" href="#windows-10-升级" title="Direct link to heading">​</a></h3><p>在升级 Windows 10 版本之后 （比如从 1709 到 1803），你可能需要重新按照上面的 <a href="#windows-%E9%94%99%E8%AF%AF-809">Windows 错误 809</a> 中的步骤修改注册表并重启。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="windows-810-dns-泄漏">Windows 8/10 DNS 泄漏<a class="hash-link" href="#windows-810-dns-泄漏" title="Direct link to heading">​</a></h3><p>Windows 8.x 和 10 默认使用 "smart multi-homed name resolution" （智能多宿主名称解析）。如果你的因特网适配器的 DNS 服务器在本地网段上，在使用 Windows 自带的 IPsec VPN 客户端时可能会导致 "DNS 泄漏"。要解决这个问题，你可以 <a href="https://www.neowin.net/news/guide-prevent-dns-leakage-while-using-a-vpn-on-windows-10-and-windows-8/" target="_blank" rel="noopener noreferrer">禁用智能多宿主名称解析</a>，或者配置你的因特网适配器以使用在你的本地网段之外的 DNS 服务器（比如 8.8.8.8 和 8.8.4.4）。在完成后<a href="https://support.opendns.com/hc/en-us/articles/227988627-How-to-clear-the-DNS-Cache-" target="_blank" rel="noopener noreferrer">清除 DNS 缓存</a>并且重启计算机。</p><p>另外，如果你的计算机启用了 IPv6，所有的 IPv6 流量（包括 DNS 请求）都将绕过 VPN。要在 Windows 上禁用 IPv6，请看<a href="https://support.microsoft.com/zh-cn/help/929852/guidance-for-configuring-ipv6-in-windows-for-advanced-users" target="_blank" rel="noopener noreferrer">这里</a>。如果你需要支持 IPv6 的 VPN，你可以另外尝试 <a href="https://github.com/Nyr/openvpn-install" target="_blank" rel="noopener noreferrer">OpenVPN</a>。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="android-mtumss-问题">Android MTU/MSS 问题<a class="hash-link" href="#android-mtumss-问题" title="Direct link to heading">​</a></h3><p>某些 Android 设备有 MTU/MSS 问题，表现为使用 IPsec/XAuth ("Cisco IPsec") 模式可以连接到 VPN 但是无法打开网站。如果你遇到该问题，尝试在 VPN 服务器上运行以下命令。如果成功解决，你可以将这些命令添加到 <code>/etc/rc.local</code> 以使它们重启后继续有效。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iptables -t mangle -A FORWARD -m policy --pol ipsec --dir </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -p tcp -m tcp --tcp-flags SYN,RST SYN -m tcpmss --mss </span><span class="token number" style="color:#36acaa">1361</span><span class="token plain">:1536 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -j TCPMSS --set-mss </span><span class="token number" style="color:#36acaa">1360</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -t mangle -A FORWARD -m policy --pol ipsec --dir out </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -p tcp -m tcp --tcp-flags SYN,RST SYN -m tcpmss --mss </span><span class="token number" style="color:#36acaa">1361</span><span class="token plain">:1536 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -j TCPMSS --set-mss </span><span class="token number" style="color:#36acaa">1360</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /proc/sys/net/ipv4/ip_no_pmtu_disc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Docker 用户：</strong> 要修复这个问题，不需要运行以上命令。你可以在<a href="https://github.com/hwdsl2/docker-ipsec-vpn-server/blob/master/README-zh.md#如何使用本镜像" target="_blank" rel="noopener noreferrer">你的 env 文件</a>中添加 <code>VPN_ANDROID_MTU_FIX=yes</code>，然后重新创建 Docker 容器。</p><p>参考链接：<a href="https://wiki.strongswan.org/projects/strongswan/wiki/ForwardingAndSplitTunneling#MTUMSS-issues" target="_blank" rel="noopener noreferrer">[1]</a> <a href="https://www.zeitgeist.se/2013/11/26/mtu-woes-in-ipsec-tunnels-how-to-fix/" target="_blank" rel="noopener noreferrer">[2]</a>。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="android-6-和-7">Android 6 和 7<a class="hash-link" href="#android-6-和-7" title="Direct link to heading">​</a></h3><p>如果你的 Android 6.x 或者 7.x 设备无法连接，请尝试以下步骤：</p><ol><li>单击 VPN 连接旁边的设置按钮，选择 "Show advanced options" 并且滚动到底部。如果选项 "Backward compatible mode" 存在（看下图），请启用它并重试连接。如果不存在，请尝试下一步。</li><li>编辑 VPN 服务器上的 <code>/etc/ipsec.conf</code>。找到 <code>sha2-truncbug</code> 一行并切换它的值。也就是说，将 <code>sha2-truncbug=no</code> 替换为 <code>sha2-truncbug=yes</code>，或者将 <code>sha2-truncbug=yes</code> 替换为 <code>sha2-truncbug=no</code>。保存修改并运行 <code>service ipsec restart</code>。然后重新连接 VPN。</li></ol><p><strong>Docker 用户：</strong> 如需在 <code>/etc/ipsec.conf</code> 中设置 <code>sha2-truncbug=yes</code>（默认为 <code>no</code>），你可以在<a href="https://github.com/hwdsl2/docker-ipsec-vpn-server/blob/master/README-zh.md#如何使用本镜像" target="_blank" rel="noopener noreferrer">你的 env 文件</a>中添加 <code>VPN_SHA2_TRUNCBUG=yes</code>，然后重新创建 Docker 容器。</p><p><img loading="lazy" src="https://raw.githubusercontent.com/hwdsl2/setup-ipsec-vpn/master/docs/images/vpn-profile-Android.png" alt="Android VPN workaround" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="macos-通过-vpn-发送通信">macOS 通过 VPN 发送通信<a class="hash-link" href="#macos-通过-vpn-发送通信" title="Direct link to heading">​</a></h3><p>OS X (macOS) 用户： 如果可以成功地使用 IPsec/L2TP 模式连接，但是你的公有 IP 没有显示为 <code>你的 VPN 服务器 IP</code>，请阅读上面的 <a href="#os-x">OS X</a> 部分并完成以下步骤。保存 VPN 配置然后重新连接。</p><ol><li>单击 <strong>高级</strong> 按钮，并选中 <strong>通过VPN连接发送所有通信</strong> 复选框。</li><li>单击 <strong>TCP/IP</strong> 选项卡，并在 <strong>配置IPv6</strong> 部分中选择 <strong>仅本地链接</strong>。</li></ol><p>如果在尝试上面步骤之后，你的计算机仍然不能通过 VPN 连接发送通信，检查一下服务顺序。进入系统偏好设置中的网络部分，单击左侧连接列表下方的齿轮按钮，选择 "设定服务顺序"。然后将 VPN 连接拖动到顶端。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ios-1314-和-macos-101511">iOS 13/14 和 macOS 10.15/11<a class="hash-link" href="#ios-1314-和-macos-101511" title="Direct link to heading">​</a></h3><p>如果你的 iOS 13/14, macOS 10.15 (Catalina) 或者 macOS 11 (Big Sur) 设备无法连接，请尝试以下步骤：编辑 VPN 服务器上的 <code>/etc/ipsec.conf</code>。找到 <code>sha2-truncbug=yes</code> 并将它替换为 <code>sha2-truncbug=no</code>。保存修改并运行 <code>service ipsec restart</code>。然后重新连接 VPN。</p><p>另外，macOS Big Sur 11.0 用户应该更新到版本 11.1 或以上，以修复 VPN 连接的某些问题。要检查 macOS 版本并安装更新，请看<a href="https://www.businessinsider.com/how-to-check-mac-os-version" target="_blank" rel="noopener noreferrer">这里</a>。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="iosandroid-睡眠模式">iOS/Android 睡眠模式<a class="hash-link" href="#iosandroid-睡眠模式" title="Direct link to heading">​</a></h3><p>为了节约电池，iOS 设备 (iPhone/iPad) 在屏幕变黑（睡眠模式）之后不久就会自动断开 Wi-Fi 连接。这会导致 IPsec VPN 断开。该行为是被 <a href="https://discussions.apple.com/thread/2333948" target="_blank" rel="noopener noreferrer">故意设计的</a> 并且不能被配置。</p><p>如果需要 VPN 在设备唤醒后自动重连，你可以 <a href="/blog/2021/03/06/ipsec-clients-ikev2">配置 IKEv2</a> 并启用 "VPN On Demand" 功能。或者你也可以另外尝试使用 <a href="https://github.com/Nyr/openvpn-install" target="_blank" rel="noopener noreferrer">OpenVPN</a>，它支持 <a href="https://docs.openvpn.net/connecting/connecting-to-access-server-with-apple-ios/faq-regarding-openvpn-connect-ios/" target="_blank" rel="noopener noreferrer">一些选项</a> 比如 "Reconnect on Wakeup" 和 "Seamless Tunnel"。</p><p>Android 设备在进入睡眠模式不久后也会断开 Wi-Fi 连接，如果你没有启用选项 "睡眠期间保持 WLAN 开启" 的话。该选项在 Android 8 (Oreo) 和更新版本中不再可用。另外，你也可以尝试打开 "始终开启 VPN" 选项以保持连接。详情请看 <a href="https://support.google.com/android/answer/9089766?hl=zh-Hans" target="_blank" rel="noopener noreferrer">这里</a>。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="debian-10-内核">Debian 10 内核<a class="hash-link" href="#debian-10-内核" title="Direct link to heading">​</a></h3><p>Debian 10 用户：运行 <code>uname -r</code> 以检查你的服务器的 Linux 内核版本。如果它包含 <code>cloud</code> 字样，并且 <code>/dev/ppp</code> 不存在，则该内核缺少 <code>ppp</code> 支持从而不能使用 IPsec/L2TP 模式。VPN 安装脚本会尝试检测此情形，并显示错误。</p><p>要解决此问题，你可以换用标准的 Linux 内核，通过安装比如 <code>linux-image-amd64</code> 软件包来实现。然后更新 GRUB 的内核默认值并重启服务器。最后重新运行 VPN 安装脚本。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="chromebook-连接问题">Chromebook 连接问题<a class="hash-link" href="#chromebook-连接问题" title="Direct link to heading">​</a></h3><p>Chromebook 用户： 如果你无法连接，请尝试以下步骤：编辑 VPN 服务器上的 <code>/etc/ipsec.conf</code>。找到这一行 <code>phase2alg=...</code> 并在结尾加上 <code>,aes_gcm-null</code> 。保存修改并运行 <code>service ipsec restart</code>。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="其它错误">其它错误<a class="hash-link" href="#其它错误" title="Direct link to heading">​</a></h3><p>如果你遇到其它错误，请参见以下链接：</p><ul><li><a href="http://www.tp-link.com/en/faq-1029.html" target="_blank" rel="noopener noreferrer">http://www.tp-link.com/en/faq-1029.html</a></li><li><a href="https://documentation.meraki.com/MX-Z/Client_VPN/Troubleshooting_Client_VPN#Common_Connection_Issues" target="_blank" rel="noopener noreferrer">https://documentation.meraki.com/MX-Z/Client_VPN/Troubleshooting_Client_VPN#Common_Connection_Issues</a>   </li><li><a href="https://stackoverflow.com/questions/25245854/windows-8-1-gets-error-720-on-connect-vpn" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/25245854/windows-8-1-gets-error-720-on-connect-vpn</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="检查日志及-vpn-状态">检查日志及 VPN 状态<a class="hash-link" href="#检查日志及-vpn-状态" title="Direct link to heading">​</a></h3><p>以下命令需要使用 <code>root</code> 账户（或者 <code>sudo</code>）运行。</p><p>首先，重启 VPN 服务器上的相关服务：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">service</span><span class="token plain"> ipsec restart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">service</span><span class="token plain"> xl2tpd restart</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Docker 用户：</strong> 运行 <code>docker restart ipsec-vpn-server</code>。</p><p>然后重启你的 VPN 客户端设备，并重试连接。如果仍然无法连接，可以尝试删除并重新创建 VPN 连接，按照本文档中的步骤操作。请确保输入了正确的 VPN 登录凭证。</p><p>检查 Libreswan (IPsec) 和 xl2tpd 日志是否有错误：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Ubuntu &amp; Debian</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> pluto /var/log/auth.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> xl2tpd /var/log/syslog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># CentOS/RHEL &amp; Amazon Linux 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> pluto /var/log/secure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> xl2tpd /var/log/messages</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>查看 IPsec VPN 服务器状态：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ipsec status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ipsec verify</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>显示当前已建立的 VPN 连接：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ipsec whack --trafficstatus</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用命令行配置-linux-vpn-客户端">使用命令行配置 Linux VPN 客户端<a class="hash-link" href="#使用命令行配置-linux-vpn-客户端" title="Direct link to heading">​</a></h2><p>在成功 <a href="/blog/2021/03/06/ipsec-server">搭建自己的 VPN 服务器</a> 之后，按照下面的步骤来使用命令行配置 Linux VPN 客户端。另外，你也可以 <a href="#linux">使用图形界面</a> 配置。以下步骤是基于 <a href="https://gist.github.com/psanford/42c550a1a6ad3cb70b13e4aaa94ddb1c" target="_blank" rel="noopener noreferrer">Peter Sanford 的工作</a>。这些命令必须在你的 VPN 客户端上使用 <code>root</code> 账户运行。</p><p>要配置 VPN 客户端，首先安装以下软件包：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Ubuntu &amp; Debian</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> -y </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> strongswan xl2tpd net-tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># CentOS &amp; RHEL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum -y </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> epel-release</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum --enablerepo</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">epel -y </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> strongswan xl2tpd net-tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Fedora</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum -y </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> strongswan xl2tpd net-tools</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>创建 VPN 变量 （替换为你自己的值）：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">VPN_SERVER_IP</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'你的VPN服务器IP'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">VPN_IPSEC_PSK</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'你的IPsec预共享密钥'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">VPN_USER</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'你的VPN用户名'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">VPN_PASSWORD</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'你的VPN密码'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>配置 strongSwan：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /etc/ipsec.conf </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"># ipsec.conf - strongSwan IPsec configuration file</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">conn myvpn</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  auto=add</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  keyexchange=ikev1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  authby=secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  type=transport</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  left=%defaultroute</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  leftprotoport=17/1701</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  rightprotoport=17/1701</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  right=</span><span class="token string variable" style="color:#36acaa">$VPN_SERVER_IP</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  ike=aes128-sha1-modp2048</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  esp=aes128-sha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /etc/ipsec.secrets </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">: PSK "</span><span class="token string variable" style="color:#36acaa">$VPN_IPSEC_PSK</span><span class="token string" style="color:#e3116c">"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">600</span><span class="token plain"> /etc/ipsec.secrets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># For CentOS/RHEL &amp; Fedora ONLY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> /etc/strongswan/ipsec.conf /etc/strongswan/ipsec.conf.old </span><span class="token operator file-descriptor important" style="color:#393A34">2</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> /etc/strongswan/ipsec.secrets /etc/strongswan/ipsec.secrets.old </span><span class="token operator file-descriptor important" style="color:#393A34">2</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ln</span><span class="token plain"> -s /etc/ipsec.conf /etc/strongswan/ipsec.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ln</span><span class="token plain"> -s /etc/ipsec.secrets /etc/strongswan/ipsec.secrets</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>配置 xl2tpd：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /etc/xl2tpd/xl2tpd.conf </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[lac myvpn]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">lns = </span><span class="token string variable" style="color:#36acaa">$VPN_SERVER_IP</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ppp debug = yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">pppoptfile = /etc/ppp/options.l2tpd.client</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">length bit = yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /etc/ppp/options.l2tpd.client </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ipcp-accept-local</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ipcp-accept-remote</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">refuse-eap</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">require-chap</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">noccp</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">noauth</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">mtu 1280</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">mru 1280</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">noipdefault</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">defaultroute</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">usepeerdns</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">connect-delay 5000</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">name "</span><span class="token string variable" style="color:#36acaa">$VPN_USER</span><span class="token string" style="color:#e3116c">"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">password "</span><span class="token string variable" style="color:#36acaa">$VPN_PASSWORD</span><span class="token string" style="color:#e3116c">"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">600</span><span class="token plain"> /etc/ppp/options.l2tpd.client</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>至此 VPN 客户端配置已完成。按照下面的步骤进行连接。</p><p><strong>注：</strong> 当你每次尝试连接到 VPN 时，必须重复下面的所有步骤。</p><p>创建 xl2tpd 控制文件：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> -p /var/run/xl2tpd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">touch</span><span class="token plain"> /var/run/xl2tpd/l2tp-control</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>重启服务：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">service</span><span class="token plain"> strongswan restart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">service</span><span class="token plain"> xl2tpd restart</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>开始 IPsec 连接：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Ubuntu &amp; Debian</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ipsec up myvpn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># CentOS/RHEL &amp; Fedora</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">strongswan up myvpn</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>开始 L2TP 连接：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"c myvpn"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /var/run/xl2tpd/l2tp-control</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>运行 <code>ifconfig</code> 并且检查输出。现在你应该看到一个新的网络接口 <code>ppp0</code>。</p><p>检查你现有的默认路由：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ip</span><span class="token plain"> route</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在输出中查找以下行： <code>default via X.X.X.X ...</code>。记下这个网关 IP，并且在下面的两个命令中使用。</p><p>从新的默认路由中排除你的 VPN 服务器 IP （替换为你自己的值）：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">route </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> 你的VPN服务器IP gw X.X.X.X</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果你的 VPN 客户端是一个远程服务器，则必须从新的默认路由中排除你的本地电脑的公有 IP，以避免 SSH 会话被断开 （替换为<a href="https://www.ipchicken.com" target="_blank" rel="noopener noreferrer">实际值</a>）：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">route </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> 你的本地电脑的公有IP gw X.X.X.X</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>添加一个新的默认路由，并且开始通过 VPN 服务器发送数据：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">route </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> default dev ppp0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>至此 VPN 连接已成功完成。检查 VPN 是否正常工作：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> -qO- http://ipv4.icanhazip.com</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token builtin class-name">echo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以上命令应该返回 <code>你的 VPN 服务器 IP</code>。</p><p>要停止通过 VPN 服务器发送数据：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">route del default dev ppp0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>要断开连接：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Ubuntu &amp; Debian</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"d myvpn"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /var/run/xl2tpd/l2tp-control</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ipsec down myvpn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># CentOS/RHEL &amp; Fedora</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"d myvpn"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /var/run/xl2tpd/l2tp-control</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">strongswan down myvpn</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="致谢">致谢<a class="hash-link" href="#致谢" title="Direct link to heading">​</a></h2><p>本文档是在 <a href="https://github.com/StreisandEffect/streisand" target="_blank" rel="noopener noreferrer">Streisand</a> 项目文档基础上翻译和修改。该项目由 Joshua Lund 和其他开发者维护。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="授权协议">授权协议<a class="hash-link" href="#授权协议" title="Direct link to heading">​</a></h2><p>注： 这个协议仅适用于本文档。</p><p>版权所有 (C) 2016-2021 Lin Song<br>
<!-- -->基于 <a href="https://github.com/StreisandEffect/streisand/blob/6aa6b6b2735dd829ca8c417d72eb2768a89b6639/playbooks/roles/l2tp-ipsec/templates/instructions.md.j2" target="_blank" rel="noopener noreferrer">Joshua Lund 的工作</a> (版权所有 2014-2016)</p><p>本程序为自由软件，在自由软件联盟发布的<a href="https://www.gnu.org/licenses/gpl.html" target="_blank" rel="noopener noreferrer"> GNU 通用公共许可协议</a>的约束下，你可以对其进行再发布及修改。协议版本为第三版或（随你）更新的版本。</p><p>我们希望发布的这款程序有用，但不保证，甚至不保证它有经济价值和适合特定用途。详情参见GNU通用公共许可协议。</p><blockquote><p><a href="https://github.com/hwdsl2/setup-ipsec-vpn/blob/master/docs/clients-zh.md" target="_blank" rel="noopener noreferrer">原文 - 配置 IPsec/L2TP 客户端</a></p></blockquote>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="ipsec" term="ipsec"/>
        <category label="l2tp" term="l2tp"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[配置 IPsec/XAuth VPN 客户端]]></title>
        <id>/2021/03/06/ipsec-clients-xauth</id>
        <link href="https://blog.alanwei.com/blog/2021/03/06/ipsec-clients-xauth"/>
        <updated>2021-03-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[在成功 搭建自己的 VPN 服务器 之后，按照下面的步骤来配置你的设备。IPsec/XAuth ("Cisco IPsec") 在 Android, iOS 和 OS X 上均受支持，无需安装额外的软件。Windows 用户可以使用免费的 Shrew Soft 客户端。如果无法连接,请首先检查是否输入了正确的 VPN 登录凭证。]]></summary>
        <content type="html"><![CDATA[<p>在成功 <a href="/blog/2021/03/06/ipsec-server">搭建自己的 VPN 服务器</a> 之后，按照下面的步骤来配置你的设备。IPsec/XAuth ("Cisco IPsec") 在 Android, iOS 和 OS X 上均受支持，无需安装额外的软件。Windows 用户可以使用免费的 <a href="https://www.shrew.net/download/vpn" target="_blank" rel="noopener noreferrer">Shrew Soft 客户端</a>。如果无法连接,请首先检查是否输入了正确的 VPN 登录凭证。</p><p>IPsec/XAuth 模式也称为 "Cisco IPsec"。该模式通常能够比 IPsec/L2TP <strong>更高效</strong>地传输数据（较低的额外开销）。</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>你也可以 <a href="/blog/2021/03/06/ipsec-clients-ikev2">配置 IKEv2</a>（推荐），或者使用 <a href="/blog/2021/03/06/ipsec-clients-l2tp">IPsec/L2TP 模式</a> 连接。</p></div></div><hr><ul><li>平台名称<ul><li><a href="#windows">Windows</a></li><li><a href="#os-x">OS X (macOS)</a></li><li><a href="#android">Android</a></li><li><a href="#ios">iOS (iPhone/iPad)</a></li><li><a href="#linux">Linux</a></li></ul></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="windows">Windows<a class="hash-link" href="#windows" title="Direct link to heading">​</a></h2><p><strong>注：</strong> 你也可以 <a href="/blog/2021/03/06/ipsec-clients-ikev2">配置 IKEv2</a>（推荐），或者使用 <a href="/blog/2021/03/06/ipsec-clients-l2tp">IPsec/L2TP 模式</a> 连接。无需安装额外的软件。</p><ol><li>下载并安装免费的 <a href="https://www.shrew.net/download/vpn" target="_blank" rel="noopener noreferrer">Shrew Soft VPN 客户端</a>。在安装时请选择 <strong>Standard Edition</strong>。<br><strong>注：</strong> 该 VPN 客户端 <strong>不支持</strong> Windows 10。</li><li>单击开始菜单 -&gt; 所有程序 -&gt; ShrewSoft VPN Client -&gt; VPN Access Manager</li><li>单击工具栏中的 <strong>Add (+)</strong> 按钮。</li><li>在 <strong>Host Name or IP Address</strong> 字段中输入<code>你的 VPN 服务器 IP</code>。</li><li>单击 <strong>Authentication</strong> 选项卡，从 <strong>Authentication Method</strong> 下拉菜单中选择 <strong>Mutual PSK + XAuth</strong>。</li><li>在 <strong>Local Identity</strong> 子选项卡中，从 <strong>Identification Type</strong> 下拉菜单中选择 <strong>IP Address</strong>。</li><li>单击 <strong>Credentials</strong> 子选项卡，并在 <strong>Pre Shared Key</strong> 字段中输入<code>你的 VPN IPsec PSK</code>。</li><li>单击 <strong>Phase 1</strong> 选项卡，从 <strong>Exchange Type</strong> 下拉菜单中选择 <strong>main</strong>。</li><li>单击 <strong>Phase 2</strong> 选项卡，从 <strong>HMAC Algorithm</strong> 下拉菜单中选择 <strong>sha1</strong>。</li><li>单击 <strong>Save</strong> 保存 VPN 连接的详细信息。</li><li>选择新添加的 VPN 连接。单击工具栏中的 <strong>Connect</strong> 按钮。</li><li>在 <strong>Username</strong> 字段中输入<code>你的 VPN 用户名</code>。</li><li>在 <strong>Password</strong> 字段中输入<code>你的 VPN 密码</code>。</li><li>单击 <strong>Connect</strong>。</li></ol><p>VPN 连接成功后，你会在 VPN Connect 状态窗口中看到 <strong>tunnel enabled</strong> 字样。单击 "Network" 选项卡，并确认 <strong>Established - 1</strong> 显示在 "Security Associations" 下面。最后你可以到 <a href="https://www.ipchicken.com" target="_blank" rel="noopener noreferrer">这里</a> 检测你的 IP 地址，应该显示为<code>你的 VPN 服务器 IP</code>。</p><p>如果在连接过程中遇到错误，请参见 <a href="/blog/2021/03/06/ipsec-clients-l2tp">故障排除</a>。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="os-x">OS X<a class="hash-link" href="#os-x" title="Direct link to heading">​</a></h2><ol><li>打开系统偏好设置并转到网络部分。</li><li>在窗口左下角单击 <strong>+</strong> 按钮。</li><li>从 <strong>接口</strong> 下拉菜单选择 <strong>VPN</strong>。</li><li>从 <strong>VPN类型</strong> 下拉菜单选择 <strong>Cisco IPSec</strong>。</li><li>在 <strong>服务名称</strong> 字段中输入任意内容。</li><li>单击 <strong>创建</strong>。</li><li>在 <strong>服务器地址</strong> 字段中输入<code>你的 VPN 服务器 IP</code>。</li><li>在 <strong>帐户名称</strong> 字段中输入<code>你的 VPN 用户名</code>。</li><li>在 <strong>密码</strong> 字段中输入<code>你的 VPN 密码</code>。</li><li>单击 <strong>认证设置</strong> 按钮。</li><li>在 <strong>机器认证</strong> 部分，选择 <strong>共享的密钥</strong> 单选按钮，然后输入<code>你的 VPN IPsec PSK</code>。</li><li>保持 <strong>群组名称</strong> 字段空白。</li><li>单击 <strong>好</strong>。</li><li>选中 <strong>在菜单栏中显示 VPN 状态</strong> 复选框。</li><li>单击 <strong>应用</strong> 保存VPN连接信息。</li></ol><p>要连接到 VPN：使用菜单栏中的图标，或者打开系统偏好设置的网络部分，选择 VPN 并单击 <strong>连接</strong>。最后你可以到 <a href="https://www.ipchicken.com" target="_blank" rel="noopener noreferrer">这里</a> 检测你的 IP 地址，应该显示为<code>你的 VPN 服务器 IP</code>。</p><p>如果在连接过程中遇到错误，请参见 <a href="/blog/2021/03/06/ipsec-clients-l2tp">故障排除</a>。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="android">Android<a class="hash-link" href="#android" title="Direct link to heading">​</a></h2><ol><li>启动 <strong>设置</strong> 应用程序。</li><li>单击 <strong>网络和互联网</strong>。或者，如果你使用 Android 7 或更早版本，在 <strong>无线和网络</strong> 部分单击 <strong>更多...</strong>。</li><li>单击 <strong>VPN</strong>。</li><li>单击 <strong>添加VPN配置文件</strong> 或窗口右上角的 <strong>+</strong>。</li><li>在 <strong>名称</strong> 字段中输入任意内容。</li><li>在 <strong>类型</strong> 下拉菜单选择 <strong>IPSec Xauth PSK</strong>。</li><li>在 <strong>服务器地址</strong> 字段中输入<code>你的 VPN 服务器 IP</code>。</li><li>保持 <strong>IPSec 标识符</strong> 字段空白。</li><li>在 <strong>IPSec 预共享密钥</strong> 字段中输入<code>你的 VPN IPsec PSK</code>。</li><li>单击 <strong>保存</strong>。</li><li>单击新的VPN连接。</li><li>在 <strong>用户名</strong> 字段中输入<code>你的 VPN 用户名</code>。</li><li>在 <strong>密码</strong> 字段中输入<code>你的 VPN 密码</code>。</li><li>选中 <strong>保存帐户信息</strong> 复选框。</li><li>单击 <strong>连接</strong>。</li></ol><p>VPN 连接成功后，会在通知栏显示图标。最后你可以到 <a href="https://www.ipchicken.com" target="_blank" rel="noopener noreferrer">这里</a> 检测你的 IP 地址，应该显示为<code>你的 VPN 服务器 IP</code>。</p><p>如果在连接过程中遇到错误，请参见 <a href="/blog/2021/03/06/ipsec-clients-l2tp">故障排除</a>。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ios">iOS<a class="hash-link" href="#ios" title="Direct link to heading">​</a></h2><ol><li>进入设置 -&gt; 通用 -&gt; VPN。</li><li>单击 <strong>添加VPN配置...</strong>。</li><li>单击 <strong>类型</strong> 。选择 <strong>IPSec</strong> 并返回。</li><li>在 <strong>描述</strong> 字段中输入任意内容。</li><li>在 <strong>服务器</strong> 字段中输入<code>你的 VPN 服务器 IP</code>。</li><li>在 <strong>帐户</strong> 字段中输入<code>你的 VPN 用户名</code>。</li><li>在 <strong>密码</strong> 字段中输入<code>你的 VPN 密码</code>。</li><li>保持 <strong>群组名称</strong> 字段空白。</li><li>在 <strong>密钥</strong> 字段中输入<code>你的 VPN IPsec PSK</code>。</li><li>单击右上角的 <strong>完成</strong>。</li><li>启用 <strong>VPN</strong> 连接。</li></ol><p>VPN 连接成功后，会在通知栏显示图标。最后你可以到 <a href="https://www.ipchicken.com" target="_blank" rel="noopener noreferrer">这里</a> 检测你的 IP 地址，应该显示为<code>你的 VPN 服务器 IP</code>。</p><p>如果在连接过程中遇到错误，请参见 <a href="/blog/2021/03/06/ipsec-clients-l2tp">故障排除</a>。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="linux">Linux<a class="hash-link" href="#linux" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="fedora-和-centos">Fedora 和 CentOS<a class="hash-link" href="#fedora-和-centos" title="Direct link to heading">​</a></h3><p>Fedora 28 （和更新版本）和 CentOS 8/7 用户可以使用 <code>yum</code> 安装 <code>NetworkManager-libreswan-gnome</code> 软件包，然后通过 GUI 配置 IPsec/XAuth VPN 客户端。</p><ol><li>进入 Settings -&gt; Network -&gt; VPN。单击 <strong>+</strong> 按钮。</li><li>选择 <strong>IPsec based VPN</strong>。</li><li>在 <strong>Name</strong> 字段中输入任意内容。</li><li>在 <strong>Gateway</strong> 字段中输入<code>你的 VPN 服务器 IP</code>。</li><li>在 <strong>Type</strong> 下拉菜单选择 <strong>IKEv1 (XAUTH)</strong>。</li><li>在 <strong>User name</strong> 字段中输入<code>你的 VPN 用户名</code>。</li><li>右键单击 <strong>User password</strong> 字段中的 <strong>?</strong>，选择 <strong>Store the password only for this user</strong>。</li><li>在 <strong>User password</strong> 字段中输入<code>你的 VPN 密码</code>。</li><li>保持 <strong>Group name</strong> 字段空白。</li><li>右键单击 <strong>Secret</strong> 字段中的 <strong>?</strong>，选择 <strong>Store the password only for this user</strong>。</li><li>在 <strong>Secret</strong> 字段中输入<code>你的 VPN IPsec PSK</code>。</li><li>保持 <strong>Remote ID</strong> 字段空白。</li><li>单击 <strong>Add</strong> 保存 VPN 连接信息。</li><li>启用 <strong>VPN</strong> 连接。</li></ol><p>VPN 连接成功后，你可以到 <a href="https://www.ipchicken.com" target="_blank" rel="noopener noreferrer">这里</a> 检测你的 IP 地址，应该显示为<code>你的 VPN 服务器 IP</code>。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="其它-linux">其它 Linux<a class="hash-link" href="#其它-linux" title="Direct link to heading">​</a></h3><p>其它 Linux 版本用户可以使用 <a href="/blog/2021/03/06/ipsec-clients-l2tp">IPsec/L2TP</a> 模式连接。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="致谢">致谢<a class="hash-link" href="#致谢" title="Direct link to heading">​</a></h2><p>本文档是在 <a href="https://github.com/StreisandEffect/streisand" target="_blank" rel="noopener noreferrer">Streisand</a> 项目文档基础上翻译和修改。该项目由 Joshua Lund 和其他开发者维护。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="授权协议">授权协议<a class="hash-link" href="#授权协议" title="Direct link to heading">​</a></h2><p>注： 这个协议仅适用于本文档。</p><p>版权所有 (C) 2016-2021 Lin Song<br>
<!-- -->基于 <a href="https://github.com/StreisandEffect/streisand/blob/6aa6b6b2735dd829ca8c417d72eb2768a89b6639/playbooks/roles/l2tp-ipsec/templates/instructions.md.j2" target="_blank" rel="noopener noreferrer">Joshua Lund 的工作</a> (版权所有 2014-2016)</p><p>本程序为自由软件，在自由软件联盟发布的<a href="https://www.gnu.org/licenses/gpl.html" target="_blank" rel="noopener noreferrer"> GNU 通用公共许可协议</a>的约束下，你可以对其进行再发布及修改。协议版本为第三版或（随你）更新的版本。</p><p>我们希望发布的这款程序有用，但不保证，甚至不保证它有经济价值和适合特定用途。详情参见GNU通用公共许可协议。</p><blockquote><p><a href="https://github.com/hwdsl2/setup-ipsec-vpn/blob/master/docs/clients-xauth-zh.md" target="_blank" rel="noopener noreferrer">原文 - 配置 IPsec/XAuth VPN 客户端</a></p></blockquote>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="ipsec" term="ipsec"/>
        <category label="xauth" term="xauth"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[搭建 IPSec 服务]]></title>
        <id>/2021/03/06/ipsec-server</id>
        <link href="https://blog.alanwei.com/blog/2021/03/06/ipsec-server"/>
        <updated>2021-03-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[使用技术:]]></summary>
        <content type="html"><![CDATA[<p>使用技术: </p><ul><li><a href="https://github.com/hwdsl2/setup-ipsec-vpn" target="_blank" rel="noopener noreferrer">setup-ipsec</a></li><li><a href="https://github.com/hwdsl2/docker-ipsec-vpn-server" target="_blank" rel="noopener noreferrer">docker-ipsec-server</a></li></ul><p>本文介绍使用Docker方式部署 IPSec 服务。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="服务器安装docker环境">服务器安装Docker环境<a class="hash-link" href="#服务器安装docker环境" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ubuntu">Ubuntu<a class="hash-link" href="#ubuntu" title="Direct link to heading">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Update the apt package index</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Install packages to allow apt to use a repository over HTTPS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain">  apt-transport-https ca-certificates </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> gnupg-agent software-properties-common -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Add Docker’s official GPG key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -fsSL https://download.docker.com/linux/ubuntu/gpg </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> apt-key </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apt-key fingerprint 0EBFCD88</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Set up the stable repository</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add-apt-repository </span><span class="token string" style="color:#e3116c">"deb [arch=amd64] https://download.docker.com/linux/ubuntu </span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable" style="color:#36acaa">lsb_release -cs</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c"> stable"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># install</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> docker-ce docker-ce-cli containerd.io -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="centos">CentOS<a class="hash-link" href="#centos" title="Direct link to heading">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Install required packages</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -y yum-utils device-mapper-persistent-data lvm2 -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Use the following command to set up the stable repository </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum-config-manager --add-repo  https://download.docker.com/linux/centos/docker-ce.repo </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Install the latest version of Docker CE and containerd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> docker-ce docker-ce-cli containerd.io -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="运行">运行<a class="hash-link" href="#运行" title="Direct link to heading">​</a></h2><p>先创建 <code>ipsec.env</code> 文件, 用于配置客户端连接VPN服务器所需要的</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">touch</span><span class="token plain"> ipsec.env </span><span class="token comment" style="color:#999988;font-style:italic"># 创建客户端连接服务器所需要的账号密码等配置信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"VPN_IPSEC_PSK=b558fC19z34oa2fa"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> ipsec.env </span><span class="token comment" style="color:#999988;font-style:italic"># 共享密钥, 客户端连接是需要</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"VPN_USER=2508681c"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> ipsec.env </span><span class="token comment" style="color:#999988;font-style:italic"># 用户名, 客户端连接需要</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"VPN_PASSWORD=76644c20"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> ipsec.env </span><span class="token comment" style="color:#999988;font-style:italic"># 密码, 客户端连接需要</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modprobe af_key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run --name ipsec-server </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --env-file ./ipsec.env </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --restart</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">always </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -p </span><span class="token number" style="color:#36acaa">500</span><span class="token plain">:500/udp </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -p </span><span class="token number" style="color:#36acaa">4500</span><span class="token plain">:4500/udp </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -v /lib/modules:/lib/modules:ro </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -d </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --privileged </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hwdsl2/ipsec-vpn-server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以下是其他命令:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 进入 IPSec 容器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token builtin class-name">exec</span><span class="token plain"> -it ipsec-server </span><span class="token function" style="color:#d73a49">bash</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看连接数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token builtin class-name">exec</span><span class="token plain"> -it ipsec-server ipsec whack --trafficstatus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 打印日志 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> logs ipsec-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看运行状态</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token builtin class-name">exec</span><span class="token plain"> -it ipsec-server ipsec status</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="客户端连接">客户端连接<a class="hash-link" href="#客户端连接" title="Direct link to heading">​</a></h2><ul><li><a href="/blog/2021/03/06/ipsec-clients-l2tp">IPSec/L2TP 方式连接</a></li><li><a href="/blog/2021/03/06/ipsec-clients-ikev2">IPSec/IKEv2 方式连接</a></li><li><a href="/blog/2021/03/06/ipsec-clients-xauth">xauth 方式连接</a></li></ul>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="ipsec" term="ipsec"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[配置右击使用Sublime打开文件夹]]></title>
        <id>/2021/03/06/sublime-right-click-open</id>
        <link href="https://blog.alanwei.com/blog/2021/03/06/sublime-right-click-open"/>
        <updated>2021-03-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[将以下代码保存到bat文件中, 然后执行:]]></summary>
        <content type="html"><![CDATA[<p>将以下代码保存到bat文件中, 然后执行: </p><div class="language-bat codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bat codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@echo off</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET st3Path=C:\Program Files\Sublime Text 3\sublime_text.exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rem add it for all file types</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@reg add "HKEY_CLASSES_ROOT\*\shell\Open with Sublime Text 3"         /t REG_SZ /v "" /d "Open with Sublime Text 3"   /f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@reg add "HKEY_CLASSES_ROOT\*\shell\Open with Sublime Text 3"         /t REG_EXPAND_SZ /v "Icon" /d "%st3Path%,0" /f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@reg add "HKEY_CLASSES_ROOT\*\shell\Open with Sublime Text 3\command" /t REG_SZ /v "" /d "%st3Path% \"%%1\"" /f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rem add it for folders</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@reg add "HKEY_CLASSES_ROOT\Folder\shell\Open with Sublime Text 3"         /t REG_SZ /v "" /d "Open with Sublime Text 3"   /f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@reg add "HKEY_CLASSES_ROOT\Folder\shell\Open with Sublime Text 3"         /t REG_EXPAND_SZ /v "Icon" /d "%st3Path%,0" /f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@reg add "HKEY_CLASSES_ROOT\Folder\shell\Open with Sublime Text 3\command" /t REG_SZ /v "" /d "%st3Path% \"%%1\"" /f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pause</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>如果安装ST3的时候已经勾选了"Open with Sublime Text 3", 上面的<code>rem add it for all file types</code>下的三行代码去掉.</p></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="sublime" term="sublime"/>
        <category label="editor" term="editor"/>
        <category label="windows" term="windows"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[VSC代码块折叠]]></title>
        <id>/2021/03/06/vsc-code-folding</id>
        <link href="https://blog.alanwei.com/blog/2021/03/06/vsc-code-folding"/>
        <updated>2021-03-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[以下是Visual Studio Code支持的代码块折叠标记及快捷键:]]></summary>
        <content type="html"><![CDATA[<p>以下是Visual Studio Code支持的代码块折叠标记及快捷键: </p><p>You can fold regions of source code using the folding icons on the gutter between line numbers and line start. Move the mouse over the gutter and click to fold and unfold regions. Use <code>Shift + Click</code> on the folding icon to fold or unfold the region and all regions inside.</p><p><img loading="lazy" src="https://code.visualstudio.com/assets/docs/editor/codebasics/folding.png" alt="folding" class="img_ev3q"></p><p>You can also use the following actions:</p><ul><li>Fold (<code>Ctrl+Shift+[</code>) folds the innermost uncollapsed region at the cursor.</li><li>Unfold (<code>Ctrl+Shift+]</code>) unfolds the collapsed region at the cursor.</li><li>Fold Recursively (<code>Ctrl+K Ctrl+[</code>) folds the innermost uncollapsed region at the cursor and all regions inside that region.</li><li>Unfold Recursively (<code>Ctrl+K Ctrl+]</code>) unfolds the region at the cursor and all regions inside that region.</li><li>Fold All (<code>Ctrl+K Ctrl+0</code>) folds all regions in the editor.</li><li>Unfold All (<code>Ctrl+K Ctrl+J</code>) unfolds all regions in the editor.</li><li>Fold Level X (<code>Ctrl+K Ctrl+2</code> for level 2) folds all regions of level X, except the region at the current cursor position.</li><li>Fold All Block Comments (<code>Ctrl+K Ctrl+/</code>) folds all regions that start with a block comment token.</li><li>Folding ranges are by default evaluated based on the indentation of lines. A folding range starts when a line has a smaller indent than one or more following lines, and ends when there is a line with the same or smaller indent.</li></ul><p>Since the 1.22 release, folding ranges can also be computed based on syntax tokens of the editor's configured language. The following languages already provide syntax aware folding: Markdown, HTML, CSS, LESS, SCSS, and JSON.</p><p>If you prefer to switch back to indentation-based folding for one (or all) of the languages above, use:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token property" style="color:#36acaa">"[html]"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"editor.foldingStrategy"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"indentation"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Regions can also be defined by markers defined by each language. The following languages currently have markers defined:</p><ul><li>C#: <code>#region</code> and <code>#endregion</code></li><li>C/C++: <code>#pragma</code> region and <code>#pragma</code> endregion</li><li>CSS/Less/SCSS: <code>/*#region*/</code> and <code>/*#endregion*/</code></li><li>Coffeescript: <code>#region</code> and <code>#endregion</code></li><li>F#: <code>//#region</code> and <code>//#endregion</code> and <code>(#_region)</code> and <code>(#_endregion)</code></li><li>Java: <code>//#region</code> and <code>// #endregion</code> and <code>//&lt;editor-fold&gt;</code> and <code>//&lt;/editor-fold&gt;</code></li><li>HTML:</li><li>PHP: <code>#region</code> and <code>#endregion</code></li><li>Powershell: <code>#region</code> and <code>#endregion</code></li><li>Python: <code>#region</code> and <code>#endregion</code></li><li>TypeScript/JavaScript: <code>//#region</code> and <code>/#endregion</code> and <code>//region</code> and <code>//endregion</code></li><li>VB: <code>#Region</code> and <code>#End Region</code></li><li>Bat: ::#region and ::#endregion</li><li>Markdown: <code>&lt;!-- #region --&gt;</code> and <code>&lt;!-- #endregion --&gt;</code></li></ul><p>To fold and unfold only the regions defined by markers use:</p><ul><li>Fold Marker Regions (<code>Ctrl+K Ctrl+8</code>) folds all marker regions.</li><li>Unfold Marker Regions (<code>Ctrl+K Ctrl+9</code>) unfolds all marker regions.</li></ul><blockquote><p><a href="https://code.visualstudio.com/docs/editor/codebasics#_folding" target="_blank" rel="noopener noreferrer">原文 - Folding</a></p></blockquote>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="editor" term="editor"/>
        <category label="vsc" term="vsc"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[VSC 代码片段介绍]]></title>
        <id>/2021/03/05/vsc-code-snippets</id>
        <link href="https://blog.alanwei.com/blog/2021/03/05/vsc-code-snippets"/>
        <updated>2021-03-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[简介]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="简介">简介<a class="hash-link" href="#简介" title="Direct link to heading">​</a></h2><p>在VSC里, 代码片段和其他提示混合出现在智能感知中(Windows: <code>Ctrl + Space</code>, Mac: <code>Cmd + Space</code>), 也可以使用通过 <code>Cmd/Ctrl + Shift + P</code> &gt; Insert Snippet 手动选择指定的代码片段, 同时支持使用tab完成代码片段插入: 使用配置<code>"editor.tabCompletion": "on"</code>开启, 输入代码片段的前缀(prefix), 然后按下 <strong>Tab</strong> 按键即可.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建自己的代码片段">创建自己的代码片段<a class="hash-link" href="#创建自己的代码片段" title="Direct link to heading">​</a></h2><p>选择 <strong>File/Code &gt; Preferences &gt; User Snippets</strong>, 可以选择创建以下类型的代码片段:</p><ul><li>针对特定语言的代码片段 (创建时选择代码片段支持的语言)</li><li>针对所有语言的通用代码片段(选择 <strong>New Global Snippets file</strong>)</li><li>针对当前项目的通用代码片段, 在你的项目根目录下的 <strong>.vscode</strong> 文件夹中创建扩展名为 <strong>.json.code-snippets</strong> 的文件即可.</li></ul><p>示例片段:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"For Loop"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"prefix"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"for"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"for-const"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"body"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"for (const ${2:element} of ${1:array}) {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"\t$0"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"}"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"description"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"A for loop."</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>"For Loop"</code>是代码片段的名称</li><li><code>prefix</code> 定义一个或多个触发词, 如果输入的字符包含<code>prefix</code>里定义的前缀, 智能感知列表就会出现这个代码片段以供选择, 除了前缀匹配, 还支持首字母匹配, 如果输入<code>fc</code>, 就会匹配上述示例中的<code>for-const</code>.</li><li><code>body</code> 代码片段实际内容, 数组的货会进行多行拼接</li><li><code>description</code> 用于在智能感知中提供描述信息, 可选.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="普通占位符">普通占位符<a class="hash-link" href="#普通占位符" title="Direct link to heading">​</a></h3><p>上述示例中的<code>body</code>有三个占位符, <code>${1:array}</code>, <code>${2:element}</code> 和 <code>$0</code>, 你可以使用 <strong>Tab</strong> 按钮在占位符之间来回切换, 冒号后面的文案为占位符的默认文本, 占位符的顺序按照数字顺序, 从0开始.</p><ul><li><code>$2</code> 普通占位符, <code>2</code> 用来指定 <strong>Tab</strong> 切换时的顺序</li><li><code>${1:default-text}</code> 冒号后面提供默认文本的占位符</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="多选值">多选值<a class="hash-link" href="#多选值" title="Direct link to heading">​</a></h3><p>占位符可以有多个可选值: <code>${1|one,tow,three}</code></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="变量占位符">变量占位符<a class="hash-link" href="#变量占位符" title="Direct link to heading">​</a></h3><p>占位符支持支持插入一些系统变量, 格式为 <code>$name</code> 或 <code>${name:default}</code> (<code>default</code>用来给占位符提供默认文本), 下面是可以使用的变量:</p><ul><li><code>TM_SELECTED_TEXT</code> The currently selected text or the empty string</li><li><code>TM_CURRENT_LINE</code> The contents of the current line</li><li><code>TM_CURRENT_WORD</code> The contents of the word under cursor or the empty string</li><li><code>TM_LINE_INDEX</code> The zero-index based line number</li><li><code>TM_LINE_NUMBER</code> The one-index based line number</li><li><code>TM_FILENAME</code> The filename of the current document</li><li><code>TM_FILENAME_BASE</code> The filename of the current document without its extensions</li><li><code>TM_DIRECTORY</code> The directory of the current document</li><li><code>TM_FILEPATH</code> The full file path of the current document</li><li><code>CLIPBOARD</code> The contents of your clipboard</li><li><code>WORKSPACE_NAME</code> The name of the opened workspace or folder</li><li><code>WORKSPACE_FOLDER</code> The path of the opened workspace or folder</li><li><code>CURRENT_YEAR</code> The current year</li><li><code>CURRENT_YEAR_SHORT</code> The current year's last two digits</li><li><code>CURRENT_MONTH</code> The month as two digits (example '02')</li><li><code>CURRENT_MONTH_NAME</code> The full name of the month (example 'July')</li><li><code>CURRENT_MONTH_NAME_SHORT</code> The short name of the month (example 'Jul')</li><li><code>CURRENT_DATE</code> The day of the month</li><li><code>CURRENT_DAY_NAME</code> The name of day (example 'Monday')</li><li><code>CURRENT_DAY_NAME_SHORT</code> The short name of the day (example 'Mon')</li><li><code>CURRENT_HOUR</code> The current hour in 24-hour clock format</li><li><code>CURRENT_MINUTE</code> The current minute</li><li><code>CURRENT_SECOND</code> The current second</li><li><code>CURRENT_SECONDS_UNIX</code> The number of seconds since the Unix epoch</li><li><code>BLOCK_COMMENT_START</code> Example output: in PHP <code>/*</code> or in HTML <code>&lt;!--</code></li><li><code>BLOCK_COMMENT_END</code> Example output: in PHP <code>*/</code> or in HTML <code>--&gt;</code></li><li><code>LINE_COMMENT</code> Example output: in PHP <code>//</code></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="其他">其他<a class="hash-link" href="#其他" title="Direct link to heading">​</a></h2><p>如果遇到 Markdown 文件没有智能感知方式插入代码片段, 可以在配置中(<code>settings.json</code>)添加一下配置项, 强制开启:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"[markdown]"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.wordWrap"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"on"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.quickSuggestions"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="示例">示例<a class="hash-link" href="#示例" title="Direct link to heading">​</a></h2><p>比如以下代码片段:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">.vscode/ts-function.code-snippets</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"TS Function"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"prefix"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ts-function"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"body"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"export type ${TM_FILENAME_BASE/^(\\w)(.*)/${1:/upcase}${2}/}Params = {}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"export interface ${TM_FILENAME_BASE/^(\\w)(.*)/${1:/upcase}${2}/}Result { }"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"/**"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" * "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" * @author ${1:创建人} "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" * @date $CURRENT_YEAR-$CURRENT_MONTH-$CURRENT_DATE"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">" */"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"export function ${TM_FILENAME_BASE}(params: ${TM_FILENAME_BASE/^(\\w)(.*)/${1:/upcase}${2}/}Params): ${TM_FILENAME_BASE/^(\\w)(.*)/${1:/upcase}${2}/}Result {"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"description"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"创建 TypeScript 函数"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当文件名为 <code>getRandom.ts</code> 文件输入 <code>ts-function</code> 按回车会生成以下代码:</p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">getRandom.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">GetRandomParams</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">GetRandomResult</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * </span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @author 创建人 </span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @date 2021-11-23</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getRandom</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">params</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> GetRandomParams</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> GetRandomResult </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><a href="https://code.visualstudio.com/docs/editor/userdefinedsnippets" target="_blank" rel="noopener noreferrer">原文 - Snippets in Visual Studio Code</a></p></blockquote>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="vsc" term="vsc"/>
        <category label="editor" term="editor"/>
        <category label="code snippets" term="code snippets"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Markdown 智能感知插入代码片段]]></title>
        <id>/2021/03/05/vsc-markdown-snippets</id>
        <link href="https://blog.alanwei.com/blog/2021/03/05/vsc-markdown-snippets"/>
        <updated>2021-03-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[解决 Visual Studio Code Markdown 文件不能插入代码片段问题]]></summary>
        <content type="html"><![CDATA[<p>解决 Visual Studio Code Markdown 文件不能插入代码片段问题</p><p><a href="https://stackoverflow.com/questions/32703317/how-to-activate-markdown-user-snippets-in-visual-studio-code" target="_blank" rel="noopener noreferrer">原文 - </a></p><p>向配置文件增加以下配置: </p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"[markdown]"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.wordWrap"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"on"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.quickSuggestions"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="vsc" term="vsc"/>
        <category label="markdown" term="markdown"/>
        <category label="editor" term="editor"/>
        <category label="code snippets" term="code snippets"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Mac安装Wireguard]]></title>
        <id>/2021/03/04/mac-install-wireguard</id>
        <link href="https://blog.alanwei.com/blog/2021/03/04/mac-install-wireguard"/>
        <updated>2021-03-04T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[1. 安装 WireGuard 客户端]]></summary>
        <content type="html"><![CDATA[<ol><li>安装 WireGuard 客户端</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">brew </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> wireguard-tools</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>配置 WireGuard 客户端</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /usr/local/etc/wiregurad </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">touch</span><span class="token plain"> /usr/local/etc/wiregurad/wg0.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>wg0.conf</strong> 文件如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[Interface]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Address = 10.200.200.2/32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PrivateKey = &lt;client_private_key&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MTU = 1420</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Peer]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PublicKey = &lt;server_public_key&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Endpoint = &lt;SERVER_IP:SERVER_PORT&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AllowedIPs = 10.200.0.0/16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PersistentKeepalive = 25</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>启动 WireGuard</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> wg-quick up wg0-client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> wg show</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>经 <a href="https://github.com/117503445" target="_blank" rel="noopener noreferrer">117503445</a><a href="https://github.com/alanwei43/alanwei43.github.io/issues/1" target="_blank" rel="noopener noreferrer">提醒</a>, 启动WireGuard的命令应该是 <code>sudo wg-quick up wg0</code></p></div></div><blockquote><p><a href="https://blog.kelu.org/tech/2020/03/13/mac-install-wireguard.html" target="_blank" rel="noopener noreferrer">原文</a></p></blockquote>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="mac" term="mac"/>
        <category label="wireguard" term="wireguard"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Sublime开启Vim模式]]></title>
        <id>/2021/03/04/sublime-vim-mode</id>
        <link href="https://blog.alanwei.com/blog/2021/03/04/sublime-vim-mode"/>
        <updated>2021-03-04T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Sublime开启Vim模式]]></summary>
        <content type="html"><![CDATA[<p>Vintage is a vi mode editing package for Sublime Text. It allows you to combine vi's command mode with Sublime Text's features, including multiple selections.</p><p>Vintage mode is developed in the open, and patches are more than welcome. If you'd like to contribute, details are in the <a href="https://github.com/sublimehq/Vintage" target="_blank" rel="noopener noreferrer">GitHub repo</a>. </p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="enabling-vintage">Enabling Vintage<a class="hash-link" href="#enabling-vintage" title="Direct link to heading">​</a></h2><p> Vintage is disabled by default, via the <code>ignored_packages</code> setting. If you remove <code>"Vintage"</code> from the list of ignored packages, you'll be able to edit with vi keys: </p><ol><li>Select the <code>Preferences ▶ Settings</code> menu item</li><li>Edit the <code>ignored_packages</code> setting, changing it from: </li></ol><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token property" style="color:#36acaa">"ignored_packages"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"Vintage"</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>to</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token property" style="color:#36acaa">"ignored_packages"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Vintage mode is now enabled – you'll see "INSERT MODE" listed in the status bar </li></ol><p>Vintage starts in insert mode by default. This can be changed by adding the following setting to your user settings: </p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token property" style="color:#36acaa">"vintage_start_in_command_mode"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><a href="https://www.sublimetext.com/docs/3/vintage.html" target="_blank" rel="noopener noreferrer">原文 Vintage Mode</a></p></blockquote>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="sublime" term="sublime"/>
        <category label="editor" term="editor"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Linux - Structure needs cleaning]]></title>
        <id>/2021/03/03/Structure-needs-cleaning</id>
        <link href="https://blog.alanwei.com/blog/2021/03/03/Structure-needs-cleaning"/>
        <updated>2021-03-03T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Linux文件系统损坏修复]]></summary>
        <content type="html"><![CDATA[<p>Linux文件系统损坏修复</p><p>原文: <a href="https://askubuntu.com/questions/910078/structure-needs-cleaning-error-cannot-mount-partition" target="_blank" rel="noopener noreferrer">Structure needs cleaning” error - cannot mount partition
</a></p><ol><li>unmount 磁盘</li><li>执行 <code>sudo fsck.ext4 /dev/sda[NUMBER]</code></li></ol>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="linux" term="linux"/>
        <category label="ubuntu" term="ubuntu"/>
        <category label="file system" term="file system"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[设置Mac系统JAVA_HOME]]></title>
        <id>/2021/03/03/mac-java-home</id>
        <link href="https://blog.alanwei.com/blog/2021/03/03/mac-java-home"/>
        <updated>2021-03-03T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[原文]]></summary>
        <content type="html"><![CDATA[<p><a href="https://explainjava.com/set-java-home-mac-os/" target="_blank" rel="noopener noreferrer">原文</a></p><p>设置Mac系统的<code>JAVA_HOME</code>环境变量:</p><ol><li>打开终端</li><li>编辑 <code>~/.bash_profile</code></li><li>新增一行内容 <code>export JAVA_HOME=$(/usr/libexec/java_home)</code></li><li>执行 <code>source .bash_profile</code></li><li>测试: <code>echo $JAVA_HOME</code></li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="以下是原文">以下是原文<a class="hash-link" href="#以下是原文" title="Direct link to heading">​</a></h2><p>In this tutorial, we show you how to set $JAVA_HOME environment variable on latest or older Mac OSX.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-mac-osx-105-or-later">1. Mac OSX 10.5 or later<a class="hash-link" href="#1-mac-osx-105-or-later" title="Direct link to heading">​</a></h3><p>In Mac OSX 10.5 or later, Apple recommends to set the <code>$JAVA_HOME</code> variable to <code>/usr/libexec/java_home</code>, just export <code>$JAVA_HOME</code> in file <code>~/.bash_profile</code> or <code>~/.profile</code>.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> .bash_profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">JAVA_HOME</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">/usr/libexec/java_home</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token builtin class-name">source</span><span class="token plain"> .bash_profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$JAVA_HOME</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /Library/Java/JavaVirtualMachines/1.7.0.jdk/Contents/Home</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="why-usrlibexecjava_home">Why /usr/libexec/java_home?<a class="hash-link" href="#why-usrlibexecjava_home" title="Direct link to heading">​</a></h3><p>This <code>java_home</code> can return the Java version specified in Java Preferences for the current user. For examples,</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/libexec/java_home -V</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Matching Java Virtual Machines </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">1.7</span><span class="token plain">.0_05, x86_64:   </span><span class="token string" style="color:#e3116c">"Java SE 7"</span><span class="token plain"> /Library/Java/JavaVirtualMachines/1.7.0.jdk/Contents/Home</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">1.6</span><span class="token plain">.0_41-b02-445, x86_64:   </span><span class="token string" style="color:#e3116c">"Java SE 6"</span><span class="token plain"> /System/Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents/Home</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">1.6</span><span class="token plain">.0_41-b02-445, i386: </span><span class="token string" style="color:#e3116c">"Java SE 6"</span><span class="token plain"> /System/Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents/Home</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This Mac OSX has three JDK installed.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">##return top Java version</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ /usr/libexec/java_home</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /Library/Java/JavaVirtualMachines/1.7.0.jdk/Contents/Home</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## I want Java version 1.6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ /usr/libexec/java_home -v </span><span class="token number" style="color:#36acaa">1.6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /System/Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents/Home</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ref: https://www.mkyong.com/java/how-to-set-java_home-environment-variable-on-mac-os-x/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="java" term="java"/>
        <category label="mac" term="mac"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[设置Mac VSC的code变量]]></title>
        <id>/2021/03/03/mac-vsc-path</id>
        <link href="https://blog.alanwei.com/blog/2021/03/03/mac-vsc-path"/>
        <updated>2021-03-03T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[原文]]></summary>
        <content type="html"><![CDATA[<p><a href="https://izziswift.com/code-not-working-in-command-line-for-visual-studio-code-on-osx-mac/" target="_blank" rel="noopener noreferrer">原文</a></p><p>Mac系统，添加<code>code</code>到<code>PATH</code>环境变量:</p><p>按下 Command + Shift + P，然后输入<code>Shell Command</code>, 选择 <code>Shell Command: Install 'code' command in PATH</code> 即可.</p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="vsc" term="vsc"/>
        <category label="mac" term="mac"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Node.js Hash计算]]></title>
        <id>/2021/02/28/node-hash</id>
        <link href="https://blog.alanwei.com/blog/2021/02/28/node-hash"/>
        <updated>2021-02-28T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[计算hash值:]]></summary>
        <content type="html"><![CDATA[<p>计算hash值:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">crypto</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"crypto"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> clearText </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"待计算文本"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hashValue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> crypto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createHash</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"sha256"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">clearText</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">digest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"hex"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="node.js" term="node.js"/>
        <category label="hash" term="hash"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Spring Boot Hot Swapping]]></title>
        <id>/2021/02/24/hot-swapping-in-spring-boot</id>
        <link href="https://blog.alanwei.com/blog/2021/02/24/hot-swapping-in-spring-boot"/>
        <updated>2021-02-24T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Spring Boot 应用配置 Hot Swapping]]></summary>
        <content type="html"><![CDATA[<p>Spring Boot 应用配置 Hot Swapping</p><p>FROM <a href="https://stackoverflow.com/questions/21399586/hot-swapping-in-spring-boot" target="_blank" rel="noopener noreferrer">Hot Swapping In Spring Boot</a></p><p>What helped me in IntelliJ 15.0, windows 10, was the following sequence:</p><p>STEP 1: Added the following dependency in pom (This is mentioned everywhere but this alone dint solve it), as mentioned by @jonashackt</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">spring-boot-devtools</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>STEP 2: Then from <strong>File-&gt;Settings-&gt; Build-Execution-Deployment -&gt; Compiler</strong> (make sure main compiler option is selected and not any of its sub-options)</p><p>enable Make Project Automatically. Click ok and close the dialog Note : In latest version it will be Build project automatically</p><p>STEP 3: Hold <code>Shift+Ctrl+A</code> (on windows) you will see a search dialog with title <strong>Enter Action or option name</strong> , type <strong>registry</strong> Double click the first option that says "Registry..." it will open another window. Look for the following option:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">compiler.automake.allow.when.app.running</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and enable it, click close</p><p>STEP 4: Restart IDE</p><p>Elaborated from this <a href="https://dzone.com/articles/spring-boot-application-live-reload-hot-swap-with" target="_blank" rel="noopener noreferrer">source</a></p>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="java" term="java"/>
        <category label="spring" term="spring"/>
        <category label="spring boot" term="spring boot"/>
        <category label="hot swap" term="hot swap"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[设置Java程序网络代理]]></title>
        <id>/2021/02/17/java-network-proxy</id>
        <link href="https://blog.alanwei.com/blog/2021/02/17/java-network-proxy"/>
        <updated>2021-02-17T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[设置Java程序网络代理]]></summary>
        <content type="html"><![CDATA[<p><a href="https://docs.telerik.com/fiddler/Configure-Fiddler/Tasks/ConfigureJavaApp" target="_blank" rel="noopener noreferrer">配置来源</a></p><p>To configure a Java application to send web traffic to Fiddler, set the proxy using jre:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">jre -DproxySet</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true -Dhttp.proxyHost</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1 -Dhttp.proxyPort</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">8888</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Or:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">jre -DproxySet</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true -DproxyHost</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1 -DproxyPort</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">8888</span><span class="token plain"> MyApp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Or, change the Java Virtual Machine's proxy settings programmatically:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">System.setProperty("http.proxyHost", "127.0.0.1");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.setProperty("https.proxyHost", "127.0.0.1");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.setProperty("http.proxyPort", "8888");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.setProperty("https.proxyPort", "8888");</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><a href="http://java.sun.com/j2se/1.5.0/docs/guide/net/proxies.html" target="_blank" rel="noopener noreferrer">Learn more about Java proxy settings</a>.</li><li><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/net/proxies.html" target="_blank" rel="noopener noreferrer">Java Networking and Proxies</a></li></ul>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="java" term="java"/>
        <category label="proxy" term="proxy"/>
        <category label="http" term="http"/>
        <category label="network" term="network"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[我的 Visual Studio Code 配置]]></title>
        <id>/2020/03/20/visual-studio-code-config</id>
        <link href="https://blog.alanwei.com/blog/2020/03/20/visual-studio-code-config"/>
        <updated>2020-03-20T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[我的 Visual Studio Code 配置]]></summary>
        <content type="html"><![CDATA[<p>下面展示一下我的VSC配置: </p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="brief">Brief<a class="hash-link" href="#brief" title="Direct link to heading">​</a></h3><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">.vscode/settings.json</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"extensions.autoUpdate"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 禁用扩展自动更新</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"extensions.autoCheckUpdates"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 禁用扩展自动更新</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"update.mode"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"manual"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// VSC更新模式改为手动检测</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"editor.lineNumbers"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"relative"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 使用相对行号(方便Vim跳转)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"window.closeWhenEmpty"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 如果打开文件为空，关闭VSC编辑器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"files.eol"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"\n"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 文件换行符</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"files.encoding"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"utf8"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 文件编码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"editor.minimap.enabled"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 是否显示小地图</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"explorer.confirmDelete"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 删除文件确认</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"[html]"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.defaultFormatter"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"vscode.html-language-features"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"[json]"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.defaultFormatter"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"vscode.json-language-features"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"[javascript]"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.defaultFormatter"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"vscode.typescript-language-features"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"[vue]"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.defaultFormatter"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"esbenp.prettier-vscode"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"[typescript]"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.defaultFormatter"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"vscode.typescript-language-features"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"[jsonc]"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.defaultFormatter"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"vscode.json-language-features"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Markdown文件配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"[markdown]"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.wordWrap"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"on"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.quickSuggestions"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">"comments"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"on"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">"other"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"on"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">"strings"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"on"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// markdown文件智能提示默认开启(用于支持Snippets)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"emmet.triggerExpansionOnTab"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"todohighlight.maxFilesForSearch"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5120</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"editor.smoothScrolling"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"workbench.list.smoothScrolling"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"explorer.autoReveal"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"focusNoScroll"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"extensions.ignoreRecommendations"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"editor.tabSize"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"files.associations"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"*.wxml"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"vue-html"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"*.mdx"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"markdown"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"editor.suggestSelection"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"first"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"editor.formatOnSave"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"json.maxItemsComputed"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">500</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"editor.unicodeHighlight.invisibleCharacters"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"window.zoomLevel"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"editor.experimental.stickyScroll.enabled"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"vim.useCtrlKeys"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2022-01-04">2022-01-04<a class="hash-link" href="#2022-01-04" title="Direct link to heading">​</a></h3><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">"settings.json</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"extensions.autoUpdate"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 禁用扩展自动更新</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"extensions.autoCheckUpdates"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 禁用扩展自动更新</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"update.mode"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"manual"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// VSC更新模式改为手动检测</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"editor.suggestSelection"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"first"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"vsintellicode.modify.editor.suggestSelection"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"automaticallyOverrodeDefaultValue"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"vim.useCtrlKeys"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"vim.easymotion"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"vim.leader"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"\\"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"vim.surround"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"vim.hlsearch"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"editor.largeFileOptimizations"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"breadcrumbs.enabled"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"editor.renderControlCharacters"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"editor.lineNumbers"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"relative"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"window.restoreWindows"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"none"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"editor.renderWhitespace"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"all"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"editor.renderIndentGuides"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"files.eol"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"\n"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"files.encoding"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"utf8"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"editor.minimap.enabled"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"explorer.confirmDelete"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"explorer.openEditors.visible"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"editor.cursorBlinking"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"phase"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"editor.smoothScrolling"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"editor.tokenColorCustomizations"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"textMateRules"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"scope"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">"entity.name.function"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">"support.function"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">"settings"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">"fontStyle"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"italic bold"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"java.configuration.checkProjectSettingsExclusions"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"[html]"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.defaultFormatter"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"vscode.html-language-features"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"[json]"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.defaultFormatter"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"vscode.json-language-features"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"[javascript]"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.defaultFormatter"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"vscode.typescript-language-features"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// "window.zoomLevel": 2, // 放大缩小</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"html.format.wrapLineLength"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"editor.fontLigatures"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// "editor.fontFamily": "'Cascadia Code', '思源黑体 Light', Consolas, 'Courier New', monospace",</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"[jsonc]"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.defaultFormatter"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"vscode.json-language-features"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"diffEditor.ignoreTrimWhitespace"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"gitlens.blame.ignoreWhitespace"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"java.semanticHighlighting.enabled"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"workbench.editor.scrollToSwitchTabs"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"yaml.schemas"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"file:///toc.schema.json"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/toc\\.yml/i"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"gitlens.views.compare.files.layout"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"list"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"explorer.confirmDragAndDrop"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"window.titleBarStyle"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"custom"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"[dart]"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.formatOnSave"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.formatOnType"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.rulers"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.selectionHighlight"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.suggest.snippetsPreventQuickSuggestions"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.suggestSelection"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"first"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.tabCompletion"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"onlySnippets"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.wordBasedSuggestions"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"settingsSync.keybindingsPerPlatform"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 隐藏title bar</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"files.watcherExclude"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"**/.git/objects/**"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"**/.git/subtree-cache/**"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"**/node_modules/**"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"**/.hg/store/**"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"workbench.activityBar.visible"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"[markdown]"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.wordWrap"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"on"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.quickSuggestions"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"explorer.autoReveal"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"focusNoScroll"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"[vue]"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.defaultFormatter"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"octref.vetur"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"[typescript]"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.defaultFormatter"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"vscode.typescript-language-features"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"editor.tabSize"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"rest-client.previewColumn"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"current"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"[typescriptreact]"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.defaultFormatter"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"vscode.typescript-language-features"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"[css]"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.defaultFormatter"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"esbenp.prettier-vscode"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"[yaml]"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"editor.defaultFormatter"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"redhat.vscode-yaml"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"emmet.showExpandedAbbreviation"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"inMarkupAndStylesheetFilesOnly"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"emmet.excludeLanguages"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"markdown"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"tsx"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"window.closeWhenEmpty"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"files.exclude"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"**/.git"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"**/.svn"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"**/.hg"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"**/CVS"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"**/.DS_Store"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"node_modules"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"files.watcherExclude"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"**/.git/objects/**"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"**/.git/subtree-cache/**"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"**/node_modules/*/**"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"**/.hg/store/**"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">keybindings.json</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ctrl+shift+i"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"editor.action.formatDocument"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ctrl+shift+w"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"workbench.action.closeOtherEditors"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ctrl+shift+r"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"revealInExplorer"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"alt+left"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"workbench.action.navigateBack"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"alt+right"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"workbench.action.navigateForward"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"f12"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"editor.action.revealDefinition"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"when"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"editorHasDefinitionProvider &amp;&amp; editorTextFocus &amp;&amp; !isInEmbeddedEditor"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ctrl+shift+d"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"workbench.action.splitEditorDown"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ctrl+shift+l"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"workbench.action.splitEditorLeft"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ctrl+shift+s"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"saveAll"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ctl+shift+m"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"workbench.action.terminal.sendSequence"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"args"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">"text"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"git status\u000D"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ctrl+e"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"-workbench.action.quickOpen"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="vsc" term="vsc"/>
        <category label="visual studio code" term="visual studio code"/>
        <category label="editor" term="editor"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[我的 Visual Studio Code 快捷键配置]]></title>
        <id>/2020/03/20/visual-studio-code-keyboard</id>
        <link href="https://blog.alanwei.com/blog/2020/03/20/visual-studio-code-keyboard"/>
        <updated>2020-03-20T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[我的 Visual Studio Code 快捷键配置]]></summary>
        <content type="html"><![CDATA[<p>迁移至<a href="/blog/2020/03/20/visual-studio-code-config">Visual Studio Code配置</a>;</p><p>下面展示一下我的VSC快捷键配置: </p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="macos">macOS<a class="hash-link" href="#macos" title="Direct link to heading">​</a></h2><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">.vscode/keybindings.json</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 格式化文档</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"shift+cmd+i"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"editor.action.formatDocument"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 关闭其他文档</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"shift+cmd+w"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"workbench.action.closeOtherEditors"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"shift+cmd+w"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"-workbench.action.closeWindow"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 侧边栏定位当前文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"shift+cmd+r"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"revealInExplorer"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ctrl+r"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"renameFile"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="windows">Windows<a class="hash-link" href="#windows" title="Direct link to heading">​</a></h2><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">.vscode/keybindings.json</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ctrl+shift+i"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"editor.action.formatDocument"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ctrl+shift+w"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"workbench.action.closeOtherEditors"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ctrl+shift+r"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"revealInExplorer"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"alt+left"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"workbench.action.navigateBack"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"alt+right"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"workbench.action.navigateForward"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"f12"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"editor.action.revealDefinition"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"when"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"editorHasDefinitionProvider &amp;&amp; editorTextFocus &amp;&amp; !isInEmbeddedEditor"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ctrl+shift+d"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"workbench.action.splitEditorDown"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ctrl+shift+l"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"workbench.action.splitEditorLeft"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ctrl+shift+s"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"saveAll"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ctl+shift+m"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"workbench.action.terminal.sendSequence"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"args"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">"text"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"git status\u000D"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ctrl+e"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"-workbench.action.quickOpen"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ctrl+r"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"renameFile"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="vsc" term="vsc"/>
        <category label="visual studio code" term="visual studio code"/>
        <category label="editor" term="editor"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[ASP.Net 身份模块介绍]]></title>
        <id>/2019/05/14/asp-net-identity-module</id>
        <link href="https://blog.alanwei.com/blog/2019/05/14/asp-net-identity-module"/>
        <updated>2019-05-14T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[原文]]></summary>
        <content type="html"><![CDATA[<p><a href="http://www.asp.net/identity/overview/getting-started/introduction-to-aspnet-identity" target="_blank" rel="noopener noreferrer">原文</a></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="前言preface">前言(Preface)<a class="hash-link" href="#前言preface" title="Direct link to heading">​</a></h3><p>ASP.Net 会员系统在2005年发布ASP.Net 2.0的时候同时发布(介绍), 而且从那以后Web应用在处理认证和授权方面已经发生了很多改变.对于会员系统应该是什么样子的, ASP.Net Identity是一个新的尝试, 当你为Web, Phone, Tablet(平板)创建现代应用的时候.
这篇文章是由Pranav Rastogi, Jon Galloway, Tom Dykstra, and Rick Anderson所写.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="背景-aspnet会员系统aspnet-membership">背景: ASP.Net会员系统(ASP.Net Membership)<a class="hash-link" href="#背景-aspnet会员系统aspnet-membership" title="Direct link to heading">​</a></h2><p>在2005年, 为了解决大部分网站对会员功能的需求, ASP.Net Membership被设计出来, 它需要表单认证和包含用户名,密码和个人信息的SQL Server数据库. 现在对于Web应用, 有更加广泛(broader)的可供选择数据存储方式, 而且大部分开发者想使他们的站点使用社交登录来提供认证和授权功能. 下面介绍的ASP.Net Membership的设计限制使上述的需求实现变得很困难:</p><ul><li>数据库架构被设计成使用SQL Server, 而且你不可以改变. 你可以添加配置信息, 但是其他数据被放在了其他表中, 使用任何手段(means)访问这些信息都是困难的, 除非通过Profile Provider API(配置提供器API).</li><li>提供器系统能够让你改变背后的数据存储方式, 但是系统被设计成假设你使用的是关系型数据库. 你可以实现在非关系型存储机制存储会员信息的提供器, 比如 Azure Storage Tables, 但是之后你就不得不围绕着关系型设计来写大量的代码, 而且对于不适用于非关系型数据库的方法需要写大量的System.NotImplementationException异常抛出.</li><li>自从登陆/登出功能是基于表单认证的, 会员系统就不能够使用OWIN, OWIN包含了对于认证的中间件, 也包括了对于外部身份系统(像Micrsoft Account, Facebook, Google, Twitter)登陆的支持, 而且log-ins可以从活动目录或者Azure活动目录使用组织账号. OWIN也包括了对于OAuth 2.0， JWT(JSON Web Token)和CORS(Corss Origin Request Source)的支持.  (Alan: <a href="http://stackoverflow.com/questions/23674613/using-jwt-to-implement-authentication-on-asp-net-web-api" target="_blank" rel="noopener noreferrer">Using JWT to implement Authentication on Asp.net web api</a>)</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="aspnet-simple-membership">ASP.Net Simple Membership<a class="hash-link" href="#aspnet-simple-membership" title="Direct link to heading">​</a></h3><p>ASP.net simple membership 被开发成ASP.Net Web Pages的会员系统. 它随同WebMatrix和Visual Studio 2010 SP1一起发布. Simple Membership的目标是使Web Pages应用添加会员功能更加容易.
Simple Membership 使自定义用户配置信息更加容易, 但是在和ASP.Net Membership共享(Alan: 应该是共存的意思)有一些其他问题, 而且有一些限制:</p><ul><li>很难在非关系型数据存储中持久化会员系统.</li><li>你不可以使用OWIN.</li><li>他不能和现有已经存在的ASP.Net Mebership实现(provider)很好地工作, 而且它不可扩展.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="aspnet-universal-providers">ASP.Net Universal Providers<a class="hash-link" href="#aspnet-universal-providers" title="Direct link to heading">​</a></h3><p>为了能够在Microsoft Azure SQL Database中持久化会员信息, ASP.Net Universal Provider(通用提供器)被开发出来, 而且它也可以和SQL Server Compact一起工作. Universal Providers 依赖于EF Code First, 这意味着Universal Providers可以在任何支持EF的存储方式上持久化数据(Alan: 也就是使用). 使用Universal Provider, 数据库架构也变的非常简洁.
Universal Providers是基于ASP.Net Membership基础设施, 因此, 作为SQLMembership Provider, Universal Provider也带来了同样的限制. 那就是他们都被设计成针对关系型数据库, 而且很难自定义配置和用户信息. 这些提供器也一直使用表单认证的登入/登出功能.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="aspnet-identity">ASP.Net Identity<a class="hash-link" href="#aspnet-identity" title="Direct link to heading">​</a></h3><p>ASP.Net的会员系统经过这么多年的进化, ASP.Net团队从客户那里获得了并吸收了很多反馈.
如果用户使用它们注册时填写的用户名和密码来登陆的假设不再有效(Alan: 大概意思应该是用户都不再通过注册然后登陆的形式来访问网站). Web就变得更加社交(社会化). 用户通过社交频道(比如FB, Twitter, 或者其他社交网站)实时与他人交流. 开发者系统用户能够使用它们的社交账号来登陆, 这样用户在他们(开发者)的网站上能够获得更加丰富的体验. 一个现代的应用必须拥有基于跳转-登陆的认证提供器(比如FB, Twitter或者其他)(Alan: 就是第三方登陆).
因为Web开发的演进, Web开发出现了一些设计模式/网站架构.(Alan: 大概是这个意思) 应用代码的单元测试变成了应用开发者的核心部分. 在2008年, ASP.Net添加了基于MVC模式的新框架, 作为帮助开发者开发可进行单元测试的ASP.Net应用的部分. 希望能够对应用程序的逻辑进行单元测试的开发者同样也希望能够对会员系统进行单元测试.
考虑到Web应用开发中的这些改变, Asp.Net Identity为了实现一下目标被开发出来:</p><ul><li><p>一统江湖的ASP.Net Identity系统</p><ul><li>ASP.Net Identity 可以应用于所有的ASP.Net框架, 比如ASP.Net MVC, Web Forms, Web Pages, Web API和SignalR。</li><li>当你创建Web, Phone, Store或者混合应用的时候也可以使用ASP.Net Identity.</li></ul></li><li><p>用户个人信息数据易于扩展(Ease of plugging in profile data about the user)</p><ul><li>你可以控制用户和配置信息的架构(Alan: 一般指表结构). 比如, 当用户在你的应用中注册时, 你可以很容易存储用汉语的生日.</li></ul></li><li><p>持久化控制(Alan: 其实就是数据存储方案的选择, 比如关系型数据库, 非关系型数据库, 甚至XML)</p><ul><li>默认情况下, ASP.Net Identity将所有的用户信息存储在数据库中. ASP.Net Identity使用EF Code First来实现所有的持久化机制.</li><li>你可以控制数据架构和常见的任务, 比如改变表名或者改变主键数据类型.</li><li>很容就能替换成其他的存储机制， 比如SharePoint, Azure Storage Table Service, NoSQL数据库等等, 而且不需要必须抛出System.NotImplementedException异常.</li></ul></li><li><p>可单元测试</p><ul><li>ASP.Net Identity 使Web应用可单元测试. 你可以写ASP.Net Identity部分的单元测试.</li></ul></li><li><p>角色提供器</p><ul><li>有一个角色提供器能够让你限制访问你的应用的某个部分. 你可以很容易的创建角色, 比如"Admin" 然后添加用户到角色.</li></ul></li><li><p>基于Claims (Alan: claims是ASP.Net很底层的一个东西了, HttpContext.Current中的<a href="https://msdn.microsoft.com/en-us/library/system.web.httpcontext.user.aspx" target="_blank" rel="noopener noreferrer">User</a>返回的就是实现了IPrincipal的一个对象. <a href="http://stackoverflow.com/questions/1064271/asp-net-mvc-set-custom-iidentity-or-iprincipal/10524305#10524305" target="_blank" rel="noopener noreferrer">Note</a>)</p><ul><li>ASP.Net Identity支持claims-base的认证, 用户的身份被表示成一个claims集合. Claims允许开发者描述角色允许的用户身份. 而角色仅仅是一个布尔值(是角色成员或不是), claim可以包括用户身份和关系的丰富信息.</li></ul></li><li><p>社交登录提供器</p><ul><li>你可以很容易添加社交登录功能使用Azure活动目录, 然后在你的应用里存储用户特殊数据.</li></ul></li><li><p>集成OWIN</p><ul><li>ASP.Net Identity 认证现在是基于OWIN中间件, 可以被使用在任何基于OWIN的宿主上. ASP.Net Identity在System.Web上没有任何依赖. 它完全兼容OWIN框架, 并可以被使用在任何基于OWIN的宿主应用中.</li></ul></li><li><p>NugGet包管理</p><ul><li>ASP.Net Identity使用NuGet包管理进行分发. 而NuGet工具被安装在VS 2013中. 你可以从NuGet上下载.</li><li>将ASP.Net Identity发布在NuGet上, 可使ASP.Net团队很容易迭代新特性和修复bug, 而且可以更快捷地分发到开发者手里.</li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="aspnet-identity起步">ASP.Net Identity起步<a class="hash-link" href="#aspnet-identity起步" title="Direct link to heading">​</a></h3><p>ASP.Net Identity被用在VS 2013 的MVC, Web Forms, Web API和SPA模板里. 在这个演练里, 我们将说明项目模板如果使用ASP.Net Identity的注册, 登陆和登出功能的.
ASP.Net Identity被实现使用下面步骤. 这篇文章的目的是让你对ASP.Net Identity有一个概览; 你可以跟着一步一步的操作或者仅仅阅读详细信息. 像获得使用ASP.Net Identity创建应用的更详细的介绍, 包括使用新的API来添加用户, 角色和配置信息, 可以查看文章底部的下一步节.</p><ul><li><p>使用独立账号(Individual User Accounts)创建ASP.Net MVC应用.你可以使用ASP.Net Identity在ASP.Net MVC, Web Forms, Web API, SignalR等等项目中. 在这篇文章中我们开始创建一个ASP.Net MVC应用. <a href="http://i2.asp.net/media/4459035/mvc.PNG?cdn_id=2015-05-22-001" target="_blank" rel="noopener noreferrer">图片</a></p></li><li><p>创建的项目包含以下三个ASP.Net Identity相关的包</p><ul><li><em>Microsoft.AspNet.Identity.EntityFramework</em>
这个包有ASP.Net Identity的EF实现, 它将会持久化ASP.Net Identity数据和架构在SQL Server里.</li><li><em>Microsoft.AspNet.Identity.Core</em>
这个包包含ASP.Net Identity的核心接口. 这个包可以被用来实现不同的持久化存储, 比如Azure Table Storage, NoSQL数据库等.</li><li><em>Microsoft.AspNet.Identity.OWIN</em>
这个包包含将ASP.Net Identity的OWIN认证插入到ASP.Net应用的功能. 这被用来给你的应用添加登陆功能并调用OWIN Cookie Authentication中间件来生成Cookie的功能.</li></ul></li><li><p>创建用户</p></li></ul>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label=".net" term=".net"/>
        <category label="asp.net" term="asp.net"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[我的Vim配置]]></title>
        <id>/2019/03/20/vim-config</id>
        <link href="https://blog.alanwei.com/blog/2019/03/20/vim-config"/>
        <updated>2019-03-20T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[我的Vim配置]]></summary>
        <content type="html"><![CDATA[<p>我的Vim基本配置: </p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置">配置<a class="hash-link" href="#配置" title="Direct link to heading">​</a></h2><p>Windows配置文件为 <code>~/_vimrc</code>, Unix配置文件为 <code>~/.vimrc</code></p><p>配置内容为: </p><div class="language-rc codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">.vimrc</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rc codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">"colo koehler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">filetype plugin on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set rnu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set nu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set nocompatible</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set noswapfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set noswf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set encoding=utf-8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set fileencoding=utf-8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set autoindent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set showcmd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set shiftwidth=4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set tabstop=4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set softtabstop=4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="其他">其他<a class="hash-link" href="#其他" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="vim-ctrl--s">Vim Ctrl + S<a class="hash-link" href="#vim-ctrl--s" title="Direct link to heading">​</a></h3><ul><li><a href="https://superuser.com/questions/1390977/pressing-ctrl-s-by-mistake-while-using-vim" target="_blank" rel="noopener noreferrer">Pressing "Ctrl + S" by mistake while using Vim</a></li><li><a href="https://www.rockyourcode.com/vim-trick-map-ctrl-s-to-save/" target="_blank" rel="noopener noreferrer">Vim Trick: Map CTRL+S to Save</a></li></ul><p><strong>解释</strong></p><p>当你在vim使用<strong>ctrl+s</strong>快捷键之后, vim好像被锁定了, 除非你按下<strong>ctrl+q</strong>退出该模式. 这个叫做 <a href="https://en.wikipedia.org/wiki/Software_flow_control" target="_blank" rel="noopener noreferrer">Software flow control</a>.</p><p><strong>禁用</strong></p><p>编辑<code>~/.bashrc</code>增加一行<code>stty -ixon</code>即可禁用vim的<code>ctrl+s</code>功能.</p><p><strong>改造成文件保存</strong></p><p>禁用<code>ctrl+s</code>功能之后, 修改vim配置文件(<em>.vimrc</em>), 可以把vim的<code>ctrl+s</code>快捷键改成保存当前文件:</p><div class="language-rc codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">.vimrc</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rc codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">" normal mode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nnoremap &lt;silent&gt;&lt;c-s&gt; :&lt;c-u&gt;update&lt;cr&gt; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">" visual mode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vnoremap &lt;silent&gt;&lt;c-s&gt; &lt;c-c&gt;:update&lt;cr&gt;gv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">" insert mode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">inoremap &lt;silent&gt;&lt;c-s&gt; &lt;c-o&gt;:update&lt;cr&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="vim" term="vim"/>
        <category label="editor" term="editor"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[异步编程简介]]></title>
        <id>/2019/03/06/async</id>
        <link href="https://blog.alanwei.com/blog/2019/03/06/async"/>
        <updated>2019-03-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[JavaScript]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="javascript">JavaScript<a class="hash-link" href="#javascript" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="promise">Promise<a class="hash-link" href="#promise" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="简述promise发展历程">简述Promise发展历程<a class="hash-link" href="#简述promise发展历程" title="Direct link to heading">​</a></h4><p>Promise 一词最早由一个C++工程师用在Xanadu项目中, 随后Promise被用在E语言当中, 这又激发了Python开发人员的灵感, 将它实现成了Twisted框架的<code>Deferred</code>对象. 2007年, JavaScript框架Dojo借鉴Twisted新增了<code>dojo.Deferred</code>对象. 2009年, Kris Zyp提出了CommonJS中的Promises/A规范. #1</p><p>Q.js是Promises/A规范比较著名的实现. jQuery在1.5版本基于Promises／A规范加入了Promise实现, 不过和Promises/A有一些细微的差别.</p><p>主要区别是Deferred和Promise之间的区别, 在Q.js中deferred有一个<code>promise</code>属性作为唯一接口监听状态变化, 使用deferred对象上的<code>resolve</code>和<code>reject</code>函数改变状态. 而在jQuery中<code>$.Deferred</code>对象既是promise也是deferred, 能监听状态变化, 也能改变状态. 不过jQuery在<code>$.Deferred</code>对象上提供了<code>promise()</code>方法可以返回一个promise #2.</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Q</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">defer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">promise</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">Deferred</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// or</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">promise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>另外在ES6标准中定义了原生Promise对象 #3.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="展示promise在ajax请求上的应用">展示Promise在Ajax请求上的应用<a class="hash-link" href="#展示promise在ajax请求上的应用" title="Direct link to heading">​</a></h4><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//Callback</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function-variable function" style="color:#d73a49">success</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">renderPage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">startAnimation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function-variable function" style="color:#d73a49">fail</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">alertError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//Promise</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> promise </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">promise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">fail</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token function" style="color:#d73a49">alertError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token spread operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">.</span><span class="token comment" style="color:#999988;font-style:italic">//do other</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">renderPage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">promise</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">startAnimation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">promise</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token spread operator" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Promise相对于传统的回调函数方式最大的优势就是封装, 可以把一个异步任务当成一个参数进行传递. 因此我们可以很轻松从一个Promise对象派生出来一个Promise:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//ref: http://api.jquery.com/deferred.then/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> defer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">Deferred</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> filtered </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> defer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">defer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">filtered</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//value =&gt; 20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//ref: https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'flowers.jpg'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">blob</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">myBlob</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> objectURL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">URL</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createObjectURL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">myBlob</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  myImage</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">src</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> objectURL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>也可以将多个并行的Promise合并成一个Promise, 由后者负责通知前面的任务都已经完成:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">when</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/users"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/roles"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> users </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> roles </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">  data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token known-class-name class-name">Promise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">all</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/users"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/roles"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> users </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> roles </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">sa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="简述promise和pubsub的区别">简述Promise和Pub/Sub的区别<a class="hash-link" href="#简述promise和pubsub的区别" title="Direct link to heading">​</a></h4><ul><li>Promise一般用于一次性事件, 事件的结果有两种. 比如Ajax请求, 文件读取.</li></ul><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">response</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token parameter">error</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">readFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token parameter">error</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Pub/Sub 模式一般用于需要多次触发, 有多种结果. 比如HTTP服务器: </li></ul><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> server </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"http"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">req</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">end</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"connection"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token parameter">socket</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//new connection</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"error"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token parameter">error</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"close"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">listen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3001</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"listen 3001"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者Web组件之间的通信, 比如Angular 1.X中父子控制器通过事件传播通信.</p><p>另外使用 $({}) 可以快速实现一个 Pub/Sub 模式:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> $pubSub </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">$</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$pubSub</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"message"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">e</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//=&gt; Hello</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$pubSub</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">trigger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"message"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"Hello"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="generator">Generator<a class="hash-link" href="#generator" title="Direct link to heading">​</a></h3><p>ES6除了内置Promise函数, 也增加了生成器特性.
利用生成器可以模仿C#代码中的async/await模式, 让异步代码编写起来更像同步代码.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="一个简单的生成器函数例子">一个简单的生成器函数例子<a class="hash-link" href="#一个简单的生成器函数例子" title="Direct link to heading">​</a></h4><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">generator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword control-flow" style="color:#00009f">yield</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"hello"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"continue"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword control-flow" style="color:#00009f">yield</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"world"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> gen </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">generator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gen</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gen</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"first"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gen</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"second"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/* output:</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">{ value: 'hello', done: false }</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">first</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">continue</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">{ value: 'world', done: false }</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">second</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">{ value: undefined, done: true } //undfined 是因为函数没有返回值</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以利用生成器的<code>yield async()</code>让函数暂停, 再使用<code>next(data)</code>异步将结果传递出去来模拟async/await特性: </p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> fs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"fs"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">readFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">readFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__dirname </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">error</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gen</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">generator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> pkg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">yield</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">readFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/package.json"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> index </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">yield</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">readFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/index.html"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> gen </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">generator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gen</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//=&gt; { value: '/package.json', done: false }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>进一步封装</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> fs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"fs"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">runAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">generator</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> it </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">generator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> yieldValue</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">recurise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        yieldValue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> it</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">yieldValue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">done</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        yieldValue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">response</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">recurise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token parameter">error</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            it</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword control-flow" style="color:#00009f">throw</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">recurise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">readFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//读取文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Promise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> reject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">readFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__dirname </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">error</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">reject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">runAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//使用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> pkg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">yield</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">readFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/package.json"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> index </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">yield</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">readFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/index.html"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="asyncawait">async/await<a class="hash-link" href="#asyncawait" title="Direct link to heading">​</a></h3><p>从ES7开始, JavaScript内置了async/await特性, 可以更方便编写异步代码.</p><blockquote><p>The async and await keywords first hit the scene way back in 2010, when it was introduced in FSharp, CSharp, and VB followed fairly quickly in 2012, with Python and TypeScript adopting them in 2015.
<a href="https://blog.stephencleary.com/2017/06/async-javascript.html" target="_blank" rel="noopener noreferrer">Async JavaScript</a></p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="c">C#<a class="hash-link" href="#c" title="Direct link to heading">​</a></h2><ul><li>上下文捕获 导致异常 </li><li>闭包 和 JS 闭包变量捕获的区别</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// 迭代子部门</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;param name="departments"&gt;所有部门&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;param name="root"&gt;根部门&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;returns&gt;&lt;/returns&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static IEnumerable&lt;Department&gt; IterateDepartments(IEnumerable&lt;Department&gt; departments, Department root)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (departments == null) throw new ArgumentNullException("departments");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (root == null) throw new ArgumentNullException("root");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (String.IsNullOrWhiteSpace(root.DeptID)) throw new ArgumentNullException("DeptId", "部门Id不能为空");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    foreach (Department child in departments.Where(dept =&gt; dept.ParentID == root.DeptID))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        yield return child;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        foreach (var iterator in IterateDepartments(departments, child))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            yield return iterator;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public IEnumerator&lt;IEnumerator&lt;Foo&gt;&gt; GetEnumerator()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    yield return Database[id].GetEnumerator();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>RxJS</p><ul><li><a href="https://en.wikipedia.org/wiki/Futures_and_promises" target="_blank" rel="noopener noreferrer">1</a></li><li><a href="https://github.com/kriskowal/q/wiki/Coming-from-jQuery" target="_blank" rel="noopener noreferrer">2</a></li><li><a href="http://www.ecma-international.org/ecma-262/6.0/#sec-promise-objects" target="_blank" rel="noopener noreferrer">3</a></li></ul>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="async" term="async"/>
        <category label="javascript" term="javascript"/>
        <category label="csharp" term="csharp"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[哲学思维讲堂 - 卡尔·雅斯贝尔斯]]></title>
        <id>/2014/09/09/philosophy-note</id>
        <link href="https://blog.alanwei.com/blog/2014/09/09/philosophy-note"/>
        <updated>2014-09-09T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[《哲学思维讲堂 - 卡尔·雅斯贝尔斯》摘抄]]></summary>
        <content type="html"><![CDATA[<p>《哲学思维讲堂 - 卡尔·雅斯贝尔斯》摘抄</p><ol><li>我们不应厚古薄今。今天单个的人拒绝虚假的安慰，面对最糟糕的状态，仍然保持坦率的真诚，从无知的信仰出发，简朴地履行日常工作，并且乐观地死去。这样的人是多么自由，多么具有素朴的尊严！一个自身所是的人，这是多么灿烂夺目的人的。</li><li>世界解除了巫术。科学和技术把我们从巫术中解放出来，而且使得我们在自然中很容易维持我们的物质生存。今天，巫术操作不仅在实践上是一种不法行为，而且是一种背叛自身知性的人的不诚实行为。尽管世界解除了巫术，但是人们在技术实践方面产生的感受却是完全相反的。实际上，当人们开电灯，调准收音机，驾驶汽车时，他们并不知道那里发生什么事情。人们学习技术操作，但他们只知道这件事不足为奇，亦即科学技术使然。但是，人们期望世界中的一切都变成这个样子。并且，他们会这样想：我们理解诸多事情，尽管我们并不理解一切，但是从原则上所有的事都可以被完全认识。科学还不能制造生物或人，但人们认为，有朝一日能够制造。</li></ol>]]></content>
        <author>
            <name>Alan</name>
            <uri>https://github.com/alanwei43</uri>
        </author>
        <category label="哲学思维讲堂" term="哲学思维讲堂"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[数学系和物理系学生有什么差别？]]></title>
        <id>/2014/09/04/math-physics-diff</id>
        <link href="https://blog.alanwei.com/blog/2014/09/04/math-physics-diff"/>
        <updated>2014-09-04T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[我曾经最大的梦想，就是嫁给一个数学家。]]></summary>
        <content type="html"><![CDATA[<section style="margin-top:1em"><hr><ul style="margin-left:-1em"><li>作者: <a href="http://zhi.hu/4k68" target="_blank">唐知Tata</a></li><li>来源: <a href="http://zhi.hu/4k68" target="_blank">http://zhi.hu/4k68</a></li><li>本文仅用于本人学习和存档, 文章所有权归作者 <a href="http://zhi.hu/4k68" target="_blank">唐知Tata</a> 所有, 如有侵权请发送邮件至 <a href="mailto:me@alanwei.com?subject=删除侵权文章" target="_top">me#alanwei.com(<i>#换成@</i>)</a> 删除此文.</li></ul><hr></section><p>我曾经最大的梦想，就是嫁给一个数学家。</p><p>他要当个黑匣子。我解不出来的方程，积不出来的积分，往他哪里一丢，过一会儿就来取新鲜的暖烘烘的答案。</p><p>他说：我帮你解出来了，有什么奖励呀？</p><p>我说：明天再奖励你一道。</p><p>他非常开心地用很高的频率点头，我如果在他下巴安根针，就可以用他来缝衣服。</p><p>我怀揣着这个梦想去旁听了数学系的课。原因之一是为了逃避我们系喜欢坐前排的不洗头的男生。</p><p>结果我什么都没听懂。不。我们学物理的也都很聪明的。听不懂不是因为听不懂，是因为数学系的男生长得实在太好看了。干干净净的，可以不用洗直接吃。</p><p>我挑来挑去，最后挑定了一个数学系男生，据说绩点3.78，不用洗直接吃。</p><p>那天我跟带我去数学系旁听的数学系女生一起在图书馆自习。那个男生也过来了。除了我之外，我们都在认认真真地看书。</p><p>那个女生突然开口说话了:正交矩阵是什么啊？好多矩阵啊我都一直很混淆。</p><p>我们物理系先学了线性代数，但是他们学得比较仔细所以很慢。我当时非常激动，没等那个男生开口，就说我知道我知道，然后就把答案说出来了。还解释了她混淆的其他几个矩阵。</p><p>那个男生微笑看着我，点点头说她说得对，还补充了一点我没说清楚的，我当然是没有听进去他补充的什么。</p><p>我开心得差点晕过去，觉得他已经是我的黑匣子了。</p><p>后来那个数学系的女生告诉我，那个男生在她生日的时候给她买了一个挺贵的礼物。我才知道我挑错人了。但是心里还是不服气地想，两个读数学的在一起，就不是黑匣子了，是两个透明的盒子，里面的零件，齿轮，看得清清楚楚，有什么意思呢。要物理系的跟数学系的，他是我的黑匣子，我是他的猫，这样才好。</p><p>但是我后来就没什么机会接触数学系的男生了。只是心里还一直存着当年第一次在数学系阳光充足的教室里面心里的惊叹：数学系的人为什么看起来这么干净！</p><p>我跟朋友聊，朋友说，可能是数学本来就比物理干净很多。所以学数学的人就是爱干净的人，学物理的人总是要接受脏的。数学系的见了我们这理论恐怕又要说逻辑不严密了。然而我们就是看到了实验现象，就胡诌出一个理论来的，直到理论的预言再被实验推翻，否则是死不认账的。</p><p>虽然其实后来也发现了我们系很多会洗头发的男神，却也总是抹不掉“学数学的人干净学物理的人脏”的印象了。</p><p>其实也许只是那天阳光太好罢了。</p>]]></content>
        <author>
            <name>唐知Tata</name>
            <uri>http://www.zhihu.com/people/tang-zhi-tata</uri>
        </author>
        <category label="转摘" term="转摘"/>
        <category label="知乎" term="知乎"/>
    </entry>
</feed>