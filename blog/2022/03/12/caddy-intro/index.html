<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Alan's Blog Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Alan's Blog Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WSJXZXE31N"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-WSJXZXE31N",{anonymize_ip:!0})</script>
<script src="/scripts/baidu.js"></script><title data-react-helmet="true">Caddy ç®€ä»‹  -  Alan&#x27;s Blog</title><meta data-react-helmet="true" property="og:title" content="Caddy ç®€ä»‹  -  Alan&#x27;s Blog"><meta data-react-helmet="true" name="description" content="Caddy ä½¿ç”¨ä»‹ç»"><meta data-react-helmet="true" property="og:description" content="Caddy ä½¿ç”¨ä»‹ç»"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link rel="stylesheet" href="/styles.66a1e391.css">
<link rel="preload" href="/styles.29ee7585.js" as="script">
<link rel="preload" href="/runtime~main.6b681f2b.js" as="script">
<link rel="preload" href="/main.67ab7898.js" as="script">
<link rel="preload" href="/1.fdda8468.js" as="script">
<link rel="preload" href="/2.92b1c921.js" as="script">
<link rel="preload" href="/3.cee7ea17.js" as="script">
<link rel="preload" href="/ccc49370.e0293a73.js" as="script">
<link rel="preload" href="/0396100f.9c723a12.js" as="script">
<link rel="preload" href="/82d0ae0c.e945e357.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><div><nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top navbarHideable_17Wu navbarHidden_19ww"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.png" alt="logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Alan&#x27;s Blog</strong></a><a class="navbar__item navbar__link" href="/docs/">æ–‡æ¡£</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">åšå®¢</a><a class="navbar__item navbar__link" href="/me">å…³äºæˆ‘</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/alanwei43" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ğŸŒ</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.png" alt="logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Alan&#x27;s Blog</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">æ–‡æ¡£</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">åšå®¢</a></li><li class="menu__list-item"><a class="menu__link" href="/me">å…³äºæˆ‘</a></li><li class="menu__list-item"><a href="https://github.com/alanwei43" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--2"><div class="sidebar_1wv2 thin-scrollbar"><h3 class="sidebarItemTitle_3lOc">çƒ­é—¨åšæ–‡</h3><ul class="sidebarItemList_2WIo"><li class="sidebarItem_iPNH"><a class="sidebarItemLink_2E17" href="/blog/tags">Tagsåˆ—è¡¨</a></li><li class="sidebarItem_iPNH"><a class="sidebarItemLink_2E17" href="/blog/2014/09/04/math-physics-diff">æ•°å­¦ç³»å’Œç‰©ç†ç³»å­¦ç”Ÿæœ‰ä»€ä¹ˆå·®åˆ«ï¼Ÿ</a></li><li class="sidebarItem_iPNH"><a class="sidebarItemLink_2E17" href="/blog/2021/02/17/java-network-proxy">è®¾ç½®Javaç½‘ç»œä»£ç†</a></li><li class="sidebarItem_iPNH"><a class="sidebarItemLink_2E17" href="/blog/2021/04/23/è¯­æ–‡è€ƒè¯•å¯ä»¥å†™è´Ÿèƒ½é‡ä½œæ–‡å—">è¯­æ–‡è€ƒè¯•å¯ä»¥å†™è´Ÿèƒ½é‡ä½œæ–‡å—</a></li><li class="sidebarItem_iPNH"><a class="sidebarItemLink_2E17" href="/blog/2021/04/11/windows-bootable-device">åˆ¶ä½œWindowså¯åŠ¨ç›˜</a></li><li class="sidebarItem_iPNH"><a class="sidebarItemLink_2E17" href="/blog/2021/04/11/iis-reverse-proxy">é…ç½®IISåå‘ä»£ç†</a></li><li class="sidebarItem_iPNH"><a class="sidebarItemLink_2E17" href="/blog/2021/04/10/node-require-cache">Node require ç¼“å­˜</a></li><li class="sidebarItem_iPNH"><a class="sidebarItemLink_2E17" href="/blog/2021/04/02/docker-timezone">Dockeræ—¶åŒºè®¾ç½®</a></li><li class="sidebarItem_iPNH"><a aria-current="page" class="sidebarItemLink_2E17 sidebarItemLinkActive_2Dvr" href="/blog/2022/03/12/caddy-intro">Caddy ç®€ä»‹</a></li><li class="sidebarItem_iPNH"><a class="sidebarItemLink_2E17" href="/blog/2022/03/12/docker-history-full-command">docker historyå‘½ä»¤æ˜¾ç¤ºå®Œæ•´ä¿¡æ¯</a></li><li class="sidebarItem_iPNH"><a class="sidebarItemLink_2E17" href="/blog/2022/03/12/macos-security-allow-apps-anywhere">macOSç³»ç»Ÿå®‰å…¨éšç§è®¾ç½®å…è®¸ä»»æ„æºä¸‹è½½çš„App</a></li><li class="sidebarItem_iPNH"><a class="sidebarItemLink_2E17" href="/blog/2022/03/10/spring-both-support-json-url-encoded">Spring æ¥å£åŒæ—¶æ”¯æŒJSONæ•°æ®å’ŒFormè¡¨å•æ•°æ®</a></li><li class="sidebarItem_iPNH"><a class="sidebarItemLink_2E17" href="/blog/2022/03/08/flutter-practice-note">Flutterå®æˆ˜ ç¬¬äºŒç‰ˆ ç¬”è®°</a></li></ul></div></div><main class="col col--8"><article><header><h1 class="margin-bottom--lg blogPostTitle_kDB-">Caddy ç®€ä»‹</h1><div><time datetime="2022-03-12T00:00:00.000Z" class="blogPostDate_2HVl">March 12, 2022  Â· 6 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/alanwei43" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/2927578?s=460&amp;u=153132e7aa3be8295a1703af9b759ca22338f557&amp;v=4" alt="Alan"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/alanwei43" target="_blank" rel="noreferrer noopener">Alan</a></h4><small class="avatar__subtitle">Maintainer of blog</small></div></div></header><section class="markdown"><p><a href="https://caddyserver.com/docs/" target="_blank" rel="noopener noreferrer">å®˜æ–¹ç»™çš„ç®€ä»‹</a>æ˜¯: Caddyæ˜¯ä¸€ä¸ªå¼ºå¤§çš„ã€å¯æ‰©å±•çš„å¹³å°, ç”¨äºä¼ºæœä½ çš„ç«™ç‚¹ã€æœåŠ¡ä»¥åŠåº”ç”¨. Caddyä½¿ç”¨Goè¯­è¨€ç¼–å†™.</p><p>ç®€å•æ¥è¯´, caddy å’Œ nginx å¾ˆåƒ, æˆ‘è§‰å¾—ç›¸æ¯”è¾ƒnginxæœ‰ä»¥ä¸‹ä¼˜ç‚¹:</p><ol><li><strong>å®‰è£…ç®€å•</strong> caddyçš„æ˜¯ä¸ª<a href="https://github.com/caddyserver/caddy/releases/" target="_blank" rel="noopener noreferrer">å•æ–‡ä»¶å¯æ‰§è¡Œç¨‹åº</a>, æ²¡æœ‰ä»»ä½•ä¾èµ–, ä¸‹è½½ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨. å¯¹äºç®€å•çš„webæœåŠ¡, ä½¿ç”¨å‘½ä»¤è¡Œå³å¯è¿è¡Œ, ä¸éœ€è¦ä»»ä½•é…ç½®æ–‡ä»¶.</li><li><strong>è‡ªåŠ¨ç­¾å‘HTTPSè¯ä¹¦</strong> caddyé»˜è®¤å¯¹æ‰€æœ‰ç«™ç‚¹å¼€å¯HTTPS(æ”¯æŒLet&#x27;s encrypt å’Œ ZeroSSLè¯ä¹¦è‡ªåŠ¨ç”³è¯·).</li><li><strong>åŸç”Ÿæ”¯æŒHTTP API</strong> æ”¯æŒä½¿ç”¨HTTP APIæ–¹å¼ä¿®æ”¹é…ç½®.</li></ol><p>ç¼ºç‚¹å°±æ˜¯ç”Ÿæ€å’Œæ€§èƒ½ä¸å¦‚nginx, ä¸è¿‡ä¸ªäººä½¿ç”¨ç»å¤§éƒ¨åˆ†åœºæ™¯éƒ½èƒ½holdä½.</p><p>Caddyç”±ZeroSSL<a href="https://github.com/caddyserver/caddy" target="_blank" rel="noopener noreferrer">å¼€æº</a>, å…¶åŸç”Ÿé…ç½®è¯­è¨€æ˜¯<a href="https://caddyserver.com/docs/json/" target="_blank" rel="noopener noreferrer">JSON</a>, ä½†æ˜¯æ‰‹å†™JSONé…ç½®æ¯”è¾ƒéº»çƒ¦ä¸”æ˜“é”™, æ‰€ä»¥Caddyæ”¯æŒé…ç½®é€‚é…å™¨(config adapter), é€‚é…å™¨æ˜¯é€šè¿‡æ’ä»¶å½¢å¼å®ç°. é™¤äº†å®˜æ–¹å»ºè®®ä½¿ç”¨çš„ <a href="https://caddyserver.com/docs/caddyfile" target="_blank" rel="noopener noreferrer">Caddyfile</a> æ–‡ä»¶é…ç½®, è¿˜æä¾›äº†<a href="https://github.com/caddyserver/nginx-adapter" target="_blank" rel="noopener noreferrer">nginxé…ç½®é€‚é…</a>. é€šè¿‡ <a href="https://github.com/caddyserver/nginx-adapter" target="_blank" rel="noopener noreferrer">nginx-adapter</a>, å¯ä»¥è®© caddy æ”¯æŒnginxçš„é…ç½®æ–‡ä»¶.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="åŸºæœ¬å‘½ä»¤"></a>åŸºæœ¬å‘½ä»¤<a class="hash-link" href="#åŸºæœ¬å‘½ä»¤" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="å¯åŠ¨"></a>å¯åŠ¨<a class="hash-link" href="#å¯åŠ¨" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># åœ¨å‰å°å¯åŠ¨ caddy æœåŠ¡, æŒ‰ ctrl + c ç»ˆæ­¢æœåŠ¡</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">caddy run --config ./Caddyfile --adapter caddyfile</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># åœ¨åå°å¯åŠ¨ caddy æœåŠ¡</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">caddy start --config ./Caddyfile --adapter caddyfile</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># æˆ–è€…ä½¿ç”¨ docker</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">docker run -d </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  --name caddy-run </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  -p </span><span class="token number">80</span><span class="token plain">:80 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  -p </span><span class="token number">443</span><span class="token plain">:443 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  -v </span><span class="token environment constant" style="color:rgb(189, 147, 249)">$PWD</span><span class="token plain">/Caddyfile /etc/caddy/Caddyfile </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  caddy</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>å…¶ä»–å‚æ•°:</p><ul><li><code>--adapter</code> ç”¨äºæŒ‡å®šé…ç½®é€‚é…å™¨(æ›´å¤šé€‚é…å™¨å‚è€ƒ: <a href="https://caddyserver.com/docs/config-adapters" target="_blank" rel="noopener noreferrer">config-adapters</a> )</li><li><code>--watch</code> å‚æ•°å¯ä»¥ç›‘è§†é…ç½®æ–‡ä»¶(ç”±å‚æ•°<code>--config</code>æŒ‡å®š)å˜åŒ–, å¹¶è‡ªåŠ¨é‡æ–°åŠ è½½æœåŠ¡</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="å¸¸ç”¨ä½¿ç”¨æ–¹å¼"></a>å¸¸ç”¨ä½¿ç”¨æ–¹å¼<a class="hash-link" href="#å¸¸ç”¨ä½¿ç”¨æ–¹å¼" title="Direct link to heading">#</a></h2><p>caddy æ”¯æŒCLIæ–¹å¼ä¼ºæœé™æ€æ–‡ä»¶å’Œåå‘ä»£ç†, åŒæ—¶æ”¯æŒé…ç½®æ–‡ä»¶è¿›è¡Œæ›´å¤æ‚çš„æœåŠ¡ä¼ºæœ.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="hello-world"></a>Hello world<a class="hash-link" href="#hello-world" title="Direct link to heading">#</a></h3><p>å‡è®¾é…ç½®æ–‡ä»¶å¦‚ä¸‹(éœ€è¦æŠŠ<code>demo.alanwei.com</code>æ›¿æ¢æˆä½ è‡ªå·±çš„åŸŸåæˆ–è€…<code>localhost</code>):</p><div class="mdxCodeBlock_1zKU"><div style="color:#F8F8F2;background-color:#282A36" class="codeBlockTitle_2eSY">Caddyfile</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">demo.alanwei.com</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">respond &quot;Hello, privacy!&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>æ‰§è¡Œå‘½ä»¤ <code>caddy run --config ./Caddyfile</code>, ç„¶åè®¿é—® <code>https://demo.alanwei.com</code> å°±ä¼šè¿”å› <code>Hello, privacy!</code>, HTTPS æ”¯æŒå®Œå…¨è‡ªåŠ¨åŒ–.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="é™æ€æ–‡ä»¶-static-files"></a>é™æ€æ–‡ä»¶ static files<a class="hash-link" href="#é™æ€æ–‡ä»¶-static-files" title="Direct link to heading">#</a></h3><p><strong>CLIæ–¹å¼</strong></p><p>åŸºæœ¬å‘½ä»¤ <code>caddy file-server</code> </p><p>ç¤ºä¾‹:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># æŒ‡å®šç«¯å£å·</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">caddy file-server --listen :2015 </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># ä¹ŸæŒ‡å®šç›®å½•</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">caddy file-server --root </span><span class="token environment constant" style="color:rgb(189, 147, 249)">$PWD</span><span class="token plain">/build --listen </span><span class="token number">0.0</span><span class="token plain">.0.0:3001</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>å¸¸ç”¨å‚æ•°:</p><ul><li><code>--listen [&lt;host&gt;]:&lt;port&gt;</code> æŒ‡å®šç›‘å¬çš„ç«¯å£å·, <code>&lt;host&gt;</code> å¯ä»¥çœç•¥</li><li><code>--browser</code> å¦‚æœç«™ç‚¹æ²¡æœ‰indexæ–‡ä»¶, å…è®¸åˆ—å‡ºç«™ç‚¹ä¸‹æ–‡ä»¶ç›®å½•</li><li><code>--root &lt;dir&gt;</code> é»˜è®¤ç«™ç‚¹ç›®å½•æ˜¯å½“å‰ç›®å½•, å¯é€šè¿‡æ”¹å‚æ•°ä¿®æ”¹é»˜è®¤è¡Œä¸º</li></ul><p><strong>Caddyfileæ–¹å¼</strong></p><p>å¯¹åº”çš„ <strong>Caddyfile</strong> åŸºæœ¬é…ç½®å¦‚ä¸‹:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">localhost:2015</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">file_server</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>æŒ‡ä»¤<a href="https://caddyserver.com/docs/caddyfile/directives/file_server" target="_blank" rel="noopener noreferrer">file_server</a>å¸¸ç”¨é€‰é¡¹: </p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">http://files.alanwei.com {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    root * /data/software # æŒ‡å®šç›®å½•</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    file_server browse {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        index &quot;REAME.md&quot; index.html index.txt # è®¾ç½®é¦–é¡µæ–‡ä»¶</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        hide android *.sh &quot;**/node_modules/**&quot; # éšè—ç‰¹å®šæ–‡ä»¶æˆ–ç›®å½•, æ”¯æŒå ä½ç¬¦å’Œglob patterns</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="åå‘ä»£ç†-reverse-proxy"></a>åå‘ä»£ç† reverse proxy<a class="hash-link" href="#åå‘ä»£ç†-reverse-proxy" title="Direct link to heading">#</a></h3><p><strong>CLIæ–¹å¼</strong></p><p>åŸºæœ¬å‘½ä»¤: <code>caddy reverse-proxy</code></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># æŠŠæ‰€æœ‰ localhost çš„è¯·æ±‚éƒ½è½¬å‘åˆ° 127.0.0.1:9000</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">caddy reverse-proxy --to </span><span class="token number">127.0</span><span class="token plain">.0.1:9000</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># æŠŠæ‰€æœ‰ *:3013 çš„è¯·æ±‚éƒ½è½¬å‘åˆ° 127.0.0.1:3010 , å¹¶ç¦ç”¨https</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">caddy reverse-proxy --insecure -from :3013 -to </span><span class="token number">127.0</span><span class="token plain">.0.1:3010</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>æ”¯æŒå‚æ•°:</p><ul><li><code>--change-host-header</code> ä¿®æ”¹upstreamçš„ <em>Host</em></li><li><code>--from [&lt;host&gt;]:&lt;port&gt;</code> æ¥æ”¶è¯·æ±‚çš„åœ°å€, é»˜è®¤æ˜¯ <em>localhost</em></li><li><code>--insecure</code> ç¦ç”¨ TLS æ ¡éªŒ</li><li><code>--to</code> ä»£ç†åˆ°çš„åœ°å€</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="caddyfile"></a>Caddyfile<a class="hash-link" href="#caddyfile" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="structure"></a>Structure<a class="hash-link" href="#structure" title="Direct link to heading">#</a></h3><p>Caddyfileçš„æ–‡ä»¶ç»“æ„å¦‚ä¸‹:</p><p><img src="https://caddyserver.com/resources/images/caddyfile-visual.png" alt="caddyfile"></p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><ul><li>æ–‡ä»¶å¼€å§‹çš„å…¨å±€é…ç½®å—(global options block)æ˜¯å¯é€‰çš„</li><li>å¦‚æœæ²¡æœ‰å…¨å±€é…ç½®å—, Caddyfile æ–‡ä»¶çš„ç¬¬ä¸€è¡Œä¸€å®šæ˜¯éœ€è¦ä¼ºæœçš„ç«™ç‚¹çš„åœ°å€(address)</li><li>å¦‚æœæ–‡ä»¶ä»…æœ‰ä¸€ä¸ªç«™ç‚¹é…ç½®å—(site block), é‚£é…ç½®å—çš„èŠ±æ‹¬å·(<code>{ }</code>)æ˜¯å¯ä»¥çœç•¥çš„</li></ul></div></div><p>Caddyfile è‡³å°‘æœ‰ä¸€ä¸ªç«™ç‚¹é…ç½®å—(site block), å¦‚æœæŒ‡ä»¤(directive)å‡ºç°åœ¨ç«™ç‚¹é…ç½®å—çš„åœ°å€(address)å‰, é‚£é…ç½®æ–‡ä»¶è§£æå°†ä¼šå¤±è´¥.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="blocks"></a>blocks<a class="hash-link" href="#blocks" title="Direct link to heading">#</a></h3><p>ä½¿ç”¨èŠ±æ‹¬å·å¼€å¯å’Œå…³é—­ä¸€ä¸ªblock:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">... {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  ...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li>å·¦èŠ±æ‹¬å·(<code>{</code>)å¿…é¡»åœ¨è¡Œå°¾</li><li>å³èŠ±æ‹¬å·(<code>}</code>)å¿…é¡»ç‹¬å ä¸€è¡Œ</li></ul><p>å½“é…ç½®æ–‡ä»¶ä»…æœ‰ä¸€ä¸ªç«™ç‚¹é…ç½®å—(site block), ä¸ºäº†æ–¹ä¾¿å¿«é€Ÿå®šä¹‰å•ä¸ªç«™ç‚¹, èŠ±æ‹¬å·(å’Œblockçš„å†…å®¹ç¼©è¿›)æ˜¯å¯é€‰çš„, æ¯”å¦‚:</p><div class="mdxCodeBlock_1zKU"><div style="color:#F8F8F2;background-color:#282A36" class="codeBlockTitle_2eSY">Caddyfile</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">localhost</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">reverse_proxy /api/* localhost:9001</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">file_server</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>ç­‰ä»·äº</p><div class="mdxCodeBlock_1zKU"><div style="color:#F8F8F2;background-color:#282A36" class="codeBlockTitle_2eSY">Caddyfile</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">localhost {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    reverse_proxy /api/* localhost:9001</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    file_server</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>å¦‚æœæœ‰å¤šä¸ªç«™ç‚¹, å¿…é¡»ä½¿ç”¨èŠ±æ‹¬å·:</p><div class="mdxCodeBlock_1zKU"><div style="color:#F8F8F2;background-color:#282A36" class="codeBlockTitle_2eSY">Caddyfile</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">example1.com {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    root * /www/example.com</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    file_server</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">example2.com {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    reverse_proxy localhost:9000</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>å¦‚æœä¸€ä¸ªè¯·æ±‚åŒ¹é…åˆ°äº†å¤šä¸ªå—(site block), åˆ™ä¼šé€‰ç”¨æœ€ç²¾ç¡®åœ°å€(address)çš„é‚£ä¸ªé…ç½®å—(site block), ä¹Ÿå°±æ˜¯è¯´è¯·æ±‚åªä¼šè¢«ä¸€ä¸ªblockæ¥ç®¡ï¼Œä¸ä¼šçº§è”ä¼ é€’åˆ°å¤šä¸ªblock.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="directives"></a>Directives<a class="hash-link" href="#directives" title="Direct link to heading">#</a></h3><p>æŒ‡ä»¤(directive)å…³é”®è¯ç”¨äºå®šä¹‰ç«™ç‚¹å¦‚ä½•è¢«ä¼ºæœ, æ¯”å¦‚<code>file_server</code>è¡¨ç¤ºé™æ€æ–‡ä»¶ç«™ç‚¹, <code>reverse_proxy</code>è¡¨ç¤ºåå‘ä»£ç†ç«™ç‚¹. </p><p>åœ¨ç«™ç‚¹é…ç½®å—é‡Œ(site block), æŒ‡ä»¤å¿…é¡»æ˜¯å…¶æ‰€åœ¨è¡Œçš„ç¬¬ä¸€ä¸ªå•è¯, æŒ‡ä»¤åé¢çš„å•è¯æ˜¯ä¼ ç»™æŒ‡ä»¤çš„å‚æ•°</p><blockquote><p>å½“Caddyfileè¢«é€‚é…çš„æ—¶å€™, æŒ‡ä»¤çš„ä¼šæŒ‰ç…§ä¸€å®šè§„åˆ™è¿›è¡Œæ’åº, å‚è€ƒ<a href="https://caddyserver.com/docs/caddyfile/directives#directive-order" target="_blank" rel="noopener noreferrer">directive order</a></p></blockquote><p>å­æŒ‡ä»¤å¯ä»¥å‡ºç°åœ¨æŒ‡ä»¤å—ä¸­:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">localhost</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">reverse_proxy localhost:9000 localhost:9001 {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    lb_policy first</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><code>lb_policy</code>(load balance policy) æ˜¯ <code>reverse_proxy</code> çš„å­æŒ‡ä»¤, ç”¨äºè®¾ç½®æœ‰å¤šä¸ªåç«¯æœåŠ¡æ—¶çš„è´Ÿè½½å‡è¡¡.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="tokens-and-quotes"></a>Tokens and quotes<a class="hash-link" href="#tokens-and-quotes" title="Direct link to heading">#</a></h3><p>è¯æ³•å’Œå¼•å·, è§£æCaddyfileçš„æ—¶å€™ï¼Œé€šè¿‡ç©ºæ ¼æ‹†åˆ†token, æ¯”å¦‚<code>directive abc def</code>è¡¨ç¤ºæŒ‡ä»¤ä¼šæ”¶åˆ°ä¸¤ä¸ªå‚æ•°, è€Œ<code>directive &quot;abc def&quot;</code>æŒ‡ä»¤å°±åªæ”¶åˆ°ä¸€ä¸ªå‚æ•°, å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼ä¼ é€’å¸¦æœ‰å¼•å·çš„å‚æ•°å€¼: </p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">directive &quot;\&quot;abc def\&quot;&quot;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">directive `&quot;abc def&quot;`</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="addresses"></a>Addresses<a class="hash-link" href="#addresses" title="Direct link to heading">#</a></h3><p>ç«™ç‚¹çš„åœ°å€(address)å¿…é¡»å‡ºç°åœ¨ç«™ç‚¹é…ç½®å—(site block)çš„å¼€å¤´, æœ‰æ•ˆçš„åœ°å€æ ¼å¼å¦‚ä¸‹:</p><ul><li><code>localhost</code></li><li><code>example.com</code></li><li><code>:443</code></li><li><code>http://example.com</code></li><li><code>localhost:8080</code></li><li><code>127.0.0.1</code></li><li><code>[::1]:2015</code></li><li><code>example.com/foo/*</code></li><li><code>*.example.com</code></li><li><code>http://</code></li></ul><p>å¦‚æœä½ æŒ‡å®šäº†ä¸»æœºå/åŸŸå(hostname), é‚£åªæœ‰è¯·æ±‚å¤´çš„<code>Host</code>å’ŒhostnameåŒ¹é…çš„è¯·æ±‚æ‰ä¼šè¢«å¤„ç†, å’Œhostnameä¸åŒ¹é…çš„è¯·æ±‚åˆ™ä¼šè¢«å¿½ç•¥. æ¯”å¦‚ç«™ç‚¹é…ç½®çš„åœ°å€æ˜¯<code>localhost</code>, é‚£caddyå°±ä¸ä¼šåŒ¹é…è¯·æ±‚å¤´<code>Host: 127.0.0.1</code> çš„è¯·æ±‚.</p><p>åœ°å€ä¸­å¯ä»¥ä½¿ç”¨é€šé…ç¬¦<code>*</code>, ä½†æ˜¯é€šé…ç¬¦åªä¼šåŒ¹é…ä¸€æ®µ, æ¯”å¦‚<code>*.example.com</code>ä¼šåŒ¹é…<code>foo.example.com</code>, ä½†æ˜¯ä¸ä¼šåŒ¹é…<code>foo.bar.example.com</code>. å¦å¤–, å¦‚æœä½¿ç”¨<code>*</code>ä½œä¸ºæ•´ä¸ªåœ°å€, ä¼šåŒ¹é…<code>localhost</code>, ä½†æ˜¯ä¸ä¼šåŒ¹é… <code>example.com</code>.</p><p>å¦‚æœå¤šä¸ªåœ°å€(address)ä½¿ç”¨ç›¸åŒçš„é…ç½®å®šä¹‰, å¯ä»¥æŠŠä»–ä»¬æ”¾åœ¨ä¸€èµ·, ä½¿ç”¨é€—å·åˆ†å‰²: </p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">localhost:8080, example.com, www.example.com {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"># æˆ–è€…å¦‚ä¸‹</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">localhost:8080,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">example.com,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">www.example.com {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>åŒååœ°å€ä¸èƒ½å¤šæ¬¡æŒ‡å®š.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="matchers"></a>Matchers<a class="hash-link" href="#matchers" title="Direct link to heading">#</a></h3><p>Request matchers ç”¨äºä½¿ç”¨æŒ‡å®šçš„æ ‡å‡†(specific criteria)æ¥è¿‡æ»¤æˆ–è€…ç•Œå®š(filter or classify)è¯·æ±‚.</p><p>åœ¨Caddyfileæ–‡ä»¶ä¸­, ä½¿ç”¨ matcher token(ä»¥ä¸‹ç®€ç§° åŒ¹é…è¯) é™å®šæŒ‡ä»¤çš„ä½œç”¨åŸŸ, å¯ç”¨çš„åŒ¹é…è¯å¦‚ä¸‹:</p><ul><li><code>*</code> åŒ¹é…æ‰€æœ‰çš„è¯·æ±‚(é»˜è®¤è¡Œä¸º)</li><li><code>/path</code> æŒ‰ç…§è¯·æ±‚è·¯å¾„åŒ¹é…</li><li><code>@name</code> ä½¿ç”¨å‘½ååŒ¹é…(named matcher)</li></ul><p>åŒ¹é…è¯(matcher token)é€šå¸¸æ˜¯å¯é€‰çš„, å¦‚æœçœç•¥åŒ¹é…è¯ç­‰åŒäºä½¿ç”¨é€šé…ç¬¦åŒ¹é…è¯: <code>*</code>.</p><p>ç®€å•ç¤ºä¾‹å¦‚ä¸‹:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">root *           /var/www  # matcher token: *</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">root /index.html /var/www  # matcher token: /index.html</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">root @post       /var/www  # matcher token: @post</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">reverse_proxy /api/* localhost:9000 # åŒ¹é…æ‰€æœ‰ /api/ çš„è¯·æ±‚è·¯å¾„</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>å¦‚æœæƒ³åŒ¹é…æ‰€æœ‰è¯·æ±‚, <code>*</code> å¯ä»¥çœç•¥, æ¯”å¦‚<code>reverse_proxy localhost:9000</code>ç­‰ä»·äº<code>reverse_proxy * localhost:9000</code>.</p><p>å¦‚æœæƒ³ä½¿ç”¨å¤šä¸ªåŒ¹é…æ¡ä»¶é™åˆ¶è¯·æ±‚, å¯ä»¥å®šä¹‰å‘½ååŒ¹é…(named matcher), ç„¶åé€šè¿‡<code>@name</code>å½¢å¼å¼•ç”¨å‘½ååŒ¹é…:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">@postfoo {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    method POST</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    path /foo/*</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">reverse_proxy @postfoo localhost:9000</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><strong>Path matchers</strong></p><p>è·¯å¾„åŒ¹é…è¯(path matcher token)å¿…é¡»ä»¥ <code>/</code> å¼€å§‹, é»˜è®¤è¯·æ±‚ä¸‹è·¯å¾„åŒ¹é…æ¨¡å¼æ˜¯å®Œå…¨åŒ¹é…, å¯ä»¥ä½¿ç”¨é€šé…ç¬¦è¿›è¡Œæ¨¡ç³ŠåŒ¹é…, æ¯”å¦‚ <code>/foo*</code> å¯ä»¥åŒæ—¶åŒ¹é…ä»¥ä¸‹è·¯å¾„:</p><ul><li><code>/foo</code></li><li><code>/foo/</code></li><li><code>/foobar</code></li></ul><p><strong>Named matchers</strong></p><p>æ‰€æœ‰éè·¯å¾„å’Œé€šé…ç¬¦åŒ¹é…çš„, éƒ½å¿…é¡»ä½¿ç”¨å‘½ååŒ¹é…(named matcher):</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">@websockets {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    header Connection *Upgrade*</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    header Upgrade    websocket</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">reverse_proxy @websockets localhost:6001</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>ä¸Šé¢çš„å‘½ååŒ¹é…åˆ™è¡¨ç¤ºä»…åŒ¹é…è¯·æ±‚å¤´<code>Connection</code>åŒ…å«<em>Upgrade</em>, ä¸”è¯·æ±‚å¤´<code>Upgrade</code>åŒ…å«<em>websocket</em>çš„è¯·æ±‚.</p><p>å¦‚æœå‘½ååŒ¹é…å™¨ä»…æœ‰ä¸€æ¡åŒ¹é…è§„åˆ™, å¯ä»¥å°†nameå’Œè§„åˆ™å†™åœ¨ä¸€è¡Œ:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">@post method POST</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">reverse_proxy @post localhost:6001</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>å‘½ååŒ¹é…å®šä¹‰äº†åŒ¹é…è§„åˆ™é›†, å®šä¹‰çš„è§„åˆ™ä½¿ç”¨ANDç»„åˆ, ä¹Ÿå°±æ˜¯è¯´è¯·æ±‚å¿…é¡»æ»¡è¶³æ‰€æœ‰è§„åˆ™æ‰ç®—é€šè¿‡å‘½ååŒ¹é….</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="placehodlers"></a>Placehodlers<a class="hash-link" href="#placehodlers" title="Direct link to heading">#</a></h3><p>ä¸ºäº†ä¾¿äºåœ¨é™æ€é…ç½®æ–‡ä»¶Caddyfileä¸­ä½¿ç”¨å˜é‡, Caddy æ”¯æŒä»¥ä¸‹å ä½ç¬¦(placeholder):</p><table><thead><tr><th>ç®€å†™</th><th>å…¨ç§°</th></tr></thead><tbody><tr><td><code>{dir}</code></td><td><code>{http.request.uri.path.dir}</code></td></tr><tr><td><code>{file}</code></td><td><code>{http.request.uri.path.file}</code></td></tr><tr><td><code>{header.*}</code></td><td><code>{http.request.header.*}</code></td></tr><tr><td><code>{host}</code></td><td><code>{http.request.host}</code></td></tr><tr><td><code>{labels.*}</code></td><td><code>{http.request.host.labels.*}</code></td></tr><tr><td><code>{hostport}</code></td><td><code>{http.request.hostport}</code></td></tr><tr><td><code>{port}</code></td><td><code>{http.request.port}</code></td></tr><tr><td><code>{method}</code></td><td><code>{http.request.method}</code></td></tr><tr><td><code>{path}</code></td><td><code>{http.request.uri.path}</code></td></tr><tr><td><code>{path.*}</code></td><td><code>{http.request.uri.path.*}</code></td></tr><tr><td><code>{query}</code></td><td><code>{http.request.uri.query}</code></td></tr><tr><td><code>{query.*}</code></td><td><code>{http.request.uri.query.*}</code></td></tr><tr><td><code>{re.*.*}</code></td><td><code>{http.regexp.*.*}</code></td></tr><tr><td><code>{remote}</code></td><td><code>{http.request.remote}</code></td></tr><tr><td><code>{remote_host}</code></td><td><code>{http.request.remote.host}</code></td></tr><tr><td><code>{remote_port}</code></td><td><code>{http.request.remote.port}</code></td></tr><tr><td><code>{scheme}</code></td><td><code>{http.request.scheme}</code></td></tr><tr><td><code>{uri}</code></td><td><code>{http.request.uri}</code></td></tr><tr><td><code>{tls_cipher}</code></td><td><code>{http.request.tls.cipher_suite}</code></td></tr><tr><td><code>{tls_version}</code></td><td><code>{http.request.tls.version}</code></td></tr><tr><td><code>{tls_client_fingerprint}</code></td><td><code>{http.request.tls.client.fingerprint}</code></td></tr><tr><td><code>{tls_client_issuer}</code></td><td><code>{http.request.tls.client.issuer}</code></td></tr><tr><td><code>{tls_client_serial}</code></td><td><code>{http.request.tls.client.serial}</code></td></tr><tr><td><code>{tls_client_subject}</code></td><td><code>{http.request.tls.client.subject}</code></td></tr><tr><td><code>{tls_client_certificate_pem}</code></td><td><code>{http.request.tls.client.certificate_pem}</code></td></tr><tr><td><code>{tls_client_certificate_der_base64}</code></td><td><code>{http.request.tls.client.certificate_der_base64}</code></td></tr><tr><td><code>{upstream_hostport}</code></td><td><code>{http.reverse_proxy.upstream.hostport}</code></td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="snippets"></a>Snippets<a class="hash-link" href="#snippets" title="Direct link to heading">#</a></h3><p>å¯ä»¥åœ¨Caddyfileä¸­å®šä¹‰ç‰‡æ®µ, æ–¹ä¾¿åœ¨å…¶ä»–blockä¸­å¤ç”¨, å¿…é¡»ä¸‹é¢å®šä¹‰ä¸€ä¸ªåä¸º <code>snippet</code> çš„ç‰‡æ®µ, ç„¶ååœ¨å¦å¤–å¦ä¸ªblockä¸­ä½¿ç”¨<code>import snippet</code>: </p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">(snippet) {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  respond &quot;Yahaha! You found {args.0}!&quot;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">a.example.com {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    import snippet &quot;Example A&quot;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">b.example.com {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    import snippet &quot;Example B&quot;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="comments"></a>Comments<a class="hash-link" href="#comments" title="Direct link to heading">#</a></h3><p>Caddyfileä¸­<code>#</code>åé¢çš„å†…å®¹è§†ä¸ºæ³¨é‡Š.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="automatic-https"></a>Automatic HTTPS<a class="hash-link" href="#automatic-https" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="overview"></a>Overview<a class="hash-link" href="#overview" title="Direct link to heading">#</a></h3><p>é»˜è®¤æƒ…å†µä¸‹, Caddyä½¿ç”¨HTTPSä¼ºæœæ‰€æœ‰ç«™ç‚¹</p><ul><li>å¯¹äºåœ°å€ä¸ºIPã€æœ¬åœ°åœ°å€æˆ–è€…å†…ç½‘åœ°å€çš„ç«™ç‚¹, æ¯”å¦‚ <code>localhost</code>, <code>127.0.0.1</code>ç­‰, Caddyä½¿ç”¨è‡ªç­¾åè¯ä¹¦ä¼ºæœ.(ä½¿ç”¨å‘½ä»¤<code>caddy trust</code>æ‰‹åŠ¨ä¿¡ä»»è¯ä¹¦)</li><li>å¯¹äºå…¬å¼€çš„DNDåŸŸå, æ¯”å¦‚<code>example.com</code>, <code>sub.example.com</code>æˆ–è€…<code>*.example.com</code>, Caddyä½¿ç”¨å…¬å¼€çš„ ACME CA è¯ä¹¦, æ¯”å¦‚ Let&#x27;s Encrypt æˆ–è€… ZeroSSL.</li></ul><p>Caddyè‡ªåŠ¨ä¸ºç«™ç‚¹ç»­ç­¾è¯ä¹¦, å¹¶é»˜è®¤æŠŠHTTPè¯·æ±‚è·³è½¬åˆ°HTTPS.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="activation"></a>Activation<a class="hash-link" href="#activation" title="Direct link to heading">#</a></h3><p>Caddyéšå¼è‡ªåŠ¨ä¸ºç«™ç‚¹æä¾›HTTPSæœåŠ¡ï¼Œæœ‰å¤šç§æ–¹å¼è®¾ç½®Caddyç«™ç‚¹çš„ä¼ºæœçš„åŸŸåæˆ–è€…IP:</p><ul><li><a href="https://caddyserver.com/docs/caddyfile" target="_blank" rel="noopener noreferrer">Caddyfile</a> çš„ <a href="https://caddyserver.com/docs/caddyfile/concepts#addresses" target="_blank" rel="noopener noreferrer">site address</a></li><li><a href="https://caddyserver.com/docs/modules/http#servers/routes" target="_blank" rel="noopener noreferrer">route</a> çš„ <a href="https://caddyserver.com/docs/json/apps/http/servers/routes/match/host/" target="_blank" rel="noopener noreferrer">host matcher</a></li><li>å‘½ä»¤è¡Œçš„å‚æ•°, æ¯”å¦‚ <a href="https://caddyserver.com/docs/command-line#caddy-file-server" target="_blank" rel="noopener noreferrer">--domain</a> æˆ–è€… <a href="https://caddyserver.com/docs/command-line#caddy-reverse-proxy" target="_blank" rel="noopener noreferrer">--from</a></li><li>è¯ä¹¦åŠ è½½å™¨: <a href="https://caddyserver.com/docs/json/apps/tls/certificates/automate/" target="_blank" rel="noopener noreferrer">automate</a></li></ul><p>ä¸‹é¢æ˜¯ç¦ç”¨Caddyé»˜è®¤HTTPSä¼ºæœè¡Œä¸ºçš„æ–¹æ³•:</p><ul><li><a href="https://caddyserver.com/docs/json/apps/http/servers/automatic_https/" target="_blank" rel="noopener noreferrer">æ˜¾å¼ç¦ç”¨</a></li><li>åœ¨é…ç½®æ–‡ä»¶ä¸­ä¸æä¾›ä»»ä½•ä¸»æœºåæˆ–IP</li><li>åœ°å€ä½¿ç”¨éHTTPç«¯å£å·(80, 443)</li><li>åœ°å€åè®®ä½¿ç”¨ <code>http</code></li><li>æ‰‹åŠ¨åŠ è½½è¯ä¹¦</li></ul><p>åœ¨Caddyfileé…ç½®æ–‡ä»¶çš„å…¨å±€é…ç½®é‡Œå¢åŠ <code>auto_https off</code>å³å¯æ˜¾å¼ç¦ç”¨caddyæ‰€æœ‰HTTPSä¼ºæœè¡Œä¸º.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="local-https"></a>Local HTTPS<a class="hash-link" href="#local-https" title="Direct link to heading">#</a></h3><p>ä¸ºäº†é€šè¿‡HTTPSä¼ºæœéå…¬å¼€ç«™ç‚¹(å³æœ¬åœ°ç«™ç‚¹), Caddyä½¿ç”¨è‡ªç­¾åè¯ä¹¦, ç­¾åè¯ä¹¦å­˜å‚¨åœ¨ <a href="https://caddyserver.com/docs/conventions#data-directory" target="_blank" rel="noopener noreferrer">Caddy&#x27;s data directory</a> çš„ <code>pki/authorities/local</code> ç›®å½•ä¸‹.</p><p>Caddyçš„æ•°æ®ç›®å½•(data directory)é»˜è®¤è·¯å¾„ä¸º:
| OS | Data directory path |
| ---- | ---- |
| Linux, BSD | <code>$HOME/.local/share/caddy</code> |
| Windows | <code>%AppData%\Caddy</code> |
| macOS | <code>$HOME/Library/Application Support/Caddy</code> |
| Plan 9 | <code>$HOME/lib/caddy</code> |
| Android | <code>$HOME/caddy</code> (or <code>/sdcard/caddy</code>) |</p><p>å¦‚æœå­˜åœ¨ç¯å¢ƒå˜é‡<code>XDG_DATA_HOME</code>, ä¼˜å…ˆä½¿ç”¨ç¯å¢ƒå˜é‡æŒ‡å®šçš„ç›®å½•.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="å¸¸ç”¨æŒ‡ä»¤"></a>å¸¸ç”¨æŒ‡ä»¤<a class="hash-link" href="#å¸¸ç”¨æŒ‡ä»¤" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="log"></a>log<a class="hash-link" href="#log" title="Direct link to heading">#</a></h3><p><strong>è¯­æ³•</strong></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">log {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    output &lt;writer_module&gt; ...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    format &lt;encoder_module&gt; ...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    level  &lt;level&gt;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><strong>ç¤ºä¾‹</strong></p><div class="mdxCodeBlock_1zKU"><div style="color:#F8F8F2;background-color:#282A36" class="codeBlockTitle_2eSY">Caddyfile</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">books.alanwei.com {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    reverse_proxy localhost:8088</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    log {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        output file books.alanwei.com.access.log {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            roll_size 10MiB # è®¾ç½®æ–‡ä»¶å¤§å°</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            roll_keep 10 # è®¾ç½®æ–‡ä»¶ä¿ç•™æ•°é‡</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            roll_keep_for 48h # è®¾ç½®æ—¥å¿—ä¿ç•™æ—¶é•¿</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        format console # è¿˜æ”¯æŒ json</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        level INFO</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="basicauth---http-basic-authentication"></a>basicauth - HTTP Basic Authentication<a class="hash-link" href="#basicauth---http-basic-authentication" title="Direct link to heading">#</a></h3><p>è®¾ç½®HTTPåŸºæœ¬è®¤è¯åŠŸèƒ½.</p><p>Caddyé…ç½®æ–‡ä»¶é‡Œçš„å¯†ç å¿…é¡»hashè®¡ç®—ä¹‹åçš„, å¯ä»¥ä½¿ç”¨ <code>caddy hash-password</code> å‘½ä»¤è®¡ç®—å¯†ç çš„hash.</p><p>ç”¨æˆ·è®¿é—®è®¤è¯é€šè¿‡å, <code>{http.auth.user.id}</code> å ä½ç¬¦å°±å˜æˆå¯ç”¨äº†, å…¶å€¼æ˜¯ç”¨æˆ·å.</p><p><strong>è¯­æ³•</strong></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">basicauth [&lt;matcher&gt;] [&lt;hash_algorithm&gt; [&lt;realm&gt;]] {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;username&gt; &lt;hashed_password_base64&gt; [&lt;salt_base64&gt;]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    ...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><code>&lt;hash_algorithm&gt;</code> å¯†ç çš„hashç®—æ³•, å¯ä»¥æ˜¯<code>bcrypt</code>(é»˜è®¤)æˆ–è€…<code>scrypt</code></li><li><code>&lt;realm&gt;</code> is a custom realm name.</li><li><code>&lt;username&gt;</code> ç”¨æˆ·åæˆ–è€…ç”¨æˆ·Id</li><li><code>&lt;hashed_password_base64&gt;</code> hashå¯†ç ç»è¿‡base64ç¼–ç çš„å€¼(ä½¿ç”¨ <code>caddy hash-password</code> è®¡ç®—)</li><li><code>&lt;salt_base64&gt;</code> è®¡ç®—hashå¯†ç ä½¿ç”¨çš„saltçš„base64ç¼–ç åçš„å€¼</li></ul><p><strong>ç¤ºä¾‹</strong></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">books.alanwei.com {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    reverse_proxy localhost:8088</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    basicauth * {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        alan JDJhJDE0JHhpVUtuU09za3dGT1F6RnlMOUlycE9kTXhoYWlOQmVleVl0dzFJczdpdkF2cUdFY3JSN3RL</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="redir---http-redirect"></a>redir - HTTP redirect<a class="hash-link" href="#redir---http-redirect" title="Direct link to heading">#</a></h3><p>è¿”å›3xxè·³è½¬å“åº”</p><p><strong>è¯­æ³•</strong></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">redir [&lt;matcher&gt;] &lt;to&gt; [&lt;code&gt;]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><code>&lt;to&gt;</code> è·³è½¬çš„ç›®æ ‡åœ°å€, è¾“å‡ºåœ¨å“åº”å¤´çš„<code>Location</code>ä¸­</li><li><code>&lt;code&gt;</code> HTTPå“åº”çŠ¶æ€ç , å…è®¸çš„å€¼å¦‚ä¸‹<ul><li><em>3xx</em> çš„æ•´æ•°</li><li><code>permanent</code> æ°¸ä¹…è·³è½¬(å“åº”çŠ¶æ€ç  <em>301</em>)</li><li><code>temporary</code> ä¸´æ—¶è·³è½¬(å“åº”çŠ¶æ€ç  <em>302</em>, é»˜è®¤è¡Œä¸º)</li><li><code>html</code> å“åº”ä¸€æ®µHTMLæ–‡æ¡£åœ¨å®¢æˆ·ç«¯æ‰§è¡Œè·³è½¬</li></ul></li></ul><p><strong>ç¤ºä¾‹</strong></p><ul><li><code>redir https://example.com</code> æ‰€æœ‰è¯·æ±‚è·³è½¬åˆ° <code>https://example.com</code></li><li><code>redir https://example.com{uri}</code> æ•ˆæœåŒä¸Š, ä½†æ˜¯ä¼šä¿ç•™URI</li><li><code>redir https://example.com{uri} permanent</code> æ•ˆæœåŒä¸Š, ä½†æ˜¯å“åº”çŠ¶æ€ç æ˜¯ 301</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="rewrite"></a>rewrite<a class="hash-link" href="#rewrite" title="Direct link to heading">#</a></h3><p>åœ¨å†…éƒ¨è¿›è¡Œè¯·æ±‚è½¬å‘, å®¢æˆ·ç«¯æ— æ„ŸçŸ¥, ç±»ä¼¼ä»£ç†è½¬å‘.</p><p><strong>è¯­æ³•</strong></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">rewrite [&lt;matcher&gt;] &lt;to&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><code>&lt;to&gt;</code> è®¾ç½®è¯·æ±‚çš„URI, ä»…ä»…æŒ‡å®šçš„éƒ¨åˆ†è¢«æ›¿æ¢. URI è·¯å¾„æ˜¯<code>?</code>ä¹‹å‰çš„å­—ç¬¦ä¸². å¦‚æœ<code>?</code>æ˜¯ç¼ºçœçš„, å…¨éƒ¨éƒ¨åˆ†éƒ½æ˜¯path.</li></ul><p><strong>ç¤ºä¾‹</strong></p><ul><li><code>rewrite * /foo.html</code> è½¬å‘æ‰€æœ‰è¯·æ±‚åˆ° <code>foo.html</code>, </li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="qa"></a>QA<a class="hash-link" href="#qa" title="Direct link to heading">#</a></h2><p>æ‰§è¡Œcaddyå‘½ä»¤å¦‚æœæç¤ºä»¥ä¸‹é”™è¯¯, éœ€è¦ä½¿ç”¨<code>sudo</code>æ‰§è¡Œ:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-log codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">loading initial config: loading new config: http app module: start: tcp: listening on :443: listen tcp :443: bind: permission denied</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>å¦‚æœå¤–éƒ¨ç½‘ç»œæ— æ³•è®¿é—®caddyä¼ºæœçš„web, æœ‰å¯èƒ½æ˜¯ç³»ç»Ÿé˜²ç«å¢™æ‹¦æˆªäº†, å¦‚æœæ˜¯linuxç³»ç»Ÿå¯ä»¥å°è¯•ä½¿ç”¨<code>ufw allow</code>å¼€æ”¾ç«¯å£å·.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/caddy">caddy</a><a class="margin-horiz--sm" href="/blog/tags/docker">docker</a><a class="margin-horiz--sm" href="/blog/tags/nginx">nginx</a><a class="margin-horiz--sm" href="/blog/tags/http">http</a></div></footer></article><div><a href="https://github.com/alanwei43/blog/tree/master/src/blog/2022-03-12-caddy-intro.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2022/03/12/docker-history-full-command"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">docker historyå‘½ä»¤æ˜¾ç¤ºå®Œæ•´ä¿¡æ¯ Â»</div></a></div></nav></div></main><div class="col col--2"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#åŸºæœ¬å‘½ä»¤" class="table-of-contents__link">åŸºæœ¬å‘½ä»¤</a><ul><li><a href="#å¯åŠ¨" class="table-of-contents__link">å¯åŠ¨</a></li></ul></li><li><a href="#å¸¸ç”¨ä½¿ç”¨æ–¹å¼" class="table-of-contents__link">å¸¸ç”¨ä½¿ç”¨æ–¹å¼</a><ul><li><a href="#hello-world" class="table-of-contents__link">Hello world</a></li><li><a href="#é™æ€æ–‡ä»¶-static-files" class="table-of-contents__link">é™æ€æ–‡ä»¶ static files</a></li><li><a href="#åå‘ä»£ç†-reverse-proxy" class="table-of-contents__link">åå‘ä»£ç† reverse proxy</a></li></ul></li><li><a href="#caddyfile" class="table-of-contents__link">Caddyfile</a><ul><li><a href="#structure" class="table-of-contents__link">Structure</a></li><li><a href="#blocks" class="table-of-contents__link">blocks</a></li><li><a href="#directives" class="table-of-contents__link">Directives</a></li><li><a href="#tokens-and-quotes" class="table-of-contents__link">Tokens and quotes</a></li><li><a href="#addresses" class="table-of-contents__link">Addresses</a></li><li><a href="#matchers" class="table-of-contents__link">Matchers</a></li><li><a href="#placehodlers" class="table-of-contents__link">Placehodlers</a></li><li><a href="#snippets" class="table-of-contents__link">Snippets</a></li><li><a href="#comments" class="table-of-contents__link">Comments</a></li></ul></li><li><a href="#automatic-https" class="table-of-contents__link">Automatic HTTPS</a><ul><li><a href="#overview" class="table-of-contents__link">Overview</a></li><li><a href="#activation" class="table-of-contents__link">Activation</a></li><li><a href="#local-https" class="table-of-contents__link">Local HTTPS</a></li></ul></li><li><a href="#å¸¸ç”¨æŒ‡ä»¤" class="table-of-contents__link">å¸¸ç”¨æŒ‡ä»¤</a><ul><li><a href="#log" class="table-of-contents__link">log</a></li><li><a href="#basicauth---http-basic-authentication" class="table-of-contents__link">basicauth - HTTP Basic Authentication</a></li><li><a href="#redir---http-redirect" class="table-of-contents__link">redir - HTTP redirect</a></li><li><a href="#rewrite" class="table-of-contents__link">rewrite</a></li></ul></li><li><a href="#qa" class="table-of-contents__link">QA</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">æ–‡ç« åˆ—è¡¨</h4><ul class="footer__items"><li class="footer__item"> <a class="footer__link-item" href="/docs/articles/es6-in-depth/0-introduction">æ·±å…¥æµ…å‡ºES6 - InfoQ.cn</a> </li><li class="footer__item"> <a class="footer__link-item" href="/docs/articles/why-java-sucks-and-csharp-rocks/1-compare-purpose">Why Java Sucks and C# Rocks - èµµåŠ¼</a> </li><li class="footer__item"> <a class="footer__link-item" href="/docs/reading">é˜…è¯»ç¬”è®°</a> </li><li class="footer__item"> <a class="footer__link-item" href="/docs/archives/git-guides">åšæ–‡å½’æ¡£</a> </li></ul></div><div class="col footer__col"><h4 class="footer__title">æ–‡æ¡£ç¿»è¯‘</h4><ul class="footer__items"><li class="footer__item"> <a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/docs/guides/blog">Docusaurus Blog</a> </li><li class="footer__item"> <a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/docs/guides/docs/markdown-features">Docusaurus Markdown</a> </li></ul></div><div class="col footer__col"><h4 class="footer__title">æ›´å¤š</h4><ul class="footer__items"><li class="footer__item"> <a href="https://github.com/alanwei43/node-auto-update" target="_blank" rel="noopener noreferrer" class="footer__link-item">node-auto-update - GitHub</a> </li><li class="footer__item"> <a href="https://github.com/alanwei43/docker-puppeteer" target="_blank" rel="noopener noreferrer" class="footer__link-item">docker-puppeteer - GitHub</a> </li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Alan&#x27;s Blog | <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer">...</a></div></div></div></footer></div></div></div>
<script src="/styles.29ee7585.js"></script>
<script src="/runtime~main.6b681f2b.js"></script>
<script src="/main.67ab7898.js"></script>
<script src="/1.fdda8468.js"></script>
<script src="/2.92b1c921.js"></script>
<script src="/3.cee7ea17.js"></script>
<script src="/ccc49370.e0293a73.js"></script>
<script src="/0396100f.9c723a12.js"></script>
<script src="/82d0ae0c.e945e357.js"></script>
</body>
</html>