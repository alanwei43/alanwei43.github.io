<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Caddy 简介  -  Alan&#x27;s Blog</title><meta data-rh="true" name="baidu-site-verification" content="code-7RGpEH8jty"><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://blog.alanwei.com/blog/2022/03/12/caddy-intro"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Caddy 简介  -  Alan&#x27;s Blog"><meta data-rh="true" name="description" content="Caddy 使用介绍"><meta data-rh="true" property="og:description" content="Caddy 使用介绍"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-03-12T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/alanwei43"><meta data-rh="true" property="article:tag" content="caddy,docker,nginx,http"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://blog.alanwei.com/blog/2022/03/12/caddy-intro"><link data-rh="true" rel="alternate" href="https://blog.alanwei.com/blog/2022/03/12/caddy-intro" hreflang="en"><link data-rh="true" rel="alternate" href="https://blog.alanwei.com/blog/2022/03/12/caddy-intro" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://7SQ6A6EP36-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Alan&#39;s Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Alan&#39;s Blog Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Alan&#39;s Blog" href="/opensearch.xml">



<script src="/scripts/baidu.js"></script>
<script src="/scripts/bing-clarity.js"></script>
<script src="/scripts/google.js"></script><link rel="stylesheet" href="/assets/css/styles.eb6e99d3.css">
<link rel="preload" href="/assets/js/runtime~main.4b3dc842.js" as="script">
<link rel="preload" href="/assets/js/main.18d16f9e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Alan&#x27;s Blog</b></a><a class="navbar__item navbar__link" href="/docs/articles">Articles</a><a class="navbar__item navbar__link" href="/docs/reading">Reading</a><a class="navbar__item navbar__link" href="/docs/built-in">Documents</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/me">Abount me</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/alanwei43" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_brwN thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_r4Q1 margin-bottom--md">Top posts</div><ul class="sidebarItemList_QwSx clean-list"><li class="sidebarItem_lnhn"><a aria-current="page" class="sidebarItemLink_yNGZ sidebarItemLinkActive_oSRm" href="/blog/2022/03/12/caddy-intro/">Caddy 简介</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2022/11/27/fnm-node-version-manager">fnm - Node版本管理工具</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2022/07/21/graphql-intro">GraphQL intro</a></li></ul><div class="sidebarItemTitle_r4Q1 margin-bottom--md">Recent posts</div><ul class="sidebarItemList_QwSx clean-list"><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2023/04/30/rsync-with-custom-port">rsync 同步文件指定端口号</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2023/04/30/vmware-install-android">使用 VMware 安装 Android</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2023/04/15/gradle-development">Gradle 开发配置</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2023/03/27/nginx-location-directive">NGINX location 指令示例</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2023/03/17/gnome-shell">Ubuntu install gnome</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2023/03/09/vue-cli-es5">Vue2项目构建没有转换ES6语法</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2023/03/07/nuxt-insert-inline-script">Nuxt 插入内联脚本</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2023/02/21/chrome-redirect-https-from-http">解决 Chrome 记住 HTTP 自动跳转 HTTPS</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2023/02/12/docusaurus-multi-documents">Docusaurus 多个文档</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2023/02/10/linux-skills">Linux 技巧</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2023/02/08/ubuntu-permanently-remove-sidebar-video">删除 Files 侧边栏预置目录</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2023/02/05/amazon-kindle-backup">Amazon Kindle 电子书备份</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2023/02/04/linux-chrome-disable-password">Ubuntu启动Chrome去掉每次输入密码</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2023/01/09/awesome-code-snippet">Awesome Code Snippet</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2023/01/08/live-stream-server">Live Stream Server</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2022/12/29/pm2-config">PM2 配置文件介绍</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2022/12/26/flutter-develop-environment-setup">Flutter 开发环境设置</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2022/11/22/linux-install-vmware-workstation">Linux install VMware Workstation</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2022/11/22/resolve-npm-install-fail">国内 .npmrc 配置</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2022/11/22/ubuntu-downgrade-package-version">Ubuntu 降低包版本号</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2022/11/18/docker-run-as-non-root-user">以非root账号方式运行Docker</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2022/11/13/google-cn-resources">google.cn 资源整理</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2022/09/04/fix-nuxt-node-fs-resolver-problem">解决nuxt依赖Node原生模块导致构建失败问题</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2022/08/21/cache-docs">Caching Tutorial for Web Authors and Webmasters</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2022/07/12/await-try-catch">为什么try catch能捕捉await后promise错误？ 和执行栈有关系吗？</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2022/07/12/pass-all-props-to-children">Pass all props to children in Vue</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2022/07/12/why-async-await-better-stackful-coroutine">async/await异步模型是否优于stackful coroutine模型？</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2022/06/17/typescript-ignore-rules">TypeScript禁用规则</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">Caddy 简介</h1><div class="container_mt6G margin-vert--md"><time datetime="2022-03-12T00:00:00.000Z" itemprop="datePublished">March 12, 2022</time> · <!-- -->21 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/alanwei43" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/2927578?s=460&amp;u=153132e7aa3be8295a1703af9b759ca22338f557&amp;v=4" alt="Alan"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/alanwei43" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Alan</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of blog</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p><a href="https://caddyserver.com/docs/" target="_blank" rel="noopener noreferrer">官方给的简介</a>是: Caddy是一个强大的、可扩展的平台, 用于伺服你的站点、服务以及应用. Caddy使用Go语言编写.</p><p>简单来说, caddy 和 nginx 很像, 我觉得相比较nginx有以下优点:</p><ol><li><strong>安装简单</strong> caddy的是个<a href="https://github.com/caddyserver/caddy/releases/" target="_blank" rel="noopener noreferrer">单文件可执行程序</a>, 没有任何依赖, 下载下来就可以使用. 对于简单的web服务, 使用命令行即可运行, 不需要任何配置文件.</li><li><strong>自动签发HTTPS证书</strong> caddy默认对所有站点开启HTTPS(支持Let&#x27;s encrypt 和 ZeroSSL证书自动申请).</li><li><strong>原生支持HTTP API</strong> 支持使用HTTP API方式修改配置.</li></ol><p>缺点就是生态和性能不如nginx, 不过个人使用绝大部分场景都能hold住.</p><p>Caddy由ZeroSSL<a href="https://github.com/caddyserver/caddy" target="_blank" rel="noopener noreferrer">开源</a>, 其原生配置语言是<a href="https://caddyserver.com/docs/json/" target="_blank" rel="noopener noreferrer">JSON</a>, 但是手写JSON配置比较麻烦且易错, 所以Caddy支持配置适配器(config adapter), 适配器是通过插件形式实现. 除了官方建议使用的 <a href="https://caddyserver.com/docs/caddyfile" target="_blank" rel="noopener noreferrer">Caddyfile</a> 文件配置, 还提供了<a href="https://github.com/caddyserver/nginx-adapter" target="_blank" rel="noopener noreferrer">nginx配置适配</a>. 通过 <a href="https://github.com/caddyserver/nginx-adapter" target="_blank" rel="noopener noreferrer">nginx-adapter</a>, 可以让 caddy 支持nginx的配置文件.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="基本命令">基本命令<a href="#基本命令" class="hash-link" aria-label="Direct link to 基本命令" title="Direct link to 基本命令">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="启动">启动<a href="#启动" class="hash-link" aria-label="Direct link to 启动" title="Direct link to 启动">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 在前台启动 caddy 服务, 按 ctrl + c 终止服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">caddy run --config ./Caddyfile --adapter caddyfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 在后台启动 caddy 服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">caddy start --config ./Caddyfile --adapter caddyfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 或者使用 docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -d </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --name caddy-run </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -p </span><span class="token number" style="color:#36acaa">80</span><span class="token plain">:80 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -p </span><span class="token number" style="color:#36acaa">443</span><span class="token plain">:443 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -v </span><span class="token environment constant" style="color:#36acaa">$PWD</span><span class="token plain">/Caddyfile /etc/caddy/Caddyfile </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  caddy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其他参数:</p><ul><li><code>--adapter</code> 用于指定配置适配器(更多适配器参考: <a href="https://caddyserver.com/docs/config-adapters" target="_blank" rel="noopener noreferrer">config-adapters</a> )</li><li><code>--watch</code> 参数可以监视配置文件(由参数<code>--config</code>指定)变化, 并自动重新加载服务</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="常用使用方式">常用使用方式<a href="#常用使用方式" class="hash-link" aria-label="Direct link to 常用使用方式" title="Direct link to 常用使用方式">​</a></h2><p>caddy 支持CLI方式伺服静态文件和反向代理, 同时支持配置文件进行更复杂的服务伺服.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="hello-world">Hello world<a href="#hello-world" class="hash-link" aria-label="Direct link to Hello world" title="Direct link to Hello world">​</a></h3><p>假设配置文件如下(需要把<code>demo.alanwei.com</code>替换成你自己的域名或者<code>localhost</code>):</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Caddyfile</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">demo.alanwei.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">respond &quot;Hello, privacy!&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>执行命令 <code>caddy run --config ./Caddyfile</code>, 然后访问 <code>https://demo.alanwei.com</code> 就会返回 <code>Hello, privacy!</code>, HTTPS 支持完全自动化.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="静态文件-static-files">静态文件 static files<a href="#静态文件-static-files" class="hash-link" aria-label="Direct link to 静态文件 static files" title="Direct link to 静态文件 static files">​</a></h3><p><strong>CLI方式</strong></p><p>基本命令 <code>caddy file-server</code> </p><p>示例:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 指定端口号</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">caddy file-server --listen :2015 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 也指定目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">caddy file-server --root </span><span class="token environment constant" style="color:#36acaa">$PWD</span><span class="token plain">/build --listen </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:3001</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>常用参数:</p><ul><li><code>--listen [&lt;host&gt;]:&lt;port&gt;</code> 指定监听的端口号, <code>&lt;host&gt;</code> 可以省略</li><li><code>--browser</code> 如果站点没有index文件, 允许列出站点下文件目录</li><li><code>--root &lt;dir&gt;</code> 默认站点目录是当前目录, 可通过改参数修改默认行为</li></ul><p><strong>Caddyfile方式</strong></p><p>对应的 <strong>Caddyfile</strong> 基本配置如下:</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">localhost:2015</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file_server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>指令<a href="https://caddyserver.com/docs/caddyfile/directives/file_server" target="_blank" rel="noopener noreferrer">file_server</a>常用选项: </p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">http://files.alanwei.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    root * /data/software # 指定目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file_server browse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        index &quot;REAME.md&quot; index.html index.txt # 设置首页文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hide android *.sh &quot;**/node_modules/**&quot; # 隐藏特定文件或目录, 支持占位符和glob patterns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="反向代理-reverse-proxy">反向代理 reverse proxy<a href="#反向代理-reverse-proxy" class="hash-link" aria-label="Direct link to 反向代理 reverse proxy" title="Direct link to 反向代理 reverse proxy">​</a></h3><p><strong>CLI方式</strong></p><p>基本命令: <code>caddy reverse-proxy</code></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 把所有 localhost 的请求都转发到 127.0.0.1:9000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">caddy reverse-proxy --to </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:9000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 把所有 *:3013 的请求都转发到 127.0.0.1:3010 , 并禁用https</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">caddy reverse-proxy --insecure -from :3013 -to </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:3010</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>支持参数:</p><ul><li><code>--change-host-header</code> 修改upstream的 <em>Host</em></li><li><code>--from [&lt;host&gt;]:&lt;port&gt;</code> 接收请求的地址, 默认是 <em>localhost</em></li><li><code>--insecure</code> 禁用 TLS 校验</li><li><code>--to</code> 代理到的地址</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="caddyfile">Caddyfile<a href="#caddyfile" class="hash-link" aria-label="Direct link to Caddyfile" title="Direct link to Caddyfile">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="structure">Structure<a href="#structure" class="hash-link" aria-label="Direct link to Structure" title="Direct link to Structure">​</a></h3><p>Caddyfile的文件结构如下:</p><p><img loading="lazy" src="https://caddyserver.com/resources/images/caddyfile-visual.png" alt="caddyfile" class="img_ev3q"></p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><ul><li>文件开始的全局配置块(global options block)是可选的</li><li>如果没有全局配置块, Caddyfile 文件的第一行一定是需要伺服的站点的地址(address)</li><li>如果文件仅有一个站点配置块(site block), 那配置块的花括号(<code>{ }</code>)是可以省略的</li></ul></div></div><p>Caddyfile 至少有一个站点配置块(site block), 如果指令(directive)出现在站点配置块的地址(address)前, 那配置文件解析将会失败.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="blocks">blocks<a href="#blocks" class="hash-link" aria-label="Direct link to blocks" title="Direct link to blocks">​</a></h3><p>使用花括号开启和关闭一个block:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">... {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>左花括号(<code>{</code>)必须在行尾</li><li>右花括号(<code>}</code>)必须独占一行</li></ul><p>当配置文件仅有一个站点配置块(site block), 为了方便快速定义单个站点, 花括号(和block的内容缩进)是可选的, 比如:</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Caddyfile</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reverse_proxy /api/* localhost:9001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file_server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>等价于</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Caddyfile</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">localhost {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reverse_proxy /api/* localhost:9001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file_server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果有多个站点, 必须使用花括号:</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Caddyfile</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">example1.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    root * /www/example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file_server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">example2.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reverse_proxy localhost:9000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果一个请求匹配到了多个块(site block), 则会选用最精确地址(address)的那个配置块(site block), 也就是说请求只会被一个block接管，不会级联传递到多个block.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="directives">Directives<a href="#directives" class="hash-link" aria-label="Direct link to Directives" title="Direct link to Directives">​</a></h3><p>指令(directive)关键词用于定义站点如何被伺服, 比如<code>file_server</code>表示静态文件站点, <code>reverse_proxy</code>表示反向代理站点. </p><p>在站点配置块里(site block), 指令必须是其所在行的第一个单词, 指令后面的单词是传给指令的参数</p><blockquote><p>当Caddyfile被适配的时候, 指令的会按照一定规则进行排序, 参考<a href="https://caddyserver.com/docs/caddyfile/directives#directive-order" target="_blank" rel="noopener noreferrer">directive order</a></p></blockquote><p>子指令可以出现在指令块中:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reverse_proxy localhost:9000 localhost:9001 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lb_policy first</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>lb_policy</code>(load balance policy) 是 <code>reverse_proxy</code> 的子指令, 用于设置有多个后端服务时的负载均衡.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="tokens-and-quotes">Tokens and quotes<a href="#tokens-and-quotes" class="hash-link" aria-label="Direct link to Tokens and quotes" title="Direct link to Tokens and quotes">​</a></h3><p>词法和引号, 解析Caddyfile的时候，通过空格拆分token, 比如<code>directive abc def</code>表示指令会收到两个参数, 而<code>directive &quot;abc def&quot;</code>指令就只收到一个参数, 可以使用以下方式传递带有引号的参数值: </p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">directive &quot;\&quot;abc def\&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">directive `&quot;abc def&quot;`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="addresses">Addresses<a href="#addresses" class="hash-link" aria-label="Direct link to Addresses" title="Direct link to Addresses">​</a></h3><p>站点的地址(address)必须出现在站点配置块(site block)的开头, 有效的地址格式如下:</p><ul><li><code>localhost</code></li><li><code>example.com</code></li><li><code>:443</code></li><li><code>http://example.com</code></li><li><code>localhost:8080</code></li><li><code>127.0.0.1</code></li><li><code>[::1]:2015</code></li><li><code>example.com/foo/*</code></li><li><code>*.example.com</code></li><li><code>http://</code></li></ul><p>如果你指定了主机名/域名(hostname), 那只有请求头的<code>Host</code>和hostname匹配的请求才会被处理, 和hostname不匹配的请求则会被忽略. 比如站点配置的地址是<code>localhost</code>, 那caddy就不会匹配请求头<code>Host: 127.0.0.1</code> 的请求.</p><p>地址中可以使用通配符<code>*</code>, 但是通配符只会匹配一段, 比如<code>*.example.com</code>会匹配<code>foo.example.com</code>, 但是不会匹配<code>foo.bar.example.com</code>. 另外, 如果使用<code>*</code>作为整个地址, 会匹配<code>localhost</code>, 但是不会匹配 <code>example.com</code>.</p><p>如果多个地址(address)使用相同的配置定义, 可以把他们放在一起, 使用逗号分割: </p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">localhost:8080, example.com, www.example.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 或者如下</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">localhost:8080,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">example.com,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">www.example.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>同名地址不能多次指定.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="matchers">Matchers<a href="#matchers" class="hash-link" aria-label="Direct link to Matchers" title="Direct link to Matchers">​</a></h3><p>Request matchers 用于使用指定的标准(specific criteria)来过滤或者界定(filter or classify)请求.</p><p>在Caddyfile文件中, 使用 matcher token(以下简称 匹配词) 限定指令的作用域, 可用的匹配词如下:</p><ul><li><code>*</code> 匹配所有的请求(默认行为)</li><li><code>/path</code> 按照请求路径匹配</li><li><code>@name</code> 使用命名匹配(named matcher)</li></ul><p>匹配词(matcher token)通常是可选的, 如果省略匹配词等同于使用通配符匹配词: <code>*</code>.</p><p>简单示例如下:</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root *           /var/www  # matcher token: *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root /index.html /var/www  # matcher token: /index.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root @post       /var/www  # matcher token: @post</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reverse_proxy /api/* localhost:9000 # 匹配所有 /api/ 的请求路径</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果想匹配所有请求, <code>*</code> 可以省略, 比如<code>reverse_proxy localhost:9000</code>等价于<code>reverse_proxy * localhost:9000</code>.</p><p>如果想使用多个匹配条件限制请求, 可以定义命名匹配(named matcher), 然后通过<code>@name</code>形式引用命名匹配:</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@postfoo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    method POST</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path /foo/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reverse_proxy @postfoo localhost:9000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Path matchers</strong></p><p>路径匹配词(path matcher token)必须以 <code>/</code> 开始, 默认请求下路径匹配模式是完全匹配, 可以使用通配符进行模糊匹配, 比如 <code>/foo*</code> 可以同时匹配以下路径:</p><ul><li><code>/foo</code></li><li><code>/foo/</code></li><li><code>/foobar</code></li></ul><p><strong>Named matchers</strong></p><p>所有非路径和通配符匹配的, 都必须使用命名匹配(named matcher):</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@websockets {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header Connection *Upgrade*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header Upgrade    websocket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reverse_proxy @websockets localhost:6001</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上面的命名匹配则表示仅匹配请求头<code>Connection</code>包含<em>Upgrade</em>, 且请求头<code>Upgrade</code>包含<em>websocket</em>的请求.</p><p>如果命名匹配器仅有一条匹配规则, 可以将name和规则写在一行:</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@post method POST</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reverse_proxy @post localhost:6001</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>命名匹配定义了匹配规则集, 定义的规则使用AND组合, 也就是说请求必须满足所有规则才算通过命名匹配.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="placehodlers">Placehodlers<a href="#placehodlers" class="hash-link" aria-label="Direct link to Placehodlers" title="Direct link to Placehodlers">​</a></h3><p>为了便于在静态配置文件Caddyfile中使用变量, Caddy 支持以下占位符(placeholder):</p><table><thead><tr><th>简写</th><th>全称</th></tr></thead><tbody><tr><td><code>{dir}</code></td><td><code>{http.request.uri.path.dir}</code></td></tr><tr><td><code>{file}</code></td><td><code>{http.request.uri.path.file}</code></td></tr><tr><td><code>{header.*}</code></td><td><code>{http.request.header.*}</code></td></tr><tr><td><code>{host}</code></td><td><code>{http.request.host}</code></td></tr><tr><td><code>{labels.*}</code></td><td><code>{http.request.host.labels.*}</code></td></tr><tr><td><code>{hostport}</code></td><td><code>{http.request.hostport}</code></td></tr><tr><td><code>{port}</code></td><td><code>{http.request.port}</code></td></tr><tr><td><code>{method}</code></td><td><code>{http.request.method}</code></td></tr><tr><td><code>{path}</code></td><td><code>{http.request.uri.path}</code></td></tr><tr><td><code>{path.*}</code></td><td><code>{http.request.uri.path.*}</code></td></tr><tr><td><code>{query}</code></td><td><code>{http.request.uri.query}</code></td></tr><tr><td><code>{query.*}</code></td><td><code>{http.request.uri.query.*}</code></td></tr><tr><td><code>{re.*.*}</code></td><td><code>{http.regexp.*.*}</code></td></tr><tr><td><code>{remote}</code></td><td><code>{http.request.remote}</code></td></tr><tr><td><code>{remote_host}</code></td><td><code>{http.request.remote.host}</code></td></tr><tr><td><code>{remote_port}</code></td><td><code>{http.request.remote.port}</code></td></tr><tr><td><code>{scheme}</code></td><td><code>{http.request.scheme}</code></td></tr><tr><td><code>{uri}</code></td><td><code>{http.request.uri}</code></td></tr><tr><td><code>{tls_cipher}</code></td><td><code>{http.request.tls.cipher_suite}</code></td></tr><tr><td><code>{tls_version}</code></td><td><code>{http.request.tls.version}</code></td></tr><tr><td><code>{tls_client_fingerprint}</code></td><td><code>{http.request.tls.client.fingerprint}</code></td></tr><tr><td><code>{tls_client_issuer}</code></td><td><code>{http.request.tls.client.issuer}</code></td></tr><tr><td><code>{tls_client_serial}</code></td><td><code>{http.request.tls.client.serial}</code></td></tr><tr><td><code>{tls_client_subject}</code></td><td><code>{http.request.tls.client.subject}</code></td></tr><tr><td><code>{tls_client_certificate_pem}</code></td><td><code>{http.request.tls.client.certificate_pem}</code></td></tr><tr><td><code>{tls_client_certificate_der_base64}</code></td><td><code>{http.request.tls.client.certificate_der_base64}</code></td></tr><tr><td><code>{upstream_hostport}</code></td><td><code>{http.reverse_proxy.upstream.hostport}</code></td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="snippets">Snippets<a href="#snippets" class="hash-link" aria-label="Direct link to Snippets" title="Direct link to Snippets">​</a></h3><p>可以在Caddyfile中定义片段, 方便在其他block中复用, 必须下面定义一个名为 <code>snippet</code> 的片段, 然后在另外另个block中使用<code>import snippet</code>: </p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(snippet) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  respond &quot;Yahaha! You found {args.0}!&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a.example.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    import snippet &quot;Example A&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b.example.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    import snippet &quot;Example B&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="comments">Comments<a href="#comments" class="hash-link" aria-label="Direct link to Comments" title="Direct link to Comments">​</a></h3><p>Caddyfile中<code>#</code>后面的内容视为注释.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="automatic-https">Automatic HTTPS<a href="#automatic-https" class="hash-link" aria-label="Direct link to Automatic HTTPS" title="Direct link to Automatic HTTPS">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h3><p>默认情况下, Caddy使用HTTPS伺服所有站点</p><ul><li>对于地址为IP、本地地址或者内网地址的站点, 比如 <code>localhost</code>, <code>127.0.0.1</code>等, Caddy使用自签名证书伺服.(使用命令<code>caddy trust</code>手动信任证书)</li><li>对于公开的DND域名, 比如<code>example.com</code>, <code>sub.example.com</code>或者<code>*.example.com</code>, Caddy使用公开的 ACME CA 证书, 比如 Let&#x27;s Encrypt 或者 ZeroSSL.</li></ul><p>Caddy自动为站点续签证书, 并默认把HTTP请求跳转到HTTPS.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="activation">Activation<a href="#activation" class="hash-link" aria-label="Direct link to Activation" title="Direct link to Activation">​</a></h3><p>Caddy隐式自动为站点提供HTTPS服务，有多种方式设置Caddy站点的伺服的域名或者IP:</p><ul><li><a href="https://caddyserver.com/docs/caddyfile" target="_blank" rel="noopener noreferrer">Caddyfile</a> 的 <a href="https://caddyserver.com/docs/caddyfile/concepts#addresses" target="_blank" rel="noopener noreferrer">site address</a></li><li><a href="https://caddyserver.com/docs/modules/http#servers/routes" target="_blank" rel="noopener noreferrer">route</a> 的 <a href="https://caddyserver.com/docs/json/apps/http/servers/routes/match/host/" target="_blank" rel="noopener noreferrer">host matcher</a></li><li>命令行的参数, 比如 <a href="https://caddyserver.com/docs/command-line#caddy-file-server" target="_blank" rel="noopener noreferrer">--domain</a> 或者 <a href="https://caddyserver.com/docs/command-line#caddy-reverse-proxy" target="_blank" rel="noopener noreferrer">--from</a></li><li>证书加载器: <a href="https://caddyserver.com/docs/json/apps/tls/certificates/automate/" target="_blank" rel="noopener noreferrer">automate</a></li></ul><p>下面是禁用Caddy默认HTTPS伺服行为的方法:</p><ul><li><a href="https://caddyserver.com/docs/json/apps/http/servers/automatic_https/" target="_blank" rel="noopener noreferrer">显式禁用</a></li><li>在配置文件中不提供任何主机名或IP</li><li>地址使用非HTTP端口号(80, 443)</li><li>地址协议使用 <code>http</code></li><li>手动加载证书</li></ul><p>在Caddyfile配置文件的全局配置里增加<code>auto_https off</code>即可显式禁用caddy所有HTTPS伺服行为.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="local-https">Local HTTPS<a href="#local-https" class="hash-link" aria-label="Direct link to Local HTTPS" title="Direct link to Local HTTPS">​</a></h3><p>为了通过HTTPS伺服非公开站点(即本地站点), Caddy使用自签名证书, 签名证书存储在 <a href="https://caddyserver.com/docs/conventions#data-directory" target="_blank" rel="noopener noreferrer">Caddy&#x27;s data directory</a> 的 <code>pki/authorities/local</code> 目录下.</p><p>Caddy的数据目录(data directory)默认路径为: </p><table><thead><tr><th>OS</th><th>Data directory path</th></tr></thead><tbody><tr><td>Linux, BSD</td><td><code>$HOME/.local/share/caddy</code></td></tr><tr><td>Windows</td><td><code>%AppData%\Caddy</code></td></tr><tr><td>macOS</td><td><code>$HOME/Library/Application Support/Caddy</code></td></tr><tr><td>Plan 9</td><td><code>$HOME/lib/caddy</code></td></tr><tr><td>Android</td><td><code>$HOME/caddy</code> (or <code>/sdcard/caddy</code>)</td></tr></tbody></table><p>如果存在环境变量<code>XDG_DATA_HOME</code>, 优先使用环境变量指定的目录.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="常用指令">常用指令<a href="#常用指令" class="hash-link" aria-label="Direct link to 常用指令" title="Direct link to 常用指令">​</a></h2><blockquote><p>指令都是在site block内使用</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="log">log<a href="#log" class="hash-link" aria-label="Direct link to log" title="Direct link to log">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="语法">语法<a href="#语法" class="hash-link" aria-label="Direct link to 语法" title="Direct link to 语法">​</a></h4><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">log {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output &lt;writer_module&gt; ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    format &lt;encoder_module&gt; ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    level  &lt;level&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="示例">示例<a href="#示例" class="hash-link" aria-label="Direct link to 示例" title="Direct link to 示例">​</a></h4><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Caddyfile</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">books.alanwei.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reverse_proxy localhost:8088</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        output file books.alanwei.com.access.log {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            roll_size 10MiB # 设置文件大小</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            roll_keep 10 # 设置文件保留数量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            roll_keep_for 48h # 设置日志保留时长</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        format console # 还支持 json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        level INFO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="basicauth">basicauth<a href="#basicauth" class="hash-link" aria-label="Direct link to basicauth" title="Direct link to basicauth">​</a></h3><p>HTTP Basic Authentication, 设置HTTP基本认证功能.</p><p>Caddy配置文件里的密码必须hash计算之后的, 可以使用 <code>caddy hash-password</code> 命令计算密码的hash.</p><p>用户访问认证通过后, <code>{http.auth.user.id}</code> 占位符就变成可用了, 其值是用户名.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="语法-1">语法<a href="#语法-1" class="hash-link" aria-label="Direct link to 语法" title="Direct link to 语法">​</a></h4><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">basicauth [&lt;matcher&gt;] [&lt;hash_algorithm&gt; [&lt;realm&gt;]] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;username&gt; &lt;hashed_password_base64&gt; [&lt;salt_base64&gt;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>&lt;hash_algorithm&gt;</code> 密码的hash算法, 可以是<code>bcrypt</code>(默认)或者<code>scrypt</code></li><li><code>&lt;realm&gt;</code> is a custom realm name.</li><li><code>&lt;username&gt;</code> 用户名或者用户Id</li><li><code>&lt;hashed_password_base64&gt;</code> hash密码经过base64编码的值(使用 <code>caddy hash-password</code> 计算)</li><li><code>&lt;salt_base64&gt;</code> 计算hash密码使用的salt的base64编码后的值</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="示例-1">示例<a href="#示例-1" class="hash-link" aria-label="Direct link to 示例" title="Direct link to 示例">​</a></h4><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">books.alanwei.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reverse_proxy localhost:8088</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    basicauth * {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        alan JDJhJDE0JHhpVUtuU09za3dGT1F6RnlMOUlycE9kTXhoYWlOQmVleVl0dzFJczdpdkF2cUdFY3JSN3RL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redir">redir<a href="#redir" class="hash-link" aria-label="Direct link to redir" title="Direct link to redir">​</a></h3><p>HTTP redirect, 返回3xx跳转响应</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="语法-2">语法<a href="#语法-2" class="hash-link" aria-label="Direct link to 语法" title="Direct link to 语法">​</a></h4><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">redir [&lt;matcher&gt;] &lt;to&gt; [&lt;code&gt;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>&lt;to&gt;</code> 跳转的目标地址, 输出在响应头的<code>Location</code>中</li><li><code>&lt;code&gt;</code> HTTP响应状态码, 允许的值如下<ul><li><em>3xx</em> 的整数</li><li><code>permanent</code> 永久跳转(响应状态码 <em>301</em>)</li><li><code>temporary</code> 临时跳转(响应状态码 <em>302</em>, 默认行为)</li><li><code>html</code> 响应一段HTML文档在客户端执行跳转</li></ul></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="示例-2">示例<a href="#示例-2" class="hash-link" aria-label="Direct link to 示例" title="Direct link to 示例">​</a></h4><ul><li><code>redir https://example.com</code> 所有请求跳转到 <code>https://example.com</code></li><li><code>redir https://example.com{uri}</code> 效果同上, 但是会保留URI</li><li><code>redir https://example.com{uri} permanent</code> 效果同上, 但是响应状态码是 301</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="rewrite">rewrite<a href="#rewrite" class="hash-link" aria-label="Direct link to rewrite" title="Direct link to rewrite">​</a></h3><p>在内部进行请求转发, 客户端无感知, 类似代理转发.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="语法-3">语法<a href="#语法-3" class="hash-link" aria-label="Direct link to 语法" title="Direct link to 语法">​</a></h4><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rewrite [&lt;matcher&gt;] &lt;to&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>&lt;to&gt;</code> 设置请求的URI, 仅仅指定的部分被替换. URI 路径是<code>?</code>之前的字符串. 如果<code>?</code>是缺省的, 全部部分都是path.</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="示例-3">示例<a href="#示例-3" class="hash-link" aria-label="Direct link to 示例" title="Direct link to 示例">​</a></h4><ul><li><code>rewrite * /foo.html</code> 转发所有请求到 <code>foo.html</code>, </li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="reverse_proxy">reverse_proxy<a href="#reverse_proxy" class="hash-link" aria-label="Direct link to reverse_proxy" title="Direct link to reverse_proxy">​</a></h3><p>用于设置反向代理</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="语法-4">语法<a href="#语法-4" class="hash-link" aria-label="Direct link to 语法" title="Direct link to 语法">​</a></h4><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reverse_proxy [&lt;matcher&gt;] [&lt;upstreams...&gt;] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # backends</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    to      &lt;upstreams...&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dynamic &lt;module&gt; ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # load balancing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lb_policy       &lt;name&gt; [&lt;options...&gt;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lb_try_duration &lt;duration&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lb_try_interval &lt;interval&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # header manipulation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trusted_proxies [private_ranges] &lt;ranges...&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header_up   [+|-]&lt;field&gt; [&lt;value|regexp&gt; [&lt;replacement&gt;]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header_down [+|-]&lt;field&gt; [&lt;value|regexp&gt; [&lt;replacement&gt;]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # round trip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    transport &lt;name&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # optionally intercept responses from upstream</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @name {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        status &lt;code...&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        header &lt;field&gt; [&lt;value&gt;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    replace_status [&lt;matcher&gt;] &lt;status_code&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    handle_response [&lt;matcher&gt;] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;directives...&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # special directives only available in handle_response</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        copy_response [&lt;matcher&gt;] [&lt;status&gt;] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            status &lt;status&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        copy_response_headers [&lt;matcher&gt;] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            include &lt;fields...&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            exclude &lt;fields...&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>header_up</code> 对传递给后端的请求头进行设置、添加、删除或者执行替换</li><li><code>header_down</code> 对后端返回的响应头进行设置、添加、删除或者执行替换</li></ul><p>默认情况下, Caddy会把所有请求头未经修改地全部传递到后端服务, 包括<code>Host</code>请求头, 下面三种情况不会传递<code>Host</code>请求头:</p><ol><li>添加或修改了 HTTP header <code>X-Forwarded-For</code> </li><li>设置了 HTTP header <code>X-Forwarded-Proto</code> </li><li>设置了 HTTP header <code>X-Forwarded-Host</code> </li></ol><p>默认情况下, caddy会忽略请求头中的 <code>X-Forwarded-*</code>, 以防止客户端欺骗. 如果caddy不是连接客户端的第一层(比如在caddy的上层还有CDN), 可以配置 <code>trusted_proxies</code> 信任的IP列表, 为了方便可以设置成<code>trusted_proxies private_ranges</code>信任所有的私有IP段. </p><blockquote><p>简单点说就是caddy为了安全, 会忽略客户端<code>X-Forwarded-*</code>请求头, 默认不会把这些请求头传递给后端, 但是考虑到caddy有可能不是直接接触到客户端, 在客户端和caddy之间可能有cdn, 所以可用通过配置<code>trusted_proxies</code>解决这种场景.</p></blockquote><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="示例-4">示例<a href="#示例-4" class="hash-link" aria-label="Direct link to 示例" title="Direct link to 示例">​</a></h4><p>将 <code>weblog.alanwei.com</code> 的请求转发到 <code>http://localhost:8089</code>:</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">weblog.alanwei.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reverse_proxy http://localhost:8089</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>将<code>demo.alanwei.com</code>转发到<code>localhost:1337</code>, 并修改后端收到的<code>Host</code>请求头.</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">demo.alanwei.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reverse_proxy localhost:1337 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        header_up Host {upstream_hostport}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        header_up X-Forwarded-Host {host}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在代理之前对路径进行裁剪:</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">demo.alanwei.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    handle_path /prefix/* {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reverse_proxy localhost:9000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="handle">handle<a href="#handle" class="hash-link" aria-label="Direct link to handle" title="Direct link to handle">​</a></h3><p>handle和nginx中的location指令很类似, 只有第一个被匹配到的handle block会被执行(多个handle block之间互斥). handle block 可以嵌套(仅限HTTP handle).</p><p><strong>语法</strong></p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">handle [&lt;matcher&gt;] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;directives...&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>&lt;directives...&gt;</code> HTTP处理指令块列表, 一行一个指令, 和handle block外的指令使用方式一样</li></ul><p>除了 handle 指令, 还有 handle_path 指令, 不同之处在于, handle_path 在处理之前会截断请求的路径.</p><p>route包括其他指令时, 和handle做的事情很像, 但是有两点不同, 1) route block彼此之间不是互斥的, 2) route 内的指令不会被重新排序.</p><p><strong>示例</strong></p><p><em>/foo/</em> 的请求转发到静态文件服务, 其他请求转发到代理服务上:</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sample.alanwei.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    handle /foo/* {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        file_server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    handle {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reverse_proxy 127.0.0.1:8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>handle 和 handle_path 可以在同一个站点中同时使用, 而且彼此之间依然互斥:</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">http://location:8090 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    handle_path /foo/* {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # The path has the &quot;/foo&quot; prefix stripped</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    handle /bar/* {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # The path still retains &quot;/bar&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="tls">tls<a href="#tls" class="hash-link" aria-label="Direct link to tls" title="Direct link to tls">​</a></h3><p><strong>示例</strong></p><ul><li>使用自定义证书: <code>tls cert.pem key.pem</code></li><li>使用本地自签名证书: <code>tls internal</code></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="qa">QA<a href="#qa" class="hash-link" aria-label="Direct link to QA" title="Direct link to QA">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="启动失败">启动失败<a href="#启动失败" class="hash-link" aria-label="Direct link to 启动失败" title="Direct link to 启动失败">​</a></h3><p>执行caddy命令如果提示以下错误, 需要使用<code>sudo</code>执行:</p><div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">loading initial config: loading new config: http app module: start: tcp: listening on :443: listen tcp :443: bind: permission denied</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果外部网络无法访问caddy伺服的web, 有可能是系统防火墙拦截了, 如果是linux系统可以尝试使用<code>ufw allow</code>开放端口号.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="禁用https">禁用HTTPS<a href="#禁用https" class="hash-link" aria-label="Direct link to 禁用HTTPS" title="Direct link to 禁用HTTPS">​</a></h3><p>全局禁用设置全局选项即可: </p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto_https off</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>禁用特定域名的https, 只需要在域名地址前指定协议即可:</p><div class="language-caddy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-caddy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">http://localhost:3009 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    root * /project_dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file_server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http://www.alanwei.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reverse_proxy localhost:3009</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/caddy">caddy</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/docker">docker</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/nginx">nginx</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/http">http</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/alanwei43/blog/tree/master/src/blog/2022/03/12-caddy-intro.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/2022/03/16/get-public-ip-using-curl"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">使用curl命令行获取当前机器公网IP</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/2022/03/12/docker-history-full-command"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">docker history命令显示完整信息</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#基本命令" class="table-of-contents__link toc-highlight">基本命令</a><ul><li><a href="#启动" class="table-of-contents__link toc-highlight">启动</a></li></ul></li><li><a href="#常用使用方式" class="table-of-contents__link toc-highlight">常用使用方式</a><ul><li><a href="#hello-world" class="table-of-contents__link toc-highlight">Hello world</a></li><li><a href="#静态文件-static-files" class="table-of-contents__link toc-highlight">静态文件 static files</a></li><li><a href="#反向代理-reverse-proxy" class="table-of-contents__link toc-highlight">反向代理 reverse proxy</a></li></ul></li><li><a href="#caddyfile" class="table-of-contents__link toc-highlight">Caddyfile</a><ul><li><a href="#structure" class="table-of-contents__link toc-highlight">Structure</a></li><li><a href="#blocks" class="table-of-contents__link toc-highlight">blocks</a></li><li><a href="#directives" class="table-of-contents__link toc-highlight">Directives</a></li><li><a href="#tokens-and-quotes" class="table-of-contents__link toc-highlight">Tokens and quotes</a></li><li><a href="#addresses" class="table-of-contents__link toc-highlight">Addresses</a></li><li><a href="#matchers" class="table-of-contents__link toc-highlight">Matchers</a></li><li><a href="#placehodlers" class="table-of-contents__link toc-highlight">Placehodlers</a></li><li><a href="#snippets" class="table-of-contents__link toc-highlight">Snippets</a></li><li><a href="#comments" class="table-of-contents__link toc-highlight">Comments</a></li></ul></li><li><a href="#automatic-https" class="table-of-contents__link toc-highlight">Automatic HTTPS</a><ul><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#activation" class="table-of-contents__link toc-highlight">Activation</a></li><li><a href="#local-https" class="table-of-contents__link toc-highlight">Local HTTPS</a></li></ul></li><li><a href="#常用指令" class="table-of-contents__link toc-highlight">常用指令</a><ul><li><a href="#log" class="table-of-contents__link toc-highlight">log</a><ul><li><a href="#语法" class="table-of-contents__link toc-highlight">语法</a></li><li><a href="#示例" class="table-of-contents__link toc-highlight">示例</a></li></ul></li><li><a href="#basicauth" class="table-of-contents__link toc-highlight">basicauth</a><ul><li><a href="#语法-1" class="table-of-contents__link toc-highlight">语法</a></li><li><a href="#示例-1" class="table-of-contents__link toc-highlight">示例</a></li></ul></li><li><a href="#redir" class="table-of-contents__link toc-highlight">redir</a><ul><li><a href="#语法-2" class="table-of-contents__link toc-highlight">语法</a></li><li><a href="#示例-2" class="table-of-contents__link toc-highlight">示例</a></li></ul></li><li><a href="#rewrite" class="table-of-contents__link toc-highlight">rewrite</a><ul><li><a href="#语法-3" class="table-of-contents__link toc-highlight">语法</a></li><li><a href="#示例-3" class="table-of-contents__link toc-highlight">示例</a></li></ul></li><li><a href="#reverse_proxy" class="table-of-contents__link toc-highlight">reverse_proxy</a><ul><li><a href="#语法-4" class="table-of-contents__link toc-highlight">语法</a></li><li><a href="#示例-4" class="table-of-contents__link toc-highlight">示例</a></li></ul></li><li><a href="#handle" class="table-of-contents__link toc-highlight">handle</a></li><li><a href="#tls" class="table-of-contents__link toc-highlight">tls</a></li></ul></li><li><a href="#qa" class="table-of-contents__link toc-highlight">QA</a><ul><li><a href="#启动失败" class="table-of-contents__link toc-highlight">启动失败</a></li><li><a href="#禁用https" class="table-of-contents__link toc-highlight">禁用HTTPS</a></li></ul></li></ul></div></div></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Recommend</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/articles/es6-in-depth/introduction">深入浅出ES6 - InfoQ.cn</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/articles/why-java-sucks-and-csharp-rocks/compare-purpose">Why Java Sucks and C# Rocks - 赵劼</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/reading">阅读笔记</a></li></ul></div><div class="col footer__col"><div class="footer__title">Translate</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/built-in/docusaurus/">Docusaurus Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/built-in/docusaurus/docs/markdown-features">Docusaurus Markdown</a></li><li class="footer__item"><a class="footer__link-item" href="/blog/2022/03/12/caddy-intro">Caddy 简介</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/alanwei43/node-io-lib" target="_blank" rel="noopener noreferrer" class="footer__link-item">node-io-lib - GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/alanwei43/docker-puppeteer" target="_blank" rel="noopener noreferrer" class="footer__link-item">docker-puppeteer - GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/alanwei43/code-server" target="_blank" rel="noopener noreferrer" class="footer__link-item">code-server - GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Alan's Blog</div></div></div></footer></div>
<script src="/assets/js/runtime~main.4b3dc842.js"></script>
<script src="/assets/js/main.18d16f9e.js"></script>
</body>
</html>