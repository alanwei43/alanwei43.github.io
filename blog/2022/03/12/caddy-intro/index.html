<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Alan's Blog Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Alan's Blog Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WSJXZXE31N"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-WSJXZXE31N",{anonymize_ip:!0})</script>
<script src="/scripts/baidu.js"></script><title data-react-helmet="true">Caddy 简介  -  Alan&#x27;s Blog</title><meta data-react-helmet="true" property="og:title" content="Caddy 简介  -  Alan&#x27;s Blog"><meta data-react-helmet="true" name="description" content="Caddy 使用介绍"><meta data-react-helmet="true" property="og:description" content="Caddy 使用介绍"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link rel="stylesheet" href="/styles.66a1e391.css">
<link rel="preload" href="/styles.29ee7585.js" as="script">
<link rel="preload" href="/runtime~main.6b681f2b.js" as="script">
<link rel="preload" href="/main.67ab7898.js" as="script">
<link rel="preload" href="/1.fdda8468.js" as="script">
<link rel="preload" href="/2.92b1c921.js" as="script">
<link rel="preload" href="/3.cee7ea17.js" as="script">
<link rel="preload" href="/ccc49370.e0293a73.js" as="script">
<link rel="preload" href="/0396100f.9c723a12.js" as="script">
<link rel="preload" href="/82d0ae0c.e945e357.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><div><nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top navbarHideable_17Wu navbarHidden_19ww"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.png" alt="logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Alan&#x27;s Blog</strong></a><a class="navbar__item navbar__link" href="/docs/">文档</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">博客</a><a class="navbar__item navbar__link" href="/me">关于我</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/alanwei43" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.png" alt="logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Alan&#x27;s Blog</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">文档</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">博客</a></li><li class="menu__list-item"><a class="menu__link" href="/me">关于我</a></li><li class="menu__list-item"><a href="https://github.com/alanwei43" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--2"><div class="sidebar_1wv2 thin-scrollbar"><h3 class="sidebarItemTitle_3lOc">热门博文</h3><ul class="sidebarItemList_2WIo"><li class="sidebarItem_iPNH"><a class="sidebarItemLink_2E17" href="/blog/tags">Tags列表</a></li><li class="sidebarItem_iPNH"><a class="sidebarItemLink_2E17" href="/blog/2014/09/04/math-physics-diff">数学系和物理系学生有什么差别？</a></li><li class="sidebarItem_iPNH"><a class="sidebarItemLink_2E17" href="/blog/2021/02/17/java-network-proxy">设置Java网络代理</a></li><li class="sidebarItem_iPNH"><a class="sidebarItemLink_2E17" href="/blog/2021/04/23/语文考试可以写负能量作文吗">语文考试可以写负能量作文吗</a></li><li class="sidebarItem_iPNH"><a class="sidebarItemLink_2E17" href="/blog/2021/04/11/windows-bootable-device">制作Windows启动盘</a></li><li class="sidebarItem_iPNH"><a class="sidebarItemLink_2E17" href="/blog/2021/04/11/iis-reverse-proxy">配置IIS反向代理</a></li><li class="sidebarItem_iPNH"><a class="sidebarItemLink_2E17" href="/blog/2021/04/10/node-require-cache">Node require 缓存</a></li><li class="sidebarItem_iPNH"><a class="sidebarItemLink_2E17" href="/blog/2021/04/02/docker-timezone">Docker时区设置</a></li><li class="sidebarItem_iPNH"><a aria-current="page" class="sidebarItemLink_2E17 sidebarItemLinkActive_2Dvr" href="/blog/2022/03/12/caddy-intro">Caddy 简介</a></li><li class="sidebarItem_iPNH"><a class="sidebarItemLink_2E17" href="/blog/2022/03/12/docker-history-full-command">docker history命令显示完整信息</a></li><li class="sidebarItem_iPNH"><a class="sidebarItemLink_2E17" href="/blog/2022/03/12/macos-security-allow-apps-anywhere">macOS系统安全隐私设置允许任意源下载的App</a></li><li class="sidebarItem_iPNH"><a class="sidebarItemLink_2E17" href="/blog/2022/03/10/spring-both-support-json-url-encoded">Spring 接口同时支持JSON数据和Form表单数据</a></li><li class="sidebarItem_iPNH"><a class="sidebarItemLink_2E17" href="/blog/2022/03/08/flutter-practice-note">Flutter实战 第二版 笔记</a></li></ul></div></div><main class="col col--8"><article><header><h1 class="margin-bottom--lg blogPostTitle_kDB-">Caddy 简介</h1><div><time datetime="2022-03-12T00:00:00.000Z" class="blogPostDate_2HVl">March 12, 2022  · 6 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/alanwei43" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/2927578?s=460&amp;u=153132e7aa3be8295a1703af9b759ca22338f557&amp;v=4" alt="Alan"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/alanwei43" target="_blank" rel="noreferrer noopener">Alan</a></h4><small class="avatar__subtitle">Maintainer of blog</small></div></div></header><section class="markdown"><p><a href="https://caddyserver.com/docs/" target="_blank" rel="noopener noreferrer">官方给的简介</a>是: Caddy是一个强大的、可扩展的平台, 用于伺服你的站点、服务以及应用. Caddy使用Go语言编写.</p><p>简单来说, caddy 和 nginx 很像, 我觉得相比较nginx有以下优点:</p><ol><li><strong>安装简单</strong> caddy的是个<a href="https://github.com/caddyserver/caddy/releases/" target="_blank" rel="noopener noreferrer">单文件可执行程序</a>, 没有任何依赖, 下载下来就可以使用. 对于简单的web服务, 使用命令行即可运行, 不需要任何配置文件.</li><li><strong>自动签发HTTPS证书</strong> caddy默认对所有站点开启HTTPS(支持Let&#x27;s encrypt 和 ZeroSSL证书自动申请).</li><li><strong>原生支持HTTP API</strong> 支持使用HTTP API方式修改配置.</li></ol><p>缺点就是生态和性能不如nginx, 不过个人使用绝大部分场景都能hold住.</p><p>Caddy由ZeroSSL<a href="https://github.com/caddyserver/caddy" target="_blank" rel="noopener noreferrer">开源</a>, 其原生配置语言是<a href="https://caddyserver.com/docs/json/" target="_blank" rel="noopener noreferrer">JSON</a>, 但是手写JSON配置比较麻烦且易错, 所以Caddy支持配置适配器(config adapter), 适配器是通过插件形式实现. 除了官方建议使用的 <a href="https://caddyserver.com/docs/caddyfile" target="_blank" rel="noopener noreferrer">Caddyfile</a> 文件配置, 还提供了<a href="https://github.com/caddyserver/nginx-adapter" target="_blank" rel="noopener noreferrer">nginx配置适配</a>. 通过 <a href="https://github.com/caddyserver/nginx-adapter" target="_blank" rel="noopener noreferrer">nginx-adapter</a>, 可以让 caddy 支持nginx的配置文件.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="基本命令"></a>基本命令<a class="hash-link" href="#基本命令" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="启动"></a>启动<a class="hash-link" href="#启动" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># 在前台启动 caddy 服务, 按 ctrl + c 终止服务</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">caddy run --config ./Caddyfile --adapter caddyfile</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 在后台启动 caddy 服务</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">caddy start --config ./Caddyfile --adapter caddyfile</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 或者使用 docker</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">docker run -d </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  --name caddy-run </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  -p </span><span class="token number">80</span><span class="token plain">:80 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  -p </span><span class="token number">443</span><span class="token plain">:443 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  -v </span><span class="token environment constant" style="color:rgb(189, 147, 249)">$PWD</span><span class="token plain">/Caddyfile /etc/caddy/Caddyfile </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  caddy</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>其他参数:</p><ul><li><code>--adapter</code> 用于指定配置适配器(更多适配器参考: <a href="https://caddyserver.com/docs/config-adapters" target="_blank" rel="noopener noreferrer">config-adapters</a> )</li><li><code>--watch</code> 参数可以监视配置文件(由参数<code>--config</code>指定)变化, 并自动重新加载服务</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="常用使用方式"></a>常用使用方式<a class="hash-link" href="#常用使用方式" title="Direct link to heading">#</a></h2><p>caddy 支持CLI方式伺服静态文件和反向代理, 同时支持配置文件进行更复杂的服务伺服.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="hello-world"></a>Hello world<a class="hash-link" href="#hello-world" title="Direct link to heading">#</a></h3><p>假设配置文件如下(需要把<code>demo.alanwei.com</code>替换成你自己的域名或者<code>localhost</code>):</p><div class="mdxCodeBlock_1zKU"><div style="color:#F8F8F2;background-color:#282A36" class="codeBlockTitle_2eSY">Caddyfile</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">demo.alanwei.com</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">respond &quot;Hello, privacy!&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>执行命令 <code>caddy run --config ./Caddyfile</code>, 然后访问 <code>https://demo.alanwei.com</code> 就会返回 <code>Hello, privacy!</code>, HTTPS 支持完全自动化.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="静态文件-static-files"></a>静态文件 static files<a class="hash-link" href="#静态文件-static-files" title="Direct link to heading">#</a></h3><p><strong>CLI方式</strong></p><p>基本命令 <code>caddy file-server</code> </p><p>示例:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># 指定端口号</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">caddy file-server --listen :2015 </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 也指定目录</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">caddy file-server --root </span><span class="token environment constant" style="color:rgb(189, 147, 249)">$PWD</span><span class="token plain">/build --listen </span><span class="token number">0.0</span><span class="token plain">.0.0:3001</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>常用参数:</p><ul><li><code>--listen [&lt;host&gt;]:&lt;port&gt;</code> 指定监听的端口号, <code>&lt;host&gt;</code> 可以省略</li><li><code>--browser</code> 如果站点没有index文件, 允许列出站点下文件目录</li><li><code>--root &lt;dir&gt;</code> 默认站点目录是当前目录, 可通过改参数修改默认行为</li></ul><p><strong>Caddyfile方式</strong></p><p>对应的 <strong>Caddyfile</strong> 基本配置如下:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">localhost:2015</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">file_server</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>指令<a href="https://caddyserver.com/docs/caddyfile/directives/file_server" target="_blank" rel="noopener noreferrer">file_server</a>常用选项: </p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">http://files.alanwei.com {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    root * /data/software # 指定目录</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    file_server browse {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        index &quot;REAME.md&quot; index.html index.txt # 设置首页文件</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        hide android *.sh &quot;**/node_modules/**&quot; # 隐藏特定文件或目录, 支持占位符和glob patterns</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="反向代理-reverse-proxy"></a>反向代理 reverse proxy<a class="hash-link" href="#反向代理-reverse-proxy" title="Direct link to heading">#</a></h3><p><strong>CLI方式</strong></p><p>基本命令: <code>caddy reverse-proxy</code></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># 把所有 localhost 的请求都转发到 127.0.0.1:9000</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">caddy reverse-proxy --to </span><span class="token number">127.0</span><span class="token plain">.0.1:9000</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 把所有 *:3013 的请求都转发到 127.0.0.1:3010 , 并禁用https</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">caddy reverse-proxy --insecure -from :3013 -to </span><span class="token number">127.0</span><span class="token plain">.0.1:3010</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>支持参数:</p><ul><li><code>--change-host-header</code> 修改upstream的 <em>Host</em></li><li><code>--from [&lt;host&gt;]:&lt;port&gt;</code> 接收请求的地址, 默认是 <em>localhost</em></li><li><code>--insecure</code> 禁用 TLS 校验</li><li><code>--to</code> 代理到的地址</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="caddyfile"></a>Caddyfile<a class="hash-link" href="#caddyfile" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="structure"></a>Structure<a class="hash-link" href="#structure" title="Direct link to heading">#</a></h3><p>Caddyfile的文件结构如下:</p><p><img src="https://caddyserver.com/resources/images/caddyfile-visual.png" alt="caddyfile"></p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><ul><li>文件开始的全局配置块(global options block)是可选的</li><li>如果没有全局配置块, Caddyfile 文件的第一行一定是需要伺服的站点的地址(address)</li><li>如果文件仅有一个站点配置块(site block), 那配置块的花括号(<code>{ }</code>)是可以省略的</li></ul></div></div><p>Caddyfile 至少有一个站点配置块(site block), 如果指令(directive)出现在站点配置块的地址(address)前, 那配置文件解析将会失败.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="blocks"></a>blocks<a class="hash-link" href="#blocks" title="Direct link to heading">#</a></h3><p>使用花括号开启和关闭一个block:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">... {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  ...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li>左花括号(<code>{</code>)必须在行尾</li><li>右花括号(<code>}</code>)必须独占一行</li></ul><p>当配置文件仅有一个站点配置块(site block), 为了方便快速定义单个站点, 花括号(和block的内容缩进)是可选的, 比如:</p><div class="mdxCodeBlock_1zKU"><div style="color:#F8F8F2;background-color:#282A36" class="codeBlockTitle_2eSY">Caddyfile</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">localhost</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">reverse_proxy /api/* localhost:9001</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">file_server</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>等价于</p><div class="mdxCodeBlock_1zKU"><div style="color:#F8F8F2;background-color:#282A36" class="codeBlockTitle_2eSY">Caddyfile</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">localhost {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    reverse_proxy /api/* localhost:9001</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    file_server</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>如果有多个站点, 必须使用花括号:</p><div class="mdxCodeBlock_1zKU"><div style="color:#F8F8F2;background-color:#282A36" class="codeBlockTitle_2eSY">Caddyfile</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">example1.com {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    root * /www/example.com</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    file_server</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">example2.com {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    reverse_proxy localhost:9000</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>如果一个请求匹配到了多个块(site block), 则会选用最精确地址(address)的那个配置块(site block), 也就是说请求只会被一个block接管，不会级联传递到多个block.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="directives"></a>Directives<a class="hash-link" href="#directives" title="Direct link to heading">#</a></h3><p>指令(directive)关键词用于定义站点如何被伺服, 比如<code>file_server</code>表示静态文件站点, <code>reverse_proxy</code>表示反向代理站点. </p><p>在站点配置块里(site block), 指令必须是其所在行的第一个单词, 指令后面的单词是传给指令的参数</p><blockquote><p>当Caddyfile被适配的时候, 指令的会按照一定规则进行排序, 参考<a href="https://caddyserver.com/docs/caddyfile/directives#directive-order" target="_blank" rel="noopener noreferrer">directive order</a></p></blockquote><p>子指令可以出现在指令块中:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">localhost</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">reverse_proxy localhost:9000 localhost:9001 {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    lb_policy first</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><code>lb_policy</code>(load balance policy) 是 <code>reverse_proxy</code> 的子指令, 用于设置有多个后端服务时的负载均衡.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="tokens-and-quotes"></a>Tokens and quotes<a class="hash-link" href="#tokens-and-quotes" title="Direct link to heading">#</a></h3><p>词法和引号, 解析Caddyfile的时候，通过空格拆分token, 比如<code>directive abc def</code>表示指令会收到两个参数, 而<code>directive &quot;abc def&quot;</code>指令就只收到一个参数, 可以使用以下方式传递带有引号的参数值: </p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">directive &quot;\&quot;abc def\&quot;&quot;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">directive `&quot;abc def&quot;`</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="addresses"></a>Addresses<a class="hash-link" href="#addresses" title="Direct link to heading">#</a></h3><p>站点的地址(address)必须出现在站点配置块(site block)的开头, 有效的地址格式如下:</p><ul><li><code>localhost</code></li><li><code>example.com</code></li><li><code>:443</code></li><li><code>http://example.com</code></li><li><code>localhost:8080</code></li><li><code>127.0.0.1</code></li><li><code>[::1]:2015</code></li><li><code>example.com/foo/*</code></li><li><code>*.example.com</code></li><li><code>http://</code></li></ul><p>如果你指定了主机名/域名(hostname), 那只有请求头的<code>Host</code>和hostname匹配的请求才会被处理, 和hostname不匹配的请求则会被忽略. 比如站点配置的地址是<code>localhost</code>, 那caddy就不会匹配请求头<code>Host: 127.0.0.1</code> 的请求.</p><p>地址中可以使用通配符<code>*</code>, 但是通配符只会匹配一段, 比如<code>*.example.com</code>会匹配<code>foo.example.com</code>, 但是不会匹配<code>foo.bar.example.com</code>. 另外, 如果使用<code>*</code>作为整个地址, 会匹配<code>localhost</code>, 但是不会匹配 <code>example.com</code>.</p><p>如果多个地址(address)使用相同的配置定义, 可以把他们放在一起, 使用逗号分割: </p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">localhost:8080, example.com, www.example.com {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"># 或者如下</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">localhost:8080,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">example.com,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">www.example.com {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>同名地址不能多次指定.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="matchers"></a>Matchers<a class="hash-link" href="#matchers" title="Direct link to heading">#</a></h3><p>Request matchers 用于使用指定的标准(specific criteria)来过滤或者界定(filter or classify)请求.</p><p>在Caddyfile文件中, 使用 matcher token(以下简称 匹配词) 限定指令的作用域, 可用的匹配词如下:</p><ul><li><code>*</code> 匹配所有的请求(默认行为)</li><li><code>/path</code> 按照请求路径匹配</li><li><code>@name</code> 使用命名匹配(named matcher)</li></ul><p>匹配词(matcher token)通常是可选的, 如果省略匹配词等同于使用通配符匹配词: <code>*</code>.</p><p>简单示例如下:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">root *           /var/www  # matcher token: *</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">root /index.html /var/www  # matcher token: /index.html</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">root @post       /var/www  # matcher token: @post</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">reverse_proxy /api/* localhost:9000 # 匹配所有 /api/ 的请求路径</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>如果想匹配所有请求, <code>*</code> 可以省略, 比如<code>reverse_proxy localhost:9000</code>等价于<code>reverse_proxy * localhost:9000</code>.</p><p>如果想使用多个匹配条件限制请求, 可以定义命名匹配(named matcher), 然后通过<code>@name</code>形式引用命名匹配:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">@postfoo {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    method POST</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    path /foo/*</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">reverse_proxy @postfoo localhost:9000</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><strong>Path matchers</strong></p><p>路径匹配词(path matcher token)必须以 <code>/</code> 开始, 默认请求下路径匹配模式是完全匹配, 可以使用通配符进行模糊匹配, 比如 <code>/foo*</code> 可以同时匹配以下路径:</p><ul><li><code>/foo</code></li><li><code>/foo/</code></li><li><code>/foobar</code></li></ul><p><strong>Named matchers</strong></p><p>所有非路径和通配符匹配的, 都必须使用命名匹配(named matcher):</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">@websockets {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    header Connection *Upgrade*</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    header Upgrade    websocket</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">reverse_proxy @websockets localhost:6001</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>上面的命名匹配则表示仅匹配请求头<code>Connection</code>包含<em>Upgrade</em>, 且请求头<code>Upgrade</code>包含<em>websocket</em>的请求.</p><p>如果命名匹配器仅有一条匹配规则, 可以将name和规则写在一行:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">@post method POST</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">reverse_proxy @post localhost:6001</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>命名匹配定义了匹配规则集, 定义的规则使用AND组合, 也就是说请求必须满足所有规则才算通过命名匹配.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="placehodlers"></a>Placehodlers<a class="hash-link" href="#placehodlers" title="Direct link to heading">#</a></h3><p>为了便于在静态配置文件Caddyfile中使用变量, Caddy 支持以下占位符(placeholder):</p><table><thead><tr><th>简写</th><th>全称</th></tr></thead><tbody><tr><td><code>{dir}</code></td><td><code>{http.request.uri.path.dir}</code></td></tr><tr><td><code>{file}</code></td><td><code>{http.request.uri.path.file}</code></td></tr><tr><td><code>{header.*}</code></td><td><code>{http.request.header.*}</code></td></tr><tr><td><code>{host}</code></td><td><code>{http.request.host}</code></td></tr><tr><td><code>{labels.*}</code></td><td><code>{http.request.host.labels.*}</code></td></tr><tr><td><code>{hostport}</code></td><td><code>{http.request.hostport}</code></td></tr><tr><td><code>{port}</code></td><td><code>{http.request.port}</code></td></tr><tr><td><code>{method}</code></td><td><code>{http.request.method}</code></td></tr><tr><td><code>{path}</code></td><td><code>{http.request.uri.path}</code></td></tr><tr><td><code>{path.*}</code></td><td><code>{http.request.uri.path.*}</code></td></tr><tr><td><code>{query}</code></td><td><code>{http.request.uri.query}</code></td></tr><tr><td><code>{query.*}</code></td><td><code>{http.request.uri.query.*}</code></td></tr><tr><td><code>{re.*.*}</code></td><td><code>{http.regexp.*.*}</code></td></tr><tr><td><code>{remote}</code></td><td><code>{http.request.remote}</code></td></tr><tr><td><code>{remote_host}</code></td><td><code>{http.request.remote.host}</code></td></tr><tr><td><code>{remote_port}</code></td><td><code>{http.request.remote.port}</code></td></tr><tr><td><code>{scheme}</code></td><td><code>{http.request.scheme}</code></td></tr><tr><td><code>{uri}</code></td><td><code>{http.request.uri}</code></td></tr><tr><td><code>{tls_cipher}</code></td><td><code>{http.request.tls.cipher_suite}</code></td></tr><tr><td><code>{tls_version}</code></td><td><code>{http.request.tls.version}</code></td></tr><tr><td><code>{tls_client_fingerprint}</code></td><td><code>{http.request.tls.client.fingerprint}</code></td></tr><tr><td><code>{tls_client_issuer}</code></td><td><code>{http.request.tls.client.issuer}</code></td></tr><tr><td><code>{tls_client_serial}</code></td><td><code>{http.request.tls.client.serial}</code></td></tr><tr><td><code>{tls_client_subject}</code></td><td><code>{http.request.tls.client.subject}</code></td></tr><tr><td><code>{tls_client_certificate_pem}</code></td><td><code>{http.request.tls.client.certificate_pem}</code></td></tr><tr><td><code>{tls_client_certificate_der_base64}</code></td><td><code>{http.request.tls.client.certificate_der_base64}</code></td></tr><tr><td><code>{upstream_hostport}</code></td><td><code>{http.reverse_proxy.upstream.hostport}</code></td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="snippets"></a>Snippets<a class="hash-link" href="#snippets" title="Direct link to heading">#</a></h3><p>可以在Caddyfile中定义片段, 方便在其他block中复用, 必须下面定义一个名为 <code>snippet</code> 的片段, 然后在另外另个block中使用<code>import snippet</code>: </p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">(snippet) {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  respond &quot;Yahaha! You found {args.0}!&quot;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">a.example.com {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    import snippet &quot;Example A&quot;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">b.example.com {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    import snippet &quot;Example B&quot;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="comments"></a>Comments<a class="hash-link" href="#comments" title="Direct link to heading">#</a></h3><p>Caddyfile中<code>#</code>后面的内容视为注释.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="automatic-https"></a>Automatic HTTPS<a class="hash-link" href="#automatic-https" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="overview"></a>Overview<a class="hash-link" href="#overview" title="Direct link to heading">#</a></h3><p>默认情况下, Caddy使用HTTPS伺服所有站点</p><ul><li>对于地址为IP、本地地址或者内网地址的站点, 比如 <code>localhost</code>, <code>127.0.0.1</code>等, Caddy使用自签名证书伺服.(使用命令<code>caddy trust</code>手动信任证书)</li><li>对于公开的DND域名, 比如<code>example.com</code>, <code>sub.example.com</code>或者<code>*.example.com</code>, Caddy使用公开的 ACME CA 证书, 比如 Let&#x27;s Encrypt 或者 ZeroSSL.</li></ul><p>Caddy自动为站点续签证书, 并默认把HTTP请求跳转到HTTPS.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="activation"></a>Activation<a class="hash-link" href="#activation" title="Direct link to heading">#</a></h3><p>Caddy隐式自动为站点提供HTTPS服务，有多种方式设置Caddy站点的伺服的域名或者IP:</p><ul><li><a href="https://caddyserver.com/docs/caddyfile" target="_blank" rel="noopener noreferrer">Caddyfile</a> 的 <a href="https://caddyserver.com/docs/caddyfile/concepts#addresses" target="_blank" rel="noopener noreferrer">site address</a></li><li><a href="https://caddyserver.com/docs/modules/http#servers/routes" target="_blank" rel="noopener noreferrer">route</a> 的 <a href="https://caddyserver.com/docs/json/apps/http/servers/routes/match/host/" target="_blank" rel="noopener noreferrer">host matcher</a></li><li>命令行的参数, 比如 <a href="https://caddyserver.com/docs/command-line#caddy-file-server" target="_blank" rel="noopener noreferrer">--domain</a> 或者 <a href="https://caddyserver.com/docs/command-line#caddy-reverse-proxy" target="_blank" rel="noopener noreferrer">--from</a></li><li>证书加载器: <a href="https://caddyserver.com/docs/json/apps/tls/certificates/automate/" target="_blank" rel="noopener noreferrer">automate</a></li></ul><p>下面是禁用Caddy默认HTTPS伺服行为的方法:</p><ul><li><a href="https://caddyserver.com/docs/json/apps/http/servers/automatic_https/" target="_blank" rel="noopener noreferrer">显式禁用</a></li><li>在配置文件中不提供任何主机名或IP</li><li>地址使用非HTTP端口号(80, 443)</li><li>地址协议使用 <code>http</code></li><li>手动加载证书</li></ul><p>在Caddyfile配置文件的全局配置里增加<code>auto_https off</code>即可显式禁用caddy所有HTTPS伺服行为.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="local-https"></a>Local HTTPS<a class="hash-link" href="#local-https" title="Direct link to heading">#</a></h3><p>为了通过HTTPS伺服非公开站点(即本地站点), Caddy使用自签名证书, 签名证书存储在 <a href="https://caddyserver.com/docs/conventions#data-directory" target="_blank" rel="noopener noreferrer">Caddy&#x27;s data directory</a> 的 <code>pki/authorities/local</code> 目录下.</p><p>Caddy的数据目录(data directory)默认路径为:
| OS | Data directory path |
| ---- | ---- |
| Linux, BSD | <code>$HOME/.local/share/caddy</code> |
| Windows | <code>%AppData%\Caddy</code> |
| macOS | <code>$HOME/Library/Application Support/Caddy</code> |
| Plan 9 | <code>$HOME/lib/caddy</code> |
| Android | <code>$HOME/caddy</code> (or <code>/sdcard/caddy</code>) |</p><p>如果存在环境变量<code>XDG_DATA_HOME</code>, 优先使用环境变量指定的目录.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="常用指令"></a>常用指令<a class="hash-link" href="#常用指令" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="log"></a>log<a class="hash-link" href="#log" title="Direct link to heading">#</a></h3><p><strong>语法</strong></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">log {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    output &lt;writer_module&gt; ...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    format &lt;encoder_module&gt; ...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    level  &lt;level&gt;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><strong>示例</strong></p><div class="mdxCodeBlock_1zKU"><div style="color:#F8F8F2;background-color:#282A36" class="codeBlockTitle_2eSY">Caddyfile</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">books.alanwei.com {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    reverse_proxy localhost:8088</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    log {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        output file books.alanwei.com.access.log {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            roll_size 10MiB # 设置文件大小</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            roll_keep 10 # 设置文件保留数量</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            roll_keep_for 48h # 设置日志保留时长</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        format console # 还支持 json</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        level INFO</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="basicauth---http-basic-authentication"></a>basicauth - HTTP Basic Authentication<a class="hash-link" href="#basicauth---http-basic-authentication" title="Direct link to heading">#</a></h3><p>设置HTTP基本认证功能.</p><p>Caddy配置文件里的密码必须hash计算之后的, 可以使用 <code>caddy hash-password</code> 命令计算密码的hash.</p><p>用户访问认证通过后, <code>{http.auth.user.id}</code> 占位符就变成可用了, 其值是用户名.</p><p><strong>语法</strong></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">basicauth [&lt;matcher&gt;] [&lt;hash_algorithm&gt; [&lt;realm&gt;]] {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;username&gt; &lt;hashed_password_base64&gt; [&lt;salt_base64&gt;]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    ...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><code>&lt;hash_algorithm&gt;</code> 密码的hash算法, 可以是<code>bcrypt</code>(默认)或者<code>scrypt</code></li><li><code>&lt;realm&gt;</code> is a custom realm name.</li><li><code>&lt;username&gt;</code> 用户名或者用户Id</li><li><code>&lt;hashed_password_base64&gt;</code> hash密码经过base64编码的值(使用 <code>caddy hash-password</code> 计算)</li><li><code>&lt;salt_base64&gt;</code> 计算hash密码使用的salt的base64编码后的值</li></ul><p><strong>示例</strong></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">books.alanwei.com {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    reverse_proxy localhost:8088</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    basicauth * {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        alan JDJhJDE0JHhpVUtuU09za3dGT1F6RnlMOUlycE9kTXhoYWlOQmVleVl0dzFJczdpdkF2cUdFY3JSN3RL</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="redir---http-redirect"></a>redir - HTTP redirect<a class="hash-link" href="#redir---http-redirect" title="Direct link to heading">#</a></h3><p>返回3xx跳转响应</p><p><strong>语法</strong></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">redir [&lt;matcher&gt;] &lt;to&gt; [&lt;code&gt;]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><code>&lt;to&gt;</code> 跳转的目标地址, 输出在响应头的<code>Location</code>中</li><li><code>&lt;code&gt;</code> HTTP响应状态码, 允许的值如下<ul><li><em>3xx</em> 的整数</li><li><code>permanent</code> 永久跳转(响应状态码 <em>301</em>)</li><li><code>temporary</code> 临时跳转(响应状态码 <em>302</em>, 默认行为)</li><li><code>html</code> 响应一段HTML文档在客户端执行跳转</li></ul></li></ul><p><strong>示例</strong></p><ul><li><code>redir https://example.com</code> 所有请求跳转到 <code>https://example.com</code></li><li><code>redir https://example.com{uri}</code> 效果同上, 但是会保留URI</li><li><code>redir https://example.com{uri} permanent</code> 效果同上, 但是响应状态码是 301</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="rewrite"></a>rewrite<a class="hash-link" href="#rewrite" title="Direct link to heading">#</a></h3><p>在内部进行请求转发, 客户端无感知, 类似代理转发.</p><p><strong>语法</strong></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-caddy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">rewrite [&lt;matcher&gt;] &lt;to&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><code>&lt;to&gt;</code> 设置请求的URI, 仅仅指定的部分被替换. URI 路径是<code>?</code>之前的字符串. 如果<code>?</code>是缺省的, 全部部分都是path.</li></ul><p><strong>示例</strong></p><ul><li><code>rewrite * /foo.html</code> 转发所有请求到 <code>foo.html</code>, </li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="qa"></a>QA<a class="hash-link" href="#qa" title="Direct link to heading">#</a></h2><p>执行caddy命令如果提示以下错误, 需要使用<code>sudo</code>执行:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-log codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">loading initial config: loading new config: http app module: start: tcp: listening on :443: listen tcp :443: bind: permission denied</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>如果外部网络无法访问caddy伺服的web, 有可能是系统防火墙拦截了, 如果是linux系统可以尝试使用<code>ufw allow</code>开放端口号.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/caddy">caddy</a><a class="margin-horiz--sm" href="/blog/tags/docker">docker</a><a class="margin-horiz--sm" href="/blog/tags/nginx">nginx</a><a class="margin-horiz--sm" href="/blog/tags/http">http</a></div></footer></article><div><a href="https://github.com/alanwei43/blog/tree/master/src/blog/2022-03-12-caddy-intro.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2022/03/12/docker-history-full-command"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">docker history命令显示完整信息 »</div></a></div></nav></div></main><div class="col col--2"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#基本命令" class="table-of-contents__link">基本命令</a><ul><li><a href="#启动" class="table-of-contents__link">启动</a></li></ul></li><li><a href="#常用使用方式" class="table-of-contents__link">常用使用方式</a><ul><li><a href="#hello-world" class="table-of-contents__link">Hello world</a></li><li><a href="#静态文件-static-files" class="table-of-contents__link">静态文件 static files</a></li><li><a href="#反向代理-reverse-proxy" class="table-of-contents__link">反向代理 reverse proxy</a></li></ul></li><li><a href="#caddyfile" class="table-of-contents__link">Caddyfile</a><ul><li><a href="#structure" class="table-of-contents__link">Structure</a></li><li><a href="#blocks" class="table-of-contents__link">blocks</a></li><li><a href="#directives" class="table-of-contents__link">Directives</a></li><li><a href="#tokens-and-quotes" class="table-of-contents__link">Tokens and quotes</a></li><li><a href="#addresses" class="table-of-contents__link">Addresses</a></li><li><a href="#matchers" class="table-of-contents__link">Matchers</a></li><li><a href="#placehodlers" class="table-of-contents__link">Placehodlers</a></li><li><a href="#snippets" class="table-of-contents__link">Snippets</a></li><li><a href="#comments" class="table-of-contents__link">Comments</a></li></ul></li><li><a href="#automatic-https" class="table-of-contents__link">Automatic HTTPS</a><ul><li><a href="#overview" class="table-of-contents__link">Overview</a></li><li><a href="#activation" class="table-of-contents__link">Activation</a></li><li><a href="#local-https" class="table-of-contents__link">Local HTTPS</a></li></ul></li><li><a href="#常用指令" class="table-of-contents__link">常用指令</a><ul><li><a href="#log" class="table-of-contents__link">log</a></li><li><a href="#basicauth---http-basic-authentication" class="table-of-contents__link">basicauth - HTTP Basic Authentication</a></li><li><a href="#redir---http-redirect" class="table-of-contents__link">redir - HTTP redirect</a></li><li><a href="#rewrite" class="table-of-contents__link">rewrite</a></li></ul></li><li><a href="#qa" class="table-of-contents__link">QA</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">文章列表</h4><ul class="footer__items"><li class="footer__item"> <a class="footer__link-item" href="/docs/articles/es6-in-depth/0-introduction">深入浅出ES6 - InfoQ.cn</a> </li><li class="footer__item"> <a class="footer__link-item" href="/docs/articles/why-java-sucks-and-csharp-rocks/1-compare-purpose">Why Java Sucks and C# Rocks - 赵劼</a> </li><li class="footer__item"> <a class="footer__link-item" href="/docs/reading">阅读笔记</a> </li><li class="footer__item"> <a class="footer__link-item" href="/docs/archives/git-guides">博文归档</a> </li></ul></div><div class="col footer__col"><h4 class="footer__title">文档翻译</h4><ul class="footer__items"><li class="footer__item"> <a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/docs/guides/blog">Docusaurus Blog</a> </li><li class="footer__item"> <a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/docs/guides/docs/markdown-features">Docusaurus Markdown</a> </li></ul></div><div class="col footer__col"><h4 class="footer__title">更多</h4><ul class="footer__items"><li class="footer__item"> <a href="https://github.com/alanwei43/node-auto-update" target="_blank" rel="noopener noreferrer" class="footer__link-item">node-auto-update - GitHub</a> </li><li class="footer__item"> <a href="https://github.com/alanwei43/docker-puppeteer" target="_blank" rel="noopener noreferrer" class="footer__link-item">docker-puppeteer - GitHub</a> </li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Alan&#x27;s Blog | <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer">...</a></div></div></div></footer></div></div></div>
<script src="/styles.29ee7585.js"></script>
<script src="/runtime~main.6b681f2b.js"></script>
<script src="/main.67ab7898.js"></script>
<script src="/1.fdda8468.js"></script>
<script src="/2.92b1c921.js"></script>
<script src="/3.cee7ea17.js"></script>
<script src="/ccc49370.e0293a73.js"></script>
<script src="/0396100f.9c723a12.js"></script>
<script src="/82d0ae0c.e945e357.js"></script>
</body>
</html>