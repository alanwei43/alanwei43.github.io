<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Alan&#39;s Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Alan&#39;s Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Alan&#39;s Blog" href="/opensearch.xml">
<script src="/scripts/baidu.js"></script>
<script src="/scripts/bing-clarity.js"></script><title data-rh="true">Caddy 简介  -  Alan&#x27;s Blog</title><meta data-rh="true" name="baidu-site-verification" content="code-7RGpEH8jty"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://blog.alanwei.com/blog/2022/03/12/caddy-intro/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Caddy 简介  -  Alan&#x27;s Blog"><meta data-rh="true" name="description" content="Caddy 使用介绍"><meta data-rh="true" property="og:description" content="Caddy 使用介绍"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-03-12T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/alanwei43"><meta data-rh="true" property="article:tag" content="caddy,docker,nginx,http"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://blog.alanwei.com/blog/2022/03/12/caddy-intro/"><link data-rh="true" rel="alternate" href="https://blog.alanwei.com/blog/2022/03/12/caddy-intro/" hreflang="en"><link data-rh="true" rel="alternate" href="https://blog.alanwei.com/blog/2022/03/12/caddy-intro/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://7SQ6A6EP36-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.3fbf6686.css">
<link rel="preload" href="/assets/js/runtime~main.68aa7264.js" as="script">
<link rel="preload" href="/assets/js/main.2ec64196.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_aKYr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.png" alt="logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Alan&#x27;s Blog</b></a><a class="navbar__item navbar__link" href="/docs/">文档</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog/">博客</a><a class="navbar__item navbar__link" href="/me/">关于我</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/alanwei43" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="Switch between dark and light mode (currently light mode)"></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">热门博文</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/05/11/javascript-video-screenshot/">使用JS对用户选择视频进行截图</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/05/08/idea-cannot-resolve-symbol/">解决 IDEA 打开Java项目提示 Cannot resolve symbol 问题</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/05/06/java-long-to-int/">long 转 int - Java</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/05/04/ubuntu-there-is-1-zombie-process/">登录 Ubuntu 20.04 LTS 显示 There is 1 zombie process</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/05/03/ubuntu-install-kvm/">Ubuntu 20.04 安装 KVM</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/05/03/windows-10-key-backup/">Windows 10 密钥查看及备份</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/04/27/front-end-pv-gif/">埋点使用Gif图片的优点</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/04/25/linux-reboot-time/">查看Linux系统开机时间</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/04/22/nodejs-undici-intro/">undici 简介 - Node.js</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/04/12/git-undo-reset/">取消 git reset 操作</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/04/9/javascript-array-shuffle/">JavaScript数组乱序</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/04/9/typescript-declare-window-variables/">TypeScript声明window全局变量</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/04/6/javascript-cancel-event/">JavaScript 取消事件绑定</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/04/4/javascript-scroll-top-smooth/">JavaScript滚动到页面顶部</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/03/31/hadoop-hive-spark-intro/">如何用形象的比喻描述大数据的技术生态？Hadoop、Hive、Spark 之间是什么关系？</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/03/31/large-git-repository.md/">如何解决Git仓库 .git 文件过大问题</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/03/27/intel-cpu-numbers/">Intel CPU 名称和编号规范</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/03/24/flutter-qa/">Flutter QA</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/03/16/dotnet-script-intro/">.Net Script 简介</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/03/16/dotnet-starter/">.Net Core QA</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/03/16/get-public-ip-using-curl/">使用curl命令行获取当前机器公网IP</a></li><li class="sidebarItem_CF0Q"><a aria-current="page" class="sidebarItemLink_miNk sidebarItemLinkActive_RRTD" href="/blog/2022/03/12/caddy-intro/">Caddy 简介</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/03/12/docker-history-full-command/">docker history命令显示完整信息</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/03/12/macos-security-allow-apps-anywhere/">macOS系统安全隐私设置允许任意源下载的App</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/03/10/spring-both-support-json-url-encoded/">Spring 接口同时支持JSON数据和Form表单数据</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/03/08/node-child-process-memory/">Node调整child_process内存大小</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/03/04/git-remove-untrack-files/">Git 删除未跟踪文件</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/03/01/spring-response-image/">Spring 响应图片等媒体数据</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/02/27/vmware-vmrun-cli/">VMware 命令行操作虚拟机</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/02/27/vmware-workstation-pro-keys/">VMware Workstation Pro keys</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/02/27/windows-vmware-tools-drive-fail/">VMware的Windows虚拟机中因驱动签名问题无法安装 VMware Tools</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/02/26/docker-dockerfile-intro/">Dockerfile 常用指令介绍</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/02/24/idea-lombok/">解决IDEA使用低版本lombok没有get/set方法问题</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/02/23/retrofit-mock-server/">Mock Retrofit http request</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/02/20/flutter-remote-debug-android-device/">Flutter远程调试Android设备</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/02/19/dart-visual-studio-code-settings/">Dart Visual Studio Code 推荐设置</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/02/18/github-qa/">GitHub QA</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/02/18/windows-virtual-desktop/">Windows 虚拟桌面快捷键</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/02/16/ubuntu-dpkg-install-dependency/">解决Ubuntu使用dpkg安装deb软件包提示缺少依赖问题</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/02/14/oray-box-intro/">蒲公英 X1 简介</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/02/12/docker-connect-host/">容器内访问物理网络</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/02/12/install-docker/">安装或卸载 Docker</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/02/12/linux-startup-script-crontab/">Linux启动自动执行特定脚本</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/02/6/ubuntu-sqlite3-starter/">Ubuntu 20.04 安装使用 SQLite</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/01/25/flutter-json-seriealize/">Flutter JSON 序列化</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/01/24/ssh-no-matching-host-key-type-found/">解决SSH no matching host key type found 问题</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/01/15/ubuntu-ssh-connection-refused/">解决 Ubuntu/Debian SSH 连接时返回的 Connection refused</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/01/10/visual-studio-code-snippets/">VSC常用代码片段</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/01/08/ubuntu-install-multimia-codecs/">Ubuntu 20.04 LTS 安装多媒体解码库</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/01/08/vmware-workstation-kernel-module-updater/">解决Ubuntu系统启动 VMware Workstation Pro 提示 Kernel Module Updater 问题</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/01/06/jdk-roadmap-download/">JDK LTS 路线图及下载地址</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/01/01/microsoft-pinyin-date/">微软拼音输入法自定义日期时间格式</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/01/01/powershell-qa/">PowerShell 常见问答</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/12/12/tsdoc-config/">API Extractor 使用</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/11/28/typescript-type-define-skills/">TypeScript 类型定义小技巧</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/11/18/book-tu-jie-http/">《图解HTTP》笔记</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/11/13/dotnet-web-api-starter/">创建.Net Web API项目</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/10/16/VMware-fusion-pro/">VMware Fusion Pro 注册码 序列号</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/10/10/react-loop-bind-event/">React事件处理程序箭头函数造成的重复渲染问题</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/10/07/detect-puppeteer-browse/">检测是否是puppeteer访问以及如何破解</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/10/07/nodejs-stream-pipe-finish/">如何知道 Node.js stream pipe 完成</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/10/06/dom-attributes-in-react-16/">DOM Attributes in React 16</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/08/10/mozilla-firefox-devtool-zoom/">修改火狐浏览器开发者工具字体大小</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/07/04/event-emitters-typescript/">Event Emitters in TypeScript</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/06/27/javascript-create-an-array-with-repeat-element/">JavaScript创建指定数量的重复元素</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/05/25/kafka-docker-setup/">使用Docker运行Apache Kafka</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/05/18/bash-shortcuts/">Bash快捷键列表</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/05/17/mac-xcrun-error/">解决 macOS 系统 xcrun error invalid active developer path 异常</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/05/17/termux-mirror/">Termux配置清华大学开源镜像</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/05/09/typescript-type-reference/">一个TypeScript类型复用的小技巧</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/05/05/macos-allow-apps-from-anywhere/">macOS 允许打开任何位置下载的App</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/05/05/spring-mvc-custom-handler-interceptor/">使用自定义的Spring MVC处理程序拦截器管理会话</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/05/05/spring-mvc-handlerinterceptor/">Spring MVC HandlerInterceptor 简介</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/05/04/spring-boot-jsp/">Spring Boot 使用 JSP</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/05/01/docusaurus-github-starter/">使用 Docusaurus 结合 GitHub 搭建个人站点</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/04/27/visual-studio-code-intelligence/">VSC指定类库文件增强智能感知</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/04/26/termux-remote-access/">Termux远程访问</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/04/23/语文考试可以写负能量作文吗/">语文考试可以写负能量作文吗</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/04/15/nginx-rewrite/">Nginx 301重定向域名</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/04/11/centos-install-nginx/">CentOS安装Nginx</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/04/11/create-windows-service/">创建Windows服务</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/04/11/customize-bash-prompt/">自定义Linux Bash终端提示符</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/04/11/docker-sentry-deploy/">使用 Docker 部署 Sentry</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/04/11/iis-reverse-proxy-url-rewrite/">How to Setup Reverse Proxy on IIS with URL-Rewrite</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/04/11/iis-reverse-proxy/">配置IIS反向代理教程</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/04/11/linux-show-ssh-connection/">查看当前机器的所有SSH连接</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/04/11/node-exec-bash-cmd/">使用 Node.js 执行命令行程序</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/04/11/spring-boot-maven-plugin/">Spring Boot Maven 插件使用</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/04/11/tcp-proxy-in-windows/">Windows 上的TCP代理设置</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/04/11/ubuntu-install-root-ca-certificate/">Ubuntu 系统安装根证书</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/04/11/ubuntu-starter-scripts/">我的Ubuntu新系统安装脚本</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/04/11/why-math-round-return-2-instead-3/">为什么 Math.Round(2.5) 返回 2</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/04/11/windows-bootable-device/">制作Windows启动盘</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/04/10/node-require-cache/">Node.js require 缓存</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/04/03/asp.net-proxy-configuration/">ASP.Net 应用配置HTTP代理</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/04/03/how-to-create-maven-multi-module-project/">如何使用命令行创建带有多个子模块的Maven项目</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/04/03/powershell-git-chinese-encode/">解决 Windows 环境中 git log 命令中文编码问题</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/04/03/windows-add-programs-to-startup-folder/">添加Windows开启启动程序</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/04/02/docker-timezone/">Docker时区设置</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/30/npm-install-eresulve-error/">解决 NPM 安装应用出现 ERESOLVE 错误</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/28/git-tags/">Git Tags 使用简介</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/26/docker-config-mirror/">Docker配置镜像加速</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/26/open-mirrors/">国内开源镜像站点</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/21/chromium-command-line-switches/">Chromium 所有开关(flag)列表</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/21/docusaurus-github-deploy/">Docusaurus 配置 GitHub Action 自动发布</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/21/frp-eof/">frp连接 EOF 失败问题</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/21/linux-all-ps-connection/">linux下查看指定进程的所有连接信息</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/21/linux-view-port-using/">显示Linux端口占用</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/21/maven-aliyun/">阿里云Maven镜像</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/21/node-tls/">解决 Node.js HTTP 请求出现的自签名证书校验失败问题</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/21/npm-taobao/">NPM的淘宝镜像</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/20/visual-studio-code-reveal/">Visual Studio Code 侧边栏定位到当前文件</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/15/chrome-flags/">Chrome flags</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/14/lets-encrypt-ssl-certificate/">Let&#x27;s Encrypt证书申请及配置</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/13/back-forward-cache/">浏览器的前进后退缓存机制 Back/forward cache</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/13/macos-change-default-behavior-function-keys/">macOS - 更改功能键的默认行为</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/09/remove-http-request-referrer/">删除HTTP请求头中的 referrer</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/07/bei-cui-cheng-xu-yuan-yi-ji-cheng-xu-yuan-be-cui/">悲催的程序员，以及程序员的悲催</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/07/cong-qian-man/">从前慢</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/06/create-java-project-use-maven/">使用Maven创建一个Java项目</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/06/how-can-i-create-an-executable-jar-with-dependencies-using-maven/">如何使用Maven创建可执行的JAR文件</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/06/ipsec-clients-ikev2/">IKEv2 配置和使用指南</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/06/ipsec-clients-l2tp/">配置 IPsec/L2TP 客户端</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/06/ipsec-clients-xauth/">配置 IPsec/XAuth VPN 客户端</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/06/ipsec-server/">搭建 IPSec 服务</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/06/sublime-right-click-open/">配置右击使用Sublime打开文件夹</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/06/vsc-code-folding/">VSC代码块折叠</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/05/vsc-code-snippets/">VSC 代码片段介绍</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/05/vsc-markdown-snippets/">Markdown 智能感知插入代码片段</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/04/mac-install-wireguard/">Mac安装Wireguard</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/04/sublime-vim-mode/">Sublime开启Vim模式</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/03/Structure-needs-cleaning/">Linux - Structure needs cleaning</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/03/mac-java-home/">设置Mac系统JAVA_HOME</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/03/03/mac-vsc-path/">设置Mac VSC的code变量</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/02/28/node-hash/">Node.js Hash计算</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/02/24/hot-swapping-in-spring-boot/">Spring Boot Hot Swapping</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2021/02/17/java-network-proxy/">设置Java程序网络代理</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2020/03/20/visual-studio-code-config/">我的 Visual Studio Code 配置</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2020/03/20/visual-studio-code-keyboard/">我的 Visual Studio Code 快捷键配置</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2019/05/14/asp-net-identity-module/">ASP.Net 身份模块介绍</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2019/03/20/vim-config/">我的Vim配置</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2019/03/06/async/">异步编程简介</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2014/09/09/philosophy-note/">哲学思维讲堂 - 卡尔·雅斯贝尔斯</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2014/09/04/math-physics-diff/">数学系和物理系学生有什么差别？</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_uMeh" itemprop="headline">Caddy 简介</h1><div class="blogPostData_Vfxe margin-vert--md"><time datetime="2022-03-12T00:00:00.000Z" itemprop="datePublished">March 12, 2022</time> · <!-- -->21 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><span class="avatar__photo-link avatar__photo"><a href="https://github.com/alanwei43" target="_blank" rel="noopener noreferrer"><img class="image_o0gy" src="https://avatars.githubusercontent.com/u/2927578?s=460&amp;u=153132e7aa3be8295a1703af9b759ca22338f557&amp;v=4" alt="Alan"></a></span><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/alanwei43" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Alan</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of blog</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p><a href="https://caddyserver.com/docs/" target="_blank" rel="noopener noreferrer">官方给的简介</a>是: Caddy是一个强大的、可扩展的平台, 用于伺服你的站点、服务以及应用. Caddy使用Go语言编写.</p><p>简单来说, caddy 和 nginx 很像, 我觉得相比较nginx有以下优点:</p><ol><li><strong>安装简单</strong> caddy的是个<a href="https://github.com/caddyserver/caddy/releases/" target="_blank" rel="noopener noreferrer">单文件可执行程序</a>, 没有任何依赖, 下载下来就可以使用. 对于简单的web服务, 使用命令行即可运行, 不需要任何配置文件.</li><li><strong>自动签发HTTPS证书</strong> caddy默认对所有站点开启HTTPS(支持Let&#x27;s encrypt 和 ZeroSSL证书自动申请).</li><li><strong>原生支持HTTP API</strong> 支持使用HTTP API方式修改配置.</li></ol><p>缺点就是生态和性能不如nginx, 不过个人使用绝大部分场景都能hold住.</p><p>Caddy由ZeroSSL<a href="https://github.com/caddyserver/caddy" target="_blank" rel="noopener noreferrer">开源</a>, 其原生配置语言是<a href="https://caddyserver.com/docs/json/" target="_blank" rel="noopener noreferrer">JSON</a>, 但是手写JSON配置比较麻烦且易错, 所以Caddy支持配置适配器(config adapter), 适配器是通过插件形式实现. 除了官方建议使用的 <a href="https://caddyserver.com/docs/caddyfile" target="_blank" rel="noopener noreferrer">Caddyfile</a> 文件配置, 还提供了<a href="https://github.com/caddyserver/nginx-adapter" target="_blank" rel="noopener noreferrer">nginx配置适配</a>. 通过 <a href="https://github.com/caddyserver/nginx-adapter" target="_blank" rel="noopener noreferrer">nginx-adapter</a>, 可以让 caddy 支持nginx的配置文件.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="基本命令">基本命令<a class="hash-link" href="#基本命令" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="启动">启动<a class="hash-link" href="#启动" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 在前台启动 caddy 服务, 按 ctrl + c 终止服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">caddy run --config ./Caddyfile --adapter caddyfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 在后台启动 caddy 服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">caddy start --config ./Caddyfile --adapter caddyfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 或者使用 docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -d </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --name caddy-run </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -p </span><span class="token number" style="color:#36acaa">80</span><span class="token plain">:80 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -p </span><span class="token number" style="color:#36acaa">443</span><span class="token plain">:443 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -v </span><span class="token environment constant" style="color:#36acaa">$PWD</span><span class="token plain">/Caddyfile /etc/caddy/Caddyfile </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  caddy</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>其他参数:</p><ul><li><code>--adapter</code> 用于指定配置适配器(更多适配器参考: <a href="https://caddyserver.com/docs/config-adapters" target="_blank" rel="noopener noreferrer">config-adapters</a> )</li><li><code>--watch</code> 参数可以监视配置文件(由参数<code>--config</code>指定)变化, 并自动重新加载服务</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="常用使用方式">常用使用方式<a class="hash-link" href="#常用使用方式" title="Direct link to heading">​</a></h2><p>caddy 支持CLI方式伺服静态文件和反向代理, 同时支持配置文件进行更复杂的服务伺服.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="hello-world">Hello world<a class="hash-link" href="#hello-world" title="Direct link to heading">​</a></h3><p>假设配置文件如下(需要把<code>demo.alanwei.com</code>替换成你自己的域名或者<code>localhost</code>):</p><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">Caddyfile</div><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">demo.alanwei.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">respond &quot;Hello, privacy!&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>执行命令 <code>caddy run --config ./Caddyfile</code>, 然后访问 <code>https://demo.alanwei.com</code> 就会返回 <code>Hello, privacy!</code>, HTTPS 支持完全自动化.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="静态文件-static-files">静态文件 static files<a class="hash-link" href="#静态文件-static-files" title="Direct link to heading">​</a></h3><p><strong>CLI方式</strong></p><p>基本命令 <code>caddy file-server</code> </p><p>示例:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 指定端口号</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">caddy file-server --listen :2015 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 也指定目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">caddy file-server --root </span><span class="token environment constant" style="color:#36acaa">$PWD</span><span class="token plain">/build --listen </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:3001</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>常用参数:</p><ul><li><code>--listen [&lt;host&gt;]:&lt;port&gt;</code> 指定监听的端口号, <code>&lt;host&gt;</code> 可以省略</li><li><code>--browser</code> 如果站点没有index文件, 允许列出站点下文件目录</li><li><code>--root &lt;dir&gt;</code> 默认站点目录是当前目录, 可通过改参数修改默认行为</li></ul><p><strong>Caddyfile方式</strong></p><p>对应的 <strong>Caddyfile</strong> 基本配置如下:</p><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">localhost:2015</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file_server</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>指令<a href="https://caddyserver.com/docs/caddyfile/directives/file_server" target="_blank" rel="noopener noreferrer">file_server</a>常用选项: </p><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">http://files.alanwei.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    root * /data/software # 指定目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file_server browse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        index &quot;REAME.md&quot; index.html index.txt # 设置首页文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hide android *.sh &quot;**/node_modules/**&quot; # 隐藏特定文件或目录, 支持占位符和glob patterns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="反向代理-reverse-proxy">反向代理 reverse proxy<a class="hash-link" href="#反向代理-reverse-proxy" title="Direct link to heading">​</a></h3><p><strong>CLI方式</strong></p><p>基本命令: <code>caddy reverse-proxy</code></p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 把所有 localhost 的请求都转发到 127.0.0.1:9000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">caddy reverse-proxy --to </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:9000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 把所有 *:3013 的请求都转发到 127.0.0.1:3010 , 并禁用https</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">caddy reverse-proxy --insecure -from :3013 -to </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:3010</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>支持参数:</p><ul><li><code>--change-host-header</code> 修改upstream的 <em>Host</em></li><li><code>--from [&lt;host&gt;]:&lt;port&gt;</code> 接收请求的地址, 默认是 <em>localhost</em></li><li><code>--insecure</code> 禁用 TLS 校验</li><li><code>--to</code> 代理到的地址</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="caddyfile">Caddyfile<a class="hash-link" href="#caddyfile" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="structure">Structure<a class="hash-link" href="#structure" title="Direct link to heading">​</a></h3><p>Caddyfile的文件结构如下:</p><p><img src="https://caddyserver.com/resources/images/caddyfile-visual.png" alt="caddyfile"></p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><ul><li>文件开始的全局配置块(global options block)是可选的</li><li>如果没有全局配置块, Caddyfile 文件的第一行一定是需要伺服的站点的地址(address)</li><li>如果文件仅有一个站点配置块(site block), 那配置块的花括号(<code>{ }</code>)是可以省略的</li></ul></div></div><p>Caddyfile 至少有一个站点配置块(site block), 如果指令(directive)出现在站点配置块的地址(address)前, 那配置文件解析将会失败.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="blocks">blocks<a class="hash-link" href="#blocks" title="Direct link to heading">​</a></h3><p>使用花括号开启和关闭一个block:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">... {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li>左花括号(<code>{</code>)必须在行尾</li><li>右花括号(<code>}</code>)必须独占一行</li></ul><p>当配置文件仅有一个站点配置块(site block), 为了方便快速定义单个站点, 花括号(和block的内容缩进)是可选的, 比如:</p><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">Caddyfile</div><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reverse_proxy /api/* localhost:9001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file_server</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>等价于</p><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">Caddyfile</div><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">localhost {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reverse_proxy /api/* localhost:9001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file_server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>如果有多个站点, 必须使用花括号:</p><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">Caddyfile</div><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">example1.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    root * /www/example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file_server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">example2.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reverse_proxy localhost:9000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>如果一个请求匹配到了多个块(site block), 则会选用最精确地址(address)的那个配置块(site block), 也就是说请求只会被一个block接管，不会级联传递到多个block.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="directives">Directives<a class="hash-link" href="#directives" title="Direct link to heading">​</a></h3><p>指令(directive)关键词用于定义站点如何被伺服, 比如<code>file_server</code>表示静态文件站点, <code>reverse_proxy</code>表示反向代理站点. </p><p>在站点配置块里(site block), 指令必须是其所在行的第一个单词, 指令后面的单词是传给指令的参数</p><blockquote><p>当Caddyfile被适配的时候, 指令的会按照一定规则进行排序, 参考<a href="https://caddyserver.com/docs/caddyfile/directives#directive-order" target="_blank" rel="noopener noreferrer">directive order</a></p></blockquote><p>子指令可以出现在指令块中:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reverse_proxy localhost:9000 localhost:9001 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lb_policy first</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>lb_policy</code>(load balance policy) 是 <code>reverse_proxy</code> 的子指令, 用于设置有多个后端服务时的负载均衡.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="tokens-and-quotes">Tokens and quotes<a class="hash-link" href="#tokens-and-quotes" title="Direct link to heading">​</a></h3><p>词法和引号, 解析Caddyfile的时候，通过空格拆分token, 比如<code>directive abc def</code>表示指令会收到两个参数, 而<code>directive &quot;abc def&quot;</code>指令就只收到一个参数, 可以使用以下方式传递带有引号的参数值: </p><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">directive &quot;\&quot;abc def\&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">directive `&quot;abc def&quot;`</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="addresses">Addresses<a class="hash-link" href="#addresses" title="Direct link to heading">​</a></h3><p>站点的地址(address)必须出现在站点配置块(site block)的开头, 有效的地址格式如下:</p><ul><li><code>localhost</code></li><li><code>example.com</code></li><li><code>:443</code></li><li><code>http://example.com</code></li><li><code>localhost:8080</code></li><li><code>127.0.0.1</code></li><li><code>[::1]:2015</code></li><li><code>example.com/foo/*</code></li><li><code>*.example.com</code></li><li><code>http://</code></li></ul><p>如果你指定了主机名/域名(hostname), 那只有请求头的<code>Host</code>和hostname匹配的请求才会被处理, 和hostname不匹配的请求则会被忽略. 比如站点配置的地址是<code>localhost</code>, 那caddy就不会匹配请求头<code>Host: 127.0.0.1</code> 的请求.</p><p>地址中可以使用通配符<code>*</code>, 但是通配符只会匹配一段, 比如<code>*.example.com</code>会匹配<code>foo.example.com</code>, 但是不会匹配<code>foo.bar.example.com</code>. 另外, 如果使用<code>*</code>作为整个地址, 会匹配<code>localhost</code>, 但是不会匹配 <code>example.com</code>.</p><p>如果多个地址(address)使用相同的配置定义, 可以把他们放在一起, 使用逗号分割: </p><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">localhost:8080, example.com, www.example.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 或者如下</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">localhost:8080,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">example.com,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">www.example.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>同名地址不能多次指定.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="matchers">Matchers<a class="hash-link" href="#matchers" title="Direct link to heading">​</a></h3><p>Request matchers 用于使用指定的标准(specific criteria)来过滤或者界定(filter or classify)请求.</p><p>在Caddyfile文件中, 使用 matcher token(以下简称 匹配词) 限定指令的作用域, 可用的匹配词如下:</p><ul><li><code>*</code> 匹配所有的请求(默认行为)</li><li><code>/path</code> 按照请求路径匹配</li><li><code>@name</code> 使用命名匹配(named matcher)</li></ul><p>匹配词(matcher token)通常是可选的, 如果省略匹配词等同于使用通配符匹配词: <code>*</code>.</p><p>简单示例如下:</p><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">root *           /var/www  # matcher token: *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root /index.html /var/www  # matcher token: /index.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root @post       /var/www  # matcher token: @post</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reverse_proxy /api/* localhost:9000 # 匹配所有 /api/ 的请求路径</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>如果想匹配所有请求, <code>*</code> 可以省略, 比如<code>reverse_proxy localhost:9000</code>等价于<code>reverse_proxy * localhost:9000</code>.</p><p>如果想使用多个匹配条件限制请求, 可以定义命名匹配(named matcher), 然后通过<code>@name</code>形式引用命名匹配:</p><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">@postfoo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    method POST</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path /foo/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reverse_proxy @postfoo localhost:9000</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>Path matchers</strong></p><p>路径匹配词(path matcher token)必须以 <code>/</code> 开始, 默认请求下路径匹配模式是完全匹配, 可以使用通配符进行模糊匹配, 比如 <code>/foo*</code> 可以同时匹配以下路径:</p><ul><li><code>/foo</code></li><li><code>/foo/</code></li><li><code>/foobar</code></li></ul><p><strong>Named matchers</strong></p><p>所有非路径和通配符匹配的, 都必须使用命名匹配(named matcher):</p><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">@websockets {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header Connection *Upgrade*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header Upgrade    websocket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reverse_proxy @websockets localhost:6001</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>上面的命名匹配则表示仅匹配请求头<code>Connection</code>包含<em>Upgrade</em>, 且请求头<code>Upgrade</code>包含<em>websocket</em>的请求.</p><p>如果命名匹配器仅有一条匹配规则, 可以将name和规则写在一行:</p><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">@post method POST</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reverse_proxy @post localhost:6001</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>命名匹配定义了匹配规则集, 定义的规则使用AND组合, 也就是说请求必须满足所有规则才算通过命名匹配.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="placehodlers">Placehodlers<a class="hash-link" href="#placehodlers" title="Direct link to heading">​</a></h3><p>为了便于在静态配置文件Caddyfile中使用变量, Caddy 支持以下占位符(placeholder):</p><table><thead><tr><th>简写</th><th>全称</th></tr></thead><tbody><tr><td><code>{dir}</code></td><td><code>{http.request.uri.path.dir}</code></td></tr><tr><td><code>{file}</code></td><td><code>{http.request.uri.path.file}</code></td></tr><tr><td><code>{header.*}</code></td><td><code>{http.request.header.*}</code></td></tr><tr><td><code>{host}</code></td><td><code>{http.request.host}</code></td></tr><tr><td><code>{labels.*}</code></td><td><code>{http.request.host.labels.*}</code></td></tr><tr><td><code>{hostport}</code></td><td><code>{http.request.hostport}</code></td></tr><tr><td><code>{port}</code></td><td><code>{http.request.port}</code></td></tr><tr><td><code>{method}</code></td><td><code>{http.request.method}</code></td></tr><tr><td><code>{path}</code></td><td><code>{http.request.uri.path}</code></td></tr><tr><td><code>{path.*}</code></td><td><code>{http.request.uri.path.*}</code></td></tr><tr><td><code>{query}</code></td><td><code>{http.request.uri.query}</code></td></tr><tr><td><code>{query.*}</code></td><td><code>{http.request.uri.query.*}</code></td></tr><tr><td><code>{re.*.*}</code></td><td><code>{http.regexp.*.*}</code></td></tr><tr><td><code>{remote}</code></td><td><code>{http.request.remote}</code></td></tr><tr><td><code>{remote_host}</code></td><td><code>{http.request.remote.host}</code></td></tr><tr><td><code>{remote_port}</code></td><td><code>{http.request.remote.port}</code></td></tr><tr><td><code>{scheme}</code></td><td><code>{http.request.scheme}</code></td></tr><tr><td><code>{uri}</code></td><td><code>{http.request.uri}</code></td></tr><tr><td><code>{tls_cipher}</code></td><td><code>{http.request.tls.cipher_suite}</code></td></tr><tr><td><code>{tls_version}</code></td><td><code>{http.request.tls.version}</code></td></tr><tr><td><code>{tls_client_fingerprint}</code></td><td><code>{http.request.tls.client.fingerprint}</code></td></tr><tr><td><code>{tls_client_issuer}</code></td><td><code>{http.request.tls.client.issuer}</code></td></tr><tr><td><code>{tls_client_serial}</code></td><td><code>{http.request.tls.client.serial}</code></td></tr><tr><td><code>{tls_client_subject}</code></td><td><code>{http.request.tls.client.subject}</code></td></tr><tr><td><code>{tls_client_certificate_pem}</code></td><td><code>{http.request.tls.client.certificate_pem}</code></td></tr><tr><td><code>{tls_client_certificate_der_base64}</code></td><td><code>{http.request.tls.client.certificate_der_base64}</code></td></tr><tr><td><code>{upstream_hostport}</code></td><td><code>{http.reverse_proxy.upstream.hostport}</code></td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="snippets">Snippets<a class="hash-link" href="#snippets" title="Direct link to heading">​</a></h3><p>可以在Caddyfile中定义片段, 方便在其他block中复用, 必须下面定义一个名为 <code>snippet</code> 的片段, 然后在另外另个block中使用<code>import snippet</code>: </p><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">(snippet) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  respond &quot;Yahaha! You found {args.0}!&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a.example.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    import snippet &quot;Example A&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b.example.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    import snippet &quot;Example B&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="comments">Comments<a class="hash-link" href="#comments" title="Direct link to heading">​</a></h3><p>Caddyfile中<code>#</code>后面的内容视为注释.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="automatic-https">Automatic HTTPS<a class="hash-link" href="#automatic-https" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="overview">Overview<a class="hash-link" href="#overview" title="Direct link to heading">​</a></h3><p>默认情况下, Caddy使用HTTPS伺服所有站点</p><ul><li>对于地址为IP、本地地址或者内网地址的站点, 比如 <code>localhost</code>, <code>127.0.0.1</code>等, Caddy使用自签名证书伺服.(使用命令<code>caddy trust</code>手动信任证书)</li><li>对于公开的DND域名, 比如<code>example.com</code>, <code>sub.example.com</code>或者<code>*.example.com</code>, Caddy使用公开的 ACME CA 证书, 比如 Let&#x27;s Encrypt 或者 ZeroSSL.</li></ul><p>Caddy自动为站点续签证书, 并默认把HTTP请求跳转到HTTPS.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="activation">Activation<a class="hash-link" href="#activation" title="Direct link to heading">​</a></h3><p>Caddy隐式自动为站点提供HTTPS服务，有多种方式设置Caddy站点的伺服的域名或者IP:</p><ul><li><a href="https://caddyserver.com/docs/caddyfile" target="_blank" rel="noopener noreferrer">Caddyfile</a> 的 <a href="https://caddyserver.com/docs/caddyfile/concepts#addresses" target="_blank" rel="noopener noreferrer">site address</a></li><li><a href="https://caddyserver.com/docs/modules/http#servers/routes" target="_blank" rel="noopener noreferrer">route</a> 的 <a href="https://caddyserver.com/docs/json/apps/http/servers/routes/match/host/" target="_blank" rel="noopener noreferrer">host matcher</a></li><li>命令行的参数, 比如 <a href="https://caddyserver.com/docs/command-line#caddy-file-server" target="_blank" rel="noopener noreferrer">--domain</a> 或者 <a href="https://caddyserver.com/docs/command-line#caddy-reverse-proxy" target="_blank" rel="noopener noreferrer">--from</a></li><li>证书加载器: <a href="https://caddyserver.com/docs/json/apps/tls/certificates/automate/" target="_blank" rel="noopener noreferrer">automate</a></li></ul><p>下面是禁用Caddy默认HTTPS伺服行为的方法:</p><ul><li><a href="https://caddyserver.com/docs/json/apps/http/servers/automatic_https/" target="_blank" rel="noopener noreferrer">显式禁用</a></li><li>在配置文件中不提供任何主机名或IP</li><li>地址使用非HTTP端口号(80, 443)</li><li>地址协议使用 <code>http</code></li><li>手动加载证书</li></ul><p>在Caddyfile配置文件的全局配置里增加<code>auto_https off</code>即可显式禁用caddy所有HTTPS伺服行为.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="local-https">Local HTTPS<a class="hash-link" href="#local-https" title="Direct link to heading">​</a></h3><p>为了通过HTTPS伺服非公开站点(即本地站点), Caddy使用自签名证书, 签名证书存储在 <a href="https://caddyserver.com/docs/conventions#data-directory" target="_blank" rel="noopener noreferrer">Caddy&#x27;s data directory</a> 的 <code>pki/authorities/local</code> 目录下.</p><p>Caddy的数据目录(data directory)默认路径为: </p><table><thead><tr><th>OS</th><th>Data directory path</th></tr></thead><tbody><tr><td>Linux, BSD</td><td><code>$HOME/.local/share/caddy</code></td></tr><tr><td>Windows</td><td><code>%AppData%\Caddy</code></td></tr><tr><td>macOS</td><td><code>$HOME/Library/Application Support/Caddy</code></td></tr><tr><td>Plan 9</td><td><code>$HOME/lib/caddy</code></td></tr><tr><td>Android</td><td><code>$HOME/caddy</code> (or <code>/sdcard/caddy</code>)</td></tr></tbody></table><p>如果存在环境变量<code>XDG_DATA_HOME</code>, 优先使用环境变量指定的目录.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="常用指令">常用指令<a class="hash-link" href="#常用指令" title="Direct link to heading">​</a></h2><blockquote><p>指令都是在site block内使用</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="log">log<a class="hash-link" href="#log" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="语法">语法<a class="hash-link" href="#语法" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">log {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output &lt;writer_module&gt; ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    format &lt;encoder_module&gt; ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    level  &lt;level&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="示例">示例<a class="hash-link" href="#示例" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">Caddyfile</div><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">books.alanwei.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reverse_proxy localhost:8088</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        output file books.alanwei.com.access.log {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            roll_size 10MiB # 设置文件大小</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            roll_keep 10 # 设置文件保留数量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            roll_keep_for 48h # 设置日志保留时长</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        format console # 还支持 json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        level INFO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="basicauth">basicauth<a class="hash-link" href="#basicauth" title="Direct link to heading">​</a></h3><p>HTTP Basic Authentication, 设置HTTP基本认证功能.</p><p>Caddy配置文件里的密码必须hash计算之后的, 可以使用 <code>caddy hash-password</code> 命令计算密码的hash.</p><p>用户访问认证通过后, <code>{http.auth.user.id}</code> 占位符就变成可用了, 其值是用户名.</p><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="语法-1">语法<a class="hash-link" href="#语法-1" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">basicauth [&lt;matcher&gt;] [&lt;hash_algorithm&gt; [&lt;realm&gt;]] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;username&gt; &lt;hashed_password_base64&gt; [&lt;salt_base64&gt;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li><code>&lt;hash_algorithm&gt;</code> 密码的hash算法, 可以是<code>bcrypt</code>(默认)或者<code>scrypt</code></li><li><code>&lt;realm&gt;</code> is a custom realm name.</li><li><code>&lt;username&gt;</code> 用户名或者用户Id</li><li><code>&lt;hashed_password_base64&gt;</code> hash密码经过base64编码的值(使用 <code>caddy hash-password</code> 计算)</li><li><code>&lt;salt_base64&gt;</code> 计算hash密码使用的salt的base64编码后的值</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="示例-1">示例<a class="hash-link" href="#示例-1" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">books.alanwei.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reverse_proxy localhost:8088</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    basicauth * {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        alan JDJhJDE0JHhpVUtuU09za3dGT1F6RnlMOUlycE9kTXhoYWlOQmVleVl0dzFJczdpdkF2cUdFY3JSN3RL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="redir">redir<a class="hash-link" href="#redir" title="Direct link to heading">​</a></h3><p>HTTP redirect, 返回3xx跳转响应</p><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="语法-2">语法<a class="hash-link" href="#语法-2" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">redir [&lt;matcher&gt;] &lt;to&gt; [&lt;code&gt;]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li><code>&lt;to&gt;</code> 跳转的目标地址, 输出在响应头的<code>Location</code>中</li><li><code>&lt;code&gt;</code> HTTP响应状态码, 允许的值如下<ul><li><em>3xx</em> 的整数</li><li><code>permanent</code> 永久跳转(响应状态码 <em>301</em>)</li><li><code>temporary</code> 临时跳转(响应状态码 <em>302</em>, 默认行为)</li><li><code>html</code> 响应一段HTML文档在客户端执行跳转</li></ul></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="示例-2">示例<a class="hash-link" href="#示例-2" title="Direct link to heading">​</a></h4><ul><li><code>redir https://example.com</code> 所有请求跳转到 <code>https://example.com</code></li><li><code>redir https://example.com{uri}</code> 效果同上, 但是会保留URI</li><li><code>redir https://example.com{uri} permanent</code> 效果同上, 但是响应状态码是 301</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="rewrite">rewrite<a class="hash-link" href="#rewrite" title="Direct link to heading">​</a></h3><p>在内部进行请求转发, 客户端无感知, 类似代理转发.</p><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="语法-3">语法<a class="hash-link" href="#语法-3" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">rewrite [&lt;matcher&gt;] &lt;to&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li><code>&lt;to&gt;</code> 设置请求的URI, 仅仅指定的部分被替换. URI 路径是<code>?</code>之前的字符串. 如果<code>?</code>是缺省的, 全部部分都是path.</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="示例-3">示例<a class="hash-link" href="#示例-3" title="Direct link to heading">​</a></h4><ul><li><code>rewrite * /foo.html</code> 转发所有请求到 <code>foo.html</code>, </li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="reverse_proxy">reverse_proxy<a class="hash-link" href="#reverse_proxy" title="Direct link to heading">​</a></h3><p>用于设置反向代理</p><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="语法-4">语法<a class="hash-link" href="#语法-4" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">reverse_proxy [&lt;matcher&gt;] [&lt;upstreams...&gt;] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # backends</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    to      &lt;upstreams...&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dynamic &lt;module&gt; ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # load balancing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lb_policy       &lt;name&gt; [&lt;options...&gt;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lb_try_duration &lt;duration&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lb_try_interval &lt;interval&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # header manipulation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trusted_proxies [private_ranges] &lt;ranges...&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header_up   [+|-]&lt;field&gt; [&lt;value|regexp&gt; [&lt;replacement&gt;]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header_down [+|-]&lt;field&gt; [&lt;value|regexp&gt; [&lt;replacement&gt;]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # round trip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    transport &lt;name&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # optionally intercept responses from upstream</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @name {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        status &lt;code...&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        header &lt;field&gt; [&lt;value&gt;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    replace_status [&lt;matcher&gt;] &lt;status_code&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    handle_response [&lt;matcher&gt;] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;directives...&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # special directives only available in handle_response</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        copy_response [&lt;matcher&gt;] [&lt;status&gt;] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            status &lt;status&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        copy_response_headers [&lt;matcher&gt;] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            include &lt;fields...&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            exclude &lt;fields...&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li><code>header_up</code> 对传递给后端的请求头进行设置、添加、删除或者执行替换</li><li><code>header_down</code> 对后端返回的响应头进行设置、添加、删除或者执行替换</li></ul><p>默认情况下, Caddy会把所有请求头未经修改地全部传递到后端服务, 包括<code>Host</code>请求头, 下面三种情况不会传递<code>Host</code>请求头:</p><ol><li>添加或修改了 HTTP header <code>X-Forwarded-For</code> </li><li>设置了 HTTP header <code>X-Forwarded-Proto</code> </li><li>设置了 HTTP header <code>X-Forwarded-Host</code> </li></ol><p>默认情况下, caddy会忽略请求头中的 <code>X-Forwarded-*</code>, 以防止客户端欺骗. 如果caddy不是连接客户端的第一层(比如在caddy的上层还有CDN), 可以配置 <code>trusted_proxies</code> 信任的IP列表, 为了方便可以设置成<code>trusted_proxies private_ranges</code>信任所有的私有IP段. </p><blockquote><p>简单点说就是caddy为了安全, 会忽略客户端<code>X-Forwarded-*</code>请求头, 默认不会把这些请求头传递给后端, 但是考虑到caddy有可能不是直接接触到客户端, 在客户端和caddy之间可能有cdn, 所以可用通过配置<code>trusted_proxies</code>解决这种场景.</p></blockquote><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="示例-4">示例<a class="hash-link" href="#示例-4" title="Direct link to heading">​</a></h4><p>将 <code>weblog.alanwei.com</code> 的请求转发到 <code>http://localhost:8089</code>:</p><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">weblog.alanwei.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reverse_proxy http://localhost:8089</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>将<code>demo.alanwei.com</code>转发到<code>localhost:1337</code>, 并修改后端收到的<code>Host</code>请求头.</p><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">demo.alanwei.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reverse_proxy localhost:1337 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        header_up Host {upstream_hostport}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        header_up X-Forwarded-Host {host}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>在代理之前对路径进行裁剪:</p><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">demo.alanwei.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    handle_path /prefix/* {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reverse_proxy localhost:9000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="handle">handle<a class="hash-link" href="#handle" title="Direct link to heading">​</a></h3><p>handle和nginx中的location指令很类似, 只有第一个被匹配到的handle block会被执行(多个handle block之间互斥). handle block 可以嵌套(仅限HTTP handle).</p><p><strong>语法</strong></p><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">handle [&lt;matcher&gt;] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;directives...&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li><code>&lt;directives...&gt;</code> HTTP处理指令块列表, 一行一个指令, 和handle block外的指令使用方式一样</li></ul><p>除了 handle 指令, 还有 handle_path 指令, 不同之处在于, handle_path 在处理之前会截断请求的路径.</p><p>route包括其他指令时, 和handle做的事情很像, 但是有两点不同, 1) route block彼此之间不是互斥的, 2) route 内的指令不会被重新排序.</p><p><strong>示例</strong></p><p><em>/foo/</em> 的请求转发到静态文件服务, 其他请求转发到代理服务上:</p><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">sample.alanwei.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    handle /foo/* {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        file_server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    handle {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reverse_proxy 127.0.0.1:8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>handle 和 handle_path 可以在同一个站点中同时使用, 而且彼此之间依然互斥:</p><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">http://location:8090 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    handle_path /foo/* {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # The path has the &quot;/foo&quot; prefix stripped</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    handle /bar/* {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # The path still retains &quot;/bar&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="tls">tls<a class="hash-link" href="#tls" title="Direct link to heading">​</a></h3><p><strong>示例</strong></p><ul><li>使用自定义证书: <code>tls cert.pem key.pem</code></li><li>使用本地自签名证书: <code>tls internal</code></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="qa">QA<a class="hash-link" href="#qa" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="启动失败">启动失败<a class="hash-link" href="#启动失败" title="Direct link to heading">​</a></h3><p>执行caddy命令如果提示以下错误, 需要使用<code>sudo</code>执行:</p><div class="codeBlockContainer_I0IT language-log theme-code-block"><div class="codeBlockContent_wNvx log"><pre tabindex="0" class="prism-code language-log codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">loading initial config: loading new config: http app module: start: tcp: listening on :443: listen tcp :443: bind: permission denied</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>如果外部网络无法访问caddy伺服的web, 有可能是系统防火墙拦截了, 如果是linux系统可以尝试使用<code>ufw allow</code>开放端口号.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="禁用https">禁用HTTPS<a class="hash-link" href="#禁用https" title="Direct link to heading">​</a></h3><p>全局禁用设置全局选项即可: </p><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto_https off</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>禁用特定域名的https, 只需要在域名地址前指定协议即可:</p><div class="codeBlockContainer_I0IT language-caddy theme-code-block"><div class="codeBlockContent_wNvx caddy"><pre tabindex="0" class="prism-code language-caddy codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">http://localhost:3009 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    root * /project_dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file_server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http://www.alanwei.com {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reverse_proxy localhost:3009</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div><footer class="row blogPostDetailsFull_enUA docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/caddy/">caddy</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/docker/">docker</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/nginx/">nginx</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/http/">http</a></li></ul></div></footer><div id="gitalk-container"></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2022/03/16/get-public-ip-using-curl/"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">使用curl命令行获取当前机器公网IP</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2022/03/12/docker-history-full-command/"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">docker history命令显示完整信息</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_cNA8 thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#基本命令" class="table-of-contents__link toc-highlight">基本命令</a><ul><li><a href="#启动" class="table-of-contents__link toc-highlight">启动</a></li></ul></li><li><a href="#常用使用方式" class="table-of-contents__link toc-highlight">常用使用方式</a><ul><li><a href="#hello-world" class="table-of-contents__link toc-highlight">Hello world</a></li><li><a href="#静态文件-static-files" class="table-of-contents__link toc-highlight">静态文件 static files</a></li><li><a href="#反向代理-reverse-proxy" class="table-of-contents__link toc-highlight">反向代理 reverse proxy</a></li></ul></li><li><a href="#caddyfile" class="table-of-contents__link toc-highlight">Caddyfile</a><ul><li><a href="#structure" class="table-of-contents__link toc-highlight">Structure</a></li><li><a href="#blocks" class="table-of-contents__link toc-highlight">blocks</a></li><li><a href="#directives" class="table-of-contents__link toc-highlight">Directives</a></li><li><a href="#tokens-and-quotes" class="table-of-contents__link toc-highlight">Tokens and quotes</a></li><li><a href="#addresses" class="table-of-contents__link toc-highlight">Addresses</a></li><li><a href="#matchers" class="table-of-contents__link toc-highlight">Matchers</a></li><li><a href="#placehodlers" class="table-of-contents__link toc-highlight">Placehodlers</a></li><li><a href="#snippets" class="table-of-contents__link toc-highlight">Snippets</a></li><li><a href="#comments" class="table-of-contents__link toc-highlight">Comments</a></li></ul></li><li><a href="#automatic-https" class="table-of-contents__link toc-highlight">Automatic HTTPS</a><ul><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#activation" class="table-of-contents__link toc-highlight">Activation</a></li><li><a href="#local-https" class="table-of-contents__link toc-highlight">Local HTTPS</a></li></ul></li><li><a href="#常用指令" class="table-of-contents__link toc-highlight">常用指令</a><ul><li><a href="#log" class="table-of-contents__link toc-highlight">log</a><ul><li><a href="#语法" class="table-of-contents__link toc-highlight">语法</a></li><li><a href="#示例" class="table-of-contents__link toc-highlight">示例</a></li></ul></li><li><a href="#basicauth" class="table-of-contents__link toc-highlight">basicauth</a><ul><li><a href="#语法-1" class="table-of-contents__link toc-highlight">语法</a></li><li><a href="#示例-1" class="table-of-contents__link toc-highlight">示例</a></li></ul></li><li><a href="#redir" class="table-of-contents__link toc-highlight">redir</a><ul><li><a href="#语法-2" class="table-of-contents__link toc-highlight">语法</a></li><li><a href="#示例-2" class="table-of-contents__link toc-highlight">示例</a></li></ul></li><li><a href="#rewrite" class="table-of-contents__link toc-highlight">rewrite</a><ul><li><a href="#语法-3" class="table-of-contents__link toc-highlight">语法</a></li><li><a href="#示例-3" class="table-of-contents__link toc-highlight">示例</a></li></ul></li><li><a href="#reverse_proxy" class="table-of-contents__link toc-highlight">reverse_proxy</a><ul><li><a href="#语法-4" class="table-of-contents__link toc-highlight">语法</a></li><li><a href="#示例-4" class="table-of-contents__link toc-highlight">示例</a></li></ul></li><li><a href="#handle" class="table-of-contents__link toc-highlight">handle</a></li><li><a href="#tls" class="table-of-contents__link toc-highlight">tls</a></li></ul></li><li><a href="#qa" class="table-of-contents__link toc-highlight">QA</a><ul><li><a href="#启动失败" class="table-of-contents__link toc-highlight">启动失败</a></li><li><a href="#禁用https" class="table-of-contents__link toc-highlight">禁用HTTPS</a></li></ul></li></ul></div></div></div></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">文章列表</h4><ul class="footer__items"><li class="footer__item"> <a class="footer__link-item" href="/docs/articles/es6-in-depth/introduction/">深入浅出ES6 - InfoQ.cn</a> </li><li class="footer__item"> <a class="footer__link-item" href="/docs/articles/why-java-sucks-and-csharp-rocks/compare-purpose/">Why Java Sucks and C# Rocks - 赵劼</a> </li><li class="footer__item"> <a class="footer__link-item" href="/docs/reading/">阅读笔记</a> </li><li class="footer__item"> <a class="footer__link-item" href="/docs/archives/git-guides/">博文归档</a> </li></ul></div><div class="col footer__col"><h4 class="footer__title">文档翻译</h4><ul class="footer__items"><li class="footer__item"> <a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/blog/2022/03/12/caddy-intro/docs/guides/blog/">Docusaurus Blog</a> </li><li class="footer__item"> <a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/blog/2022/03/12/caddy-intro/docs/guides/docs/markdown-features/">Docusaurus Markdown</a> </li><li class="footer__item"> <a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/blog/2022/03/12/caddy-intro/">Caddy 简介</a> </li></ul></div><div class="col footer__col"><h4 class="footer__title">更多</h4><ul class="footer__items"><li class="footer__item"> <a href="https://github.com/alanwei43/node-io-lib" target="_blank" rel="noopener noreferrer" class="footer__link-item">node-io-lib - GitHub</a> </li><li class="footer__item"> <a href="https://github.com/alanwei43/docker-puppeteer" target="_blank" rel="noopener noreferrer" class="footer__link-item">docker-puppeteer - GitHub</a> </li><li class="footer__item"> <a href="https://github.com/alanwei43/code-server" target="_blank" rel="noopener noreferrer" class="footer__link-item">code-server - GitHub</a> </li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Alan&#x27;s Blog<!-- --> <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer"> </a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.68aa7264.js"></script>
<script src="/assets/js/main.2ec64196.js"></script>
</body>
</html>