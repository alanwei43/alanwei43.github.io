<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Alan's Blog Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Alan's Blog Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WSJXZXE31N"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-WSJXZXE31N",{anonymize_ip:!0})</script>
<script src="/resources/scripts/baidu.js?v=1"></script><title data-react-helmet="true">Why Java Sucks and C# Rocks（3）：Attribute与Annotation  -  Alan&#x27;s Blog</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Why Java Sucks and C# Rocks（3）：Attribute与Annotation  -  Alan&#x27;s Blog"><meta data-react-helmet="true" name="description" content="Why Java Sucks and C# Rocks"><meta data-react-helmet="true" property="og:description" content="Why Java Sucks and C# Rocks"><meta data-react-helmet="true" name="keywords" content="java,c#,csharp"><meta data-react-helmet="true" property="og:url" content="https://blog.alanwei.com/docs/articles/why-java-sucks-and-csharp-rocks/3-attribute-and-annotation"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://blog.alanwei.com/docs/articles/why-java-sucks-and-csharp-rocks/3-attribute-and-annotation"><link rel="stylesheet" href="/styles.ef286c5e.css">
<link rel="preload" href="/styles.19c276ab.js" as="script">
<link rel="preload" href="/runtime~main.cd30fe3d.js" as="script">
<link rel="preload" href="/main.a484e648.js" as="script">
<link rel="preload" href="/1.df8e704e.js" as="script">
<link rel="preload" href="/2.b16e91d4.js" as="script">
<link rel="preload" href="/3.71509150.js" as="script">
<link rel="preload" href="/1be78505.49ee94a1.js" as="script">
<link rel="preload" href="/179.ac9c1f31.js" as="script">
<link rel="preload" href="/935f2afb.522a0310.js" as="script">
<link rel="preload" href="/17896441.a03da8db.js" as="script">
<link rel="preload" href="/05d2ae8b.dd9e6038.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top navbarHideable_17Wu navbarHidden_19ww"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.png" alt="logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Alan&#x27;s Blog</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">文档</a><a class="navbar__item navbar__link" href="/blog">博客</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/alanwei43" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.png" alt="logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Alan&#x27;s Blog</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">文档</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">博客</a></li><li class="menu__list-item"><a href="https://github.com/alanwei43" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy sidebarWithHideableNavbar_CROi"><a tabindex="-1" class="sidebarLogo_xFc8" href="/"><img src="/img/logo.png" alt="logo" class="themedImage_YANc themedImage--light_3CMI"><img src="/img/logo.png" alt="logo" class="themedImage_YANc themedImage--dark_3ARp"><strong>Alan&#x27;s Blog</strong></a><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">我的文档列表</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">系列文章</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/articles/README">README.md</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">深入浅出ES6</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/0-introduction">ES6是什么</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/1-iterators-and-the-for-of-loop">迭代器和 for-of 循环</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/2-generators">生成器 Generators</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/3-template-string">模板字符串</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/4-rest-parameters-and-defaults">不定参数和默认参数</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/5-destructuring">解构 Destructuring</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/6-arrow-functions">箭头函数 Arrow Functions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/7-symbols">Symbols</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/8-babel-and-broccoli">学习 Babel 和 Broccoli，马上就用 ES6</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/9-collections">集合</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/10-generators-continued">生成器 Generators，续篇</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/11-proxies-and-reflect">代理 Proxies</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/12-classes">类 Class</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/13-let-and-const">let 和 const</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/14-subclassing">子类 Subclassing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/15-modules">模块 Modules</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/16-the-future">展望未来</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Why Java Sucks and C# Rocks</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/articles/why-java-sucks-and-csharp-rocks/1-compare-purpose">比较的意义与目的</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/articles/why-java-sucks-and-csharp-rocks/2-basic-type-and-oop">基础类型与面向对象</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/articles/why-java-sucks-and-csharp-rocks/3-attribute-and-annotation">Attribute与Annotation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/articles/why-java-sucks-and-csharp-rocks/4-generics">泛型</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/articles/why-java-sucks-and-csharp-rocks/4-1-reddit-and-property">Reddit，兼谈C#属性</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/articles/why-java-sucks-and-csharp-rocks/5-anonymous-method">匿名方法</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/articles/why-java-sucks-and-csharp-rocks/5-1-standard-event-model">标准事件模型</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/articles/why-java-sucks-and-csharp-rocks/6-yield">yield及其作用</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">阅读笔记</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reading/README">README.md</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reading/mastering-spring-5">Mastering Spring 5.0</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reading/spring-in-action">Spring in Action</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reading/core-java-for-the-impatient">Core Java for the Impatient</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Docusaurus 文档翻译</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/intro">简介</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/blog">博客</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/typescript-support">TypeScript支持</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">文档</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guides/docs/markdown-features">Markdown 特性</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guides/api/client">Client API</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">博文整理</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/archives/README">README.md</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/archives/docker">Docker</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/archives/editor">编辑器</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/archives/literature">诗和远方</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/archives/git-guides">Git</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/archives/bookmarks">书签</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">测试导航条</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">嵌套节点1</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/examples/doc4">示例文档4</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/doc1">Style Guide</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">嵌套节点2</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/mdx">Powered by MDX</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/doc2">Document Number 2</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/doc3">This is Document Number 3</a></li><li class="menu__list-item"><a href="http://www.baidu.com" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">测试链接</a></li></ul></li></ul></div><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_2WRA"><svg width="20" height="20" role="img" class="collapseSidebarButtonIcon_CoMu"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Why Java Sucks and C# Rocks（3）：Attribute与Annotation</h1></header><div class="markdown"><section><b>本文摘抄于 <a href="http://blog.zhaojie.me/" target="_blank">老赵点滴</a>, 仅用于本人学习和存档, 文章所有权归 <a href="http://blog.zhaojie.me/" target="_blank">老赵点滴</a> 所有. 如有侵权请发送邮件至 alan.wei#live.com(<i>#换成@</i>) 删除此文.</b><hr></section><p><a href="http://blog.zhaojie.me/2010/04/why-java-sucks-and-csharp-rocks-3-attribute-and-annotation.html" target="_blank" rel="noopener noreferrer">原文 -  Why Java Sucks and C# Rocks（3）：Attribute与Annotation</a></p><p><a href="/docs/articles/why-java-sucks-and-csharp-rocks/2-basic-type-and-oop">上一篇文章里</a>里我谈了Java和C#语言中对于基础类型的不同态度，我认为C#把基础类型视做对象的做法比Java更有“万物皆对象”的理念，使用起来也更为方便。此外，C#拥有一个Java 1.4所不存在的特性，即Attribute（自定义特性），而在之后的Java 5.0中也增加了类似的功能，这便是Annotation（标注）。那么，Attribute的作用是什么，Java中的Annotation和C#中的Attribute又有什么区别呢，Java 5.0中又从C# 1.0中吸收了哪些优点？我们现在就来关注这方面的问题。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="自定义特性与设计"></a>自定义特性与设计<a class="hash-link" href="#自定义特性与设计" title="Direct link to heading">#</a></h2><p>Attribute是C# 1.0中的重要功能，它的作用便是为某个成员，例如类、方法或参数附加上一些元数据，而在程序中则可以通过反射操作获取到这些数据。例如，在.NET框架中，每个类型在默认情况下是无法被序列化的，除非我们为类型添加Serializable标记。如下：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[Serializable]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class Product { ... }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Product类在标记了Serializable之后，就可以被BinarySerializer或DataContractSerializer等工具类序列化或反序列化。C#有个约定：所有的Attribute都（直接或间接）继承System.Attribute类，并且类名以Attribute结尾，但是在使用时可以省略。因此，事实上Serializable标记其实是SerializableAttribute类，它是System.Attribute的子类。</p><p>C#中的Attribute对于软件设计有非常重要的作用，例如Kent Beck评价到：</p><blockquote><p>NUnit 2.0 is an excellent example of idiomatic design. Most folks who port xUnit just transliterate the Smalltalk or Java version. That&#x27;s what we did with NUnit at first, too. This new version is NUnit as it would have been done had it been done in C# to begin with.</p></blockquote><p>简而言之，大部分xUnit框架都是简单地移植JUnit的代码，但是NUnit却利用了C#的Attribute提供了更优雅的设计，类似的观点在Martin Fowler所编的杂志中也有过更为具体的论述。因此，C#在这方面可谓大大领先于Java 1.4。幸运的是，在C#发布两年后Java语言也推出了5.0版本，增加了Annotation功能，这无疑缩小了与C#之间的差距。</p><p>只可惜，Java语言中的Annotation功能，我认为相对于C#语言的Attribute功能至少有两个缺点。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="缺点1：失血模型"></a>缺点1：失血模型<a class="hash-link" href="#缺点1：失血模型" title="Direct link to heading">#</a></h2><p>说起C#的Attribute与Java的Annotation，两者最大的区别便是：C#中的Attribute是类，而Java中的Annotation是接口。</p><p>由于C#的Attribute其实也是.NET中标准的“类”，因此与类有关的设计方式都可以运用其中，例如抽象类，抽象方法，重载方法，也可以实现接口等等。这类特性造就了一些非常常用的设计模式，例如可能对于大部分.NET程序员都非常熟悉的“验证标记”。</p><p>简单地说，这是一种通过标记来表示“验证逻辑”的做法，例如我们可以先定义一个基类：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class ValidationResult { ... }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[AttributeUsage(AttributeTargets.Property, AllowMultiple = true)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">public abstract class ValidationAttribute : Attribute</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public abstract ValidationResult Validate(object value);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>ValidationAttribute类继承了System.Attribute，也就是说，它可以作为其他Attribute的基类。例如，我们可以定义这样一些通用的验证类：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class RangeAttribute : ValidationAttribute</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public int Min { get; set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public int Max { get; set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public override ValidationResult Validate(object value) { ... }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class RegexAttribute : ValidationAttribute</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public string Pattern { get; set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public override ValidationResult Validate(object value) { ... }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>于是，我们便可以在一个类的属性上进行标记，表示对某个属性的验证要求：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class Person</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [Range(Min = 10, Max = 60)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public int Age { get; set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [Range(Min = 30, Max = 50)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public int Size { get; set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [Regex(Pattern = @&quot;^\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,3}$&quot;)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public string Email { get; set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>这样的标记便表示Age的合法范围是10到60，Size的合法范围是30到50，而Email需要满足特定的正则表达式。标记之后，我们便可以使用统一的代码进行验证，例如：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public static void Validate(object o)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    var type = o.GetType();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    foreach (var property in type.GetProperties())</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        var validateAttrs = </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            (ValidationAttribute[])property.GetCustomAttributes(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                typeof(ValidationAttribute), true);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        var propValue = property.GetValue(o, null);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        foreach (var attr in validateAttrs)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            var result = attr.Validate(propValue);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            // do more things</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>如此，我们便可以轻易地获取每个属性上的验证条件，并调用Validate方法进行验证。我们有能力这么做的原因，是因为C#中的Attribute是类，这样我们可以使用抽象类ValidationAttribute进行统一控制。如果这段验证逻辑是由类库提供的，而开发人员想要增加额外的验证条件，也只需要自己定义新的类来继承ValidationAttribute，并提供自定义的Validate方法逻辑即可。这种方式大量出现在各类.NET的类库及框架中，给.NET程序员带来许多便利。</p><p>而在Java 5.0中，似乎Annotation和C#的Attribute在表现形式上差不多。例如，我们也可以定义一些“验证标记”：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public @interface RangeValidation {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    int min();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    int max();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">public @interface RegexValidation {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    String pattern();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>使用时似乎也差不多：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class Person {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @RangeValidation(min = 10, max = 60)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public int age;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @RegexValidation(pattern = &quot;^\\w+@[a-zA-Z_]+?\\.[a-zA-Z]{2,3}$&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public String email;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>与C#不同，Java的Annotation其实是接口，它默认实现类库中定义的<code>java.lang.annotation.Annotation</code>接口，并且只能定义一些无参数的方法（不过可以指定默认值）——因为这些方法的作用其实只是类似于一些“字段”，只是用于保存数据，以便在程序中返回。这样看来，似乎和C#中没有区别，只是一个使用了“属性”，一个利用了“方法”而已，不是吗？</p><p>自然不是，区别很大。试想，现在如果您要编写一段代码来进行统一的验证，那么该怎么做？似乎没法做，因为在C#中我们可以通过统一的基类来获取所有表示验证的Attribute，然后调用定义在基类中的Validate方法。在Java语言中我们无法做到这点，因此如果要识别RangeValidation，那么我们就必须独立准备一段逻辑，而要识别RegexValidation则又是另一段不同的方法。因为两者的“识别”方式完全不同，因此我们无法使用相同的代码进行验证工作。</p><p>更关键的是，如果验证逻辑是由类库提供的，而开发人员想要补充额外的验证方式，那么该怎么做？我们可以提供自定义的Annotation，这很容易，那么识别这个Annotation的逻辑该如何交给类库呢？这个自然也有办法解决，但无论如何都会带来较多的代码量，且做不到C#般优雅，自然。</p><p>因此，Java的Annotation落后于C#的Attribute的关键之处，在于Java的Annotation只能定义为失血的对象，而C#的Attribute可以在需要的时候包含一定的逻辑，这样便可以让C#程序员获得更好的灵活性，使用更丰富的开发模式。与此相比，“类”和“接口”的区别，其实倒真只是表象罢了。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="缺点2：古怪的约定"></a>缺点2：古怪的约定<a class="hash-link" href="#缺点2：古怪的约定" title="Direct link to heading">#</a></h2><p>相比于上一个缺点来说，第二个缺点似乎并不那么严重，不过我认为这的确也是Java语言的Annotation设计中无法令人满意的地方。</p><p>在前面的代码中我们已经可以发现，其实C#的Attribute及Java的Annotation在使用上非常相似，为此我们再来仔细对比一下：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[Range(Min = 10, Max = 60)] // C#</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@RangeValidation(min = 10, max = 60) // Java</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>这样看来，C#和Java在使用时的形式基本完全一致，都是使用名称+属性名的方式进行标记。不过其实C#和Java都有额外的语法，例如在C#中，我们可以这样定义RangeAttribute类：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class RangeAttribute : ValidationAttribute</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public RangeAttribute() { }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public RangeAttribute(int min, int max)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        this.Min = min;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        this.Max = max;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public int Min { get; set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public int Max { get; set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>与之前的RangeAttribute相比，新的定义增加了两个构造函数定义，一个是无参数的构造函数（其实原来的定义也有，只不过由编译器自动添加），还有一个构造函数则直接接收min和max参数，这样我们便可以直接通过构造函数来标记Attribute了：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[Range(10, 60)]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>当然，有人说这种做法不如显式指定Min和Max来的清晰——可能是这样吧，但是在很多时候通过构造函数传参也有优势，例如我们可以重新定义之前的RegexAttribute为：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class RegexAttribute : ValidationAttribute</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public RegexAttribute(string pattern)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        this.Pattern = pattern;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public string Pattern { get; private set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>在这里我们为RegexAttribute提供了一个接收pattern的构造函数，并将Pattern属性的set方法设为private。于是我们便可以这样使用RegexAttribute了：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[Regex(@&quot;^\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,3}$&quot;)]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>这么做有两个好处：首先，外部无法设置Pattern属性的值，这点加强了对象的封装性。其次，这里相当于强制RegexAttribute在使用时必须提供一个pattern参数（虽然无法进行验证）。这样，代码在使用时既显得优雅，可读性也非常良好。但其实，我认为更关键的是，这种使用模式和创建一个对象，并为其属性进行赋值一样：我们可以选择任意的构造函数创建对象，再“有选择地”进行属性赋值。例如上文AttributeUsage的使用：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[AttributeUsage(AttributeTargets.Property, AllowMultiple = true)]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>这里的含义是，创建一个AttributeUsageAttribute类，提供AttributeTargets.Property作为构造函数的参数，并同时将AllowMultiple属性设为true。可见，这种做法给了我们相当自由性——而且非常自然，没有奇怪约定。在设计一个Attribute的时候，我们一般可以提供几个常用的构造函数，在大部分情况下使用这些构造函数也已经足够了。除此之外，Attribute对象的属性包含了默认值，在必要的时候可以进行修改。</p><p>在Java语言中，事实上我们也可以修改RegexValidation类，让开发人员可以通过这种方式来使用：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">@RegexValidation(&quot;^\\w+@[a-zA-Z_]+?\\.[a-zA-Z]{2,3}$&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>只要我们可以把RegexValidation改成这样即可：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public @interface RegexValidation {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    String value();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>在Java语言中，假如Attribute的一个成员名为value，且没有其他成员（或是其他成员都提供了默认值），那么便可以如C#中构造函数般使用。那么……</p><blockquote><p>如果我想使用“构造函数”的方式传递数据，但成员名还是想用pattern，可以吗？
如果我想使用“构造函数”的方式传递多个参数，可以吗？</p></blockquote><p>不可以。我也不知道为什么会有这种特别的约定规则呢？可能和Annotation是接口有关吧。接口没有构造函数，因此没有一个合适的方式以省去成员名的方式传递参数，只能指定一个特别的名称了——但对于开发人员来说，凭什么我的Regex值一定要叫value而不能叫pattern呢？</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="java-50学习c"></a>Java 5.0学习C#<a class="hash-link" href="#java-50学习c" title="Direct link to heading">#</a></h2><p>我不知道为什么有了C#的优秀榜样，Java 5.0却还是不愿意做的更好。其实C#中的Attribute也有缺点，例如无法使用泛型，所以Java完全有胜过C#的机会。其实在以后的文章中您也可以发现这样一个现象：C#的榜样并不完美，但Java的进化更为糟糕。对此，我们除了一声长叹又能怎么办呢？</p><p>除了Annotation之外，Java 5.0还从C#处学习了以下功能：</p><ul><li>可以使用enum关键字定义强类型的常量——C# 1.0中也有类似功能（好吧，我承认，其实Java的enum功能比C#中要丰富一些）。</li><li>可变参数，即可以使用“一一列举”形式，提供某个方法最后一个数组参数的内容——其实就是C# 1.0中的params。</li><li>增强了for的能力，可以方便地使用枚举器（Iterator）——这其实就是C# 1.0中的foreach。</li></ul><p>那么，到底是谁是所谓的“copy cat”呢？就像我在第一篇文章中写的那样，“自从C# 1.0诞生之日起，就只出现Java借鉴C#特性的情况，至今已将近10年”，以后我们还可以看到更多例子。我并不想说所谓的“抄袭”，我只想说“学习”或是“借鉴”。我认为，只要是优点，出现雷同这都是完全正常且值得鼓励的。我现在提到这些，主要的目的是想告诉那些固执地认为“C#只是Java的山寨复制品”的同学们一个事实。</p><div>本文为 <a href="https://www.zhihu.com/people/jeffz" target="_blank">赵劼</a> 发表在 <a href="http://blog.zhaojie.me" target="_blank">个人博客</a> 的系列文章之一。</div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/alanwei43/blog/tree/master/src/docs/articles/why-java-sucks-and-csharp-rocks/3-attribute-and-annotation.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/articles/why-java-sucks-and-csharp-rocks/2-basic-type-and-oop"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Why Java Sucks and C# Rocks（2）：基础类型与面向对象</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/articles/why-java-sucks-and-csharp-rocks/4-generics"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Why Java Sucks and C# Rocks（4）：泛型 »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#自定义特性与设计" class="table-of-contents__link">自定义特性与设计</a></li><li><a href="#缺点1：失血模型" class="table-of-contents__link">缺点1：失血模型</a></li><li><a href="#缺点2：古怪的约定" class="table-of-contents__link">缺点2：古怪的约定</a></li><li><a href="#java-50学习c" class="table-of-contents__link">Java 5.0学习C#</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">阅读笔记</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/reading/mastering-spring-5">Mastering Spring 5.0</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">文档翻译</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/docs/guides/blog">Docusaurus Blog</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/docs/guides/docs/markdown-features">Docusaurus Markdown</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">更多</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">我的GitHub</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/tool/wh-fgj/">武汉房管局住房统计数据</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 Alan's Blog</div></div></div></footer></div>
<script src="/styles.19c276ab.js"></script>
<script src="/runtime~main.cd30fe3d.js"></script>
<script src="/main.a484e648.js"></script>
<script src="/1.df8e704e.js"></script>
<script src="/2.b16e91d4.js"></script>
<script src="/3.71509150.js"></script>
<script src="/1be78505.49ee94a1.js"></script>
<script src="/179.ac9c1f31.js"></script>
<script src="/935f2afb.522a0310.js"></script>
<script src="/17896441.a03da8db.js"></script>
<script src="/05d2ae8b.dd9e6038.js"></script>
</body>
</html>