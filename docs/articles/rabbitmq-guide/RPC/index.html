<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Alan&#39;s Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Alan&#39;s Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Alan&#39;s Blog" href="/opensearch.xml">
<script src="/scripts/baidu.js"></script>
<script src="/scripts/bing-clarity.js"></script><title data-rh="true">Remote procedure call (RPC)  -  Alan&#x27;s Blog</title><meta data-rh="true" name="baidu-site-verification" content="code-7RGpEH8jty"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://blog.alanwei.com/docs/articles/rabbitmq-guide/RPC/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Remote procedure call (RPC)  -  Alan&#x27;s Blog"><meta data-rh="true" name="description" content="è‹±æ–‡åŸæ–‡"><meta data-rh="true" property="og:description" content="è‹±æ–‡åŸæ–‡"><meta data-rh="true" name="keywords" content="rabbitmq"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://blog.alanwei.com/docs/articles/rabbitmq-guide/RPC/"><link data-rh="true" rel="alternate" href="https://blog.alanwei.com/docs/articles/rabbitmq-guide/RPC/" hreflang="en"><link data-rh="true" rel="alternate" href="https://blog.alanwei.com/docs/articles/rabbitmq-guide/RPC/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://7SQ6A6EP36-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.b72fdff5.css">
<link rel="preload" href="/assets/js/runtime~main.f6291dab.js" as="script">
<link rel="preload" href="/assets/js/main.103252c6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_aKYr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.png" alt="logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Alan&#x27;s Blog</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">æ–‡æ¡£</a><a class="navbar__item navbar__link" href="/blog/">åšå®¢</a><a class="navbar__item navbar__link" href="/me/">å…³äºæˆ‘</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/alanwei43" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="Switch between dark and light mode (currently light mode)"></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y sidebarWithHideableNavbar_FoYL"><a tabindex="-1" class="sidebarLogo_FJUI" href="/"><img src="/img/logo.png" alt="logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.png" alt="logo" class="themedImage_W2Cr themedImage--dark_oUvU"><b>Alan&#x27;s Blog</b></a><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">æˆ‘çš„æ–‡æ¡£åˆ—è¡¨</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" href="/docs/articles/">ç³»åˆ—æ–‡ç« </a><button aria-label="Toggle the collapsible sidebar category &#x27;ç³»åˆ—æ–‡ç« &#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/articles/es6-in-depth/introduction/">æ·±å…¥æµ…å‡ºES6</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/articles/okhttp-guide/overview/">OkHttp ç®€ä»‹</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/articles/rabbitmq-guide/install/">RabbitMQ ç®€ä»‹</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/articles/rabbitmq-guide/install/">å®‰è£…</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/articles/rabbitmq-guide/hello-world/">Hello World</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/articles/rabbitmq-guide/WorkQueues/">Work Queues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/articles/rabbitmq-guide/Publish-Subscribe/">Publish/Subscribe</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/articles/rabbitmq-guide/Routing/">Routing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/articles/rabbitmq-guide/Topic/">Topics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/articles/rabbitmq-guide/RPC/">Remote procedure call (RPC)</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/articles/why-java-sucks-and-csharp-rocks/compare-purpose/">Why Java Sucks and C# Rocks</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/archives/">åšæ–‡å½’æ¡£</a><button aria-label="Toggle the collapsible sidebar category &#x27;åšæ–‡å½’æ¡£&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/reading/">é˜…è¯»ç¬”è®°</a><button aria-label="Toggle the collapsible sidebar category &#x27;é˜…è¯»ç¬”è®°&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/guides/api/client/">Docusaurusæ–‡æ¡£ç¿»è¯‘</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_cwdi"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_xORG"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/">ğŸ </a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docs/articles/">ç³»åˆ—æ–‡ç« </a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">RabbitMQ ç®€ä»‹</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docs/articles/rabbitmq-guide/RPC/">Remote procedure call (RPC)</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Remote procedure call (RPC)</h1></header><p><a href="http://www.rabbitmq.com/tutorials/tutorial-six-dotnet.html" target="_blank" rel="noopener noreferrer">è‹±æ–‡åŸæ–‡</a></p><p>åœ¨ç¬¬äºŒä¸ªæ•™ç¨‹é‡Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨å·¥ä½œé˜Ÿåˆ—åœ¨å¤šä¸ªå·¥ä½œè€…è¿›ç¨‹ä¹‹é—´åˆ†å‘è€—æ—¶ä»»åŠ¡ã€‚</p><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨è¿œç¨‹è®¡ç®—æœºä¸Šè¿è¡Œä¸€ä¸ªå‡½æ•°å¹¶ç­‰å¾…ç»“æœè¯¥å¦‚ä½•åšå‘¢ï¼Ÿå—¯ï¼Œè¿™ç§äº‹å®Œå…¨ä¸åŒçš„ä½¿ç”¨åœºæ™¯ã€‚è¿™ç§æ¨¡å¼é€šå¸¸è¢«ç§°ä½œè¿œç¨‹å¤„ç†è°ƒç”¨ï¼ˆRemote Procedure Callï¼‰æˆ–è€…ç®€ç§°RPCã€‚</p><p>åœ¨è¿™ä¸ªæ•™ç¨‹é‡Œæˆ‘ä»¬å°†ä¼šä½¿ç”¨RabbitMQå»ºç«‹RPCç³»ç»Ÿï¼šä¸€ä¸ªå®¢æˆ·ç«¯å’Œä¸€ä¸ªå¯ä¼¸ç¼©çš„RPCæœåŠ¡å™¨ã€‚å› ä¸ºæˆ‘ä»¬æ²¡æœ‰å€¼å¾—åˆ†å‘çš„è€—æ—¶ä»»åŠ¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä¼šåˆ›å»ºä¸€ä¸ªè¿”å›æ–æ³¢é‚£å¥‘æ•°çš„è™šæ‹ŸRPCæœåŠ¡ã€‚</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="client-interface">Client interface<a class="hash-link" href="#client-interface" title="Direct link to heading">â€‹</a></h2><p>ä¸ºäº†å±•ç¤ºå¦‚ä½•ä½¿ç”¨ä¸€ä¸ªRPCæœåŠ¡æˆ‘ä»¬å°†ä¼šåˆ›å»ºä¸€ä¸ªç®€å•çš„å®¢æˆ·ç«¯ã€‚å®ƒå°†ä¼šæš´éœ²ä¸€ä¸ªåä¸ºcallçš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å‘é€ä¸€ä¸ªRPCè¯·æ±‚å¹¶ä¸”é˜»å¡ç›´åˆ°æ¥æ”¶åˆ°ç­”æ¡ˆï¼ˆå“åº”ï¼‰ï¼š</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">var rpcClient = new RPCClient();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Console.WriteLine(&quot; [x] Requesting fib(30)&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var response = rpcClient.Call(&quot;30&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Console.WriteLine(&quot; [.] Got &#x27;{0}&#x27;&quot;, response);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpcClient.Close();</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Note:</p><p>è™½ç„¶RPCæ˜¯ä¸€ä¸ªç”¨äºè®¡ç®—çš„å¸¸è§æ¨¡å¼ï¼Œä½†å®ƒå¸¸å¸¸æ˜¯å±é™©çš„ã€‚å½“ä¸€ä¸ªç¨‹åºå‘˜æ²¡æœ‰æ„è¯†åˆ°å‡½æ•°è°ƒç”¨æ˜¯å¦æ˜¯æœ¬åœ°æ—¶æˆ–è€…æ˜¯ä¸€ä¸ªå¾ˆæ…¢çš„RPCè°ƒç”¨æ—¶é—®é¢˜å°±ä¼šäº§ç”Ÿã€‚</p><p>è§£å†³ä¸Šé¢çš„ç¼ºé™·ï¼Œè€ƒè™‘ä»¥ä¸‹å»ºè®®ï¼š</p><p>ææ˜ç™½å“ªä¸ªå‡½æ•°æ˜¯æœ¬åœ°è°ƒç”¨ï¼Œå“ªä¸€ä¸ªæ˜¯è¿œç¨‹è°ƒç”¨ã€‚</p><p>ç»„ç»‡ä½ çš„ç³»ç»Ÿã€‚è®©ç»„ä»¶ä¹‹é—´çš„ä¾èµ–ä¿æŒæ¸…æ™°ã€‚</p><p>é”™è¯¯å¤„ç†æƒ…å†µã€‚å½“RPCæœåŠ¡å™¨é•¿æ—¶é—´ç½¢å·¥å®¢æˆ·ç«¯åº”è¯¥æ€ä¹ˆååº”ï¼Ÿ</p><p>å½“ä¸Šè¿°é—®é¢˜ä¸æ¸…æ¥šæ—¶é¿å…ä½¿ç”¨RPCã€‚å¦‚æœä½ ææ˜ç™½äº†ï¼Œä½ åº”è¯¥ä½¿ç”¨ä¸€ä¸ªé˜»å¡çš„å¼‚æ­¥ç®¡é“å–ä»£RPCï¼Œç»“æœè¢«å¼‚æ­¥æ¨é€åˆ°ä¸‹ä¸€ä¸ªè®¡ç®—é˜¶æ®µã€‚</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="callback-queue">Callback queue<a class="hash-link" href="#callback-queue" title="Direct link to heading">â€‹</a></h2><p>é€šå¸¸é€šè¿‡RabbitMQæ‰§è¡ŒRPCè°ƒç”¨æ˜¯å®¹æ˜“çš„ã€‚ä¸€ä¸ªå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¯·æ±‚æ¶ˆæ¯ï¼ŒæœåŠ¡å™¨ç«¯å›å¤å“åº”æ¶ˆæ¯ã€‚ä¸ºäº†èƒ½å¤Ÿæ¥å—å“åº”æˆ‘ä»¬éœ€è¦å‘é€ä¸€ä¸ªå¸¦æœ‰â€œcallbackâ€é˜Ÿåˆ—åœ°å€çš„è¯·æ±‚ã€‚</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">var corrId = Guid.NewGuid().ToString();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var props = channel.CreateBasicProperties();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">props.ReplyTo = replyQueueName;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">props.CorrelationId = corrId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var messageBytes = Encoding.UTF8.GetBytes(message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">channel.BasicPublish(exchange: &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     routingKey: &quot;rpc_queue&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     basicProperties: props,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     body: messageBytes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ... then code to read a response message from the callback_queue ...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Note:
æ¶ˆæ¯å±æ€§</p><p>AMQPåè®®ç»™æ¶ˆæ¯é¢„å…ˆå®šä¹‰äº†14ä¸ªå±æ€§é›†ã€‚å¤§éƒ¨åˆ†æ¶ˆæš‘æå°‘ä½¿ç”¨ï¼Œä¸‹é¢å‡ ä¸ªä¾‹å¤–ï¼ˆä¸‹é¢å‡ ä¸ªå¸¸ç”¨ï¼‰ï¼š</p><p><code>deliveryMode</code>: ä½¿æ¶ˆæ¯æŒä¹…åŒ–ï¼ˆå€¼ä¸º2ï¼‰æˆ–è€…çŸ­æš‚çš„ï¼ˆå‘åå³å¿˜æ¨¡å¼ï¼Œå…¶ä»–ä»»æ„å€¼ï¼‰ã€‚ä½ ä¹Ÿè®¸è¿˜è®°å¾—ç¬¬äºŒä¸ªæ•™ç¨‹é‡Œæåˆ°çš„è¿™ä¸ªå±æ€§ã€‚</p><p><code>contentType</code>: ç”¨äºæè¿°ç¼–ç çš„mime-typeã€‚æ¯”å¦‚å¯¹äºå¸¸ç”¨çš„JSONç¼–ç è®¾ç½®å±æ€§å€¼ä¸ºapplication/jsonæ˜¯ä¸€ä¸ªå¥½çš„å®è·µã€‚</p><p><code>replyTo</code>: ä¸€èˆ¬ç”¨äºå‘½åå›è°ƒé˜Ÿåˆ—ã€‚</p><p><code>correlationId</code>: å¸¸ç”¨äºå…³è”RPCè¯·æ±‚ç­‰å¾…å“åº”ã€‚</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="correlation-id">Correlation Id<a class="hash-link" href="#correlation-id" title="Direct link to heading">â€‹</a></h2><p>åœ¨ä¸Šé¢å‘é€è¯·æ±‚ä¹‹å‰çš„æ–¹æ³•é‡Œï¼Œæˆ‘ä»¬å»ºè®®ä¸ºæ¯ä¸€ä¸ªRPCè¯·æ±‚åˆ›å»ºä¸€ä¸ªå›è°ƒé˜Ÿåˆ—ã€‚é‚£æ˜¯éå¸¸ä½æ•ˆçš„ã€‚å¹¸è¿çš„æ˜¯æœ‰ä¸€ä¸ªæ›´å¥½çš„åŠæ³•ï¼šè®©æˆ‘ä»¬åˆ›å»ºå•ä¸ªå›è°ƒé˜Ÿåˆ—æ¯å®¢æˆ·ç«¯ã€‚</p><p>è¿™ä¼šäº§ç”Ÿæ–°çš„é—®é¢˜ï¼Œå“åº”ä¸æ¸…æ¥šæ˜¯å“ªä¸ªé˜Ÿåˆ—å‘å‡ºçš„è¯·æ±‚ã€‚è¿™æ—¶å€™éœ€è¦ä½¿ç”¨correlationIdå±æ€§ã€‚æˆ‘ä»¬æ‰“ç®—æŠŠæ¯ä¸ªè¯·æ±‚çš„correlationIdè®¾ç½®æˆå”¯ä¸€å€¼ã€‚ä¹‹åï¼Œæˆ‘ä»¬åœ¨å›è°ƒé˜Ÿåˆ—é‡Œæ¥æ”¶ä¸€æ¡æ¶ˆæ¯ï¼Œæˆ‘ä»¬å°†ä¼šæŸ¥çœ‹è¿™ä¸ªå±æ€§ï¼Œç„¶ååŸºäºè¿™ä¸ªå±æ€§æˆ‘ä»¬èƒ½å¤ŸåŒ¹é…è¿™ä¸ªè¯·æ±‚çš„å“åº”ã€‚å¦‚æœæˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ªä½ç½®çš„correlationIdå€¼ï¼Œæˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°ä¸¢å¼ƒæ¶ˆæ¯ï¼Œè¿™æ¡æ¶ˆæ¯ä¸å±äºæˆ‘ä»¬çš„è¯·æ±‚ã€‚</p><p>You may ask, why should we ignore unknown messages in the callback queue, rather than failing with an error? It&#x27;s due to a possibility of a race condition on the server side. Although unlikely, it is possible that the RPC server will die just after sending us the answer, but before sending an acknowledgment message for the request. If that happens, the restarted RPC server will process the request again. That&#x27;s why on the client we must handle the duplicate responses gracefully, and the RPC should ideally be idempotent. ä½ ä¹Ÿè®¸ä¼šé—®ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨å›è°ƒé˜Ÿåˆ—é‡Œå¿½ç•¥æœªçŸ¥æ¶ˆæ¯ï¼Œè€Œä¸æ˜¯å¼•å‘ä¸€ä¸ªé”™è¯¯ç„¶åå¤±è´¥ã€‚</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="summary">Summary<a class="hash-link" href="#summary" title="Direct link to heading">â€‹</a></h2><p><img src="http://www.rabbitmq.com/img/tutorials/python-six.png" alt="summary"></p><p>æˆ‘ä»¬çš„RPCåƒè¿™æ ·å·¥ä½œï¼š</p><p>å½“æˆ‘ä»¬çš„å®¢æˆ·ç«¯å¯åŠ¨æ—¶ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªåŒ¿åæ’ä»–çš„å›è°ƒé˜Ÿåˆ—ã€‚ </p><p>å¯¹äºæ¯ä¸€ä¸ªRPCè¯·æ±‚ï¼Œå®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯éƒ½å¸¦æœ‰ä¸¤ä¸ªå±æ€§ï¼šreplayToï¼Œç”¨æ¥æ ‡è¯†å›è°ƒé˜Ÿåˆ—ï¼ŒcorrelationIdï¼Œä¸ºæ¯ä¸€æ¬¡è¯·æ±‚è®¾ç½®å”¯ä¸€æ ‡è¯†ã€‚</p><p>è¯·æ±‚è¢«å‘é€åˆ°ä¸€ä¸ª<code>rpc_queue</code>é˜Ÿåˆ—ã€‚</p><p>RPCå·¥ä½œçº¿ç¨‹ï¼ˆä¹Ÿç§°ä½œæœåŠ¡å™¨ï¼‰ç­‰å¾…é‚£ä¸ªé˜Ÿåˆ—ï¼ˆrpc_queueï¼‰çš„è¯·æ±‚ã€‚å½“è¯·æ±‚å‡ºç°ï¼ŒRPCå·¥ä½œçº¿ç¨‹å¼€å§‹æ‰§è¡Œä½œä¸šå¹¶ä¸”æŠŠä½œä¸šçš„ç»“æœä»¥æ¶ˆæ¯çš„å½¢å¼ä½¿ç”¨replyToå­—æ®µå‘å›å®¢æˆ·ç«¯ï¼Œ</p><p>å®¢æˆ·ç«¯åœ¨å›è°ƒé˜Ÿåˆ—é‡Œç­‰å¾…æ•°æ®ã€‚å½“æ¶ˆæ¯å‡ºç°ï¼Œå®¢æˆ·ç«¯æ£€æŸ¥<code>correlationId</code>å±æ€§ã€‚å¦‚æœè¿™ä¸ªå±æ€§å€¼å’Œè¯·æ±‚é‡Œçš„å€¼åŒ¹é…ï¼Œå®ƒå°±ä¼šæŠŠè¿™ä¸ªå“åº”è¿”å›ç»™åº”ç”¨ã€‚</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="putting-it-all-together">Putting it all together<a class="hash-link" href="#putting-it-all-together" title="Direct link to heading">â€‹</a></h2><p>æ–æ³¢é‚£å¥‘ä»»åŠ¡:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">private static int fib(int n)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (n == 0 || n == 1) return n;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return fib(n - 1) + fib(n - 2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>æˆ‘ä»¬å£°æ˜æˆ‘ä»¬çš„æ–æ³¢é‚£å¥‘å‡½æ•°ã€‚å‡è®¾åªæœ‰æ­£æ•´æ•°æœ‰æ•ˆã€‚ï¼ˆä¸è¦è¿™ä¸ªå‡½æ•°å¯¹å¤§æ•°èƒ½å·¥ä½œï¼Œè¿™å¯èƒ½æ˜¯æœ€æ…¢çš„é€’å½’å®ç°ï¼‰ã€‚</p><p> RPC serverçš„ä»£ç å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">using System;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using RabbitMQ.Client;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using RabbitMQ.Client.Events;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Text;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class RPCServer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void Main()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var factory = new ConnectionFactory() { HostName = &quot;localhost&quot; };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        using(var connection = factory.CreateConnection())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        using(var channel = connection.CreateModel())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            channel.QueueDeclare(queue: &quot;rpc_queue&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 durable: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 exclusive: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 autoDelete: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 arguments: null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            channel.BasicQos(0, 1, false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            var consumer = new QueueingBasicConsumer(channel);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            channel.BasicConsume(queue: &quot;rpc_queue&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 noAck: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 consumer: consumer);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Console.WriteLine(&quot; [x] Awaiting RPC requests&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            while(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                string response = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var ea = (BasicDeliverEventArgs)consumer.Queue.Dequeue();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var body = ea.Body;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var props = ea.BasicProperties;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var replyProps = channel.CreateBasicProperties();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                replyProps.CorrelationId = props.CorrelationId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                try</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    var message = Encoding.UTF8.GetString(body);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    int n = int.Parse(message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Console.WriteLine(&quot; [.] fib({0})&quot;, message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    response = fib(n).ToString();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                catch(Exception e)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Console.WriteLine(&quot; [.] &quot; + e.Message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    response = &quot;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                finally</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    var responseBytes = Encoding.UTF8.GetBytes(response);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    channel.BasicPublish(exchange: &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                         routingKey: props.ReplyTo,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                         basicProperties: replyProps,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                         body: responseBytes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    channel.BasicAck(deliveryTag: ea.DeliveryTag,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                     multiple: false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Assumes only valid positive integer input.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Don&#x27;t expect this one to work for big numbers,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// and it&#x27;s probably the slowest recursive implementation possible.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static int fib(int n)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if(n == 0 || n == 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return n;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return fib(n - 1) + fib(n - 2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>æœåŠ¡å™¨ç«¯ä»£ç æ›´ç®€å•æ˜äº†ï¼š</p><p>é€šå¸¸æˆ‘å¼€å§‹å…ˆå»ºç«‹è¿æ¥ï¼Œé€šé“å’Œå£°æ˜é˜Ÿåˆ—ã€‚</p><p>æˆ‘ä»¬ä¹Ÿè®¸æƒ³è¿è¡Œæ›´å¤šçš„æœåŠ¡å™¨æ¥å¤„ç†ã€‚ä¸ºäº†åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Šè´Ÿè½½å‡è¡¡æˆ‘ä»¬éœ€è¦è®¾ç½®<code>channel.basicQos</code>çš„<code>preferchCount</code>ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨<code>basicConsume</code>æ¥è®¿é—®é˜Ÿåˆ—ã€‚ç„¶åä¸ºäº†ç­‰å¾…è¯·æ±‚æ¶ˆæ¯æˆ‘ä»¬è¿›å…¥whileå¾ªç¯ï¼Œæ‰§è¡Œå·¥ä½œå¹¶å‘é€å“åº”ã€‚</p><p>RPCå®¢æˆ·ç«¯ä»£ç å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">using System;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Collections.Generic;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Linq;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Text;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Threading.Tasks;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using RabbitMQ.Client;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using RabbitMQ.Client.Events;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class RPCClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private IConnection connection;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private IModel channel;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private string replyQueueName;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private QueueingBasicConsumer consumer;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public RPCClient()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var factory = new ConnectionFactory() { HostName = &quot;localhost&quot; };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        connection = factory.CreateConnection();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        channel = connection.CreateModel();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        replyQueueName = channel.QueueDeclare().QueueName;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        consumer = new QueueingBasicConsumer(channel);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        channel.BasicConsume(queue: replyQueueName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             noAck: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             consumer: consumer);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string Call(string message)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var corrId = Guid.NewGuid().ToString();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var props = channel.CreateBasicProperties();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        props.ReplyTo = replyQueueName;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        props.CorrelationId = corrId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var messageBytes = Encoding.UTF8.GetBytes(message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        channel.BasicPublish(exchange: &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             routingKey: &quot;rpc_queue&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             basicProperties: props,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             body: messageBytes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            var ea = (BasicDeliverEventArgs)consumer.Queue.Dequeue();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if(ea.BasicProperties.CorrelationId == corrId)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return Encoding.UTF8.GetString(ea.Body);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void Close()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        connection.Close();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class RPC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void Main()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var rpcClient = new RPCClient();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Console.WriteLine(&quot; [x] Requesting fib(30)&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var response = rpcClient.Call(&quot;30&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Console.WriteLine(&quot; [.] Got &#x27;{0}&#x27;&quot;, response);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rpcClient.Close();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>å®¢æˆ·ç«¯ä»£ç æ¶‰åŠäº†ç¨å¾®å¤šä¸€äº›ï¼š</p><p>æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªè¿æ¥å’Œä¸€ä¸ªé€šé“å¹¶ä¸”å£°æ˜ä¸€ä¸ªæ’ä»–çš„å›è°ƒé˜Ÿåˆ—ç”¨äºå›å¤ã€‚</p><p>æˆ‘ä»¬è®¢é˜…äº†å›è°ƒé˜Ÿåˆ—ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½å¤Ÿæ¥æ”¶RPCå“åº”</p><p>æˆ‘ä»¬çš„callæ–¹æ³•æ‰§è¡Œå®é™…çš„RPCè¯·æ±‚ã€‚</p><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é¦–å…ˆå£°ç§°ä¸€ä¸ªå”¯ä¸€çš„<code>correlationId</code>æ•°å¹¶ä¿å­˜å®ƒï¼Œåœ¨whileå¾ªç¯é‡Œå°†ä¼šä½¿ç”¨è¿™ä¸ªå€¼æ•è·åˆé€‚çš„å“åº”ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å‘å¸ƒè¯·æ±‚æ¶ˆæ¯ï¼Œå¹¶å¸¦æœ‰replayToå’ŒcorrelationIdä¸¤ä¸ªå±æ€§ã€‚</p><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥åä¸‹æ¥ç„¶åç­‰å¾…ç›´åˆ°åˆé€‚çš„å“åº”åˆ°è¾¾ã€‚</p><p>whileå¾ªç¯åšçš„äº‹æƒ…å¾ˆç®€å•ï¼Œå¯¹äºæ¯ä¸€ä¸ªå“åº”æ¶ˆæ¯å®ƒï¼ˆè¿™whileå¾ªç¯é‚£æ®µä»£ç ï¼‰éƒ½æ£€æŸ¥correlationIdæ˜¯å¦æ˜¯æˆ‘ä»¬æŸ¥æ‰¾çš„é‚£ä¸ªã€‚å¦‚æœæ˜¯ï¼Œå®ƒä¼šä¿å­˜å“åº”ã€‚æœ€ç»ˆæˆ‘ä»¬ç»™ç”¨æˆ·è¿”å›å“åº”ã€‚</p><p>æ‰§è¡Œå®¢æˆ·ç«¯è¯·æ±‚ï¼š</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">RPCClient fibonacciRpc = new RPCClient();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(&quot; [x] Requesting fib(30)&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">String response = fibonacciRpc.call(&quot;30&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(&quot; [.] Got &#x27;&quot; + response + &quot;&#x27;&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fibonacciRpc.close();</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>ç°åœ¨æ˜¯æ—¶å€™æŸ¥çœ‹æˆ‘ä»¬å®Œæ•´çš„ä¾‹å­æºç äº†ï¼ˆåŒ…æ‹¬åŸºæœ¬çš„å¼‚å¸¸å¤„ç†ï¼‰ï¼šRPCClient.cså’ŒRPCServer.csã€‚</p><p>åƒå¾€å¸¸ä¸€æ ·ç¼–è¯‘ï¼š</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ csc /r:&quot;RabbitMQ.Client.dll&quot; RPCClient.cs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ csc /r:&quot;RabbitMQ.Client.dll&quot; RPCServer.cs</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>æˆ‘ä»¬çš„RPCæœåŠ¡å·²ç»å‡†å¤‡å¥½äº†ã€‚æˆ‘ä»¬å¯ä»¥å¯åŠ¨æœåŠ¡å™¨äº†ï¼š</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ RPCServer.exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> [x] Awaiting RPC requests</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>è¿è¡Œä¸‹é¢å®¢æˆ·ç«¯è¯·æ±‚ä¸€ä¸ªæ–æ³¢é‚£å¥‘æ•°ï¼š</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ RPCClient.exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> [x] Requesting fib(30)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>ç›®å‰è¿™é‡Œçš„è®¾è®¡ä¸æ˜¯ä¸€ä¸ªRPCæœåŠ¡å”¯ä¸€å¯èƒ½çš„å®ç°ï¼Œä½†æ˜¯å®ƒç»™å‡ºäº†ä¸€äº›é‡è¦çš„å»ºè®®ï¼š</p><p>å¦‚æœRPCæœåŠ¡å™¨å¾ˆæ…¢ï¼Œä½ å¯ä»¥è¿è¡Œä¸€ä¸ªæ–°çš„RPCæœåŠ¡å™¨ã€‚è¯•ç€åœ¨ä¸€ä¸ªæ–°çš„æ§åˆ¶å°è¿è¡Œç¬¬äºŒä¸ªRPCServerã€‚</p><p>åœ¨å®¢æˆ·ç«¯ï¼ŒRPCè¦æ±‚å®¢æˆ·ç«¯åªèƒ½å‘é€å’Œæ¥æ”¶ä¸€æ¡æ¶ˆæ¯ã€‚æ²¡æœ‰è¦æ±‚åƒqueueDeclareçš„åŒæ­¥è°ƒç”¨ã€‚å¯¹äºå•ä¸ªRPCè¯·æ±‚ï¼ŒRPCå®¢æˆ·ç«¯åªéœ€è¦ä¸€æ¬¡ç½‘ç»œæ¥å›å°±å¯ä»¥å¾—åˆ°ç»“æœã€‚</p><p>ç›®å‰æˆ‘ä»¬çš„ä»£ç è¿˜æ˜¯éå¸¸ç®€å•ï¼Œè€Œä¸”æ²¡æœ‰å°è¯•è§£å†³æ›´å¤æ‚ï¼ˆä½†æ›´é‡è¦ï¼‰çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼š</p><p>å¦‚æœæ²¡æœ‰è¿è¡Œçš„æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯åº”è¯¥å¦‚ä½•ååº”ï¼Ÿ</p><p>å¯¹äºRPCï¼Œå®¢æˆ·ç«¯æ˜¯å¦åº”è¯¥æœ‰æŸäº›ç±»å‹çš„è¶…æ—¶ï¼Ÿ</p><p>å¦‚æœæœåŠ¡å™¨å‘ç”Ÿæ•…éšœæˆ–è€…æŠ›å‡ºå¼‚å¸¸ï¼Œåº”è¯¥æŠŠå®ƒè½¬å‘åˆ°å®¢æˆ·ç«¯å—ï¼Ÿ</p><p>åœ¨å¤„ç†ä¹‹å‰é˜»æ­¢æ— æ•ˆå…¥ç«™æ¶ˆæ¯ï¼ˆæ¯”å¦‚æ£€æŸ¥é™åˆ¶ï¼Œç±»å‹ï¼‰</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/articles/rabbitmq-guide/Topic/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Topics</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/articles/why-java-sucks-and-csharp-rocks/compare-purpose/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">æ¯”è¾ƒçš„æ„ä¹‰ä¸ç›®çš„</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#client-interface" class="table-of-contents__link toc-highlight">Client interface</a></li><li><a href="#callback-queue" class="table-of-contents__link toc-highlight">Callback queue</a></li><li><a href="#correlation-id" class="table-of-contents__link toc-highlight">Correlation Id</a></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li><li><a href="#putting-it-all-together" class="table-of-contents__link toc-highlight">Putting it all together</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">æ–‡ç« åˆ—è¡¨</h4><ul class="footer__items"><li class="footer__item"> <a class="footer__link-item" href="/docs/articles/es6-in-depth/introduction/">æ·±å…¥æµ…å‡ºES6 - InfoQ.cn</a> </li><li class="footer__item"> <a class="footer__link-item" href="/docs/articles/why-java-sucks-and-csharp-rocks/compare-purpose/">Why Java Sucks and C# Rocks - èµµåŠ¼</a> </li><li class="footer__item"> <a class="footer__link-item" href="/docs/reading/">é˜…è¯»ç¬”è®°</a> </li><li class="footer__item"> <a class="footer__link-item" href="/docs/archives/git-guides/">åšæ–‡å½’æ¡£</a> </li></ul></div><div class="col footer__col"><h4 class="footer__title">æ–‡æ¡£ç¿»è¯‘</h4><ul class="footer__items"><li class="footer__item"> <a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/docs/articles/rabbitmq-guide/RPC/docs/guides/blog/">Docusaurus Blog</a> </li><li class="footer__item"> <a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/docs/articles/rabbitmq-guide/RPC/docs/guides/docs/markdown-features/">Docusaurus Markdown</a> </li><li class="footer__item"> <a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/blog/2022/03/12/caddy-intro/">Caddy ç®€ä»‹</a> </li></ul></div><div class="col footer__col"><h4 class="footer__title">æ›´å¤š</h4><ul class="footer__items"><li class="footer__item"> <a href="https://github.com/alanwei43/node-io-lib" target="_blank" rel="noopener noreferrer" class="footer__link-item">node-io-lib - GitHub</a> </li><li class="footer__item"> <a href="https://github.com/alanwei43/docker-puppeteer" target="_blank" rel="noopener noreferrer" class="footer__link-item">docker-puppeteer - GitHub</a> </li><li class="footer__item"> <a href="https://github.com/alanwei43/code-server" target="_blank" rel="noopener noreferrer" class="footer__link-item">code-server - GitHub</a> </li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Alan&#x27;s Blog<!-- --> <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer"> </a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.f6291dab.js"></script>
<script src="/assets/js/main.103252c6.js"></script>
</body>
</html>