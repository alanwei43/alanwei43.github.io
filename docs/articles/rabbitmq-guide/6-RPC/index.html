<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Alan's Blog Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Alan's Blog Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WSJXZXE31N"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-WSJXZXE31N",{anonymize_ip:!0})</script>
<script src="scripts/baidu.js"></script><title data-react-helmet="true">Remote procedure call (RPC)  -  Alan&#x27;s Blog</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Remote procedure call (RPC)  -  Alan&#x27;s Blog"><meta data-react-helmet="true" name="description" content="è‹±æ–‡åŸæ–‡"><meta data-react-helmet="true" property="og:description" content="è‹±æ–‡åŸæ–‡"><meta data-react-helmet="true" name="keywords" content="rabbitmq"><meta data-react-helmet="true" property="og:url" content="https://blog.alanwei.com/docs/articles/rabbitmq-guide/6-RPC"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://blog.alanwei.com/docs/articles/rabbitmq-guide/6-RPC"><link rel="stylesheet" href="/styles.db0a97ff.css">
<link rel="preload" href="/styles.9ca389b8.js" as="script">
<link rel="preload" href="/runtime~main.bce1c40f.js" as="script">
<link rel="preload" href="/main.985e31c1.js" as="script">
<link rel="preload" href="/1.a307ce8b.js" as="script">
<link rel="preload" href="/2.29f05d6f.js" as="script">
<link rel="preload" href="/3.eacda5b5.js" as="script">
<link rel="preload" href="/1be78505.adae09cb.js" as="script">
<link rel="preload" href="/337.b9b65b77.js" as="script">
<link rel="preload" href="/935f2afb.d3dbf78d.js" as="script">
<link rel="preload" href="/17896441.921438d2.js" as="script">
<link rel="preload" href="/f894a538.c53d91f7.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top navbarHideable_17Wu navbarHidden_19ww"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.png" alt="logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Alan&#x27;s Blog</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">æ–‡æ¡£</a><a class="navbar__item navbar__link" href="/blog">åšå®¢</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/alanwei43" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ğŸŒ</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.png" alt="logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Alan&#x27;s Blog</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">æ–‡æ¡£</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">åšå®¢</a></li><li class="menu__list-item"><a href="https://github.com/alanwei43" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy sidebarWithHideableNavbar_CROi"><a tabindex="-1" class="sidebarLogo_xFc8" href="/"><img src="/img/logo.png" alt="logo" class="themedImage_YANc themedImage--light_3CMI"><img src="/img/logo.png" alt="logo" class="themedImage_YANc themedImage--dark_3ARp"><strong>Alan&#x27;s Blog</strong></a><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">æˆ‘çš„æ–‡æ¡£åˆ—è¡¨</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">ç³»åˆ—æ–‡ç« </a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/articles/">README.md</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">æ·±å…¥æµ…å‡ºES6</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/0-introduction">ES6æ˜¯ä»€ä¹ˆ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/1-iterators-and-the-for-of-loop">è¿­ä»£å™¨å’Œ for-of å¾ªç¯</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/2-generators">ç”Ÿæˆå™¨ Generators</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/3-template-string">æ¨¡æ¿å­—ç¬¦ä¸²</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/4-rest-parameters-and-defaults">ä¸å®šå‚æ•°å’Œé»˜è®¤å‚æ•°</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/5-destructuring">è§£æ„ Destructuring</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/6-arrow-functions">ç®­å¤´å‡½æ•° Arrow Functions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/7-symbols">Symbols</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/8-babel-and-broccoli">å­¦ä¹  Babel å’Œ Broccoliï¼Œé©¬ä¸Šå°±ç”¨ ES6</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/9-collections">é›†åˆ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/10-generators-continued">ç”Ÿæˆå™¨ Generatorsï¼Œç»­ç¯‡</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/11-proxies-and-reflect">ä»£ç† Proxies</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/12-classes">ç±» Class</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/13-let-and-const">let å’Œ const</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/14-subclassing">å­ç±» Subclassing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/15-modules">æ¨¡å— Modules</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/es6-in-depth/16-the-future">å±•æœ›æœªæ¥</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Why Java Sucks and C# Rocks</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/why-java-sucks-and-csharp-rocks/1-compare-purpose">æ¯”è¾ƒçš„æ„ä¹‰ä¸ç›®çš„</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/why-java-sucks-and-csharp-rocks/2-basic-type-and-oop">åŸºç¡€ç±»å‹ä¸é¢å‘å¯¹è±¡</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/why-java-sucks-and-csharp-rocks/3-attribute-and-annotation">Attributeä¸Annotation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/why-java-sucks-and-csharp-rocks/4-1-reddit-and-property">Redditï¼Œå…¼è°ˆC#å±æ€§</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/why-java-sucks-and-csharp-rocks/4-generics">æ³›å‹</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/why-java-sucks-and-csharp-rocks/5-1-standard-event-model">æ ‡å‡†äº‹ä»¶æ¨¡å‹</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/why-java-sucks-and-csharp-rocks/5-anonymous-method">åŒ¿åæ–¹æ³•</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/why-java-sucks-and-csharp-rocks/6-yield">yieldåŠå…¶ä½œç”¨</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">RabbitMQ Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/articles/rabbitmq-guide/0-install">å®‰è£…</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/articles/rabbitmq-guide/1-hello-world">Hello World</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/articles/rabbitmq-guide/2-WorkQueues">Work Queues</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/articles/rabbitmq-guide/3-Publish-Subscribe">Publish/Subscribe</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/articles/rabbitmq-guide/4-Routing">Routing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/articles/rabbitmq-guide/5-Topic">Topics</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/articles/rabbitmq-guide/6-RPC">Remote procedure call (RPC)</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">OkHttp Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/okhttp-guide/1-overview">æ¦‚è¿°</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/okhttp-guide/2-calls">è°ƒç”¨</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/okhttp-guide/3-caching">ç¼“å­˜</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/okhttp-guide/4-connections">è¿æ¥</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/okhttp-guide/5-events">äº‹ä»¶</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/articles/okhttp-guide/6-https">HTTPS</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">åšæ–‡åˆ†ç±»</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/archives/">README.md</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/archives/program">ç¼–ç¨‹è¯­è¨€</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/archives/literature">æ–‡ç« è½¬æ‘˜</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/archives/server">ç³»ç»ŸæœåŠ¡</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/archives/docker">Docker</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/archives/editor">ç¼–è¾‘å™¨</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/archives/mirrors">é•œåƒåˆ—è¡¨</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/archives/git-guides">Git</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/archives/bookmarks">ä¹¦ç­¾</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">é˜…è¯»ç¬”è®°</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reading/">README.md</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reading/practical-vim">Vimå®ç”¨æŠ€å·§</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Mastering Spring 5.0</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reading/mastering-spring-5/">README</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reading/mastering-spring-5/chapter-1">å‘ Spring Framework 5.0 è¿›åŒ–</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reading/mastering-spring-5/chapter-2">ä¾èµ–æ³¨å…¥</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reading/mastering-spring-5/chapter-3">ä½¿ç”¨Spring MVCæ„å»ºWebåº”ç”¨ç¨‹åº</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reading/zh.javascript.info">ç°ä»£ JavaScript æ•™ç¨‹</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reading/understanding-ecmascript-6">Understanding ECMAScript 6</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Docusaurus æ–‡æ¡£ç¿»è¯‘</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guides/intro">ç®€ä»‹</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guides/blog">åšå®¢</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guides/docs/markdown-features">Markdown ç‰¹æ€§</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guides/typescript-support">TypeScriptæ”¯æŒ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guides/api/client">Client API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guides/theme">ä¸»é¢˜</a></li></ul></li></ul></div><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_2WRA"><svg width="20" height="20" role="img" class="collapseSidebarButtonIcon_CoMu"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Remote procedure call (RPC)</h1></header><div class="markdown"><p><a href="http://www.rabbitmq.com/tutorials/tutorial-six-dotnet.html" target="_blank" rel="noopener noreferrer">è‹±æ–‡åŸæ–‡</a></p><p>åœ¨ç¬¬äºŒä¸ªæ•™ç¨‹é‡Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨å·¥ä½œé˜Ÿåˆ—åœ¨å¤šä¸ªå·¥ä½œè€…è¿›ç¨‹ä¹‹é—´åˆ†å‘è€—æ—¶ä»»åŠ¡ã€‚</p><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨è¿œç¨‹è®¡ç®—æœºä¸Šè¿è¡Œä¸€ä¸ªå‡½æ•°å¹¶ç­‰å¾…ç»“æœè¯¥å¦‚ä½•åšå‘¢ï¼Ÿå—¯ï¼Œè¿™ç§äº‹å®Œå…¨ä¸åŒçš„ä½¿ç”¨åœºæ™¯ã€‚è¿™ç§æ¨¡å¼é€šå¸¸è¢«ç§°ä½œè¿œç¨‹å¤„ç†è°ƒç”¨ï¼ˆRemote Procedure Callï¼‰æˆ–è€…ç®€ç§°RPCã€‚</p><p>åœ¨è¿™ä¸ªæ•™ç¨‹é‡Œæˆ‘ä»¬å°†ä¼šä½¿ç”¨RabbitMQå»ºç«‹RPCç³»ç»Ÿï¼šä¸€ä¸ªå®¢æˆ·ç«¯å’Œä¸€ä¸ªå¯ä¼¸ç¼©çš„RPCæœåŠ¡å™¨ã€‚å› ä¸ºæˆ‘ä»¬æ²¡æœ‰å€¼å¾—åˆ†å‘çš„è€—æ—¶ä»»åŠ¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä¼šåˆ›å»ºä¸€ä¸ªè¿”å›æ–æ³¢é‚£å¥‘æ•°çš„è™šæ‹ŸRPCæœåŠ¡ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="client-interface"></a>Client interface<a class="hash-link" href="#client-interface" title="Direct link to heading">#</a></h2><p>ä¸ºäº†å±•ç¤ºå¦‚ä½•ä½¿ç”¨ä¸€ä¸ªRPCæœåŠ¡æˆ‘ä»¬å°†ä¼šåˆ›å»ºä¸€ä¸ªç®€å•çš„å®¢æˆ·ç«¯ã€‚å®ƒå°†ä¼šæš´éœ²ä¸€ä¸ªåä¸ºcallçš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å‘é€ä¸€ä¸ªRPCè¯·æ±‚å¹¶ä¸”é˜»å¡ç›´åˆ°æ¥æ”¶åˆ°ç­”æ¡ˆï¼ˆå“åº”ï¼‰ï¼š</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">var rpcClient = new RPCClient();</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Console.WriteLine(&quot; [x] Requesting fib(30)&quot;);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">var response = rpcClient.Call(&quot;30&quot;);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Console.WriteLine(&quot; [.] Got &#x27;{0}&#x27;&quot;, response);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">rpcClient.Close();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Note:</p><p>è™½ç„¶RPCæ˜¯ä¸€ä¸ªç”¨äºè®¡ç®—çš„å¸¸è§æ¨¡å¼ï¼Œä½†å®ƒå¸¸å¸¸æ˜¯å±é™©çš„ã€‚å½“ä¸€ä¸ªç¨‹åºå‘˜æ²¡æœ‰æ„è¯†åˆ°å‡½æ•°è°ƒç”¨æ˜¯å¦æ˜¯æœ¬åœ°æ—¶æˆ–è€…æ˜¯ä¸€ä¸ªå¾ˆæ…¢çš„RPCè°ƒç”¨æ—¶é—®é¢˜å°±ä¼šäº§ç”Ÿã€‚</p><p>è§£å†³ä¸Šé¢çš„ç¼ºé™·ï¼Œè€ƒè™‘ä»¥ä¸‹å»ºè®®ï¼š</p><p>ææ˜ç™½å“ªä¸ªå‡½æ•°æ˜¯æœ¬åœ°è°ƒç”¨ï¼Œå“ªä¸€ä¸ªæ˜¯è¿œç¨‹è°ƒç”¨ã€‚</p><p>ç»„ç»‡ä½ çš„ç³»ç»Ÿã€‚è®©ç»„ä»¶ä¹‹é—´çš„ä¾èµ–ä¿æŒæ¸…æ™°ã€‚</p><p>é”™è¯¯å¤„ç†æƒ…å†µã€‚å½“RPCæœåŠ¡å™¨é•¿æ—¶é—´ç½¢å·¥å®¢æˆ·ç«¯åº”è¯¥æ€ä¹ˆååº”ï¼Ÿ</p><p>å½“ä¸Šè¿°é—®é¢˜ä¸æ¸…æ¥šæ—¶é¿å…ä½¿ç”¨RPCã€‚å¦‚æœä½ ææ˜ç™½äº†ï¼Œä½ åº”è¯¥ä½¿ç”¨ä¸€ä¸ªé˜»å¡çš„å¼‚æ­¥ç®¡é“å–ä»£RPCï¼Œç»“æœè¢«å¼‚æ­¥æ¨é€åˆ°ä¸‹ä¸€ä¸ªè®¡ç®—é˜¶æ®µã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="callback-queue"></a>Callback queue<a class="hash-link" href="#callback-queue" title="Direct link to heading">#</a></h2><p>é€šå¸¸é€šè¿‡RabbitMQæ‰§è¡ŒRPCè°ƒç”¨æ˜¯å®¹æ˜“çš„ã€‚ä¸€ä¸ªå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¯·æ±‚æ¶ˆæ¯ï¼ŒæœåŠ¡å™¨ç«¯å›å¤å“åº”æ¶ˆæ¯ã€‚ä¸ºäº†èƒ½å¤Ÿæ¥å—å“åº”æˆ‘ä»¬éœ€è¦å‘é€ä¸€ä¸ªå¸¦æœ‰â€œcallbackâ€é˜Ÿåˆ—åœ°å€çš„è¯·æ±‚ã€‚</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">var corrId = Guid.NewGuid().ToString();</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">var props = channel.CreateBasicProperties();</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">props.ReplyTo = replyQueueName;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">props.CorrelationId = corrId;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">var messageBytes = Encoding.UTF8.GetBytes(message);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">channel.BasicPublish(exchange: &quot;&quot;,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                     routingKey: &quot;rpc_queue&quot;,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                     basicProperties: props,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                     body: messageBytes);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">// ... then code to read a response message from the callback_queue ...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Note:
æ¶ˆæ¯å±æ€§</p><p>AMQPåè®®ç»™æ¶ˆæ¯é¢„å…ˆå®šä¹‰äº†14ä¸ªå±æ€§é›†ã€‚å¤§éƒ¨åˆ†æ¶ˆæš‘æå°‘ä½¿ç”¨ï¼Œä¸‹é¢å‡ ä¸ªä¾‹å¤–ï¼ˆä¸‹é¢å‡ ä¸ªå¸¸ç”¨ï¼‰ï¼š</p><p><code>deliveryMode</code>: ä½¿æ¶ˆæ¯æŒä¹…åŒ–ï¼ˆå€¼ä¸º2ï¼‰æˆ–è€…çŸ­æš‚çš„ï¼ˆå‘åå³å¿˜æ¨¡å¼ï¼Œå…¶ä»–ä»»æ„å€¼ï¼‰ã€‚ä½ ä¹Ÿè®¸è¿˜è®°å¾—ç¬¬äºŒä¸ªæ•™ç¨‹é‡Œæåˆ°çš„è¿™ä¸ªå±æ€§ã€‚</p><p><code>contentType</code>: ç”¨äºæè¿°ç¼–ç çš„mime-typeã€‚æ¯”å¦‚å¯¹äºå¸¸ç”¨çš„JSONç¼–ç è®¾ç½®å±æ€§å€¼ä¸ºapplication/jsonæ˜¯ä¸€ä¸ªå¥½çš„å®è·µã€‚</p><p><code>replyTo</code>: ä¸€èˆ¬ç”¨äºå‘½åå›è°ƒé˜Ÿåˆ—ã€‚</p><p><code>correlationId</code>: å¸¸ç”¨äºå…³è”RPCè¯·æ±‚ç­‰å¾…å“åº”ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="correlation-id"></a>Correlation Id<a class="hash-link" href="#correlation-id" title="Direct link to heading">#</a></h2><p>åœ¨ä¸Šé¢å‘é€è¯·æ±‚ä¹‹å‰çš„æ–¹æ³•é‡Œï¼Œæˆ‘ä»¬å»ºè®®ä¸ºæ¯ä¸€ä¸ªRPCè¯·æ±‚åˆ›å»ºä¸€ä¸ªå›è°ƒé˜Ÿåˆ—ã€‚é‚£æ˜¯éå¸¸ä½æ•ˆçš„ã€‚å¹¸è¿çš„æ˜¯æœ‰ä¸€ä¸ªæ›´å¥½çš„åŠæ³•ï¼šè®©æˆ‘ä»¬åˆ›å»ºå•ä¸ªå›è°ƒé˜Ÿåˆ—æ¯å®¢æˆ·ç«¯ã€‚</p><p>è¿™ä¼šäº§ç”Ÿæ–°çš„é—®é¢˜ï¼Œå“åº”ä¸æ¸…æ¥šæ˜¯å“ªä¸ªé˜Ÿåˆ—å‘å‡ºçš„è¯·æ±‚ã€‚è¿™æ—¶å€™éœ€è¦ä½¿ç”¨correlationIdå±æ€§ã€‚æˆ‘ä»¬æ‰“ç®—æŠŠæ¯ä¸ªè¯·æ±‚çš„correlationIdè®¾ç½®æˆå”¯ä¸€å€¼ã€‚ä¹‹åï¼Œæˆ‘ä»¬åœ¨å›è°ƒé˜Ÿåˆ—é‡Œæ¥æ”¶ä¸€æ¡æ¶ˆæ¯ï¼Œæˆ‘ä»¬å°†ä¼šæŸ¥çœ‹è¿™ä¸ªå±æ€§ï¼Œç„¶ååŸºäºè¿™ä¸ªå±æ€§æˆ‘ä»¬èƒ½å¤ŸåŒ¹é…è¿™ä¸ªè¯·æ±‚çš„å“åº”ã€‚å¦‚æœæˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ªä½ç½®çš„correlationIdå€¼ï¼Œæˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°ä¸¢å¼ƒæ¶ˆæ¯ï¼Œè¿™æ¡æ¶ˆæ¯ä¸å±äºæˆ‘ä»¬çš„è¯·æ±‚ã€‚</p><p>You may ask, why should we ignore unknown messages in the callback queue, rather than failing with an error? It&#x27;s due to a possibility of a race condition on the server side. Although unlikely, it is possible that the RPC server will die just after sending us the answer, but before sending an acknowledgment message for the request. If that happens, the restarted RPC server will process the request again. That&#x27;s why on the client we must handle the duplicate responses gracefully, and the RPC should ideally be idempotent. ä½ ä¹Ÿè®¸ä¼šé—®ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨å›è°ƒé˜Ÿåˆ—é‡Œå¿½ç•¥æœªçŸ¥æ¶ˆæ¯ï¼Œè€Œä¸æ˜¯å¼•å‘ä¸€ä¸ªé”™è¯¯ç„¶åå¤±è´¥ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="summary"></a>Summary<a class="hash-link" href="#summary" title="Direct link to heading">#</a></h2><p><img src="http://www.rabbitmq.com/img/tutorials/python-six.png" alt="summary"></p><p>æˆ‘ä»¬çš„RPCåƒè¿™æ ·å·¥ä½œï¼š</p><p>å½“æˆ‘ä»¬çš„å®¢æˆ·ç«¯å¯åŠ¨æ—¶ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªåŒ¿åæ’ä»–çš„å›è°ƒé˜Ÿåˆ—ã€‚ </p><p>å¯¹äºæ¯ä¸€ä¸ªRPCè¯·æ±‚ï¼Œå®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯éƒ½å¸¦æœ‰ä¸¤ä¸ªå±æ€§ï¼šreplayToï¼Œç”¨æ¥æ ‡è¯†å›è°ƒé˜Ÿåˆ—ï¼ŒcorrelationIdï¼Œä¸ºæ¯ä¸€æ¬¡è¯·æ±‚è®¾ç½®å”¯ä¸€æ ‡è¯†ã€‚</p><p>è¯·æ±‚è¢«å‘é€åˆ°ä¸€ä¸ª<code>rpc_queue</code>é˜Ÿåˆ—ã€‚</p><p>RPCå·¥ä½œçº¿ç¨‹ï¼ˆä¹Ÿç§°ä½œæœåŠ¡å™¨ï¼‰ç­‰å¾…é‚£ä¸ªé˜Ÿåˆ—ï¼ˆrpc_queueï¼‰çš„è¯·æ±‚ã€‚å½“è¯·æ±‚å‡ºç°ï¼ŒRPCå·¥ä½œçº¿ç¨‹å¼€å§‹æ‰§è¡Œä½œä¸šå¹¶ä¸”æŠŠä½œä¸šçš„ç»“æœä»¥æ¶ˆæ¯çš„å½¢å¼ä½¿ç”¨replyToå­—æ®µå‘å›å®¢æˆ·ç«¯ï¼Œ</p><p>å®¢æˆ·ç«¯åœ¨å›è°ƒé˜Ÿåˆ—é‡Œç­‰å¾…æ•°æ®ã€‚å½“æ¶ˆæ¯å‡ºç°ï¼Œå®¢æˆ·ç«¯æ£€æŸ¥<code>correlationId</code>å±æ€§ã€‚å¦‚æœè¿™ä¸ªå±æ€§å€¼å’Œè¯·æ±‚é‡Œçš„å€¼åŒ¹é…ï¼Œå®ƒå°±ä¼šæŠŠè¿™ä¸ªå“åº”è¿”å›ç»™åº”ç”¨ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="putting-it-all-together"></a>Putting it all together<a class="hash-link" href="#putting-it-all-together" title="Direct link to heading">#</a></h2><p>æ–æ³¢é‚£å¥‘ä»»åŠ¡:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">private static int fib(int n)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">{</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    if (n == 0 || n == 1) return n;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    return fib(n - 1) + fib(n - 2);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>æˆ‘ä»¬å£°æ˜æˆ‘ä»¬çš„æ–æ³¢é‚£å¥‘å‡½æ•°ã€‚å‡è®¾åªæœ‰æ­£æ•´æ•°æœ‰æ•ˆã€‚ï¼ˆä¸è¦è¿™ä¸ªå‡½æ•°å¯¹å¤§æ•°èƒ½å·¥ä½œï¼Œè¿™å¯èƒ½æ˜¯æœ€æ…¢çš„é€’å½’å®ç°ï¼‰ã€‚</p><p> RPC serverçš„ä»£ç å¦‚ä¸‹ï¼š</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">using System;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">using RabbitMQ.Client;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">using RabbitMQ.Client.Events;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">using System.Text;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">class RPCServer</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">{</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    public static void Main()</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        var factory = new ConnectionFactory() { HostName = &quot;localhost&quot; };</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        using(var connection = factory.CreateConnection())</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        using(var channel = connection.CreateModel())</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            channel.QueueDeclare(queue: &quot;rpc_queue&quot;,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                                 durable: false,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                                 exclusive: false,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                                 autoDelete: false,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                                 arguments: null);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            channel.BasicQos(0, 1, false);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            var consumer = new QueueingBasicConsumer(channel);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            channel.BasicConsume(queue: &quot;rpc_queue&quot;,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                                 noAck: false,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                                 consumer: consumer);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            Console.WriteLine(&quot; [x] Awaiting RPC requests&quot;);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            while(true)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                string response = null;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                var ea = (BasicDeliverEventArgs)consumer.Queue.Dequeue();</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                var body = ea.Body;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                var props = ea.BasicProperties;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                var replyProps = channel.CreateBasicProperties();</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                replyProps.CorrelationId = props.CorrelationId;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                try</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    var message = Encoding.UTF8.GetString(body);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    int n = int.Parse(message);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    Console.WriteLine(&quot; [.] fib({0})&quot;, message);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    response = fib(n).ToString();</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                catch(Exception e)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    Console.WriteLine(&quot; [.] &quot; + e.Message);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    response = &quot;&quot;;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                finally</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    var responseBytes = Encoding.UTF8.GetBytes(response);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    channel.BasicPublish(exchange: &quot;&quot;,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                                         routingKey: props.ReplyTo,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                                         basicProperties: replyProps,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                                         body: responseBytes);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                    channel.BasicAck(deliveryTag: ea.DeliveryTag,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                                     multiple: false);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    /// &lt;summary&gt;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    /// Assumes only valid positive integer input.</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    /// Don&#x27;t expect this one to work for big numbers,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    /// and it&#x27;s probably the slowest recursive implementation possible.</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    /// &lt;/summary&gt;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    private static int fib(int n)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        if(n == 0 || n == 1)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            return n;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        return fib(n - 1) + fib(n - 2);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">} </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>æœåŠ¡å™¨ç«¯ä»£ç æ›´ç®€å•æ˜äº†ï¼š</p><p>é€šå¸¸æˆ‘å¼€å§‹å…ˆå»ºç«‹è¿æ¥ï¼Œé€šé“å’Œå£°æ˜é˜Ÿåˆ—ã€‚</p><p>æˆ‘ä»¬ä¹Ÿè®¸æƒ³è¿è¡Œæ›´å¤šçš„æœåŠ¡å™¨æ¥å¤„ç†ã€‚ä¸ºäº†åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Šè´Ÿè½½å‡è¡¡æˆ‘ä»¬éœ€è¦è®¾ç½®<code>channel.basicQos</code>çš„<code>preferchCount</code>ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨<code>basicConsume</code>æ¥è®¿é—®é˜Ÿåˆ—ã€‚ç„¶åä¸ºäº†ç­‰å¾…è¯·æ±‚æ¶ˆæ¯æˆ‘ä»¬è¿›å…¥whileå¾ªç¯ï¼Œæ‰§è¡Œå·¥ä½œå¹¶å‘é€å“åº”ã€‚</p><p>RPCå®¢æˆ·ç«¯ä»£ç å¦‚ä¸‹ï¼š</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">using System;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">using System.Collections.Generic;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">using System.Linq;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">using System.Text;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">using System.Threading.Tasks;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">using RabbitMQ.Client;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">using RabbitMQ.Client.Events;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">class RPCClient</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">{</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    private IConnection connection;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    private IModel channel;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    private string replyQueueName;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    private QueueingBasicConsumer consumer;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    public RPCClient()</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        var factory = new ConnectionFactory() { HostName = &quot;localhost&quot; };</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        connection = factory.CreateConnection();</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        channel = connection.CreateModel();</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        replyQueueName = channel.QueueDeclare().QueueName;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        consumer = new QueueingBasicConsumer(channel);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        channel.BasicConsume(queue: replyQueueName,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                             noAck: true,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                             consumer: consumer);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    public string Call(string message)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        var corrId = Guid.NewGuid().ToString();</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        var props = channel.CreateBasicProperties();</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        props.ReplyTo = replyQueueName;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        props.CorrelationId = corrId;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        var messageBytes = Encoding.UTF8.GetBytes(message);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        channel.BasicPublish(exchange: &quot;&quot;,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                             routingKey: &quot;rpc_queue&quot;,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                             basicProperties: props,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                             body: messageBytes);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        while(true)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            var ea = (BasicDeliverEventArgs)consumer.Queue.Dequeue();</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            if(ea.BasicProperties.CorrelationId == corrId)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                return Encoding.UTF8.GetString(ea.Body);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    public void Close()</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        connection.Close();</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">class RPC</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">{</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    public static void Main()</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        var rpcClient = new RPCClient();</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        Console.WriteLine(&quot; [x] Requesting fib(30)&quot;);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        var response = rpcClient.Call(&quot;30&quot;);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        Console.WriteLine(&quot; [.] Got &#x27;{0}&#x27;&quot;, response);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        rpcClient.Close();</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>å®¢æˆ·ç«¯ä»£ç æ¶‰åŠäº†ç¨å¾®å¤šä¸€äº›ï¼š</p><p>æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªè¿æ¥å’Œä¸€ä¸ªé€šé“å¹¶ä¸”å£°æ˜ä¸€ä¸ªæ’ä»–çš„å›è°ƒé˜Ÿåˆ—ç”¨äºå›å¤ã€‚</p><p>æˆ‘ä»¬è®¢é˜…äº†å›è°ƒé˜Ÿåˆ—ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½å¤Ÿæ¥æ”¶RPCå“åº”</p><p>æˆ‘ä»¬çš„callæ–¹æ³•æ‰§è¡Œå®é™…çš„RPCè¯·æ±‚ã€‚</p><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é¦–å…ˆå£°ç§°ä¸€ä¸ªå”¯ä¸€çš„<code>correlationId</code>æ•°å¹¶ä¿å­˜å®ƒï¼Œåœ¨whileå¾ªç¯é‡Œå°†ä¼šä½¿ç”¨è¿™ä¸ªå€¼æ•è·åˆé€‚çš„å“åº”ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å‘å¸ƒè¯·æ±‚æ¶ˆæ¯ï¼Œå¹¶å¸¦æœ‰replayToå’ŒcorrelationIdä¸¤ä¸ªå±æ€§ã€‚</p><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥åä¸‹æ¥ç„¶åç­‰å¾…ç›´åˆ°åˆé€‚çš„å“åº”åˆ°è¾¾ã€‚</p><p>whileå¾ªç¯åšçš„äº‹æƒ…å¾ˆç®€å•ï¼Œå¯¹äºæ¯ä¸€ä¸ªå“åº”æ¶ˆæ¯å®ƒï¼ˆè¿™whileå¾ªç¯é‚£æ®µä»£ç ï¼‰éƒ½æ£€æŸ¥correlationIdæ˜¯å¦æ˜¯æˆ‘ä»¬æŸ¥æ‰¾çš„é‚£ä¸ªã€‚å¦‚æœæ˜¯ï¼Œå®ƒä¼šä¿å­˜å“åº”ã€‚æœ€ç»ˆæˆ‘ä»¬ç»™ç”¨æˆ·è¿”å›å“åº”ã€‚</p><p>æ‰§è¡Œå®¢æˆ·ç«¯è¯·æ±‚ï¼š</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">RPCClient fibonacciRpc = new RPCClient();</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">System.out.println(&quot; [x] Requesting fib(30)&quot;);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">String response = fibonacciRpc.call(&quot;30&quot;);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">System.out.println(&quot; [.] Got &#x27;&quot; + response + &quot;&#x27;&quot;);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">fibonacciRpc.close();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>ç°åœ¨æ˜¯æ—¶å€™æŸ¥çœ‹æˆ‘ä»¬å®Œæ•´çš„ä¾‹å­æºç äº†ï¼ˆåŒ…æ‹¬åŸºæœ¬çš„å¼‚å¸¸å¤„ç†ï¼‰ï¼šRPCClient.cså’ŒRPCServer.csã€‚</p><p>åƒå¾€å¸¸ä¸€æ ·ç¼–è¯‘ï¼š</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ csc /r:&quot;RabbitMQ.Client.dll&quot; RPCClient.cs</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ csc /r:&quot;RabbitMQ.Client.dll&quot; RPCServer.cs</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>æˆ‘ä»¬çš„RPCæœåŠ¡å·²ç»å‡†å¤‡å¥½äº†ã€‚æˆ‘ä»¬å¯ä»¥å¯åŠ¨æœåŠ¡å™¨äº†ï¼š</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ RPCServer.exe</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> [x] Awaiting RPC requests</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>è¿è¡Œä¸‹é¢å®¢æˆ·ç«¯è¯·æ±‚ä¸€ä¸ªæ–æ³¢é‚£å¥‘æ•°ï¼š</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ RPCClient.exe</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> [x] Requesting fib(30)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>ç›®å‰è¿™é‡Œçš„è®¾è®¡ä¸æ˜¯ä¸€ä¸ªRPCæœåŠ¡å”¯ä¸€å¯èƒ½çš„å®ç°ï¼Œä½†æ˜¯å®ƒç»™å‡ºäº†ä¸€äº›é‡è¦çš„å»ºè®®ï¼š</p><p>å¦‚æœRPCæœåŠ¡å™¨å¾ˆæ…¢ï¼Œä½ å¯ä»¥è¿è¡Œä¸€ä¸ªæ–°çš„RPCæœåŠ¡å™¨ã€‚è¯•ç€åœ¨ä¸€ä¸ªæ–°çš„æ§åˆ¶å°è¿è¡Œç¬¬äºŒä¸ªRPCServerã€‚</p><p>åœ¨å®¢æˆ·ç«¯ï¼ŒRPCè¦æ±‚å®¢æˆ·ç«¯åªèƒ½å‘é€å’Œæ¥æ”¶ä¸€æ¡æ¶ˆæ¯ã€‚æ²¡æœ‰è¦æ±‚åƒqueueDeclareçš„åŒæ­¥è°ƒç”¨ã€‚å¯¹äºå•ä¸ªRPCè¯·æ±‚ï¼ŒRPCå®¢æˆ·ç«¯åªéœ€è¦ä¸€æ¬¡ç½‘ç»œæ¥å›å°±å¯ä»¥å¾—åˆ°ç»“æœã€‚</p><p>ç›®å‰æˆ‘ä»¬çš„ä»£ç è¿˜æ˜¯éå¸¸ç®€å•ï¼Œè€Œä¸”æ²¡æœ‰å°è¯•è§£å†³æ›´å¤æ‚ï¼ˆä½†æ›´é‡è¦ï¼‰çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼š</p><p>å¦‚æœæ²¡æœ‰è¿è¡Œçš„æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯åº”è¯¥å¦‚ä½•ååº”ï¼Ÿ</p><p>å¯¹äºRPCï¼Œå®¢æˆ·ç«¯æ˜¯å¦åº”è¯¥æœ‰æŸäº›ç±»å‹çš„è¶…æ—¶ï¼Ÿ</p><p>å¦‚æœæœåŠ¡å™¨å‘ç”Ÿæ•…éšœæˆ–è€…æŠ›å‡ºå¼‚å¸¸ï¼Œåº”è¯¥æŠŠå®ƒè½¬å‘åˆ°å®¢æˆ·ç«¯å—ï¼Ÿ</p><p>åœ¨å¤„ç†ä¹‹å‰é˜»æ­¢æ— æ•ˆå…¥ç«™æ¶ˆæ¯ï¼ˆæ¯”å¦‚æ£€æŸ¥é™åˆ¶ï¼Œç±»å‹ï¼‰</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/articles/rabbitmq-guide/5-Topic"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Topics</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/articles/okhttp-guide/1-overview"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">æ¦‚è¿° Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#client-interface" class="table-of-contents__link">Client interface</a></li><li><a href="#callback-queue" class="table-of-contents__link">Callback queue</a></li><li><a href="#correlation-id" class="table-of-contents__link">Correlation Id</a></li><li><a href="#summary" class="table-of-contents__link">Summary</a></li><li><a href="#putting-it-all-together" class="table-of-contents__link">Putting it all together</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">æ–‡ç« åˆ—è¡¨</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/articles/es6-in-depth/0-introduction">æ·±å…¥æµ…å‡ºES6 - InfoQ.cn</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/articles/why-java-sucks-and-csharp-rocks/1-compare-purpose">Why Java Sucks and C# Rocks - èµµåŠ¼</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/reading">é˜…è¯»ç¬”è®°</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/archives/git-guides">åšæ–‡å½’æ¡£</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">æ–‡æ¡£ç¿»è¯‘</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/docs/guides/blog">Docusaurus Blog</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/docs/guides/docs/markdown-features">Docusaurus Markdown</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">æ›´å¤š</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/alanwei43/node-auto-update" target="_blank" rel="noopener noreferrer" class="footer__link-item">node-auto-update - GitHub</a></li><li class="footer__item"><a href="https://github.com/alanwei43/docker-puppeteer" target="_blank" rel="noopener noreferrer" class="footer__link-item">docker-puppeteer - GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Alan's Blog</div></div></div></footer><div class="youPai_2rSg"><a href="https://www.upyun.com/?utm_source=lianmeng&amp;utm_medium=referral" target="_blank">æœ¬ç½‘ç«™ç”±<img src="https://gitee.com/alanway/resources/raw/master/images/youpai-logo.png">æä¾›CDNåŠ é€Ÿ/äº‘å­˜å‚¨æœåŠ¡</a></div></div></div>
<script src="/styles.9ca389b8.js"></script>
<script src="/runtime~main.bce1c40f.js"></script>
<script src="/main.985e31c1.js"></script>
<script src="/1.a307ce8b.js"></script>
<script src="/2.29f05d6f.js"></script>
<script src="/3.eacda5b5.js"></script>
<script src="/1be78505.adae09cb.js"></script>
<script src="/337.b9b65b77.js"></script>
<script src="/935f2afb.d3dbf78d.js"></script>
<script src="/17896441.921438d2.js"></script>
<script src="/f894a538.c53d91f7.js"></script>
</body>
</html>